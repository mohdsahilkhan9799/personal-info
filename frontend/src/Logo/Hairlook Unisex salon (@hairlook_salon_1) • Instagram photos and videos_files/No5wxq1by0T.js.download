;/*FB_PKG_DELIM*/

__d("ACTSanitizerApiLazyLoader",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=512*1024;function a(){h==null&&(h=j());var a=h;void a.then(function(a){a=a.getWasmMemorySize();a!=null&&a>=i&&(h=j())});return a}function j(){return c("JSResourceForInteraction")("ACTSanitizerApiWasm").__setRef("ACTSanitizerApiLazyLoader").load().then(function(a){return a.ACTSanitizerWasm()})}g.loadACTSanitizerApi=a}),98);
__d("ArmadilloTaskHandlers",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";b={add:(a=c("JSResourceForInteraction"))("AddTaskHandler").__setRef("ArmadilloTaskHandlers"),get_messenger_db_dump_attachments_for_bug_reporting:a("GetMessengerDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),maw_get_devices:a("MAWGetDevicesTaskHandler").__setRef("ArmadilloTaskHandlers"),preload_messenger_db_dump_attachments_for_bug_reporting:a("PreloadDBDumpAttachments").__setRef("ArmadilloTaskHandlers"),test:a("TestNativeTaskHandler").__setRef("ArmadilloTaskHandlers"),zenon_send_chatd_mws_message:a("MAWZenonSendMultiwayMsgChatdTaskHandler").__setRef("ArmadilloTaskHandlers")};g.TASK_HANDLERS_RESOURCES=b}),98);
__d("BroadcastChannelClientServerHandshake",["FBLogger","Promise","Random","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a.addEventListener("message",function(b){var c;((c=b.data)==null?void 0:c.type)==="BroadcastChannelHandshake-syn"&&a.postMessage({nonce:b.data.nonce,type:"BroadcastChannelHandshake-syn-ack"})})}function e(a,e){var f=d("Random").random(),g=0;return new(h||(h=b("Promise")))(function(b,d){var h=!1,i=function b(){if(g===6){h=!0;a.removeEventListener("message",j);try{throw c("FBLogger")("ls_web_init").mustfixThrow("BC handshake failed, failing, likely worker failure%s",e!=null?" for"+e:"")}catch(a){d(a)}return}if(h)return;a.postMessage({nonce:f,type:"BroadcastChannelHandshake-syn"});c("setTimeout")(b,100*Math.pow(2,g++))},j=function c(d){var e;((e=d.data)==null?void 0:e.type)==="BroadcastChannelHandshake-syn-ack"&&((e=d.data)==null?void 0:e.nonce)===f&&(b(),h=!0,a.removeEventListener("message",c))};a.addEventListener("message",j);i()})}g.listen=a;g.checkAlive=e}),98);
__d("CometTaskFrameworkTypes",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["UNKNOWN","BACKGROUND","CURRENT_THREAD","LS_WORKER","MAW_WORKER","TEST"]);c="comet_task_framework";f.ExecutionContext=a;f.TASK_FRAMEWORK_PREFIX=c}),66);
__d("InstamadilloTaskHandlers",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";b={33:(a=c("JSResourceForInteraction"))("IGDUnsendMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),46:a("IGDSendMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_edit_message:a("IGDEditMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_react_message:a("IGDSendRemoveReactionTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_send_media_message:a("IGDSendMediaMessageTaskHandler").__setRef("InstamadilloTaskHandlers"),igd_send_xma_receiver_fetch:a("IGDSendXmaReceiverFetchTaskHandler").__setRef("InstamadilloTaskHandlers")};g.TASK_HANDLERS_RESOURCES=b}),98);
__d("CometTaskHandlers",["ArmadilloTaskHandlers","InstamadilloTaskHandlers"],(function(a,b,c,d,e,f,g){"use strict";a=babelHelpers["extends"]({},d("ArmadilloTaskHandlers").TASK_HANDLERS_RESOURCES,d("InstamadilloTaskHandlers").TASK_HANDLERS_RESOURCES);g.TASK_HANDLERS_RESOURCES=a}),98);
__d("WorkerBootstrap",["HasteSupportData","ServerJSDefine"],(function(a,b,c,d,e,f,g){"use strict";function h(a){Object.keys(a).forEach(function(b){c("ServerJSDefine").handleDefine(b,[],a[b],-1,null)})}function a(a,c){var f,g;a.hsdp&&d("HasteSupportData").handle(a.hsdp);var i=(f=(g=a.jsmods)!=null?g:a.dynamicModules)!=null?f:{};h(i);var j=b.call(null,c);a.rds!=null&&a.rds.length>0&&e.call(null,a.rds,function(){});if(typeof j==="function"||j!==null)try{for(var k=arguments.length,l=new Array(k>2?k-2:0),m=2;m<k;m++)l[m-2]=arguments[m];j.apply(void 0,l)}catch(a){}}function f(a){a=a;if(typeof a==="function"||a!==null)try{a()}catch(a){}}g.initDynamicModules=h;g.start=a;g.startServerJS=f}),98);
__d("CurrentSharedWorker",["HasteSupportData","QPLUserFlow","SharedWorkerStatusLock","WorkerBootstrap","emptyFunction","err","qpl","structuredClone"],(function(a,b,c,d,e,f,g){"use strict";var h=null,i=[],j=new Set(),k=[],l=!1,m=!1,n=null,o=!1,p=c("qpl")._(931609794,"2369");c("QPLUserFlow").start(p);var q=d("SharedWorkerStatusLock").getStatusLock({});c("QPLUserFlow").addPoint(p,"status_lock");c("QPLUserFlow").addAnnotations(p,{string:{id:self.worker_id}});self.setTimeout(function(){if(!o){try{var a;(a=j.values().next().value)==null?void 0:a.postMessage({type:"self-terminate",response:{from:"bundle",workerID:self.worker_id}})}catch(a){c("QPLUserFlow").endFailure(p,"timeout_termination_error"),x(a)}self.close()}},3e5);function r(){m=!0,n=null,h!==null&&(c("QPLUserFlow").addPoint(p,"process_message_buffer"),c("QPLUserFlow").addAnnotations(p,{"int":{message_buffer_size:i.length}}),i.forEach(function(a){return a()}),i=[]),c("QPLUserFlow").endSuccess(p)}function s(a,f){var g=a.data;if(typeof g==="object"&&(g==null?void 0:g.type)==="execute-worker"){var k=!l;try{if(!l&&g.args instanceof Array){var t=g.args[0],u=t.hsdp,v=t.jsmods,w=t.dynamicModules;t=t.rds;c("QPLUserFlow").addPoint(p,"first_init");u!=null&&d("HasteSupportData").handle(u);d("WorkerBootstrap").initDynamicModules((v=(u=v)!=null?u:w)!=null?v:{});t!=null&&t.length>0&&e.call(null,t,function(){});q.init();c("QPLUserFlow").addPoint(p,"status_lock_init");l=!0;n!=null&&(n(),r())}u=b.call(b,"SiteData");j.size>1&&f.postMessage({type:"execute-worker-imports",response:{}});f.postMessage({type:"execute-worker-ack",response:{firstInit:k,workerRevision:u.client_revision,spinMode:u.spin,spinTime:u.__spin_t}});o=!0}catch(a){c("QPLUserFlow").endFailure(p,"worker_init_error"),q.release(),f.postMessage({type:"execute-worker-ack",response:{firstInit:k,error:a.message}}),self.close()}}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-get-rev")try{w=b.call(b,"SiteData");f.postMessage({type:"sw-get-rev",response:{workerRevision:w.client_revision,spinMode:w.spin,spinTime:w.__spin_t}})}catch(a){f.postMessage({type:"sw-get-rev",response:{error:a.message}})}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-shutdown"){v=Array.isArray(g.args)?g.args[0]:null;typeof v==="object"&&(v==null?void 0:v.upgrade)===!0?y("requested-upgrade"):typeof v==="object"&&typeof (v==null?void 0:v.reason)==="string"?y(v==null?void 0:v.reason):y()}else if(typeof g==="object"&&(g==null?void 0:g.type)==="sw-uptime-tracking"){u=typeof (g==null?void 0:g.args)==="object"?(t=g.args)==null?void 0:t.trackerID:null;f.postMessage({type:"sw-uptime-tracking",response:{trackerID:u}})}else typeof g==="object"&&(g==null?void 0:g.type)==="ww-hrp-init"?f.postMessage({type:"ww-hrp-init",response:{}}):typeof g==="object"&&(g==null?void 0:g.type)==="ww-connection-ack"?f.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id}}):h!==null&&m?h(g):i.push(function(){return s(a,f)})}function a(a){var b=h==null;h=(a=a)!=null?a:c("emptyFunction");b&&m&&(i.forEach(function(a){return a()}),i=[])}function t(a,b){j.forEach(function(c){try{c.postMessage(a,b)}catch(b){c.postMessage(a)}})}function f(a){if(l){c("QPLUserFlow").addPoint(p,"init_complete_handler_ran");a();r();return}c("QPLUserFlow").addPoint(p,"init_complete_handler_attached");n=a}["log","error","info","debug","warn"].forEach(function(a){if(self.console[a]==null)throw c("err")('"'+a+'" is not a valid console method.');var b=self.console[a];self.console[a]=function(){for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];b.apply(void 0,e);var g=!1;try{c("structuredClone")!=null&&c("structuredClone")(e),g=!0}catch(a){}if(!g){t({type:"console",response:{method:"error",args:["DataCloneError: Failed to forward console message from web worker due to args not being serializable."]}});return}t({type:"console",response:{method:a,args:e}})}});try{c("QPLUserFlow").addPoint(p,"bootstrap_start");var u=self.shared_worker_bootstrap_buffer==null?void 0:self.shared_worker_bootstrap_buffer();if(u!=null){var v=u.ports,w=u.messages;c("QPLUserFlow").addAnnotations(p,{"int":{bootstrap_ports_num:v.length}});v==null?void 0:v.forEach(function(a){try{a.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id}}),a.addEventListener("message",function(b){return s(b,a)}),j.add(a)}catch(a){c("QPLUserFlow").addPoint(p,"connection_fail"),x(a)}});w==null?void 0:w.forEach(function(a){try{s(a.e,a.port)}catch(b){c("QPLUserFlow").addPoint(p,"message_processing_fail");c("QPLUserFlow").addAnnotations(p,{string:{failed_msg_type:(a=(a=a.e.data)==null?void 0:a.type)!=null?a:"unknown"}});x(b)}c("QPLUserFlow").addAnnotations(p,{"int":{msg_num:w.length},string_array:{msgs:w.map(function(a){return(a=a.e.data)==null?void 0:a.type})}})})}else c("QPLUserFlow").addPoint(p,"bootstrap_buffer_empty")}catch(a){x(a),c("QPLUserFlow").endFailure(p,"uncaught_bootstrap_error")}function x(a){try{t({type:"sw-uncaught-error",e:{message:a.message,lineno:a.lineno,colno:a.colno,filename:a.filename,error:a.error}})}catch(b){c("QPLUserFlow").addPoint(p,"sending_error_failed");c("QPLUserFlow").addAnnotations(p,{string:{error:String((a=b.message)!=null?a:b)}})}}self.addEventListener("error",function(a){if(j.size===0){k.push(a);return}x(a)});self.addEventListener("connect",function(a){var b=a.ports[0];b.postMessage({type:"connection-ack",response:{from:"bundle",workerID:self.worker_id}});b.addEventListener("message",function(a){return s(a,b)});b.start();j.add(b);k.length>0&&(k.forEach(x),k.splice(0,k.length))});function y(a){q.release(),t({type:"sw-shutdown",response:{reason:a,workerID:self.worker_id,isInitialized:o}}),self.close()}g.setMessageHandler=a;g.postMessage=t;g.onInitComplete=f;g.shutdownWorker=y}),98);
__d("CurrentSharedWorkerAdapter",["CurrentSharedWorker","FBLogger"],(function(a,b,c,d,e,f,g){a=function(){function a(){}var b=a.prototype;b.addEventListener=function(a,b,e){switch(a){case"message":d("CurrentSharedWorker").setMessageHandler(function(a){return b({data:a})});break;case"error":break;default:c("FBLogger")("worker").mustfix("Unexpected message type %",a)}};b.removeEventListener=function(a,b,e){switch(a){case"message":d("CurrentSharedWorker").setMessageHandler(null);break;case"error":break;default:c("FBLogger")("worker").mustfix("Unexpected message type %",a)}};b.postMessage=function(a,b){d("CurrentSharedWorker").postMessage(a,b)};return a}();g.CurrentSharedWorkerAdapter=a}),98);
__d("CurrentWorkerMessagePort",["err","ifRequired"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function a(){if(h==null)if("SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope){var a;h=(a=c("ifRequired")("SharedWorkerBootstrapExperimental",function(a){return new a.CurrentSharedWorkerExperimentalAdapter()},function(){return null}))!=null?a:c("ifRequired")("CurrentSharedWorkerAdapter",function(a){return new a.CurrentSharedWorkerAdapter()},function(){return null})}else if("DedicatedWorkerGlobalScope"in self&&self instanceof self.DedicatedWorkerGlobalScope)h=self;else throw new Error("CurrentWorkerAdapter: Unsupported worker type");if(h==null)throw c("err")("CurrentWorkerAdapter: None of shared worker adapters are available");return h}g.getMessagePort=a}),98);
__d("EBLSDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("EBLS").__setRef("EBLSDeferred");function a(){return h.load().then(function(a){return a.init()})}function b(){return h.load().then(function(a){return a.genLSClient()})}function d(){return h.load().then(function(a){return a.getLSStorage()})}function e(a,b,c){return h.load().then(function(d){return d.platformClientInit(a,b,c)})}g.init=a;g.genLSClient=b;g.getLSStorage=d;g.platformClientInit=e}),98);
__d("WAGetIdentityKeys",["MAWTransactionMode","WADbSignal","WADbTransactor","WALogger","WASignalKeys","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] ",""]);h=function(){return a};return a}var i="IdentityKey was null";a=d("WADbTransactor").makeSignalTransactor({meta:d("MAWTransactionMode").READONLY},"getIdentityKeys",function(a){return function(){return a.meta.get(d("WADbSignal").MetaKeysEnum.identityKeyPair).then(function(a){a=a==null?void 0:a.value.identityKeyPair;if(a==null){d("WALogger").ERROR(h(),i);throw c("err")(i)}var b=d("WASignalKeys").serializePubKey(a);a=a.privateKey;return{identityPrivateKey:a,identityPublicKey:b}})}});g.errNullKey=i;g.getIdentityKeys=a}),98);
__d("WAGetLocalPublicPrivateIdentityKeyApiV2",["WADbSignal","WALogger","WASignalDB","WASignalKeys","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);h=function(){return a};return a}a=function(){return d("WASignalDB").getDb().runInTransaction(["meta"],"readonly",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a=(yield a.stores.meta.get(d("WADbSignal").MetaKeysEnum.identityKeyPair));if((a==null?void 0:(b=a.value)==null?void 0:b.identityKeyPair)==null){b="[Remote Presence Error] Identity key pair was null";d("WALogger").ERROR(h(),b);throw c("err")(b)}return d("WASignalKeys").toSerializedKeyPair(a.value.identityKeyPair)});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("getLocalPublicPrivateIdentityKey"))};g.getLocalPublicPrivateIdentityKey=a}),98);
__d("EBWorkerAddDeviceUtils",["LSMetadata","LSReStoreWrapper","MAWLSVaultingHooks","MWSetupEBStateDB","Promise","WADexieToWormMigration","WAGetIdentityKeys","WAGetLocalPublicPrivateIdentityKeyApiV2","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(d("WADexieToWormMigration").isWorm("MAWBridgeHandlers.getIdentityKeys")){var a=(yield d("WAGetLocalPublicPrivateIdentityKeyApiV2").getLocalPublicPrivateIdentityKey()),b=a.privateKey;a=a.serializedPubKey;return{identityPrivateKey:b,identityPublicKey:a}}return d("WAGetIdentityKeys").getIdentityKeys()});return i.apply(this,arguments)}function e(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var g=(yield d("MWSetupEBStateDB").makeEBStateDB(!0,!1,!1));if(g==null)throw c("err")("persistence is null");g=d("LSReStoreWrapper").createLSReStore(g,d("LSMetadata").schema,[c("MAWLSVaultingHooks")],void 0);return g.runInTransaction(function(c){return e.runInTransaction(function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(d){var e=(yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=c[a];b=b.entries(new WeakMap());var e=(yield b.next());if(e.done)return!1;a=d[a];while(!e.done){var f=e.value,g=f[0];f=f[1];yield a.upsert(g,f);e=(yield b.next())}return!0});return function(b){return a.apply(this,arguments)}}())));return e.every(function(a){return a})});return function(a){return d.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":65")},"readonly",void 0,void 0,f.id+":63")});return j.apply(this,arguments)}g.getIdentityKeysInWorker=a;g.copyEBStateTablesFromMainthreadToWorker=e}),98);
__d("EBWorkerEBSMStateUtils",["EBLS","I64","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state))}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(a=a)!=null?a:yield d("EBLS").getLSStorage();a=(yield i(a));return a==null?"clientStateRow is null":"clientStateRow:\n        backupId: "+(h||(h=d("I64"))).to_string(a.backupId)+",\n        backupTenancy: "+(a.backupTenancy==null?"null":(h||(h=d("I64"))).to_string(a.backupTenancy))+",\n        authLevel: "+(h||(h=d("I64"))).to_string(a.authorityLevel)+"\n        deviceId: "+(a.deviceId==null?"null":(h||(h=d("I64"))).to_string(a.deviceId))});return j.apply(this,arguments)}g.getEBSMWorkerStateRow=i;g.getEBSMWorkerState=a}),98);
__d("EBWorkerODSEntityName.enum",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({MW_EBSM_HYDRATION:"mw_ebsm_hydration",MW_EBSM_IDB:"mw_eb_ebsm_idb",MW_EBSM_CORRUPTION:"mw_ebsm_corruption",MW_EBSM_RESTORE_PERSISTENCE_ERROR:"mw_ebsm_restore_persistence",MW_EBSM_IDB_TABLE_DELETION:"mw_ebsm_idb_table_deletion",MW_EB_AUTO_RESTORE_AUTH_WORKER:"mw_eb_auto_restore_auth_worker",MW_EB_AUTO_RESTORE_AUTH_MAIN_THREAD:"mw_eb_auto_restore_auth_main_thread",MW_EB_DEVICE_MIGRATION_WORKER:"mw_eb_device_migration_worker"});c=a;f["default"]=c}),66);
__d("IGDAWAdminWriteICDCMsgTxn",["Promise","cr:10743","cr:2327"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(c=b("cr:2327"))!=null?c:b("cr:10743");function a(a,c,d){return i?i.writeICDCAdminMsg(a,c,d):(h||(h=b("Promise"))).resolve()}g.writeICDCAdminMsg=a}),98);
__d("IGDAWAdminWriteUserDeviceMsgTxn",["Promise","cr:10744","cr:2693"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(c=b("cr:2693"))!=null?c:b("cr:10744");function a(a,c,d,e,f,g){return i?i.writeUserDeviceAdminMsg(a,c,d,e,f,g):(h||(h=b("Promise"))).resolve()}g.writeUserDeviceAdminMsg=a}),98);
__d("IGDAWDbAddDeviceChangeAlertsTxn",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a,b){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield a.e2ee_deviceChangeAlerts.put(b)});return g.apply(this,arguments)}f.addDeviceChangeAlertsTxn=a}),66);
__d("IGDAWDbUpdateDeviceChangeAlertsTxn",["I64","MAWUnsafeCoerce","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield a.e2ee_deviceChangeAlerts.upsert([b.deviceChangeAlertsId],b)});return i.apply(this,arguments)}function c(a){return d("MAWUnsafeCoerce").unsafeCoerce((h||(h=d("I64"))).of_float(a))}g.updateDeviceChangeAlertsTxn=a;g.convertDeviceChangeAlertsId=c}),98);
__d("IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn",["IGDAWDbUpdateDeviceChangeAlertsTxn","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){c=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(a.e2ee_deviceChangeAlerts.index("deviceJid")).getKeyRange(c).filter(function(a){return!a.loggedOut})));yield (h||(h=b("Promise"))).all(c.map(function(b){return d("IGDAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn(a,babelHelpers["extends"]({},b,{loggedOut:!0}))}))});return i.apply(this,arguments)}g.updateDeviceChangeAlertsLogInStatusTxn=a}),98);
__d("IGDDbThreadTxns",["I64","Promise","ReQL","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){return new Map(yield a.runInTransaction(function(a){return(i||(i=b("Promise"))).all(c.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c;b=d("WAJids").extractUserId(b);return[b,yield (c=d("ReQL")).toArrayAsync(c.mergeJoin(c.fromTableAscending(a.participants.index("contactIdThreadKey"),[]).getKeyRange((h||(h=d("I64"))).of_string(b)),d("ReQL").fromTableAscending(a.threads)).map(function(a){a[0];a=a[1];return a}))]});return function(a){return c.apply(this,arguments)}}()))},"readonly",void 0,void 0,f.id+":24"))});return j.apply(this,arguments)}g.getAllThreadsForUsers=a}),98);
__d("IGDHandleICDCErrorInstruction",["IGDAWAdminWriteICDCMsgTxn","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.shouldShowAdminMessages,i=e.threads;if(!g)return;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield (h||(h=b("Promise"))).all(i.map(function(b){return d("IGDAWAdminWriteICDCMsgTxn").writeICDCAdminMsg(a,b,c.notificationTs)})),d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.ICDC,key:"icdc"})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":30")});return i.apply(this,arguments)}g.handleICDCError=a}),98);
__d("MAWAdminMsgHelpers",["MAWCreateParticipantAdminMsg","MAWExternalId","MAWRemoveParticipantAdminMsg","WAAckLevel","WAGlobals","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h="Facebook User";function a(a){return a==null||a===""?h:a}function b(a){return a!=null?d("WAJids").userIdFromJid(a):h}function c(a,b,c,e){return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:d("MAWCreateParticipantAdminMsg").createParticipantAdminMessage(c==="@me"?d("WAGlobals").getMyUserJid():c,b),serverTs:e,ts:e,type:"Admin"}}function e(a,b,c,e){return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:d("MAWRemoveParticipantAdminMsg").removeParticipantAdminMessage(c==="@me"?d("WAGlobals").getMyUserJid():c,b),serverTs:e,ts:e,type:"Admin"}}function f(a,b,c,e){var f,g=d("WAGlobals").getMyUserJid();c=c==="@me"?g:c;if(c===g)f={adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"currentUserPromotedParticipant"};else if(c==null)f=b===g?{adminMsgContent:[],adminType:"currentUserGotPromoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"participantGotPromoted"};else{c=d("WAJids").userIdFromJid(c);f=b===g?{adminMsgContent:[c],adminType:"participantPromotedYou"}:{adminMsgContent:[c,d("WAJids").userIdFromJid(b)],adminType:"participantPromotedParticipant"}}return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:f,serverTs:e,ts:e,type:"Admin"}}function i(a,b,c,e){var f,g=d("WAGlobals").getMyUserJid();c=c==="@me"?g:c;if(c===g)f=b===g?{adminMsgContent:[],adminType:"currentUserSelfDemoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"currentUserDemotedParticipant"};else if(c==null)f=b===g?{adminMsgContent:[],adminType:"currentUserGotDemoted"}:{adminMsgContent:[d("WAJids").userIdFromJid(b)],adminType:"participantGotDemoted"};else{var h=d("WAJids").userIdFromJid(c);f=b===g?{adminMsgContent:[h],adminType:"participantDemotedYou"}:{adminMsgContent:[h,d("WAJids").userIdFromJid(b)],adminType:c===b?"participantSelfDemoted":"participantDemotedParticipant"}}return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:f,serverTs:e,ts:e,type:"Admin"}}function j(a,b,c,e){var f=[],g=b.subject.content;if(g==null)return;b.subject.user===d("WAGlobals").getMyUserJid()?(b="currentUserNamedGroup",f.push(g)):c==null?(b="unkonwnUserNamedGroup",f.push(g)):(b="participantNamedGroup",f.push(c,g));return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:{adminMsgContent:f,adminType:b},serverTs:e,ts:e,type:"Admin"}}function k(a,b,c,e){var f,g=[];if(c===d("WAGlobals").getMyUserJid())switch(b){case"all_member_add":f="currentUserSetAddModeAllMembers";break;case"admin_add":f="currentUserSetAddModeAdminOnly";break}else if(c!=null){g.push(d("WAJids").userIdFromJid(c));switch(b){case"all_member_add":f="participantSetAddModeAllMembers";break;case"admin_add":f="participantSetAddModeAdminOnly";break}}else switch(b){case"all_member_add":f="serverSetAddModeAllMembers";break;case"admin_add":f="serverSetAddModeAdminOnly";break}if(f==null)return;return{ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a,externalId:d("MAWExternalId").generateExternalId()},msgContent:{adminMsgContent:g,adminType:f},serverTs:e,ts:e,type:"Admin"}}g.UNKNOWN_USER=h;g.maybeUnknownParticipantName=a;g.createAdminMsgContactId=b;g.createParticipantAddAdminMessage=c;g.createParticipantRemoveAdminMsg=e;g.createParticipantPromoteAdminMsg=f;g.createParticipantDemoteAdminMsg=i;g.createGroupNameChangeAdminMsg=j;g.createMemberAddModeChangeAdminMsg=k}),98);
__d("MAWCreateParticipantAdminMsg",["MAWAdminMsgHelpers","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"participantAddedYou"};case 2:return{adminMsgContent:[b,c],adminType:"participantAddedYouAndOneUser"};default:return{adminMsgContent:[b,a.toString()],adminType:"participantAddedYouAndMoreThanOneUsers"}}}function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"currentUserAddedOneParticipant"};case 2:return{adminMsgContent:[b,c],adminType:"currentUserAddedTwoParticipant"};default:return{adminMsgContent:[b,a.toString()],adminType:"currentUserAddedMoreThanTwoParticipant"}}}function j(a,b,c,d){switch(a){case 1:return{adminMsgContent:[b,c],adminType:"participantAddedOneUser"};case 2:return{adminMsgContent:[b,c,d],adminType:"participantAddedTwoUser"}}return{adminMsgContent:[b,c,a.toString()],adminType:"participantAddedMoreThanTwoUser"}}function a(a,b,c,e){e=e==null?b.map(d("MAWAdminMsgHelpers").createAdminMsgContactId):e;var f=e[0];e=e[1];c=c==null?d("MAWAdminMsgHelpers").createAdminMsgContactId(a):d("MAWAdminMsgHelpers").maybeUnknownParticipantName(c);if(a===d("WAGlobals").getMyUserJid())return i(b.length,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e));return b.includes(d("WAGlobals").getMyUserJid())?h(b.length,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(c),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(b[0]===d("WAGlobals").getMyUserJid()?e:f)):j(b.length,c,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e))}g.createParticipantAdminMessage=a}),98);
__d("MAWRemoveParticipantAdminMsg",["MAWAdminMsgHelpers","WAGlobals"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:"participantRemovedYou"};case 2:return{adminMsgContent:[b,c],adminType:"participantRemovedYouAndOneUser"};default:return{adminMsgContent:[b,a.toString()],adminType:"participantRemovedYouAndMoreThanOneUsers"}}}function i(a,b,c,d){switch(a){case 1:return d?{adminMsgContent:[],adminType:"currentUserLeftGroup"}:{adminMsgContent:[b],adminType:"currentUserRemovedOneParticipant"};case 2:return{adminMsgContent:[b,c],adminType:"currentUserRemovedTwoParticipant"};default:return{adminMsgContent:[b,a.toString()],adminType:"currentUserRemovedMoreThanTwoParticipant"}}}function j(a,b,c,d,e){switch(a){case 1:return e?{adminMsgContent:[b],adminType:"participantLeftGroup"}:{adminMsgContent:[b,c],adminType:"participantRemovedOneUser"};case 2:return{adminMsgContent:[b,c,d],adminType:"participantRemovedTwoUser"}}return{adminMsgContent:[b,c,a.toString()],adminType:"participantRemovedMoreThanTwoUser"}}function a(a,b,c,e){e=e==null?b.map(d("MAWAdminMsgHelpers").createAdminMsgContactId):e;var f=e[0];e=e[1];c=c==null?d("MAWAdminMsgHelpers").createAdminMsgContactId(a):d("MAWAdminMsgHelpers").maybeUnknownParticipantName(c);if(a===d("WAGlobals").getMyUserJid())return i(b.length,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e),b[0]===d("WAGlobals").getMyUserJid());return b.includes(d("WAGlobals").getMyUserJid())?h(b.length,c,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(b[0]===d("WAGlobals").getMyUserJid()?e:f)):j(b.length,c,d("MAWAdminMsgHelpers").maybeUnknownParticipantName(f),d("MAWAdminMsgHelpers").maybeUnknownParticipantName(e),b[0]===a)}g.removeParticipantAdminMessage=a}),98);
__d("MAWAdminWriteUserDeviceMsgTxn",["MAWAckLevel","MAWAdminMsgHelpers","MAWDbMsgTxns","MAWDexieTable","MAWExternalId","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWUserJidWrapper","MAWWriteMsgTxns","WAJids","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";e={add:"add",remove:"remove",update:"update"};function h(a,b){switch(a){case"add":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_DEVICE;case"remove":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_REMOVED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_REMOVED_DEVICE;case"update":if(b)return d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_UPDATED_DEVICE;else return d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_UPDATED_DEVICE}}function a(a,b,e,f,g){return d("MAWDbMsgTxns").getIsThreadEmpty(a,e.jid).then(function(i){if(i)return d("MAWDexieTable").dexieResolve();i=b===d("MAWUserJidWrapper").getMyUserJid();var j=h(f,i);i=i?[]:[d("WAJids").userIdFromJid(b)];i=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:i,adminType:j,version:1},e.jid,g);return d("MAWWriteMsgTxns").writeMsg(a,i,e,"MAWAdminWriteUsersConnectedMsgTxn::writeUserDeviceAdminMsg").then(c("emptyFunction"))})}function b(a,b,e,f){var g=d("MAWAdminMsgHelpers").UNKNOWN_USER,h=b===d("MAWUserJidWrapper").getMyUserJid();b={ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:h?d("WAJids").AUTHOR_ME:b,externalId:d("MAWExternalId").generateExternalId(),msgContent:{adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.ICDC_ALERT_ADMIN_MESSAGE,authorName:g},threadJid:e.jid,ts:(h=f)!=null?h:d("WATimeUtils").unixTime(),type:d("MAWMsgType").MSG_TYPE.ICDC_ALERT};return d("MAWWriteMsgTxns").writeMsg(a,b,e,"MAWAdminWriteUsersConnectedMsgTxn::writeICDCAlert").then(c("emptyFunction"))}g.DeviceChange=e;g.getUserDeviceAdminType=h;g.writeUserDeviceAdminMsg=a;g.writeICDCAlert=b}),98);
__d("MAWDbDeviceChangeAlerts",[],(function(a,b,c,d,e,f){"use strict";b="add";c="keyChange";d="remove";function a(a){return a}f.ADD=b;f.KEY_CHANGE=c;f.REMOVE=d;f.unsafeCoerceToDeviceChangeAlertsID=a}),66);
__d("IGDHandleIdentityAddedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDAWDbAddDeviceChangeAlertsTxn","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.allowSecurityAlertForSelf,i=e.contactId,k=e.isMe,l=e.shouldShowAdminMessages,m=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=j(a,c,k,g),f=e.promise;e=e.showSelfAlerts;var n=l?m.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,i,k,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.add,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([f].concat(n));(e||l)&&d("MAWODSProxy").odsBumpEntityKey({entity:k?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").ADD})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":47")});return i.apply(this,arguments)}function j(a,c,e,f){var g=!1,i=(h||(h=b("Promise"))).resolve();if(e&&c.model!=null&&c.platform!=null&&c.notificationTs!=null){g=!0;e=c.instruction==="identityChanged"?d("MAWDbDeviceChangeAlerts").KEY_CHANGE:d("MAWDbDeviceChangeAlerts").ADD;i=d("IGDAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:e,deviceJid:c.device,identity:c.identity,isArchived:!f,isConfirmed:!1,isNotified:!1,model:c.model,platform:c.platform,ts:c.notificationTs})}return{promise:i,showSelfAlerts:g}}g.handleIdentityAdded=a;g.addDeviceChangeAlerts=j}),98);
__d("IGDHandleIdentityChangedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDHandleIdentityAddedInstruction","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAJids","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.allowSecurityAlertForSelf,i=e.isMe,j=e.shouldShowAdminMessages,k=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=d("IGDHandleIdentityAddedInstruction").addDeviceChangeAlerts(a,c,i,g),f=e.promise;e=e.showSelfAlerts;var l=j?k.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,d("WAJids").extractUserId(c.jid),i,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.update,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([f].concat(l));(e||j)&&d("MAWODSProxy").odsBumpEntityKey({entity:i?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").KEY_CHANGE})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":31")});return i.apply(this,arguments)}g.handleIdentityChanged=a}),98);
__d("IGDHandleIdentityRemovedInstruction",["IGDAWAdminWriteUserDeviceMsgTxn","IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWAdminWriteUserDeviceMsgTxn","MAWDbDeviceChangeAlerts","MAWODSProxy","Promise","WAOdsEnums","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,c){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){var g=e.contactId,i=e.isMe,j=e.shouldShowAdminMessages,k=e.threads;yield a.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=i?d("IGDAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn(a,c.device):(h||(h=b("Promise"))).resolve(),f=j?k.map(function(b){return d("IGDAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,g,i,b,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.remove,c.notificationTs)}):[];yield (h||(h=b("Promise"))).all([e].concat(f));(i||j)&&d("MAWODSProxy").odsBumpEntityKey({entity:i?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").REMOVE})});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":30")});return i.apply(this,arguments)}g.handleIdentityRemoved=a}),98);
__d("MAWGetReStoreDBError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.message=b;c.name="MAWGetReStoreDBError";return c}return b}(babelHelpers.wrapNativeSuper(Error));f["default"]=a}),66);
__d("MAWReStoreDbSetup",["MAWGetReStoreDBError","asyncToGeneratorRuntime","cr:10742","cr:2924","cr:3535","cr:4561","err"],(function(a,b,c,d,e,f,g){"use strict";var h;h=(h=(h=b("cr:3535"))!=null?h:b("cr:10742"))!=null?h:b("cr:2924");if(h!=null&&b("cr:4561")!=null){var i=h;h=babelHelpers["extends"]({},h,{createDB:function(){return i.createDB(void 0,[b("cr:4561")])}})}var j=(h=h)==null?void 0:h.createDB,k;function a(){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield k);a==null?void 0:a.closeDb==null?void 0:a.closeDb();k=null});return l.apply(this,arguments)}function d(){if(j==null)throw c("err")("Unexpected invocation of OneDB");k==null&&(k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{var a=(yield j());yield a.runInTransaction(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){}),"readwrite",void 0,void 0,f.id+":52");return a}catch(a){throw new(c("MAWGetReStoreDBError"))("Failed to get ReStore DB: "+a)}})());return k}function e(){return j!=null}g.closeDB=a;g.getDB=d;g.shouldUseReStoreDb=e}),98);
__d("MAWReStoreDb",["FBLogger","MAWIndexedDb","MAWReStoreDbSetup","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(c("gkx")("3577"))try{var a=(yield d("MAWReStoreDbSetup").getDB());return a}catch(a){throw c("FBLogger")("igd_web_on_msgr").blameToPreviousFrame().catching(a).mustfixThrow("Failed to get ReStore DB: %s",arguments[0])}h==null&&(d("MAWIndexedDb").willSetupDB()?h=d("MAWIndexedDb").getDB().then(function(){return d("MAWReStoreDbSetup").getDB()}):h=d("MAWReStoreDbSetup").getDB());return h});return i.apply(this,arguments)}function e(){return d("MAWReStoreDbSetup").shouldUseReStoreDb()}g.getDB=a;g.shouldUseReStoreDb=e}),98);
__d("IGDAWProtocolQueueInstructions",["FBLogger","IGDDbThreadTxns","IGDHandleICDCErrorInstruction","IGDHandleIdentityAddedInstruction","IGDHandleIdentityChangedInstruction","IGDHandleIdentityRemovedInstruction","MAWDbAppMeta","MAWReStoreDb","Promise","WAAssertUnreachable","WAGlobals","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWReStoreDb").getDB(f.id+":33")),e=(yield j(b,a)),g=e[0],h=g.allowSecurityAlertForContact;g=g.allowSecurityAlertForSelf;e=e[1];var i=[];for(a of a){var k=a.jid,m=d("WAJids").extractUserId(k);k=k===d("WAGlobals").getMyUserJid();var n=l({allowSecurityAlertForContact:h,isICDCError:a.instruction==="icdcError",isMe:k});n={allowSecurityAlertForSelf:g,contactId:m,isMe:k,shouldShowAdminMessages:n,threads:(k=e.get(m))!=null?k:[]};try{yield o(b,a,n),i.push(a.stanzaQueueId)}catch(a){c("FBLogger")("igd_web_on_msgr").warn("Failed to handle instruction. The error is %s",a)}}return{followUpParams:void 0,toAck:i}});return i.apply(this,arguments)}function j(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=new Set(b.map(function(a){return a.jid})),e=(yield m(a)),f=e.allowSecurityAlertForContact&&b.some(function(a){return a.jid!==d("WAGlobals").getMyUserJid()});b=b.some(function(a){return a.instruction==="icdcError"});f=f||b;b=f?yield d("IGDDbThreadTxns").getAllThreadsForUsers(a,Array.from(c)):new Map();return[e,b]});return k.apply(this,arguments)}function l(a){var b=a.allowSecurityAlertForContact,c=a.isICDCError;a=a.isMe;return!a&&(b||c)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield (h||(h=b("Promise"))).all([a.tables.e2ee_appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlertForSelf),a.tables.e2ee_appMeta.get(d("MAWDbAppMeta").AppMetaKeysEnum.allowSecurityAlert)]));var c=a[0];a=a[1];return{allowSecurityAlertForContact:(a=a==null?void 0:a.value.allowSecurityAlert)!=null?a:!1,allowSecurityAlertForSelf:(a=c==null?void 0:c.value.allowSecurityAlertForSelf)!=null?a:!0}});return n.apply(this,arguments)}function o(a,b,e){switch(b.instruction){case"identityChanged":return d("IGDHandleIdentityChangedInstruction").handleIdentityChanged(a,b,e);case"identityAdded":return d("IGDHandleIdentityAddedInstruction").handleIdentityAdded(a,b,e);case"identityRemoved":return d("IGDHandleIdentityRemovedInstruction").handleIdentityRemoved(a,b,e);case"icdcError":return d("IGDHandleICDCErrorInstruction").handleICDCError(a,b,e);default:throw c("WAAssertUnreachable")(b)}}g.handleInstructions=a;g.getShouldShowAdminMessages=l}),98);
__d("MessagingArmadilloThreadCutoverNonTALClientDomain",[],(function(a,b,c,d,e,f){a=Object.freeze({ARMADILLO_CUTOVER_CLIENT_DOMAIN_MESSENGER_CUTOVER_DASM_NATIVE_OPERATIONS:"MessengerCutoverDasmNativeOperations"});f["default"]=a}),66);
__d("MessagingArmadilloThreadCutoverNonTALClientEvent",[],(function(a,b,c,d,e,f){a=Object.freeze({ARMADILLO_CUTOVER_CLIENT_EVENT_COMPLETE_CUTOVER:"CompleteCutover",ARMADILLO_CUTOVER_CLIENT_EVENT_THREAD_FETCH:"ThreadFetch"});f["default"]=a}),66);
__d("MessagingArmadilloThreadCutoverNonTALClientEventDetails",[],(function(a,b,c,d,e,f){a=Object.freeze({ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_SUCCESS:"Success",ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_APPEND_ADMIN_MESSAGES:"AppendAdminMessages",ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_GENERIC_ERROR:"GenericError",ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_MISSING_ACT_THREAD:"MissingActThread",ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_THREAD_ALREADY_MIGRATED:"ThreadAlreadyMigrated"});f["default"]=a}),66);
__d("MAWAdminWriteCutoverThreadMsgTxn",["CurrentEnvironment","MAWBridge","MAWBridgeMsg","MAWDbMsg","MAWDbThreadTxns","MAWIndexedDb","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWWriteBulkWriteIncomingAdminMsgTxns","MAWWriteMsgTxns","MessagingArmadilloThreadCutoverNonTALClientDomain","MessagingArmadilloThreadCutoverNonTALClientEvent","MessagingArmadilloThreadCutoverNonTALClientEventDetails","WAJids","WALogger","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["cutoverThreadAdminMessage failed to get the thread"]);h=function(){return a};return a}function i(a,b,e,f,g){a=d("WAJids").switchOnMsgrChatJidType(a,{group:function(a){return d("WAJids").groupIdFromJid(a)},user:function(a){return d("WAJids").userIdFromJid(a)}});d("MAWBridge").getBridge().fireAndForget("event","logCutoverEvent",{armadilloThreadId:a,domain:c("MessagingArmadilloThreadCutoverNonTALClientDomain").ARMADILLO_CUTOVER_CLIENT_DOMAIN_MESSENGER_CUTOVER_DASM_NATIVE_OPERATIONS,event:c("MessagingArmadilloThreadCutoverNonTALClientEvent").ARMADILLO_CUTOVER_CLIENT_EVENT_COMPLETE_CUTOVER,eventDetails:f,openThreadId:b,success:g,traceId:e})}function a(a,b,e,f){return d("MAWDbThreadTxns").getThread(a,b).then(function(g){var j=function(a,c){i(b,e,f,a,c)};if(!g.success){d("WALogger").WARN(h());j(c("MessagingArmadilloThreadCutoverNonTALClientEventDetails").ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_MISSING_ACT_THREAD,!1);return{needsMarkThreadAsMigrated:!1}}var k=g.value;if(k.isMigratedLocally===!0){j(c("MessagingArmadilloThreadCutoverNonTALClientEventDetails").ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_THREAD_ALREADY_MIGRATED,!0);return{needsMarkThreadAsMigrated:!1}}g=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(k.chatId);var l=d("MAWDbMsg").craftCutoverAdminMsgAltIndex(k.chatId);return a.messages.where("altIndex").equals(g).first().then(function(b){var e=c("CurrentEnvironment").instagramdotcom?d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_IGD_THREAD_ADMIN_MESSAGE:d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_THREAD_ADMIN_MESSAGE;if(!b){var f=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:e,version:1},k.jid,d("WATimeUtils").castToUnixTime(0),l);return d("MAWWriteMsgTxns").writeMsg(a,f,k,"MAWAdminWriteCutoverThreadMsgTxn::writeCutoverThreadAdminMsg",{sortOrderMs:0}).then(function(){j(c("MessagingArmadilloThreadCutoverNonTALClientEventDetails").ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_APPEND_ADMIN_MESSAGES,!0);return{needsMarkThreadAsMigrated:!0}})}var g=babelHelpers["extends"]({},b,{altIndex:l,author:d("WAJids").AUTHOR_SYSTEM,msgContent:{adminMsgContent:[],adminType:e},type:d("MAWMsgType").MSG_TYPE.ADMIN});return a.messages.put(g).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(g)});j(c("MessagingArmadilloThreadCutoverNonTALClientEventDetails").ARMADILLO_CUTOVER_CLIENT_EVENT_DETAILS_APPEND_ADMIN_MESSAGES,!0);return{needsMarkThreadAsMigrated:!0}})})})}function b(a,b){var e=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CUTOVER_ROLLBACK_ADMIN_MESSAGE},b.jid),f=babelHelpers["extends"]({},b,{didInsertDualThreadCutoverAdminMsg:!1});return a.threads.put(f).then(function(){return d("MAWWriteMsgTxns").writeMsg(a,e,f,"MAWAdminWriteCutoverThreadMsgTxn::writeRollbackCutoverAdminMsg").then(c("emptyFunction"))})}function e(a,b){var e=d("MAWDbMsg").craftCutoverAdminMsgAltIndex(b.chatId),f=d("MAWDbMsg").craftE2eeAdminMsgAltIndex(b.chatId);return a.messages.where("altIndex").equals(f).first().then(function(g){if(g!=null)return;return a.messages.where("altIndex").equals(e).first().then(function(e){if(!e)return d("MAWWriteBulkWriteIncomingAdminMsgTxns").writeE2EEAdminMsgsForIncomingCreatedThreads(a,[b]).then(c("emptyFunction"));var g=babelHelpers["extends"]({},e,{altIndex:f,author:d("WAJids").AUTHOR_SYSTEM,msgContent:{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.E2EE_THREAD_DESCRIPTION},type:d("MAWMsgType").MSG_TYPE.ADMIN});return a.messages.put(g).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(g)})})})})}g.writeCutoverThreadAdminMsg=a;g.writeRollbackCutoverAdminMsg=b;g.revertCutoverThreadAdminMsg=e}),98);
__d("MAWHIMLogger",["WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";a=d("WATagsLogger").TAGS(["HandleIncomingMessage"]);g["default"]=a}),98);
__d("MAWEphemeralUtils",["MAWLocalizationType","MAWUserJidWrapper","WAArmadilloApplication.pb","WAJids","err"],(function(a,b,c,d,e,f,g){"use strict";var h=60,i=60*h,j=24*i;function a(a,b,c,e){var f=[],g=b===j,k=a===d("MAWUserJidWrapper").getMyUserJid();if(e)e=d("MAWLocalizationType").LOCALIZATION_TYPE.EPHEMERAL_SETTINGS_AUTO_RESET;else if(!k||a==null)b===0?e=d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_OFF:b<h?(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_SECONDS:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_SECONDS,f.push(b.toString())):b<i?(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_MINUTES:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_MINUTES,f.push((b/h).toString())):b<j||g?(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_HOURS:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_HOURS,f.push((b/i).toString())):(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_TURNED_ON_DAYS:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_EPHEMERAL_SETTING_CHANGE_DAYS,f.push((b/j).toString()));else{a=d("WAJids").extractUserId(a).toString();b===0?k?e=d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_OFF:(e=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_OFF,f.push(a)):b<h?(k?e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_SECONDS:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_SECONDS:(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_SECONDS:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_SECONDS,f.push(a)),f.push(b.toString())):b<i?(k?e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_MINUTES:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_MINUTES:(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_MINUTES:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_MINUTES,f.push(a)),f.push((b/h).toString())):b<j||g?(k?e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_HOURS:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_HOURS:(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_HOURS:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_HOURS,f.push(a)),f.push((b/i).toString())):(k?e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_TURNED_ON_DAYS:d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_SETTING_CHANGE_DAYS:(e=c?d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_TURNED_ON_DAYS:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_SETTING_CHANGE_DAYS,f.push(a)),f.push((b/j).toString()))}return{ephemeralSettingChangeContent:f,ephemeralSettingChangeType:e}}function b(a,b,e){var f,g=[];b=d("WAJids").extractUserId(b).toString();switch(a){case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE:e?f=d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_TAKE_SCREENSHOT:(f=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_TAKE_SCREENSHOT,g.push(b));break;case d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING:e?f=d("MAWLocalizationType").LOCALIZATION_TYPE.YOU_EPHEMERAL_RECORD_SCREEN:(f=d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_EPHEMERAL_RECORD_SCREEN,g.push(b));break;default:throw c("err")("Received unexpected screenshot action type")}return{ephemeralScreenshotActionContent:g,ephemeralScreenshotActionType:f}}g.getEphemeralSettingChangeData=a;g.getEphemeralScreenshotActionData=b}),98);
__d("MAWEphemeralAdminMsgBuildTxns",["MAWAckLevel","MAWBridgeMsg","MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDexieTable","MAWEphemeralUtils","MAWExternalId","MAWIndexedDb","MAWMsgType","MAWUserJidWrapper","MAWWriteMsgTxns","WAJids","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f,g,h,i,j){if(e<0)throw c("err")("Received unexpected ephemeral time setting");e=d("MAWEphemeralUtils").getEphemeralSettingChangeData(b,e,h,i);h=e.ephemeralSettingChangeContent;i=e.ephemeralSettingChangeType;var k={ack:d("MAWAckLevel").ACK.sent,altIndex:void 0,author:(e=b)!=null?e:d("WAJids").AUTHOR_SYSTEM,msgContent:{adminMsgContent:h,adminType:i,version:1},type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN};e=j!=null&&b!=null?d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,j,g.jid,b):d("MAWDexieTable").dexieResolve();return e.then(function(b){if(b==null){var c,e=babelHelpers["extends"]({},k,{externalId:(c=j)!=null?c:d("MAWExternalId").generateExternalId(),sortOrderMs:d("WATimeUtils").castUnixTimeToMillisTime(f),threadJid:g.jid,ts:f});return d("MAWWriteMsgTxns").writeDedupedEphemeralSettingAdminMessage(a,e,g,d("WATimeUtils").castUnixTimeToMillisTime(f)).then(function(a){return babelHelpers["extends"]({},e,{msgId:a.msgId,rowId:a.rowId})})}else if(b.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT){var h=babelHelpers["extends"]({},b,k);return a.messages.put(h).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(b.threadJid,[b])});d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(h)});return h})}else return null})}function b(a,b,c,e,f,g,h){var i=b===d("MAWUserJidWrapper").getMyUserJid(),j=d("MAWEphemeralUtils").getEphemeralScreenshotActionData(f,b,i),k=j.ephemeralScreenshotActionContent;j=j.ephemeralScreenshotActionType;if(h==null){var l={ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:i?d("WAJids").AUTHOR_ME:b,externalId:g,msgContent:{adminMsgContent:k,adminType:j,screenshotActionType:f,version:1},sortOrderMs:d("WATimeUtils").castUnixTimeToMillisTime(e),threadJid:c.jid,ts:e,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION};return d("MAWWriteMsgTxns").writeDedupedEphemeralSettingAdminMessage(a,l,c,d("WATimeUtils").castUnixTimeToMillisTime(e)).then(function(a){return babelHelpers["extends"]({},l,{msgId:a.msgId,rowId:a.rowId})})}else if(h.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT){var m=babelHelpers["extends"]({},h,{ack:d("MAWAckLevel").ACK.received,altIndex:void 0,author:i?d("WAJids").AUTHOR_ME:b,msgContent:{adminMsgContent:k,adminType:j,screenshotActionType:f,version:1},type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION});return a.messages.put(m).then(function(){d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(h.threadJid,[h])});d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(m)});return m})}else return d("MAWDexieTable").dexieResolve(null)}g.writeEphemeralSettingAdminMsg=a;g.writeEphemeralScreenshotActionMsg=b}),98);
__d("MAWMsgActionType",[],(function(a,b,c,d,e,f){"use strict";a={DELETE_FOR_ME:"DELETE_FOR_ME",NO_ACTION:"NO_ACTION",REVOKE:"REVOKE",UPDATE_CIPHERTEXT:"UPDATE_CIPHERTEXT",UPDATE_CIPHERTEXT_WITH_ASSOCIATED:"UPDATE_CIPHERTEXT_WITH_ASSOCIATED",WRITE:"WRITE",WRITE_WITH_ASSOCIATED:"WRITE_WITH_ASSOCIATED"};f.MSG_ACTION=a}),66);
__d("MAWDbReceiptTxns",["MAWDexieTable","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpectedly fetched null data from a msgIdToReceiptData map"]);h=function(){return a};return a}function a(a,b,c){return i([{deliveryReceipts:b==="delivered"?c:[],msgId:a,readReceipts:b==="read"?c:[],senderReceipts:b==="sender"?c:[]}]).then(function(a){return a[0]||{type:"missing"}})}function i(a){var b=a.map(function(a){return a.msgId}),c=new Map();a.forEach(function(a){c.set(a.msgId,a)});a=b.map(function(a){var b=c.get(a);if(b==null){d("WALogger").ERROR(h());return null}var e=new Set(),f=new Map(),g=b.deliveryReceipts,i=b.readReceipts;b=b.senderReceipts;[{receiptType:"delivered",receivers:g},{receiptType:"read",receivers:i},{receiptType:"sender",receivers:b}].forEach(function(a){var b=a.receiptType;a=a.receivers;a.forEach(function(a){var c=a.device;a=a.ts;c=d("WAJids").extractUserJid(c);var g=!1;if(b!=="sender"){var h=f.get(c);a=j(h,b,a);f.set(c,a);g=k(h,a)}g&&e.add(c)})});return{affectedUserJids:e,receipt:{msgId:a,statusTsPerUser:f}}}).filter(Boolean);return d("MAWDexieTable").dexieResolve(a.map(function(a){return{affectedUserJids:a.affectedUserJids,receipt:a.receipt}}))}function j(a,b,c){var d;d=(d=a==null?void 0:a.deliveredTs)!=null?d:c;a=a==null?void 0:a.readTs;b==="read"&&a==null&&(a=c);return{deliveredTs:d,readTs:a}}function k(a,b){return((b==null?void 0:b.deliveredTs)||0)>((a==null?void 0:a.deliveredTs)||0)||((b==null?void 0:b.readTs)||0)>((a==null?void 0:a.readTs)||0)}function b(a,b){return a.receipts.bulkDelete(b)}g.writeReceiptsForDevices=a;g.bulkWriteReceiptsForDevices=i;g.bulkDeleteAllReceiptsForMessages=b}),98);
__d("MAWMessageRequestUtils",["MAWFolderTypes","WADbContact"],(function(a,b,c,d,e,f,g){"use strict";function a(a){a=a===d("MAWFolderTypes").FOLDER_ID.PENDING||a===d("MAWFolderTypes").FOLDER_ID.OTHER;return a}function b(a,b){return(a===null||a===d("MAWFolderTypes").FOLDER_ID.INBOX)&&(b===d("WADbContact").REVERSED_ONE_WAY_CONTACT||b===d("WADbContact").NON_CONTACT)}g.isMessageRequestOrSpamThread=a;g.isInboxRequest=b}),98);
__d("MAWMarkThreadAsReadTxns",["FBLogger","MAWBridgeThread","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWMessageRequestUtils","MAWTimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d,e,f){f===void 0&&(f=!1);var g=new Map();g.set(b,{msgId:d,sortOrderMs:e});return h(a,g,f).then(function(a){a=a.get(b);if(a==null)throw c("FBLogger")("messenger_web_devx","maw_mark_thread_as_read").warn("ThreadReadReceiptInfo unexpectedly unavailable for thread\n         in markThreadAsReadUpToMsgSortOrderMs()");return a})}function h(a,b,c){c===void 0&&(c=!1);return j(a,b).then(function(e){var f=e.threadJidToReadReceiptInfo,g=e.updatedThreads;return a.threads.bulkPut(g).then(function(){g.forEach(function(a){var e;e=(e=b.get(a.jid))==null?void 0:e.sortOrderMs;e!=null&&!c&&d("MAWIndexedDb").afterTransaction({tag:"ThreadTimestampsUpdated",value:d("MAWBridgeThread").createBridgeThreadTimestampsUpdated(a.jid,e,e,!1)});f.set(a.jid,{isReadReceiptExpectedToBeSent:(a=(e=f.get(a.jid))==null?void 0:e.isReadReceiptExpectedToBeSent)!=null?a:!1,type:"success"})});return f})})}function i(a,b,c){return d("MAWDbMsgTxns").getThreadOldestMessageId(a,b.jid).then(function(a){if(a==null)return null;a=d("MAWTimeUtils").ensureValidMillisTime(b.newestMsgTs);return babelHelpers["extends"]({},b,{lastReadMsg:c.msgId,newestMsgTs:a})})}function j(a,b){var e=new Map(),f=Array.from(b.keys()),g=[];return a.threads.where("jid").anyOf(f).toArray().then(function(h){var j=new Map();h.forEach(function(a){return j.set(a.jid,a)});f.forEach(function(a){j.has(a)||j.set(a,null)});h=Array.from(j).map(function(d){var f=d[0];d=d[1];if(d==null){e.set(f,{isReadReceiptExpectedToBeSent:!1,type:"missing"});return}f=k(d.folder);e.set(d.jid,{isReadReceiptExpectedToBeSent:f,type:"success"});f=b.get(d.jid);if(f==null)throw c("FBLogger")("maw_threads","maw_mark_thread_as_read").warn("ThreadReadReceiptInfo unexpectedly unavailable for thread\n            in getThreadJidToReadReceiptInfo()");return i(a,d,f).then(function(a){a!=null&&g.push(a)})});return d("MAWDexieTable").dexieAll(h).then(function(){return{threadJidToReadReceiptInfo:e,updatedThreads:g}})})}function k(a){return!d("MAWMessageRequestUtils").isMessageRequestOrSpamThread(a)}g.markThreadAsReadUpToMsgSortOrderMs=a;g.bulkMarkThreadAsReadUpToMsgSortOrderMs=h;g.isReadReceiptExpectedToBeSentFor=k}),98);
__d("MAWPendingReceiptProcessingTxns",["MAWDbMsg","MAWDbParticipantTxns","MAWDbReceiptTxns","MAWDexieTable","MAWMarkThreadAsReadTxns","WAJids","WALogger","WAMsg","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing pending receipts for "," from ",""]);h=function(){return a};return a}function a(a,b,c){var e=d("WAMsg").craftWAMsgIdString({author:c.author,chat:b,externalId:c.externalId});return a.pendingReceipts.get(e).then(function(b){if(b==null)return;d("WALogger").LOG(h(),c.externalId,c.author);if(b.author===d("WAJids").AUTHOR_ME){var f=d("MAWDexieTable").dexieResolve();b.deliveryReceipts.length>0&&(f=f.then(function(){return d("MAWDbReceiptTxns").writeReceiptsForDevices(c.msgId,"delivered",b.deliveryReceipts)}));b.readReceipts.length>0&&(f=f.then(function(){return d("MAWDbReceiptTxns").writeReceiptsForDevices(c.msgId,"read",b.readReceipts)}));return f.then(function(b){var f=[];b!=null&&b.type!=="missing"&&b.receipt.statusTsPerUser.forEach(function(b,e){var g=b.deliveredTs!=null?c.ts:d("WATimeUtils").castToUnixTime(0),h=b.readTs!=null?c.ts:d("WATimeUtils").castToUnixTime(0);b=(b=b.readTs)!=null?b:d("WATimeUtils").castToUnixTime(0);f.push(d("MAWDbParticipantTxns").updateParticipantTimestamps(a,[c.threadJid,e],g,h,b))});return d("MAWDexieTable").dexieAll(f).then(function(){a.pendingReceipts["delete"](e)})})}else return d("MAWDexieTable").dexieAll([d("MAWMarkThreadAsReadTxns").markThreadAsReadUpToMsgSortOrderMs(a,c.threadJid,c.msgId,d("WATimeUtils").castToMillisTime(d("MAWDbMsg").getSortOrderWithFallback(c)))]).then(function(){return a.pendingReceipts["delete"](e)})})}g.processPendingReceipts=a}),98);
__d("MAWWriteEditTxns",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWBulkEditMsgsTxns","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWUnsafeCoerce","MAWUserJidWrapper","MAWWriteMsgTxns","WAJids","WAMsgType","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=b.args,f=b.externalId,g=e.editMsgContent;e=e.originalProtocolMsgId;var i=e.chat,j=e.externalId;return d("MAWDexieTable").dexieAll([a.threads.get({jid:i}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,e)]).then(function(e){var k=e[0],l=e[1];if(k==null)return d("WAResultOrError").makeError("missing_thread");if(l==null)return d("WAResultOrError").makeError("missing_msg");if(l.type!==d("WAMsgType").MSG_TYPE.TEXT)throw c("err")("Only text or cipher text can be edited. Original msg type: %s",l.type);return d("MAWDexieTable").dexieAll([a.messages.where("quoteExternalId").equals(j).toArray(),a.editMsgHistory.where("originalMsgExternalId").equals(j).toArray()]).then(function(e){var k=e[0];e=e[1];var m=e.find(function(a){return a.author===d("WAJids").AUTHOR_ME&&a.threadJid===i&&a.editExternalId===f});if((m==null?void 0:m.sendStatus)!=null&&m.sendStatus>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("already_sent");m=[];m.push(h(b,i,j));e=e.find(function(a){return a.author===d("WAJids").AUTHOR_ME&&a.threadJid===i&&a.editExternalId===j});e==null&&(l.editCount==null||l.editCount===0)&&m.push(h(l,i,j));return d("MAWDbEditMsgHistoryTxns").bulkAddEditMsgHistory(a,m,!1).then(function(){var b,e=babelHelpers["extends"]({},l,{ack:d("MAWAckLevel").ACK.clock,editCount:((b=l.editCount)!=null?b:0)+1,msgContent:g}),h=[],m=d("MAWUserJidWrapper").getMyUserJid();k.filter(function(a){var b;return(((b=a.quote)==null?void 0:b.content.author)===d("WAJids").AUTHOR_ME||((b=a.quote)==null?void 0:b.content.author)===m)&&a.threadJid===i}).forEach(function(a){if(a!=null){var b=a.quote,d=a.quoteExternalId;if(b==null)c("FBLogger")("messenger_e2ee_web").warn("[edit message] Failed to get the quoted content for a msg that has been quoted.",d);else{d=babelHelpers["extends"]({},a,{quote:babelHelpers["extends"]({},b,{content:babelHelpers["extends"]({},b.content,{msgContent:babelHelpers["extends"]({},e.msgContent)})})});h.push(d)}}});return a.messages.bulkPut([e].concat(h)).then(function(){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,l)}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(e,void 0,a)})}).then(function(){h.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})});return d("WAResultOrError").makeResult({originalMsgExternalId:j,originalMsgId:l.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:i,externalId:f}})})})})})}function h(a,b,c){var e;return{author:d("WAJids").AUTHOR_ME,editExternalId:a.externalId,editTs:(e=a.serverTs)!=null?e:a.ts,msgContent:(e=(e=a.args)==null?void 0:e.editMsgContent)!=null?e:d("MAWUnsafeCoerce").unsafeCoerce(a.msgContent),originalMsgExternalId:c,sendStatus:d("MAWAckLevel").ACK.clock,specialTextSize:a.specialTextSize,threadJid:b}}function b(a,b,c,e,f,g,h){if(b.type!==d("WAMsgType").MSG_TYPE.TEXT||!e||e.length===0)return d("MAWWriteMsgTxns").writeNewIncomingMsg(a,b,c,f,g,h);var i=e.sort(function(a,b){return b.editTs-a.editTs})[0].msgContent;e=e.length;return d("MAWWriteMsgTxns").writeNewIncomingMsg(a,babelHelpers["extends"]({},b,{editCount:e,msgContent:i}),c,f,g,h).then(function(c){return(c.type===d("WAMsgType").MSG_TYPE.TEXT?d("MAWDbEditMsgHistoryTxns").bulkAddEditMsgHistory(a,[d("MAWBulkEditMsgsTxns").getMessageHistory(babelHelpers["extends"]({},c,{msgContent:b.msgContent}),c.threadJid)],g):d("MAWDexieTable").dexieResolve()).then(function(){return c})})}g.writeEdit=a;g.writeNewIncomingMsgAndEditHistory=b}),98);
__d("MAWDbGroupInviteTxns",["MAWDexieTable","MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.groupInvites.put(b).then(function(){return b})}function b(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).anyOf([[b,c]])["delete"]()}function h(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).equals([b,c]).first()}function c(a,b,c){return a.groupInvites.where(["threadJid","inviteeJid"]).anyOf([[b,c]]).toArray()}function e(a,b){return b.type===d("MAWMsgType").MSG_TYPE.GROUP_INVITE?b.invitedParticipantUserJid==null?d("MAWDexieTable").dexieResolve():h(a,b.threadJid,b.invitedParticipantUserJid):d("MAWDexieTable").dexieResolve()}g.putGroupInvite=a;g.deleteGroupInvitesByThreadAndInvitedParticipant=b;g.maybeGetGroupInvite=h;g.getGroupInvitesByThreadAndInvitedParticipant=c;g.getAndCheckGroupInviteFromMsg=e}),98);
__d("MAWDbGroupInfoTxns",["MAWBridgeTypesCreators","MAWIndexedDb","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(a,b.jid).then(function(c){var d=b.participantVersion;c.success&&c.value.participantVersion!=null&&b.participantVersion==null&&(d=c.value.participantVersion);c=b.subject.content;c!=null&&c.length===0&&(c=void 0);var e={creationTs:b.creationTs,creator:b.creator,groupJid:b.jid,inviter:b.inviter,memberAddMode:b.memberAddMode,name:c,nameOwner:b.subject.user,nameTs:b.subject.ts,participantVersion:d};return i(a,e).then(function(){return e})})}function h(a,b){return a.groupInfo.get({groupJid:b}).then(function(a){return a==null?d("WAResultOrError").makeError("missing"):d("WAResultOrError").makeResult(a)})}function i(a,b){return a.groupInfo.put(b).then(function(){d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(b)})})}function b(a,b){return a.groupInfo.bulkPut(b).then(function(){b.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(a)})})})}function c(a,b){return a.groupInfo.bulkGet(b)}function e(a,b){return a.groupInfo["delete"](b)}g.putGroupInfo=a;g.getGroupInfo=h;g.updateGroupInfo=i;g.bulkUpdateGroupInfo=b;g.getGroupInfos=c;g.deleteGroupInfo=e}),98);
__d("MAWGroupInviteManagementTxns",["MAWDbGroupInviteTxns","MAWDbParticipantTxns","MAWDexieTable","MAWUserJidWrapper"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=!1;return d("MAWDbParticipantTxns").getInvitedParticipantsInThread(a,b).then(function(e){if(e.length===0){c=!0;var f=d("MAWUserJidWrapper").getMyUserJid();return d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,f).then(function(){return c})}else{var g=[];e.forEach(function(c){g.push(d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,c.userJid))});return d("MAWDexieTable").dexieAll(g).then(function(){return c})}})}g.deleteGroupInvitesByThread=a}),98);
__d("MAWLoadMessageRequestCapabilitiesTxns",["MAWDexieTable","MAWIndexedDb","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a){for(var b=0;b<a.length;b++){var c=a[b],e=d("WAJids").interpretAsUserJid(c.jid);if(e==null)continue;d("MAWIndexedDb").afterTransaction({tag:"OneToOneMessageRequestLoaded",value:{fbid:d("WAJids").extractUserId(e),threadJid:c.jid}})}return d("MAWDexieTable").dexieResolve()}g.loadMessageRequestDataForThreads=a}),98);
__d("MAWThreadManagementTxns",["MAWBridgeEventTransmitter","MAWBridgeParticipants","MAWBridgeTypesCreators","MAWDbGroupInfoTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDexieTable","MAWGetOrCreateThreadTxns","MAWGroupInviteManagementTxns","MAWIndexedDb","MAWLoadMessageRequestCapabilitiesTxns","MAWQplProxy","MAWUserJidWrapper","WAJids","WALogger","WAMsgType","WASortedLists","WATimeUtils","err","qpl","vulture"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted "," media rows and "," chunk rows"]);h=function(){return a};return a}function a(a,b,e){var f=b.authoritativeThreadKey,g=b.createTs,h=b.description,i=b.folder,j=b.lastActivityTimestamp,k=b.lastReadWatermarkTimestamp,l=b.offlineThreadingId,n=b.userJid;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{authoritativeThreadKey:f,clientThreadKey:l,createTs:g,description:h,folder:i,jid:n,lastActivityTimestamp:j,lastReadWatermarkTimestamp:k},e).then(function(b){var f=b.created;b=b.thread;e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"process-setup-thread-start",{instanceKey:e});f=m(a,n,f,b);e!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25313175,"1551"),"process-setup-thread-end",{instanceKey:e});return f})}function b(a,b){c("vulture")("WRfdPbETS5gp7XJBUDqz4fakhqw=");return d("MAWGetOrCreateThreadTxns").bulkGetOrCreateThread(a,b.map(function(a){var b=a.authoritativeThreadKey,c=a.createTs,d=a.description,e=a.folder,f=a.lastActivityTimestamp,g=a.lastReadWatermarkTimestamp,h=a.offlineThreadingId;a=a.userJid;return{authoritativeThreadKey:b,clientThreadKey:h,createTs:c,description:d,folder:e,jid:a,lastActivityTimestamp:f,lastReadWatermarkTimestamp:g}})).then(function(c){return d("MAWDexieTable").dexieAll(c.map(function(c,d){var e=c.created;c=c.thread;return m(a,b[d].userJid,e,c)}))})}function e(a,b,c,e){return d("MAWDbGroupInfoTxns").getGroupInfo(a,b).then(function(b){if(!b.success)return null;var f=b.value;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{createTs:d("WATimeUtils").castUnixTimeToMillisTime(f.creationTs),description:"getOrRepairGroupThread",folder:c,jid:f.groupJid,skipVerifyThread:e}).then(function(a){var b=a.created;a=a.thread;return{created:b,groupInfo:f,thread:a}})})}function i(a,b){var c=[],e=[];b.forEach(function(a){d("MAWDbMsg").isMediaMsg(a)&&a.mediaId!=null&&(c.push(a.mediaId),e.push(a.msgId))});return a.media.bulkGet(c).then(function(b){var c=[],f=[];b.forEach(function(a,b){if(a!=null){var g=e[b];a.msgIds=d("WASortedLists").filter(a.msgIds,function(a){return a!==g});a.mediaEntries["delete"](g);a.msgIds.length===0&&a.mediaEntries.size===0&&(a.plaintextHash!=null&&c.push(a.hashedPlaintextHash),f.push(a.mediaId))}});b=a.media.bulkDelete(f);var g=a.chunk.where("hashedPlaintextHash").anyOf(c)["delete"]();return d("MAWDexieTable").dexieAll([b,g]).then(function(){d("WALogger").LOG(h(),f.length,c.length)})})}function j(a,b){return d("MAWDbMsgTxns").getThreadNewestMessageTs(a,b).then(function(c){return a.messages.where("threadJid").equals(b.jid).toArray().then(function(d){return k(a,b,c,d,!0)})})}function f(a,b,c,e){var f=c==null?void 0:c.lastMessageTimestamp;if(c==null)return j(a,b);var g=a.messages.where("threadJid").equals(b.jid).toArray(),h=d("MAWDbMsgTxns").getThreadNewestMessageTs(a,b);return d("MAWDexieTable").dexieAll([g,h]).then(function(g){var h=g[0];g=g[1];var i=[],j=new Set();f!=null&&h.forEach(function(a){var b;b=(b=a.originalTs)!=null?b:a.ts;b<=f+1&&(j.add(a.msgId),i.push(a))});if((c==null?void 0:c.messages.length)!==0){var l=new Set();c.messages.forEach(function(a){l.add((a=a.key)==null?void 0:a.id)});h.forEach(function(a){l.has(a.externalId)&&!j.has(a.msgId)&&(j.add(a.msgId),i.push(a))})}if(i.length!==h.length)for(var m=h,n=Array.isArray(m),o=0,m=n?m:m[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var p;if(n){if(o>=m.length)break;p=m[o++]}else{o=m.next();if(o.done)break;p=o.value}p=p;if(!j.has(p.msgId)&&p.type!==d("WAMsgType").ADMIN)return k(a,b,g,i,!1,e)}return k(a,b,g,h,!0,e)})}function k(a,b,c,e,f,g){var h=d("WAJids").interpretAsGroupJid(b.jid),j=f?d("MAWDbThreadTxns").deleteThreadRow(a,b.jid):d("MAWDexieTable").dexieResolve(),k=f?d("MAWDbParticipantTxns").deleteAllParticipantsForThread(a,b.jid):d("MAWDexieTable").dexieResolve(),l=d("MAWDexieTable").dexieResolve(!1),m=d("MAWDexieTable").dexieResolve();h!=null&&f&&(l=d("MAWGroupInviteManagementTxns").deleteGroupInvitesByThread(a,h),m=d("MAWDbGroupInfoTxns").deleteGroupInfo(a,h));return d("MAWDexieTable").dexieAll([i(a,e),d("MAWDbReactionsTxns").deleteAllReactionsForMessages(a,e),d("MAWDbMsgTxns").deleteMessages(a,e,g),j,k,m,l]).then(function(a){a[0];a[1];a[2];a[3];a[4];a[5];a=a[6];f?(d("MAWBridgeEventTransmitter").deleteMessagesOfThreadAfterTxn(b,c),h!=null&&a&&d("MAWIndexedDb").afterTransaction({tag:"DeleteGroupInvite",value:d("MAWBridgeTypesCreators").createBridgeDeleteGroupInvite(b.jid)}),d("MAWIndexedDb").afterTransaction({tag:"ThreadHiddenV2",value:b.jid})):d("MAWIndexedDb").afterTransaction({tag:"DeleteMessages",value:d("MAWBridgeTypesCreators").createBridgeDeleteMessages(b.jid,e)});return{deletedMessages:e.map(function(a){return d("MAWDbMsg").getWAMsgId(a)})}})}function l(a,b){c("vulture")("6kObH00INqRyY1-L2YKkSr2287s=");var e=b.offlineThreadingId,f=b.userJid;return d("MAWGetOrCreateThreadTxns").createThread(a,{clientThreadKey:e,description:"setupOneToOneThread",jid:f}).then(function(b){return m(a,f,!0,b)})}function m(a,b,e,f){b=d("WAJids").interpretAsUserJid(b);if(b==null)throw c("err")("Non-user jids are not supported");var g=[d("MAWLoadMessageRequestCapabilitiesTxns").loadMessageRequestDataForThreads([f])];b=[{type:"participant",userJid:b}];var h=d("MAWUserJidWrapper").getMyUserJid();h!==f.jid&&b.push({type:"participant",userJid:h});g.push(d("MAWDbParticipantTxns").bulkUpsertParticiantsInThread(a,f.jid,b).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(a)})}));return d("MAWDexieTable").dexieAll(g).then(function(){return{created:e,thread:f}})}function n(a,b){var c=[d("MAWLoadMessageRequestCapabilitiesTxns").loadMessageRequestDataForThreads([b])];c.push(d("MAWDbParticipantTxns").getParticipantsInThread(a,b.jid).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(a)})}));return d("MAWDexieTable").dexieAll(c).then(function(){return b})}g.getOrSetupOneToOneThread=a;g.bukGetOrSetupOneToOneThread=b;g.getGroupThread=e;g.deleteAllThreadData=j;g.metaSyncChatDeleteThread=f;g.setupOneToOneThread=l;g.processSetupThreadResponse=m;g.processSetupThreadResponseReadOnly=n}),98);
__d("MAWWriteGroupInviteTxns",["MAWBridgeTypesCreators","MAWDbGroupInviteTxns","MAWDbParticipant","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLowLevelApiTypes","MAWThreadManagementTxns","MAWUserJidWrapper","WAGroupInviteUtils","WAJids","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDbThreadTxns").getThread(a,c).then(function(c){return!c.success?d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.MISSING_GROUP:d("MAWDbGroupInviteTxns").maybeGetGroupInvite(a,b.threadJid,b.inviteeJid).then(function(c){return c&&!d("WATimeUtils").isInFuture(c.inviteExpirationTs)?d("MAWLowLevelApiTypes").WRITE_GROUP_INVITE_ERROR.EXISTING_GROUP_INVITE:d("MAWDbGroupInviteTxns").putGroupInvite(a,b)})})}function b(a,b,c,e){var f=b.caption,g=b.groupJid,h=b.inviteCode;b=b.inviteExpiration;var i=d("WAJids").interpretAsUserJid(c);if(g==null||b==null||h==null||i==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError({type:"invalid_args"}));c=[d("WATimeUtils").castLongIntToUnixTime(b),d("WAJids").toGroupJid(g),d("WAGroupInviteUtils").toInviteCode(h)];var j=c[0];b=c[1];var k=c[2],l={folder:e,groupJid:b,inviteCode:k,inviteExpireTs:j,inviterJid:i,type:"group_invite"};return d("MAWThreadManagementTxns").getGroupThread(a,b,e,!0).then(function(b){return b==null?d("WAResultOrError").makeError(l):d("MAWDbParticipantTxns").getParticipant(a,b.thread.jid,i)}).then(function(b){if(!b.success)return d("WAResultOrError").makeError(l);var c=d("MAWUserJidWrapper").getMyUserJid(),e=d("MAWDbParticipant").craftParticipantId(b.value.threadJid,c);return d("MAWDbGroupInviteTxns").putGroupInvite(a,{caption:f==null?void 0:f.text,inviteCode:k,invitedParticipantId:e,inviteeJid:c,inviteExpirationTs:j,inviterJid:i,threadJid:b.value.threadJid}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"GroupInviteUpdate",value:d("MAWBridgeTypesCreators").createBridgeGroupInvite(a)});return d("WAResultOrError").makeResult()})})}g.writeGroupInvite=a;g.writeIncomingGroupInviteMsg=b}),98);
__d("MAWExpiredXMACleaner",["MAWMsgCleaner","WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ExpiredXMACleaner: Adding timestamps backend(",")"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["startExpiredXMACleaner invoked"]);j=function(){return a};return a}var k=null;function a(a){d("WALogger").LOG(j()),k==null&&(k=new(d("MAWMsgCleaner").MsgCleaner)(a,d("MAWMsgCleaner").CLEANER_TYPE.XMA))}function b(a){if(k==null){var b="Trying to add new addNewExpiredXMACleanerTimestamp before the cleaner is initialized!";d("WALogger").ERROR(i(),b);throw c("err")(b)}else d("WALogger").DEV(h(),a),k.update(a)}function e(){return k}function f(){k=null}g.startExpiredXMACleaner=a;g.addNewExpiredXMACleanerTimestamp=b;g.getExpiredXMACleaner_FOR_TESTING_ONLY=e;g.resetExpiredXMACleaner_FOR_TESTING_ONLY=f}),98);
__d("MAWXMAManagementTxns",["MAWDexieTable","MAWMediaManagementTxns","MAWXMAUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f,g){var i=b.unstoredDbXMA,j=b.unstoredFavicon,k=b.unstoredHeaderMedia,l=b.unstoredPreviews;f===void 0&&(f=!1);g===void 0&&(g="wa");var m=new Map(),n=function(b){return b!=null?d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,b,c,g,!0).then(function(a){return[b.plaintextHash,a]}):d("MAWDexieTable").dexieResolve([void 0,void 0])};f||(m.set(j==null?void 0:j.plaintextHash,n(j)).set(k==null?void 0:k.plaintextHash,n(k)),l==null?void 0:l.forEach(function(a){m.set(a==null?void 0:a.plaintextHash,n(a))}));b=Array.from(m.values());return d("MAWDexieTable").dexieAll(b).then(function(b){var g,m=new Map(b),n=((g=l)!=null?g:[]).map(function(a){return m.get(a.plaintextHash)}).filter(Boolean);return h(a,f?d("MAWXMAUtils").buildUnstoredTombstonedXMA(i):i,m.get(j==null?void 0:j.plaintextHash),m.get(k==null?void 0:k.plaintextHash),n,c,e).then(function(a){return{dbMedias:b.map(function(a){a[0];a=a[1];return a}).filter(Boolean),dbXMA:a,firstPreview:n[0]}})})}function h(a,b,d,e,f,g,h){h=babelHelpers["extends"]({},b,{associatedMessageId:(b=h)!=null?b:void 0,defaultPreviewMediaId:(h=f[0])==null?void 0:h.mediaId,defaultPreviewMediaPlaintextHash:(b=f[0])==null?void 0:b.plaintextHash,faviconMediaId:d==null?void 0:d.mediaId,faviconPlaintextHash:d==null?void 0:d.plaintextHash,headerMediaId:e==null?void 0:e.mediaId,headerMediaPlaintextHash:e==null?void 0:e.plaintextHash,msgId:g.msgId,previewMediaIds:f.map(function(a){return a.mediaId})});return a.xma.add(h).then(function(b){return a.xma.get(b)}).then(function(a){if(a==null)throw c("err")("Failed to write XMA to db");return a})}function b(a,b,c,e,f,g,h,i,j,k,l,m,n){var o=d("MAWXMAUtils").isXMAExpired(!1,j.targetExpiringAtSec);h=babelHelpers["extends"]({},j,{associatedMessageId:(j=h)!=null?j:void 0,author:i.author,externalId:i.externalId,isTombstoned:o,msgId:g,offlineAttachmentId:k,targetType:f,threadJid:i.chat});var p=o?h:babelHelpers["extends"]({},h,{defaultPreviewMediaId:(j=b)!=null?j:void 0,defaultPreviewMediaPlaintextHash:(g=l)!=null?g:void 0,faviconMediaId:(k=e)!=null?k:void 0,faviconPlaintextHash:(f=n)!=null?f:void 0,headerMediaId:(i=c)!=null?i:void 0,headerMediaPlaintextHash:(o=m)!=null?o:void 0,previewMediaIds:b!=null?[b]:[]});return a.xma.add(p).then(function(a){return babelHelpers["extends"]({},p,{xmaId:a})})}g.handleUnstoredXMAContent=a;g.saveXMA=b}),98);
__d("MAWWriteXMAMessageTxns",["MAWBridgeMsg","MAWDbXMATxns","MAWDexieTable","MAWExpiredXMACleaner","MAWGetIsMediaDownloadStatusEnabled","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWMsgType","MAWWriteMsgTxns","MAWXMAManagementTxns","MAWXMAUtils","MWPBumpEntityKey","WAJids","WATimeUtils","err","gkx","justknobx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";f=6*d("WATimeUtils").HOUR_SECONDS;var h=new Set([d("MAWMsgType").MSG_TYPE.TEXT,d("MAWMsgType").MSG_TYPE.GIF,d("MAWMsgType").MSG_TYPE.STICKER]);function a(a,b,c,e){var f=c.unstoredAssociatedMedia,g=c.unstoredAssociatedMsg,h=c.unstoredDbXMA;return d("MAWDbXMATxns").maybeGetAssociatedXMAMsg(a,g,e.jid).then(function(c){var i=b;if(c!=null&&c.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT){var j=c.serverTs,k=c.sortOrderMs;c=c.ts;i=babelHelpers["extends"]({},b,{serverTs:j,sortOrderMs:k!=null?k-1:k,ts:c})}j=[h.targetExpiringAtSec,h.targetType];k=j[0];c=j[1];d("MAWXMAUtils").isXMAStoryReaction(c)&&(g==null?void 0:g.msgContent)!=null&&(i=babelHelpers["extends"]({},b,{msgContent:g.msgContent}));j=d("MAWXMAUtils").isXMAExpired(h.isTombstoned,k);i.isExpiredXmaMsg=j;k=!d("MAWXMAUtils").isXMAStoryReaction(c)&&g!=null?d("MAWWriteMsgTxns").prepareMsgWriteData(a,g,e):d("MAWDexieTable").dexieResolve(null);return d("MAWDexieTable").dexieAll([d("MAWWriteMsgTxns").prepareMsgWriteData(a,i,e),k]).then(function(a){var b=a[0];a=a[1];return{associatedData:a,associatedMedia:f,associatedMsg:g,xmaData:b,xmaMsg:i}})})}function b(a,b,e,f,g){var h=e.unstoredDbXMA,i=[h.targetExpiringAtSec,h.targetType],j=i[0];i=i[1];if(b==null||b.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return d("MAWDexieTable").dexieResolve({dbMedias:null,dbXMA:null});b.isExpiredXmaMsg!==!0&&j!=null&&d("MAWExpiredXMACleaner").addNewExpiredXMACleanerTimestamp(j);d("MAWXMAUtils").isXMAStoryReaction(i)&&d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(b)});return d("MAWXMAManagementTxns").handleUnstoredXMAContent(a,babelHelpers["extends"]({},e,{unstoredDbXMA:h}),b,g,b.isExpiredXmaMsg===!0,f).then(function(e){var f=e.dbMedias,g=e.dbXMA;e=e.firstPreview;if(g!=null&&!d("MAWXMAUtils").isXMAStoryReply(g.targetType)&&b.isExpiredXmaMsg!==!0)if(d("MAWGetIsMediaDownloadStatusEnabled").getIsMediaDownloadStatusForXMAsEnabledWithChunkVerification()){var h=new Map(f.map(function(a){return[a.mediaId,a]})),i=g.headerMediaId!=null?h.get(g.headerMediaId):null;h=g.faviconMediaId!=null?h.get(g.faviconMediaId):null;c("promiseDone")(d("MAWHandleXmaTransactionUtil").checkAllMediaChunksAndHandleXmaAfterTransaction(e,h,i,g,a))}else c("promiseDone")(d("MAWHandleXmaTransactionUtil").checkMediaChunkAndHandleXmaAfterTransaction(e,g,a));return{dbMedias:f,dbXMA:g}})}function e(a,b,e,f,g,i,j,k){if(!h.has(g.type))throw c("err")("flow check, this message type is not supported for XMA replies: "+g.type);var l=b.author;if(l==="@system")throw c("err")("wrong author of story reply");var m=d("WAJids").interpretAsUserJid(f);if(m==null)throw c("err")("this is a flow check, participant jid can not be null");var n=(k=k==null?void 0:(k=k[0])==null?void 0:k.plaintextHash)!=null?k:g.plaintextHash;(i?void 0:e==null?void 0:e.defaultPreviewMediaId)!=null&&n==null&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("maw.reply_attachment_media_missing_plaintext_hash","write_xma_message_txns_handle_xma_reply_msg");k={author:l===d("WAJids").AUTHOR_ME?m:d("WAJids").AUTHOR_ME,expirationTs:e.targetExpiringAtSec,externalId:e.externalId,mediaId:i?void 0:e==null?void 0:e.defaultPreviewMediaId,msgId:c("gkx")("458")?e.msgId:void 0,plaintextHash:c("justknobx")._("2969")&&!i?n:void 0,sourceId:(l=(k=e.defaultCTA)==null?void 0:k.nativeUrl)!=null?l:(m=e.defaultCTA)==null?void 0:m.actionUrl,ts:b.ts,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:e.targetType};var o=babelHelpers["extends"]({},g,{mediaId:(l=j==null?void 0:j.mediaId)!=null?l:g.mediaId,quote:{content:k,remoteJid:f}});return a.messages.put(o).then(function(){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:c("justknobx")._("2969")&&!i?d("MAWBridgeMsg").createBridgeMsg(o,void 0,{replyPlaintextHash:n}):d("MAWBridgeMsg").createBridgeMsg(o)})})}g.REVOKE_CONTENT_EXPIRATION_IN_SEC=f;g.XMA_REPLY_MSG_SUPPORTED_TYPES=h;g.prepareXMAWriteData=a;g.handleIncomingXMA=b;g.handleXMAReplyMsg=e}),98);
__d("MAWHandleIncomingMsgApi",["FBLogger","MAWDbMsgTxns","MAWDbRavenActionTxns","MAWDexieTable","MAWEBSwitch","MAWEphemeralAdminMsgBuildTxns","MAWEphemeralMsgTxns","MAWEphemeralSettingsTxns","MAWHIMLogger","MAWJidUtils","MAWMediaManagementTxns","MAWMsgActionType","MAWMsgType","MAWODSProxy","MAWPendingReceiptProcessingTxns","MAWUpdateQuotedMsgTxns","MAWWriteEditTxns","MAWWriteGroupInviteTxns","MAWWriteMsgTxns","MAWWriteReceiverFetchTxns","MAWWriteRevokeMessageTxns","MAWWriteXMAMessageTxns","MAWXMAUtils","WAGetPlatformFromStanzaId","WAJids","WAOdsEnums","WAResultOrError","err","gkx","justknobx","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Could not write dbAssociatedMsg but it exists: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIncomingMsgInternal: Finished writing the incoming message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleIncomingMsgInternal: Finished writing the incoming xma, has associated data = ",""]);j=function(){return a};return a}var k=c("requireDeferred")("ArmadilloReceiveWriteDbSuccessFalcoEvent").__setRef("MAWHandleIncomingMsgApi"),l=c("requireDeferred")("EncryptedBackupTaskSkippedFalcoEvent").__setRef("MAWHandleIncomingMsgApi"),m=d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult(void 0));function a(a,b,c){var e;b.receiveFlow.addPoint("him_write_message_start");var f=((e=b==null?void 0:(e=b.msg)==null?void 0:(e=e.ephemeralSetting)==null?void 0:e.ephemeralExpirationInSec)!=null?e:0)>0;return n(a,b,c).then(function(a){var c;b.receiveFlow.addPoint("him_write_message_end",{bool:{isEphemeralMsg:f,outOfSync:(a==null?void 0:(c=a.value)==null?void 0:c.outOfSyncEphemeralSetting)!=null},string:{msgWrittenResultType:(c=a==null?void 0:(c=a.value)==null?void 0:c.msgType)!=null?c:"unknown"}});f&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.TOTAL_INCOMING_MESSAGE,key:"ephemeralMsgs"});return a})["catch"](function(a){var c;a.message="[handleIncomingMsg] ["+((c=b.type)!=null?c:"")+"/"+b.action+"] "+a.message;throw a})}function n(a,b,e){if(b.action===d("MAWMsgActionType").MSG_ACTION.NO_ACTION)return m;var f=function(c,e,f){return d("MAWEphemeralMsgTxns").syncEphemeralSettingOnIncomingMsg(a,c,e,b.thread,b.device,f)};switch(b.type){case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:return d("MAWWriteMsgTxns").writeNewIncomingMsg(a,b.msg,b.thread,"MAWHandleIncomingMsgApi::handleIncomingMsgInternal",e,b.stanzaSource).then(function(){return d("WAResultOrError").makeResult(null)});case d("MAWMsgType").MSG_TYPE.RAVEN_ACTION:return d("MAWDbRavenActionTxns").writeRavenActionMsg(a,b.msg,b.thread).then(function(){return d("WAResultOrError").makeResult(null)});case d("MAWMsgType").MSG_TYPE.REACTION:return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult({reactToExternalId:b.msg.reactToExternalId}));case d("MAWMsgType").MSG_TYPE.GROUP_INVITE:return d("WAJids").isAuthorMe(b.id.author)?m:d("MAWWriteGroupInviteTxns").writeIncomingGroupInviteMsg(a,b.msg,b.thread.jid,b.folder);case d("MAWMsgType").MSG_TYPE.TEXT:case d("MAWMsgType").MSG_TYPE.FUTUREPROOF:case d("MAWMsgType").MSG_TYPE.IMAGE:case d("MAWMsgType").MSG_TYPE.VIDEO:case d("MAWMsgType").MSG_TYPE.PTT:case d("MAWMsgType").MSG_TYPE.GIF:case d("MAWMsgType").MSG_TYPE.STICKER:case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:case d("MAWMsgType").MSG_TYPE.RAVEN:case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:if(b.action===d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME)return d("MAWWriteMsgTxns").handleDeleteForMeMessage(a,b.msg,b.thread,b.pendingDeleteForMeStanza).then(function(a){return p(a)});var g=b.action===d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT?d("MAWWriteMsgTxns").writeCiphertextUpdate(a,b.msg,b.existingMsg,b.thread,b.existingEditMsgHistory,b.stanzaSource):b.action===d("MAWMsgActionType").MSG_ACTION.REVOKE?d("MAWWriteMsgTxns").handleOutOfOrderRevokedMessage(a,b.msg,b.thread,b.pendingRevokedStanza,b.pendingRevokedStanza!=null):d("MAWWriteEditTxns").writeNewIncomingMsgAndEditHistory(a,b.msg,b.thread,b.editMsgHistories,"MAWHandleIncomingMsgApi::handleIncomingMsgInternal",e,b.stanzaSource);return g.then(function(c){var g=b.type===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH?d("MAWWriteReceiverFetchTxns").handleUnstoredReceiverFetchInfo(a,c,b.receiverFetchInfo):d("MAWDexieTable").dexieResolve(),h=b.media!=null?d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,b.media,c,b.stanzaSource,void 0,void 0,void 0,e):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([g,h]).then(function(e){e[0];var g=e[1];return d("MAWDexieTable").dexieAll([q(a,b.id,c,c.type!==d("MAWMsgType").MSG_TYPE.FUTUREPROOF),f(c,d("MAWJidUtils").getAuthorJid(b.id.author),b.ts)]).then(function(a){a[0];a=a[1];return p(c,a,g==null?null:[g])})}).then(function(e){var f={author:c.author,chat:c.threadJid,externalId:c.externalId};return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f).then(function(c){if(c!=null)return d("MAWUpdateQuotedMsgTxns").associateAllReplies(a,c,b.thread.jid)}).then(function(){return e})})});case d("MAWMsgType").MSG_TYPE.REVOKED:return d("MAWWriteRevokeMessageTxns").writeIncomingRevokeMsg(a,b.msg,b.thread,b.originalMsg,b.previousRevokeMsg,b.ebTimestampMs).then(function(c){return d("MAWDexieTable").dexieAll([q(a,b.id,c),f(c,d("MAWJidUtils").getAuthorJid(b.id.author),b.ts)]).then(function(a){a[0];a=a[1];return p(c,a)})});case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN:return d("MAWEphemeralSettingsTxns").handleAndWriteIncomingEphemeralSetting(a,d("MAWJidUtils").getAuthorJid(b.id.author),b.device,b.msg.ephemeralExpirationInSec,b.msg.ephemeralLastUpdatedOrSetTimestamp,b.msg.isEphemeralSettingReset,b.thread,b.ts,b.id.externalId,!0).then(function(c){return q(a,b.id,c==null?void 0:c.dbMsg).then(function(){return p(c==null?void 0:c.dbMsg,c==null?void 0:c.outOfSyncEphemeralSetting)})});case d("MAWMsgType").MSG_TYPE.ICDC_ALERT:return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult({msgType:void 0,outOfSyncEphemeralSetting:void 0,plaintextHashs:void 0}));case d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION:return d("MAWEphemeralAdminMsgBuildTxns").writeEphemeralScreenshotActionMsg(a,d("MAWJidUtils").getAuthorJid(b.id.author),b.thread,b.ts,b.screenshotActionType,b.id.externalId,b.existingMsg).then(function(c){return d("MAWDexieTable").dexieAll([q(a,b.id,c),f(c,d("MAWJidUtils").getAuthorJid(b.id.author),b.ts)]).then(function(a){a[0];a=a[1];return p(c,a)})});case d("MAWMsgType").MSG_TYPE.XMA:if(b.action===d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME)return d("MAWWriteMsgTxns").handleDeleteForMeMessage(a,b.msg,b.thread,b.pendingDeleteForMeStanza).then(function(a){return p(a)});g=b.action===d("MAWMsgActionType").MSG_ACTION.WRITE_WITH_ASSOCIATED||b.action===d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT_WITH_ASSOCIATED?r(a,b,e):b.action===d("MAWMsgActionType").MSG_ACTION.REVOKE?o(a,b,e):o(a,b,e).then(function(c){return d("MAWWriteXMAMessageTxns").handleIncomingXMA(a,c,b.xma,b.stanzaSource,null).then(function(a){return babelHelpers["extends"]({},a,{dbMsg:c})})});return g.then(function(e){var g=e.dbAssociatedMsg,h=e.dbMedias,i=e.dbMsg;c("MAWHIMLogger").LOG(j(),b.action===d("MAWMsgActionType").MSG_ACTION.WRITE_WITH_ASSOCIATED||b.action===d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT_WITH_ASSOCIATED);return d("MAWDexieTable").dexieAll([q(a,b.id,i,!0,g),f(i,d("MAWJidUtils").getAuthorJid(b.id.author),b.ts)]).then(function(c){c[0];var e=c[1];return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b.id).then(function(c){if(c!=null)return d("MAWUpdateQuotedMsgTxns").associateAllReplies(a,c,b.thread.jid)}).then(function(){return e})}).then(function(a){return p(i,a,h)})});default:throw c("err")("We do not support handleIncomingMsgInternal with type: "+((g=b.type)!=null?g:""))}}function o(a,b,c){return b.action===d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT||b.action===d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT_WITH_ASSOCIATED?d("MAWWriteMsgTxns").writeCiphertextUpdate(a,b.msg,b.existingMsg,b.thread,null,b.stanzaSource):b.action===d("MAWMsgActionType").MSG_ACTION.REVOKE?d("MAWWriteMsgTxns").handleOutOfOrderRevokedMessage(a,b.msg,b.thread,b.pendingRevokedStanza,b.pendingRevokedStanza!=null):d("MAWWriteMsgTxns").writeNewIncomingMsg(a,b.msg,b.thread,"MAWHandleIncomingMsgApi::writeXmaMsg",c,b.stanzaSource)}function p(a,b,c){return d("WAResultOrError").makeResult({msgType:a==null?void 0:a.type,outOfSyncEphemeralSetting:(a=b)!=null?a:void 0,plaintextHashs:c==null?void 0:c.map(function(a){return a.plaintextHash})})}function q(a,b,e,f,g){var h=b.author,j=b.chat,m=b.externalId;f===void 0&&(f=!1);if(e==null)return d("MAWDexieTable").dexieResolve();void k.load().then(function(a){return a.log(function(){return{encrypted_backup_enable:c("MAWEBSwitch").isEnabled(),message_id:m}})});(!f||!c("MAWEBSwitch").isEnabled())&&void l.load().then(function(a){return a.log(function(){return{message_id:m,skipped_reason:"Msg type: "+e.type+", EB enabled: "+c("MAWEBSwitch").isEnabled().toString()}})});if(e==null)return d("MAWDexieTable").dexieResolve();b=d("MAWPendingReceiptProcessingTxns").processPendingReceipts(a,j,e);f=h===d("WAJids").AUTHOR_ME&&g!=null&&g.type!==d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME?d("MAWPendingReceiptProcessingTxns").processPendingReceipts(a,j,g):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([b,f]).then(function(){c("MAWHIMLogger").LOG(i())})}function r(a,b,e){e===void 0&&(e=!0);b.associatedMsg.externalId===b.msg.externalId&&c("FBLogger")("maw_db").mustfix("[handleIncomingXMAWithAssociatedData] associatedMsg and msg have the same externalId, platform %s",d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(b.msg.externalId));var f=b.existingAssociatedMsg,g;f!=null&&c("gkx")("1760")?f.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?g=d("MAWWriteMsgTxns").writeCiphertextUpdate(a,b.associatedMsg,f,b.thread,null,b.stanzaSource):g=d("MAWDexieTable").dexieResolve(f):g=d("MAWWriteMsgTxns").writeNewIncomingMsg(a,b.associatedMsg,b.thread,"MAWHandleIncomingMsgApi::handleIncomingXMAWithAssociatedData",e,b.stanzaSource);return g.then(function(f){return f.type===d("MAWMsgType").MSG_TYPE.REVOKED&&c("justknobx")._("2848")?d("MAWDexieTable").dexieResolve({dbAssociatedMsg:null,dbMedias:null,dbMsg:null}):o(a,b,e).then(function(c){if(b.associatedMedia!=null)return d("MAWMediaManagementTxns").handleUnstoredDbMedia(a,b.associatedMedia,f,b.stanzaSource).then(function(d){return s(a,c,f,b.xma,b.msg,b.associatedMsg,b.thread.jid,b.stanzaSource,d)});else return s(a,c,f,b.xma,b.msg,b.associatedMsg,b.thread.jid,b.stanzaSource)})})}function s(a,b,e,f,g,i,j,k,l){return d("MAWWriteXMAMessageTxns").handleIncomingXMA(a,b,f,k,e.msgId).then(function(f){var k=f.dbMedias;f=f.dbXMA;e==null&&c("MAWHIMLogger").ERROR(h(),i.externalId);return(e!=null&&f!=null&&d("MAWXMAUtils").isXMAStoryReply(f.targetType)?d("MAWWriteXMAMessageTxns").handleXMAReplyMsg(a,g,f,j,e,g.isExpiredXmaMsg===!0,l,k):d("MAWDexieTable").dexieResolve()).then(function(){return l!=null?{dbAssociatedMsg:e,dbMedias:k!=null?[].concat(k,[l]):[l],dbMsg:b}:{dbAssociatedMsg:e,dbMedias:k,dbMsg:b}})})}g.handleIncomingMsg=a;g.processReceipts=q}),98);
__d("MAWLinkReactionsToMsgsTxns",["MAWDbMsgTxns","MAWDbReactionUtils","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a.reduce(function(a,b){var c,d={author:b.reactToAuthor,chat:b.threadJid,externalId:b.reactToExternalId};c=(c=a.get(d))!=null?c:[];c.push(b);return a.set(d,c)},new(d("WAMsgMap").MsgMap)())}function i(a){a.forEach(function(a){d("MAWDbReactionUtils").dispatchReaction(a)})}function j(a,b){return a.reactions.where("reactToExternalId").anyOf(b).toArray().then(function(a){return h(a.filter(function(a){return a.reactToMsgId==null}))})}function a(a,b){return j(a,b).then(function(b){return d("MAWDbMsgTxns").getMsgsByProtocolMsgId(a,b.keys()).then(function(a){return a.flatMap(function(a){var c={author:a.author,chat:a.threadJid,externalId:a.externalId};c=(c=b.get(c))!=null?c:[];return c.map(function(b){b.reactToMsgId=a.msgId;return b})})})})}function b(a,b){return a.reactions.bulkPut(b).then(function(){i(b)})}g.getReactionLinkUpdatesForExternalIds=a;g.updateReactionLinks=b}),98);
__d("MAWLinkReactionsToMsgsApi",["MAWIndexedDb","MAWLinkReactionsToMsgsTxns","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MAWIndexedDb").makeMsgrTransactor({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READONLY},"linkReactionsToMsgs",function(a){return function(b){return d("MAWLinkReactionsToMsgsTxns").getReactionLinkUpdatesForExternalIds(a,b).then(function(b){return d("MAWLinkReactionsToMsgsTxns").updateReactionLinks(a,b)})}});function a(a){return h(a)}g.linkReactionsToMsgs=a}),98);
__d("MAWOfflineThreadTxns",["MAWBridgeThread","MAWDbGroupInfoTxns","MAWDbParticipantTxns","MAWDbThread","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLoadMessageRequestCapabilitiesTxns","MAWUserJidWrapper","MAWWriteBulkWriteIncomingAdminMsgTxns","WAArrayZip","WAJids","WATagsLogger","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Duplicated thread creation for ",""]);h=function(){return a};return a}var i=new Set();function a(a,b,c){var e=[],f=new Set(b),g=new Map(),k=new Map();c.forEach(function(a){k.set(a.jid,"exists"),g.set(a.jid,a),f["delete"](a.jid),e.push(a)});f.forEach(function(a){i.has(a)&&d("WATagsLogger").TAGS(["occamadillo","incoming_processing"]).LOG(h(),a)});return n(a,f).then(function(b){b.oneToOneThreadsCreationData.forEach(function(a){i.add(a.thread.jid)});b.groupThreadsCreationData.forEach(function(a,b){i.add(b),a.groupInfo==null&&k.set(b,"missing")});return a.threads.bulkAdd(o(b),{allKeys:!0}).then(function(b){return d("MAWDbThreadTxns").getThreads(a,Array.from(f.values())).then(function(b){e.push.apply(e,b);l(e);var c=p(b);return d("MAWDexieTable").dexieAll([j(a,c),d("MAWWriteBulkWriteIncomingAdminMsgTxns").writeE2EEAdminMsgsForIncomingCreatedThreads(a,b)]).then(function(){b.forEach(function(a){return g.set(a.jid,a)});return{threadCreationResult:k,threads:g}})})})})}function j(a,b){return d("MAWDexieTable").dexieAll([k(a,b),d("MAWLoadMessageRequestCapabilitiesTxns").loadMessageRequestDataForThreads(Array.from(b.values()))])}function k(a,b){var e=[],f=d("MAWUserJidWrapper").getMyUserJid();b.forEach(function(a,b){e.push({threadJid:b,type:"participant",userJid:b}),f!==b&&e.push({threadJid:b,type:"participant",userJid:f})});return d("MAWDbParticipantTxns").bulkAddParticipantsInThreads(a,e).then(c("emptyFunction"))}function l(a){a.forEach(function(a){return d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(a,a.optimisticThreadKey,void 0,"createAllThreadsForOfflineMsgs")})})}function m(a,b){return{folder:null,jid:a,lastReadMsg:null,lastReadMsgReceiptSent:null,lastReadMsgTs:null,newestMsg:null,newestMsgTs:b!=null?d("WATimeUtils").castUnixTimeToMillisTime(b):null,oldestMsg:null,optimisticThreadKey:void 0,threadOrder:d("MAWDbThread").craftThreadOrder(d("WATimeUtils").millisTime(),a)}}function n(a,b){var c=[],e=[];b.forEach(function(a){d("WAJids").switchOnMsgrChatJidType(a,{group:function(a){return c.push(a)},user:function(a){return e.push(a)}})});return d("MAWDbGroupInfoTxns").getGroupInfos(a,c).then(function(a){var b=new Map(d("WAArrayZip").zip(c,a));a=new Map(c.map(function(a){var c=b.get(a);return[a,{groupInfo:c,thread:m(a,c==null?void 0:c.creationTs)}]}));var f=new Map(e.map(function(a){return[a,{thread:m(a,null)}]}));return{groupThreadsCreationData:a,oneToOneThreadsCreationData:f}})}function o(a){var b=a.groupThreadsCreationData;a=a.oneToOneThreadsCreationData;return Array.from(b.values()).map(function(a){a=a.thread;return a}).concat(Array.from(a.values()).map(function(a){a=a.thread;return a}))}function p(a){var b=new Map();a.forEach(function(a){d("WAJids").switchOnMsgrChatJidType(a.jid,{group:c("emptyFunction"),user:function(c){return b.set(c,a)}})});return b}g.createAllThreadsForOfflineMsgs=a}),98);
__d("MAWPreprocessMsgs",["FBLogger","LSMEBTaskCreationSource","MAWBuildIncomingMsgs","MAWDbMsgTxns","MAWDexieTable","MAWHIMLogger","MAWMediaManagementTxns","MAWMsgActionType","MAWMsgType","MAWWriteMsgTxns","MAWWriteXMAMessageTxns","WAGlobals","WAJids","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unsupported message type on preprocessing ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media is null for StanzaID ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Preparing media for msg with StanzaID ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpected msg type when writing ephemeral setting message. Should not happen"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["No unstored content for incoming message: SHOULD NEVER HAPPEN"]);l=function(){return a};return a}var m=c("MAWHIMLogger").TAGS(["MAWPreprocessMsgs"]);function a(a){var b=[],c=[];a.forEach(function(a){var d=a.msgData;a=a.unstoredContent;switch(d.type){case"IncomingMsg":if(a==null){m.ERROR(l());return}var e=a.unstoredDbEditActionMsg;a=a.unstoredDbReaction;if(a!=null){a={chatJid:d.id.chat,unstoredReaction:a};b.push(a)}e!=null&&c.push({chatJid:d.id.chat,msg:e});break;case"IncomingCiphertextMsg":default:break}});return{editActionMsgs:c,reactionMsgs:b}}function b(a,b,c,d){b.receiveFlow.addPoint("him_get_preprocessing_data_start");return n(a,b,c,d).then(function(a){var c;b.receiveFlow.addPoint("him_get_preprocessing_data_end",{string:{action:a.action,type:(c=a.type)!=null?c:""}});return a})}function n(a,b,e,f){var g=b.msgData,l=b.receiveFlow,n=b.stanzaSource,p=b.unstoredContent;b=g.folder;var q=g.id,r=g.ts,s={id:q,receiveFlow:l,stanzaSource:n,thread:e,ts:r},t=d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.NO_ACTION,msg:null,type:null}));switch(g.type){case"IncomingMsg":if(p==null)return t;var u=g.device,v=p.unstoredDbMsg;l=p.unstoredDbRavenActionMsg;var w=p.unstoredDbReaction,x=p.unstoredDbReceiverFetchInfo,y=p.unstoredIncomingDbGroupInvite;if(l!=null)return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:l,type:d("MAWMsgType").MSG_TYPE.RAVEN_ACTION}));else if(w!=null)return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:w,type:d("MAWMsgType").MSG_TYPE.REACTION}));else if(y!=null)return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:u,folder:b,msg:y,type:d("MAWMsgType").MSG_TYPE.GROUP_INVITE}));else if(v==null)return t;else if(v.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_ADMIN){l=g.msg;if(l.version==="v3"&&l.type==="ephemeral")return d("MAWDexieTable").dexieResolve(babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:u,msg:l,type:v.type}));else{m.ERROR(k());return t}}else if(v.type===d("MAWMsgType").MSG_TYPE.TEXT||v.type===d("MAWMsgType").MSG_TYPE.FUTUREPROOF)return d("MAWWriteMsgTxns").prepareTextMsgWriteData(a,v,e).then(function(a){var b=a.editMsgHistories,e=a.existingEditMsgHistory,f=a.existingMsg,g=a.isDeletedWithThread,h=a.isDeleteForMeOrRevoked,i=a.pendingDeleteForMeStanza;a=a.pendingRevokedStanza;var j=o(f,v,e);if(h||g||f!=null&&j!==!0)return t;if(j&&f!=null)return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT,device:u,existingEditMsgHistory:e,existingMsg:f,msg:v,type:v.type});if(i!=null)return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME,msg:v,pendingDeleteForMeStanza:i,type:v.type});return a!=null?babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.REVOKE,device:u,msg:v,pendingRevokedStanza:a,type:v.type}):babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:u,editMsgHistories:b,msg:c("justknobx")._("3227")&&n==="ebrestore"?babelHelpers["extends"]({},v,{source:"eb_restore"}):v,type:v.type})});else if(v.type===d("MAWMsgType").MSG_TYPE.IMAGE||v.type===d("MAWMsgType").MSG_TYPE.VIDEO||v.type===d("MAWMsgType").MSG_TYPE.PTT||v.type===d("MAWMsgType").MSG_TYPE.GIF||v.type===d("MAWMsgType").MSG_TYPE.STICKER||v.type===d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE||v.type===d("MAWMsgType").MSG_TYPE.RAVEN){v.type===d("MAWMsgType").MSG_TYPE.IMAGE&&((w=g.msg.metadata)==null?void 0:w.groupId)!=null&&(v.groupId=g.msg.metadata.groupId,v.groupIndex=g.msg.metadata.groupIndex,v.groupSize=g.msg.metadata.groupSize);v.type===d("MAWMsgType").MSG_TYPE.IMAGE&&(p==null?void 0:(b=p.unstoredDbMedia)==null?void 0:(y=b.validatedImageInfo)==null?void 0:y.hdType)!=null&&(v.hdType=p==null?void 0:p.unstoredDbMedia.validatedImageInfo.hdType);m.LOG(j(),v.externalId);return d("MAWMediaManagementTxns").prepareMediaWriteData(a,v,p==null?void 0:p.unstoredDbMedia,e).then(function(a){var b=a.existingMsg,e=a.isDeletedWithThread,g=a.isDeleteForMeOrRevoked,h=a.pendingDeleteForMeStanza,j=a.pendingRevokedStanza;a=a.shouldDropDocument;var k=[p==null?void 0:p.unstoredDbMedia,o(b,v)],l=k[0];k=k[1];l==null&&m.LOG(i(),v.externalId);if(c("justknobx")._("3227")&&n==="ebrestore"&&b!=null&&l!=null&&b.source==="media_restore")return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT,device:u,existingMsg:b,media:l,msg:babelHelpers["extends"]({},v,{source:f===c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE?"media_restore":"eb_restore"}),type:v.type});if(a===!0||g||e||l==null||b!=null&&!k)return t;if(k&&b!=null)return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT,device:u,existingMsg:b,media:l,msg:v,type:v.type});if(h!=null)return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME,msg:v,pendingDeleteForMeStanza:h,type:v.type});return j!=null?babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.REVOKE,device:u,msg:v,pendingRevokedStanza:j,type:v.type}):babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:u,media:l,msg:c("justknobx")._("3227")&&n==="ebrestore"?babelHelpers["extends"]({},v,{source:f===c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE?"media_restore":"eb_restore"}):v,type:v.type})})}else if(v.type===d("MAWMsgType").MSG_TYPE.XMA){var z=p==null?void 0:p.unstoredXMA;return z==null?t:d("MAWWriteXMAMessageTxns").prepareXMAWriteData(a,v,z,e).then(function(a){var b=a.xmaData.existingMsg,e=o(b,v),f=c("justknobx")._("3227")&&n==="ebrestore"?babelHelpers["extends"]({},a.xmaMsg,{source:"eb_restore"}):a.xmaMsg;if(a.associatedMsg!=null&&a.associatedData!=null&&!a.associatedData.isDeletedWithThread&&!a.associatedData.isDeleteForMeOrRevoked){var g,h=a.associatedMsg,i=a.associatedData.existingMsg;if(e&&b!=null)return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT_WITH_ASSOCIATED,associatedMsg:h,device:u,existingAssociatedMsg:i,existingMsg:b,msg:f,type:v.type,xma:z});if(b!=null&&a.associatedData.existingMsg!=null)return t;if([b,(g=a.associatedData)==null?void 0:g.existingMsg].filter(function(a){return a==null}).length===1){c("FBLogger")("maw_db").mustfix("[duplicate msgs] XMA and associated inconsistency: existing message not found for %s, xmaMessageType: %s, authorMe: %s, xma data: existingMsgType: %s, isDeletedWithThread: %s, isDeleteForMeOrRevoked: %s, hasPendingDeleteForMeStanza: %s, hasPendingRevokedStanza: %s, associated data: existingMsgType: %s, isDeletedWithThread: %s, isDeleteForMeOrRevoked: %s, hasPendingDeleteForMeStanza: %s, hasPendingRevokedStanza: %s",b==null?"XMA":"Associated",f==null?void 0:f.xmaMessageType,d("WAJids").isAuthorMe(f==null?void 0:f.author),b==null?void 0:b.type,(g=a.xmaData)==null?void 0:g.isDeletedWithThread,(g=a.xmaData)==null?void 0:g.isDeleteForMeOrRevoked,((g=a.xmaData)==null?void 0:g.pendingDeleteForMeStanza)!=null,((g=a.xmaData)==null?void 0:g.pendingRevokedStanza)!=null,i==null?void 0:i.type,(g=a.associatedData)==null?void 0:g.isDeletedWithThread,(g=a.associatedData)==null?void 0:g.isDeleteForMeOrRevoked,((g=a.associatedData)==null?void 0:g.pendingDeleteForMeStanza)!=null,((g=a.associatedData)==null?void 0:g.pendingRevokedStanza)!=null)}return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE_WITH_ASSOCIATED,associatedMedia:a.associatedMedia,associatedMsg:h,device:u,existingAssociatedMsg:i,msg:f,type:v.type,xma:z})}if(e&&b!=null)return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT,device:u,existingMsg:b,msg:f,type:v.type,xma:z});g=a.xmaData;h=g.isDeletedWithThread;i=g.isDeleteForMeOrRevoked;e=g.pendingDeleteForMeStanza;g=g.pendingRevokedStanza;if(h||i||b!=null)return t;if(e!=null)return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME,msg:a.xmaMsg,pendingDeleteForMeStanza:e,type:v.type});return g!=null?babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.REVOKE,device:u,msg:a.xmaMsg,pendingRevokedStanza:g,type:v.type}):babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:u,msg:f,type:v.type,xma:z})})}else if(v.type===d("MAWMsgType").MSG_TYPE.REVOKED)return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,v.revokedExternalId,e.jid,q.author),d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,v.externalId,e.jid,q.author)]).then(function(a){var b=a[0];a=a[1];return a!=null?t:babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:u,ebTimestampMs:v.ebTimestampMs,msg:v,originalMsg:b,previousRevokeMsg:a,type:v.type})});else if(v.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SCREENSHOT_ACTION){l=d("WAJids").isAuthorMe(q.author)?d("WAGlobals").getMyUserJid():q.author;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,q.externalId,e.jid,l)]).then(function(a){a=a[0];return babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:u,existingMsg:a,screenshotActionType:v.msgContent.screenshotActionType,type:v.type})})}else if(v.type===d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE)return d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,q.externalId,e.jid,q.author).then(function(a){return a!=null?t:babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:u,msg:v,type:v.type})});else if(v.type===d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH&&x!=null)return d("MAWDbMsgTxns").maybeGetMsgByExternalId(a,q.externalId,e.jid,q.author).then(function(a){return a!=null?t:babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,device:u,msg:v,receiverFetchInfo:x,type:v.type})});else{m.ERROR(h(),v.type);return t}case"IncomingCiphertextMsg":if(!((w=g==null?void 0:g.createPlaceholder)!=null?w:!1))return t;var A=d("MAWBuildIncomingMsgs").buildUnstoredCiphertextMsg(q,r);return d("MAWWriteMsgTxns").prepareMsgWriteData(a,A,e).then(function(a){var b=a.existingMsg,c=a.isDeletedWithThread;a=a.isDeleteForMeOrRevoked;return a||c||b!=null?t:babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:A,type:d("MAWMsgType").MSG_TYPE.CIPHERTEXT})});case"UnavailableMsg":case"FrankingInvalidMsg":var B=d("MAWBuildIncomingMsgs").buildUnstoredUnavailableMsg(q,r);return d("MAWWriteMsgTxns").prepareMsgWriteData(a,B,e).then(function(a){var b=a.existingMsg,c=a.isDeletedWithThread;a=a.isDeleteForMeOrRevoked;return a||c||b!=null?t:babelHelpers["extends"]({},s,{action:d("MAWMsgActionType").MSG_ACTION.WRITE,msg:B,type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE})})}}function o(a,b,c){if(a==null&&c==null)return!1;return b.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?!1:(a==null?void 0:a.type)===d("MAWMsgType").MSG_TYPE.CIPHERTEXT||(c==null?void 0:c.msgContent.content)===""}g.classifyIncomingMsgs=a;g.getMessageDataByType=b;g.isCiphertextUpdate=o}),98);
__d("MAWSharedOfflineQueueMetric",["$InternalEnum","FBLogger","WAGlobals","WAPREList","WATagsLogger","WATimeUtils","WAWaterFlow"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["New mailbox age is ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["New mailbox age is ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Waterflow should start before the start of the processing"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Possible stuck reason: ",""]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS(["offline-resume"]);f=b("$InternalEnum").Mirrored(["OFFLINE","ONLINE"]);var m=b("$InternalEnum").Mirrored(["WA_CLIENT_INFRA","WA_CLIENT_INFRA_DUPLICATED_START","WA_PASSIVE_MODE","WA_PASSIVE_MODE_FAIL","MAW_INFRA","MAW_STUCK","WA_STUCK","MAW_NOT_IDLE_OQ"]),n=function(){function a(a,b,c,e){this.$1=0,this.$3=c,this.$2=d("WAWaterFlow").makeWaterflow("offline-resume",d("WAPREList").PRE_METRIC.OFFLINE_QUEUE),this.$6(a),this.$7(),this.$8(b),this.$9(e),this.$4=Math.round(d("WATimeUtils").performanceAbsoluteNow()/1e3)}var b=a.prototype;b.$8=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"passive-mode-start":b.$2.isOnGoing()||b.$2.startMetric();b.$2.startPoint(m.WA_PASSIVE_MODE,{passiveModeAcks:a.count});b.$10("wa");break;case"passive-mode-end":b.$2.endPoint(m.WA_PASSIVE_MODE);b.$10("wa");break;default:a.type,b.$2.addPoint(m.WA_PASSIVE_MODE_FAIL),b.$10("wa")}})};b.$9=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"new-message":if(a.commonMessageBase.offline==null)return;b.addWAMessage();b.$10("wa");break}})};b.$6=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"offline-start":b.$11(a.offlineStats);b.$10("wa");break;case"offline-end":b.$2.isOnGoing()&&(b.$2.endPoint(m.WA_CLIENT_INFRA),b.$10("maw"));break;case"offline-entity":b.$12(a.serverTs,a.offline);b.$10("wa");break;case"offline-processed":b.$13(a.count);b.$10("wa");break;case"connection-lost":b.$2.isOnGoing()&&b.$2.endFail("connection-lost",{isConnectionLost:!0});b.$14();break;default:a}})};b.$10=function(a){var b=this;clearTimeout(this.$5);this.$2.isOnGoing()&&(this.$5=setTimeout(function(){b.$2.isOnGoing()&&(a==="wa"?b.$2.addPoint(m.WA_STUCK,{waStuck:!0}):b.$2.addPoint(m.MAW_STUCK,{mawStuck:!0}),l.WARN(k(),a))},d("WAGlobals").getConfig().offlineQueueStuckTimeoutMs()))};b.$14=function(){clearTimeout(this.$5)};b.$7=function(){var a=this;this.$3.subscribe(function(b){switch(b.type){case"idle-oq-safe-guard":if(!a.$2.isOnGoing())break;a.$2.addPoint(m.MAW_NOT_IDLE_OQ);break;case"maw-infra-start":if(!a.$2.isOnGoing())break;a.$10("maw");a.$2.startPoint(m.MAW_INFRA);break;case"maw-infra-batch":a.$2.isOnGoing()||(a.$2.startMetric(),a.$2.startPoint(m.MAW_INFRA));a.$10("maw");a.$2.reAnnotate(function(a){a=a.mawInfraBatchCount;return{mawInfraBatchCount:((a=a)!=null?a:0)+1}});break;case"maw-infra-end":if(!a.$2.isOnGoing())break;a.$2.endPoint(m.MAW_INFRA);a.$14();b.success?a.$2.endSuccess():a.$2.endFail("fail");break;default:b}})};b.addWAMessage=function(){this.$2.isOnGoing()&&(this.$2.reAnnotate(function(a){a=a.waMessage;return{waMessage:((a=a)!=null?a:0)+1}}),this.$10("wa"))};b.addMAWEntity=function(a){this.$2.isOnGoing()&&(this.$2.reAnnotate(function(b){b=b.mawProcessedCount;return{mawProcessedCount:((b=b)!=null?b:0)+a}}),this.$10("maw"))};b.$11=function(a){this.$2.isOnGoing()?this.$2.addPoint(m.WA_CLIENT_INFRA_DUPLICATED_START):(this.$1++,this.$2.startMetric(),this.$4=Math.round(d("WATimeUtils").performanceAbsoluteNow()/1e3)),this.$2.startPoint(m.WA_CLIENT_INFRA,{batchSize:d("WAGlobals").getConfig().batchSize(),expectedAppdata:a.appdata,expectedCount:a.count,expectedMessage:a.message,expectedNotification:a.notification,expectedReceipt:a.receipt,offlineResumeCount:this.$1,waDanglingQueue:d("WAGlobals").getConfig().waDanglingQueue()})};b.getDetails=function(){var a;return((a=this.$2)==null?void 0:a.getAnnotations())||{}};b.$13=function(a){var b;(b=this.$2)==null?void 0:b.reAnnotate(function(b){return{waProcessed:((b=b.waProcessed)!=null?b:0)+a}})};b.addRuntimeErrorDuringOffflineQueue=function(){if(this.$2.isOnGoing()){var a;(a=this.$2)==null?void 0:a.reAnnotate(function(a){return{runtimeErrors:((a=a.runtimeErrors)!=null?a:0)+1}})}};b.addDecryptionError=function(){if(this.$2.isOnGoing()){var a;(a=this.$2)==null?void 0:a.reAnnotate(function(a){return{decryptErrors:((a=a.decryptErrors)!=null?a:0)+1}})}};b.addRetriesTrack=function(a){if(this.$2.isOnGoing()){var b;(b=this.$2)==null?void 0:b.reAnnotate(function(b){return{retries:((b=b.retries)!=null?b:0)+a}})}};b.$12=function(a,b){var c=this;if(!this.$2.isOnGoing()){l.WARN(j());return}this.$2.reAnnotate(function(d){var e=d.mailboxAgeSec,f=d.maxOffline;d=d.waDownloaded;e=e;e==null&&a!=null&&(e=c.$4-a,l.LOG(i(),e));e!=null&&a!=null&&(c.$4-a>e&&(e=c.$4-a,l.LOG(h(),e)));return{mailboxAgeSec:e,maxOffline:Math.max((e=f)!=null?e:0,b),waDownloaded:((f=d)!=null?f:0)+1}})};return a}(),o;function a(a,b,d,e){if(o!=null){var f=o;c("FBLogger")("messenger_e2ee_web").mustfix("Offline sync reported is inited twice");return f}o=new n(a,b,d,e);return o}function e(){if(o==null){c("FBLogger")("messenger_e2ee_web").mustfix("Offline sync reported is not inited");return null}return o}g.OfflineMode=f;g.OfflineStages=m;g.makeOfflineQueueMetric=a;g.getOfflineQueueMetric=e}),98);
__d("MAWSharedOfflineResumeUINotifier",["MAWBridge","MAWQplProxy","MAWSharedProtocolQueueConst","WAOfflineUtils","WATagsLogger","WAThrottle","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose([' -> Unable to send "Offline Complete" event ',""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose([' -> "Offline Complete" bridge event sent']);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAW UI: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Set thread metadata: ",", ",""]);k=function(){return a};return a}var l=1e3/3,m=d("WATagsLogger").TAGS(["ProtocolQueue","MAWConsumer"]);a=function(){function a(){var a=this;this.$1={};this.$2={};this.$3=0;this.$4="wa";this.$5=!1;this.$6=0;this.$7=0;this.$8=0;this.$9=0;this.$10=null;this.$16=d("WAThrottle").throttle(function(){if(a.$5)return;a.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing)},l);this.$12=d("WAThrottle").throttle(function(){a.$4==="wa"&&a.$5===!1&&a.$11(d("WAOfflineUtils").WAClientInfraOfflineProgress.Processing)},l)}var b=a.prototype;b.subscribeToWAEvents=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"offline-start":b.$10=d("MAWQplProxy").performanceAbsoluteNow();b.$6=a.offlineStats.count;b.$8=a.offlineStats.message;b.$11(d("WAOfflineUtils").WAClientInfraOfflineProgress.Initializing,b.$10);b.$5=!1;b.$4="wa";break;case"offline-processed":break;case"offline-entity":b.$7++;b.$12();break;case"offline-end":b.$11(d("WAOfflineUtils").WAClientInfraOfflineProgress.Complete);b.$4="maw";break;case"connection-lost":b.$11(d("WAOfflineUtils").WAClientInfraOfflineProgress.Failed);break;default:a}})};b.subscribeToMawEvents=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"maw-infra-start":b.$10==null&&(b.$10=d("MAWQplProxy").performanceAbsoluteNow());b.$13();break;case"maw-infra-end":a.success?b.notifyUICurrentProcessingSucceeded():b.$14();b.$10=null;break}})};b.subscribeToMessageEvents=function(a){var b=this;a.subscribe(function(a){switch(a.type){case"new-message":if(a.commonMessageBase.offline==null)return;b.addWAMessage();break}})};b.addWAMessage=function(){this.$9++,this.$12()};b.$13=function(){this.$3=0,this.$5=!1,this.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Initializing)};b.setThreadMetadata=function(a){var b=a.reduce(function(a,b){a[b.from]=b.t;return a},{});a=a.reduce(function(a,b){b=b.from;a[b]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing};return a},{});m.DEV(k(),JSON.stringify(b),JSON.stringify(a));this.$1=b;this.$2=a};b.notifyUIChatReady=function(a){this.$2[a]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete},this.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Processing)};b.updateChatState=function(a){var b=this;Object.entries(a).forEach(function(a){var c=a[0];a=a[1];if(b.$1[c]!=null){var e=b.$1[c];a>=e&&(b.$2[c]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete})}});this.$16()};b.addMAWEntity=function(a){this.$3+=a,this.$16()};b.notifyUICurrentProcessingSucceeded=function(){var a=this;Object.keys(this.$2).forEach(function(b){a.$2[b]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete}});this.$5=!0;this.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete);this.$1={};this.$2={}};b.$14=function(){var a=this;Object.keys(this.$2).forEach(function(b){a.$2[b]={chatStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete,snippetStatus:d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete}});this.$15(d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Failed);this.$1={};this.$2={}};b.maybeNotifyUI=function(){this.$16()};b.$11=function(a,b){d("MAWBridge").getBridge().fireAndForget("event","offlineSnapshot",{downloaded:{count:this.$7,message:this.$9},expected:{count:this.$6,message:this.$8},status:a,timestamp:b!=null?b:d("MAWQplProxy").performanceAbsoluteNow()})};b.$15=function(a){var b=d("MAWQplProxy").performanceAbsoluteNow();b={chatJidStatus:this.$2,startTime:this.$10!=null?this.$10:null,status:a,timestamp:b,totalExpectedCount:this.$6,totalProcessedCount:this.$3};m.LOG(j(),JSON.stringify(b));a===d("MAWSharedProtocolQueueConst").OfflineConsumerStatus.Complete?c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("event","offlineConsumerProgress",b),function(){m.LOG(i())},function(a){m.ERROR(h(),a)}):d("MAWBridge").getBridge().fireAndForget("event","offlineConsumerProgress",b)};return a}();b=new a();g.ConsumerUINotifier=a;g.offlineResumeUINotifier=b}),98);
__d("MAWLoadGroupInvitesTxns",["MAWBridgeTypesCreators","MAWDbGroupInviteTxns","MAWDexieTable","MAWIndexedDb","MAWUserJidWrapper","WAJids","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=[],f=d("MAWUserJidWrapper").getMyUserJid();b.forEach(function(b){return d("WAJids").switchOnMsgrChatJidType(b.jid,{group:function(){e.push(d("MAWDbGroupInviteTxns").getGroupInvitesByThreadAndInvitedParticipant(a,b.jid,f))},user:c("emptyFunction")})});return d("MAWDexieTable").dexieAll(e).then(function(a){a.forEach(function(a,b){a.forEach(function(b,a){d("MAWIndexedDb").afterTransaction({tag:"GroupInviteUpdate",value:d("MAWBridgeTypesCreators").createBridgeGroupInvite(b)})})})})}g.loadGroupInvites=a}),98);
__d("MAWLoadMsgsTxns",["MAWBridgeMsg","MAWBridgeMsgCountdown","MAWBridgeTypesCreators","MAWDbChunkTxns","MAWDbEditMsgHistoryTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDbReactionUtils","MAWDbReactionsTxns","MAWDbXMATxns","MAWDexieTable","MAWHandleXmaTransactionUtil","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWLoggerUtils","MAWMediaAfterTxns","MAWXMAUtils","WATagsLogger","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCounter: Showing UI counter for ",""]);h=function(){return a};return a}function i(a,b){return d("MAWDbMediaTxns").getMsgMediaPairFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b[0],e=b[1];return d("MAWDbChunkTxns").hasMediaChunk(a,e.hashedPlaintextHash).then(function(b){d("MAWMediaAfterTxns").handleNewMediaAfterTxn(c,e,b,a)})}))})}function j(a,b){return d("MAWDbXMATxns").getXMAFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return;return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.defaultPreviewMediaId).then(function(e){c("promiseDone")(d("MAWHandleXmaTransactionUtil").checkMediaChunkAndHandleXmaAfterTransaction(e,b,a))})}))})}function k(a,b){return d("MAWDbReactionsTxns").getReactionsFromMessages(a,b).then(function(a){a.forEach(function(a){return d("MAWDbReactionUtils").dispatchReaction(a)});return a})}function a(a,b,c,e,f,g,l){f===void 0&&(f=!1);l===void 0&&(l=null);return d("MAWDbMsgTxns").getMsgsFromOffset(a,b,c,e,f,!1,g,l).then(function(b){var c=b.msgs,e=babelHelpers.objectWithoutPropertiesLoose(b,["msgs"]);return d("MAWDexieTable").dexieAll(c.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)})).then(function(a){return babelHelpers["extends"]({msgs:c,replyMediaInfo:a},e)})}).then(function(e){var l=e.hasMoreAfter,m=e.hasMoreBefore,n=e.msgs,o=e.replyMediaInfo;e=n.map(function(a,b){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return;return d("MAWBridgeMsg").createBridgeMsg(a,void 0,(o||[])[b])}).filter(Boolean);e.length>0&&d("MAWIndexedDb").afterTransaction({tag:"NewMsgs",value:{msgs:e}});e=n.filter(function(a){return a.ephemeralCounterStarted});e.length>0&&(d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.Countdown,d("MAWLoggerUtils").Tag.OnLoad]).LOG(h(),e.map(function(a){return a.msgId})),d("MAWIndexedDb").afterTransaction({tag:"MsgsStartCountdown",value:d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(e)}));(n.length>0||c==null)&&d("MAWIndexedDb").afterTransaction({tag:"MsgsLoaded",value:d("MAWBridgeTypesCreators").createBridgeMsgsLoadedInfo(b,n,f,m,l,g)});return d("MAWDexieTable").dexieAll([k(a,n),d("MAWDbEditMsgHistoryTxns").loadEditMsgHistory(a,n),i(a,n),j(a,n)]).then(function(a){a=a[0];return{hasMoreAfter:l,hasMoreBefore:m,msgs:n,reactions:a}})})}g.loadMsgsAndMediaFromOffset=a}),98);
__d("MAWLoadThreadsTxns",["FBLogger","MAWBridgeParticipants","MAWBridgeThread","MAWBridgeTypesCreators","MAWDbParticipantTxns","MAWDexieTable","MAWIndexedDb","MAWLoadGroupInvitesTxns","MAWLoadMessageRequestCapabilitiesTxns","MAWLoadMsgsTxns","MAWThreadSnippetUtils","MAWTransactionMode","MAWUserJidWrapper","WAJids","WALogger","emptyFunction","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){f===void 0&&(f="loadContentsForThreads");b.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"VerifyThreadExists",value:d("MAWBridgeThread").createBridgeThread(a,e==null?void 0:e.get(a.jid),void 0,f)})});return d("MAWDexieTable").dexieAll([].concat(b.map(function(b){return i(a,b,c)}),[h(a,b),j(a,b),d("MAWLoadMessageRequestCapabilitiesTxns").loadMessageRequestDataForThreads(b),d("MAWLoadGroupInvitesTxns").loadGroupInvites(a,b)])).then(function(){return b})}function b(a,b,c,e,f){f===void 0&&(f=!1);return d("MAWDexieTable").dexieAll([h(a,[c]),i(a,c,e),d("MAWThreadSnippetUtils").updateThreadInfoToUIOnPageLoad(a,c,f)]).then(function(e){e=e[0];b||l(a,c.jid,d("WAJids").interpretAsGroupJid(c.jid)!=null,!1,c.cannotReplyReason,c.archived);return e})}function h(a,b){return b.length===0?d("MAWDexieTable").dexieResolve([]):d("MAWDbParticipantTxns").getParticipantsInThreads(a,b.map(function(a){return a.jid})).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"ParticipantsUpdated",value:d("MAWBridgeParticipants").createBridgeParticipants(a)});return a})}function i(a,b,c){return d("MAWLoadMsgsTxns").loadMsgsAndMediaFromOffset(a,b.jid,null,c,!0)}function j(a,b){var e=[];b.forEach(function(a){return d("WAJids").switchOnMsgrChatJidType(a.jid,{group:function(a){return e.push(a)},user:c("emptyFunction")})});return a.groupInfo.bulkGet(e).then(function(a){a.forEach(function(a){a!=null&&d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(a)})})})}e=function(a){a=a.threadJid;return k(a)};var k=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY},"checkIfGroupParticipant",function(a){return function(){for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];return l.apply(void 0,[a].concat(c))}});function l(a,b,e,f,g,h){e===void 0&&(e=!0);f===void 0&&(f=!0);var i=d("MAWUserJidWrapper").getMyUserJid();return d("MAWDbParticipantTxns").getParticipant(a,b,i).then(function(a){if(!a.success){var j=e?"group":"one_to_one";d("WALogger").LOG(["[Occamadillo] User is not a participant of "+j+" thread\n        "+b.toString()+", showing a VIEWER_NOT_SUBSCRIBED composer blocker"]);if(g==null){var k;c("FBLogger")("maw_db","checkIfParticipant").catching((k=a.payload)!=null?k:c("err")(a.error)).warn("[Occamadillo] User %s is not a participant of %s thread %s, occam: %s, archived: %s, cannotReplyReason null.",i,j,b.toString(),f,h)}c("FBLogger")("labyrinth_web","checkIfParticipant").warn("[Occamadillo] User not a participant from checkIfParticipant");k={cannotReplyReason:"viewer_not_subscribed",threadJid:b};d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread(k)})}})}g.loadContentsForThreads=a;g.loadParticipantsAndMsgs=b;g.loadParticipants=h;g.loadGroups=j;g.checkIfGroupParticipant=e}),98);
__d("MAWThreadFetchAndEmitTxns",["MAWDexieTable","MAWLoadGroupInvitesTxns","MAWLoadMessageRequestCapabilitiesTxns","MAWLoadThreadsTxns","MAWThreadManagementTxns","WAJids","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,e,f){f===void 0&&(f="fetchAndEmitThread");return d("WAJids").switchOnMsgrChatJidType(b,{group:function(b){return d("MAWThreadManagementTxns").getGroupThread(a,b,c).then(function(a){return a==null?null:{created:a.created,thread:a.thread}})},user:function(b){var g;return d("MAWThreadManagementTxns").getOrSetupOneToOneThread(a,{createTs:e==null?void 0:d("WATimeUtils").castUnixTimeToMillisTime(e),description:f,folder:(g=c)!=null?g:void 0,userJid:b})}}).then(function(b){return b==null||b.thread==null?null:d("MAWLoadThreadsTxns").loadContentsForThreads(a,[b.thread],1,null,f).then(function(){return b})})}function b(a,b){if(b.size===0)return d("MAWDexieTable").dexieResolve();b=Array.from(b);return a.threads.where("jid").anyOf(b).toArray().then(function(b){b=b.filter(Boolean);return d("MAWDexieTable").dexieAll([d("MAWLoadThreadsTxns").loadParticipants(a,b),d("MAWLoadThreadsTxns").loadGroups(a,b),d("MAWLoadMessageRequestCapabilitiesTxns").loadMessageRequestDataForThreads(b),d("MAWLoadGroupInvitesTxns").loadGroupInvites(a,b)])}).then(c("emptyFunction"))}g.fetchAndEmitThread=a;g.emitThreadContents=b}),98);
__d("MAWBulkHandleIncomingMsgApi",["LSMEBTaskCreationSource","MAWBulkEditMsgsTxns","MAWBulkWriteReactionsTxns","MAWDbThreadTxns","MAWDexieTable","MAWHIMLogger","MAWHandleIncomingMsgApi","MAWIndexedDb","MAWLinkReactionsToMsgsApi","MAWMsgActionType","MAWMsgType","MAWODSProxy","MAWOfflineThreadTxns","MAWPreprocessMsgs","MAWReceiverBumpEligibilityCache","MAWSharedOfflineQueueMetric","MAWSharedOfflineResumeUINotifier","MAWThreadFetchAndEmitTxns","MAWTransactionMode","WAMsgMap","WAOdsEnums","WAResultOrError","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Should never have 'write' and 'delete' in same OQ batch"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Should never have 'update ciphertext' and 'delete' in same OQ batch"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handling message with StanzaID ",", action "," and type ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handling "," messages"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot create thread for message. Reason: ",". StanzaID ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot create thread for message. Reason: ","."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Previous message processing action failed so subsequent one can't succeed"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["ERROR!!! At this point we must have fields in the map, ",""]);o=function(){return a};return a}function a(a,b){var e;return d("MAWIndexedDb").makeMsgrTransactor({chunk:(e=d("MAWTransactionMode")).READWRITE,deletedMessages:e.READWRITE,deviceChangeAlerts:e.READWRITE,editMsgHistory:e.READWRITE,ephemeralSettings:e.READWRITE,existingUsers:e.READWRITE,ftsBackloggedMessages:e.READWRITE,ftsPurgeBacklog:e.READWRITE,groupInfo:e.READWRITE,groupInvites:e.READWRITE,media:e.READWRITE,mediaBackup:e.READWRITE,messages:e.READWRITE,participants:e.READWRITE,pendingReceipts:e.READWRITE,pendingStanzas:e.READWRITE,reactions:e.READWRITE,receiverFetchInfo:e.READWRITE,threads:e.READWRITE,unrenderedMessages:e.READWRITE,xma:e.READWRITE},"bulkHandleIncomingMsgs",function(e){return function(){var f=d("MAWDexieTable").dexieResolve(),g=new(d("WAMsgMap").MsgMap)();d("MAWODSProxy").odsBumpEntityKey({amount:a.length,entity:d("WAOdsEnums").Entity.TOTAL_INCOMING_MESSAGE,key:"msgs"});d("MAWDexieTable").setDexiePSDItem("offlineQueueSize",a.length);var h=new Set(a.map(function(a){a=a.msgData;return a.id.chat})),i=d("MAWPreprocessMsgs").classifyIncomingMsgs(a),j=i.editActionMsgs,k=i.reactionMsgs,r=function(a,b){var e=g.get(a);!b.success?g.set(a,b):e==null?c("MAWHIMLogger").ERROR(o(),b):!e.success?c("MAWHIMLogger").WARN(n()):g.set(a,d("WAResultOrError").makeResult(babelHelpers["extends"]({},e.value,b.value)))};return p(e,h).then(function(i){var n=i.threadCreationResult,o=i.threads,p=function(a,b){g.set(a,d("WAResultOrError").makeResult({protocolMsgId:a,unknownGroup:b==="missing"}))};i=d("MAWDexieTable").dexieAll(a.map(function(a){var f;f=[o.get(a.msgData.id.chat),(f=n.get(a.msgData.id.chat))!=null?f:"missing"];var g=f[0];f=f[1];if(g==null){c("MAWHIMLogger").ERROR(m(),f);c("MAWHIMLogger").WARN(l(),f,a.msgData.id.externalId);return}p(a.msgData.id,f);return d("MAWPreprocessMsgs").getMessageDataByType(e,a,g,b)}).filter(Boolean))["catch"](function(a){a.message="[getAllMessagesProcessingData] "+a.message;throw a});var t=!(b===c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE&&c("justknobx")._("3060"));return d("MAWDexieTable").dexieAll([d("MAWBulkWriteReactionsTxns").prepareReactionsData(e,k),i]).then(function(a){var b=a[0],c=a[1];d("MAWReceiverBumpEligibilityCache").updateReceiverBumpEligibilityCache(c);return d("MAWBulkWriteReactionsTxns").bulkWriteReactions(e,b).then(function(){var a=s(c);a.forEach(function(a){f=f.then(function(){return d("MAWHandleIncomingMsgApi").handleIncomingMsg(e,a,t)}).then(function(b){r(a.id,b),q(a.id,a.ts)})});f["catch"](function(a){a.message="[writeIncomingMsgs] "+a.message;throw a});return f}).then(function(){var a=j.length===0?d("MAWDexieTable").dexieResolve():d("MAWBulkEditMsgsTxns").prepareDataForMessageEdit(e,j).then(function(a){return d("MAWBulkEditMsgsTxns").bulkEditMsgs(e,j,a)});return a.then(function(){return d("MAWThreadFetchAndEmitTxns").emitThreadContents(e,h).then(function(){return{msgResults:g}})})})})})}})().then(function(a){var b=new Set();a.msgResults.values().forEach(function(a){if(a.success){a=a.value;(a==null?void 0:a.reactToExternalId)!=null?b.add(a.reactToExternalId):(a==null?void 0:a.protocolMsgId)!=null&&b.add(a.protocolMsgId.externalId)}});return d("MAWLinkReactionsToMsgsApi").linkReactionsToMsgs(Array.from(b)).then(function(){return a})})}function p(a,b){var c=Array.from(b);return d("MAWDbThreadTxns").getThreads(a,c).then(function(b){return d("MAWOfflineThreadTxns").createAllThreadsForOfflineMsgs(a,c,b)})}function q(a,b){var c;a=a.chat.toString();d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.updateChatState((c={},c[a]=b,c));d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.addMAWEntity(1);(a=d("MAWSharedOfflineQueueMetric").getOfflineQueueMetric())==null?void 0:a.addMAWEntity(1)}var r=c("MAWHIMLogger").TAGS(["MergeActions"]);function s(a){r.LOG(k(),a.length);var b=new(d("WAMsgMap").MsgMap)();for(var c=0;c<a.length;c++){var e=a[c];r.LOG(j(),e.id.externalId,e.action,e.type);e.receiveFlow.addPoint("him_merge_actions");var f=b.get(e.id);if(f==null){b.set(e.id,e);continue}if(f.action===e.action&&f.type===e.type){e.receiveFlow.addAnnotations({bool:{merge_actions_duplicate:!0}});continue}switch(e.action){case d("MAWMsgActionType").MSG_ACTION.NO_ACTION:continue;case d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT:case d("MAWMsgActionType").MSG_ACTION.UPDATE_CIPHERTEXT_WITH_ASSOCIATED:if(f.action===d("MAWMsgActionType").MSG_ACTION.REVOKE||f.action===d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME){r.ERROR(i());continue}b.set(e.id,e);continue;case d("MAWMsgActionType").MSG_ACTION.WRITE:case d("MAWMsgActionType").MSG_ACTION.WRITE_WITH_ASSOCIATED:if(f.action===d("MAWMsgActionType").MSG_ACTION.REVOKE||f.action===d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME){r.ERROR(h());continue}switch(e.type){case d("MAWMsgType").MSG_TYPE.UNAVAILABLE:break;case d("MAWMsgType").MSG_TYPE.CIPHERTEXT:f.type===d("MAWMsgType").MSG_TYPE.UNAVAILABLE&&b.set(e.id,e);break;default:b.set(e.id,e)}break;case d("MAWMsgActionType").MSG_ACTION.DELETE_FOR_ME:case d("MAWMsgActionType").MSG_ACTION.REVOKE:f.action!==d("MAWMsgActionType").MSG_ACTION.REVOKE&&b.set(e.id,e);break}}f=[];for(e=0;e<a.length;e++){var g;c=a[e];var l=b.get(c.id);c.receiveFlow.addAnnotations({string:{final_action:(g=l==null?void 0:l.action)!=null?g:"undefined",final_msg_type:(g=l==null?void 0:l.type)!=null?g:"undefined",has_replaced_action:(c!==l).toString(),initial_action:c.action,initial_msg_type:c.type}});if(l==null||l.action===d("MAWMsgActionType").MSG_ACTION.NO_ACTION)continue;f.push(l);b["delete"](c.id)}return f}g.bulkHandleIncomingMsgs=a}),98);
__d("MAWCreateThreadThroughMI",["MAWDexieTable","MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWLoadThreadsTxns","MAWMICSchema","MAWQplProxy","MAWThreadManagementTxns","MAWTransactionMode","WAGlobals","WAJids","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READONLY,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READWRITE,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"createThreadByJid",function(a){return function(b,c){var e=b.authoritativeThreadKey;c=b.chatJid;var f=b.description,g=b.lastActivityTimestampMs,h=b.lastReadWatermarkTimestampMs,i=b.numOfMsgsToLoad,j=d("WATimeUtils").castToMillisTime(g),k=d("WATimeUtils").castToMillisTime(h),l=d("WAGlobals").getMyUserJid();return d("WAJids").switchOnMsgrChatJidType(c,{group:function(b){return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{authoritativeThreadKey:e,description:f,jid:b,lastActivityTimestamp:j,lastReadWatermarkTimestamp:k})},user:function(b){return d("MAWThreadManagementTxns").getOrSetupOneToOneThread(a,{authoritativeThreadKey:e,description:f,lastActivityTimestamp:j,lastReadWatermarkTimestamp:k,userJid:b})}}).then(function(b){var c=d("WAJids").interpretAsGroupJid(b.thread.jid),e=c!=null;c=b.thread?b.thread:b;return d("MAWDexieTable").dexieAll([d("MAWLoadThreadsTxns").loadParticipantsAndMsgs(a,b.created&&e,c,(c=i)!=null?c:1,!1)]).then(function(a){a=a[0];a=e&&(b.created||a.length===0||a.some(function(a){return a.addressable!==!0}));e&&d("MAWIndexedDb").afterTransaction({tag:"GroupInviteLoaded",value:{actorId:d("WAJids").extractUserId(l),threadJid:b.thread.jid}});return{chatJid:b.thread.jid,isCreated:b.created,shouldQueryForGroup:a}})})}},{onTxnRequested:function(a,b){d("MAWQplProxy").sendQplPointThroughBridge(d("MAWMICSchema").EVENT,d("MAWMICSchema").POINTS.occamadillo_thread_mapping_txn_reached,void 0,void 0,{toClientId:b==null?void 0:b.fromClientId})}});g.createThreadThroughMI=b}),98);
__d("MAWDbAddDeviceChangeAlertsTxn",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.deviceChangeAlerts.add(b)}f.addDeviceChangeAlertsTxn=a}),66);
__d("MAWDbAppDataTxns",["MAWAckLevel","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateAppDataSystemAck on sent appData"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["updateAppDataSystemAck on non existing appData"]);i=function(){return a};return a}function a(a,b,c){return a.appData.get({externalId:b}).then(function(b){if(!b){d("WALogger").LOG(i());return null}if(b.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(h());return b}var e=babelHelpers["extends"]({},b,{ack:c});return a.appData.put(e).then(function(){return e})})}function b(a,b){return a.appData.bulkGet(b)}g.updateAppDataSystemAck=a;g.bulkGetAppData=b}),98);
__d("MAWDbGetDeviceChangeAlertsByOptionsTxn",["WAGlobals","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=d("WATimeUtils").pastUnixTime(30*d("WATimeUtils").DAY_SECONDS);function a(a,b){var c=b.after,e=b.isArchived,f=e===void 0?!1:e;e=b.limit;b=e===void 0?20:e;e=a.deviceChangeAlerts;return(c==null?e:e.where("deviceChangeAlertsId").above(c)).filter(function(a){return a.isArchived===f&&a.ts>=h}).reverse().limit(b).toArray().then(function(a){return a.map(function(a){return babelHelpers["extends"]({},a,{isCurrentDevice:d("WAGlobals").getMyDeviceJid()===a.deviceJid})})})}g.getDeviceChangeAlertsByOptionsTxn=a}),98);
__d("MAWDbGetDeviceChangeAlertsTxn",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.deviceChangeAlerts.get(b)}f.getDeviceChangeAlertsTxn=a}),66);
__d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn",["MAWIndexedDb"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.deviceChangeAlerts.filter(function(a){return a.isArchived===!1}).toArray().then(function(a){return d("MAWIndexedDb").afterTransaction({tag:"UnArchivedSelfDeviceChangeAlerts",value:a.length})})}g.getUnArchivedDeviceChangeAlertsCountTxn=a}),98);
__d("MAWDbPendingReceiptTxns",["WAJids","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=b.map(function(a){var b=a.author,c=a.externalId;a=a.thread;return d("WAMsg").craftWAMsgIdString({author:b,chat:a,externalId:c})});return a.pendingReceipts.where("id").anyOf(c).toArray().then(function(c){var e=new Map();c.forEach(function(a){e.set(a.id,a)});var f=b.map(function(a){var b=a.author,c=a.externalId,f=a.thread,g=d("WAMsg").craftWAMsgIdString({author:b,chat:f,externalId:c}),h=e.get(g),i=(h=h)!=null?h:{author:b,deliveryReceipts:[],externalId:c,id:g,readReceipts:[],thread:f};b===d("WAJids").AUTHOR_ME?(a.deliveryReceipts.forEach(function(a){i.deliveryReceipts.push(a)}),a.readReceipts.forEach(function(a){i.readReceipts.push(a)})):(i.deliveryReceipts=[],a.readReceipts.forEach(function(a){i.readReceipts.push(a)}));return i});return a.pendingReceipts.bulkPut(f).then(function(){return f})})}function b(a,b){return a.pendingReceipts.bulkGet(b)}g.bulkAddPendingReceipts=a;g.getPendingReceipts=b}),98);
__d("MAWDbPoll",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}f.convertStringToOptionHash=a}),66);
__d("MAWDbGetAlertsWithDeviceJidTxn",["err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return a.deviceChangeAlerts.filter(function(a){return a.deviceJid===b&&!a.loggedOut}).toArray().then(function(a){a.length>1&&c("err")("Invalid result, more than one active devices with the same deviceJid: "+b);return a[0]})}g.getAlertsWithDeviceJidTxn=a}),98);
__d("MAWDbUpdateDeviceChangeAlertsTxn",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.deviceChangeAlerts.put(b)}f.updateDeviceChangeAlertsTxn=a}),66);
__d("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn",["MAWDbGetAlertsWithDeviceJidTxn","MAWDbUpdateDeviceChangeAlertsTxn"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWDbGetAlertsWithDeviceJidTxn").getAlertsWithDeviceJidTxn(a,b).then(function(b){return d("MAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn(a,babelHelpers["extends"]({},b,{loggedOut:!0}))})}g.updateDeviceChangeAlertsLogInStatusTxn=a}),98);
__d("WADevToolsDebugFns",["WADevToolsBridge"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b={};for(var c in a){var e=a[c];b[c]={id:c,args:e.serializedArgs,desc:e.desc,title:e.name}}d("WADevToolsBridge").getDevToolBridge().setHandlers("backend",{getDebugFns:function(){return b},callDebugFn:function(b){var c=b.id;b=b.args;(c=a[c]).execute.apply(c,b)}})}function b(a,b){return babelHelpers["extends"]({name:a},b)}g.registerDebugFnsToDevTool=a;g.defineDebugFunction=b}),98);
__d("MAWDebugHydrateOfflineQueue",["MAWExternalId","MAWIndexedDb","MAWJobDefinitions","MAWJobManager","MAWLoggerUtils","MAWTransactionMode","WADbTransactor","WADevToolsDebugFns","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a,c){var e=c.maxMessages,f=c.minMessages;return d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"debug",function(c){return function(){return c.participants.toArray().then(function(b){return b.filter(function(b){return b.userJid===a.contactJid})}).then(function(a){a=a.map(function(a){return a.threadJid});return c.threads.where("jid").anyOf(a).toArray().then(function(a){return Array.from(new Set(a.filter(function(a){return(a==null?void 0:a.archived)!==!0}).map(function(a){return a==null?void 0:a.jid}).filter(Boolean)))})}).then(function(a){setTimeout(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){for(var b of a){var c=Math.floor(Math.random()*e)+f;for(var g=0;g<c;g++)yield d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendMsg(b,{content:"Message "+g,s2sInstanceKey:d("MAWLoggerUtils").getInstanceKey()},d("MAWExternalId").generateExternalId()))}}),0)})}})()},i=function(a){return d("WADbTransactor").makeSignalTransactor({contacts:d("MAWTransactionMode").READONLY},"debug",function(b){return function(){var d=b.contacts.filter(function(b){return b.contactJid===a}).toArray();return d.then(function(a){if(a.length===0)throw c("err")("No participant found");a=a[0];return a})}})()};a=d("WADevToolsDebugFns").defineDebugFunction("hydrateOfflineQueue",{desc:"Hydrate the offline queue for a target user",execute:function(a,b,c){return i(a).then(function(a){return h(a,{maxMessages:b,minMessages:c})})},serializedArgs:[{desc:"Name or Jid of the target user",name:"targetUserNameOrJid",placeholder:"Target user name or Jid",type:"string"},{desc:"Max number of messages per thread to send",name:"maxMessages",placeholder:"30",type:"number"},{desc:"Min number of messages per thread to send",name:"minMessages",placeholder:"1",type:"number"}]});g.hydrateOfflineQueue=a}),98);
__d("MAWDebugSendMultipleMsgs",["MAWJobDefinitions","MAWJobManager","MAWLoggerUtils","Promise","WADevToolsDebugFns"],(function(a,b,c,d,e,f,g){"use strict";var h;a=d("WADevToolsDebugFns").defineDebugFunction("sendMultipleMsgs",{desc:"Sends multiple messages to a thread",execute:function(a,c){return(h||(h=b("Promise"))).all(Array.from(Array(c).keys()).map(function(b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendMsg(a,{content:b+" message",s2sInstanceKey:d("MAWLoggerUtils").getInstanceKey()}))}))},serializedArgs:[{desc:"ChatJid of the thread to send messages to",name:"chatJid",placeholder:"1234@msgr",type:"string"},{desc:"Number of messages to send",name:"numberOfMsgs",placeholder:"100",type:"number"}]});g.sendMultipleMsgs=a}),98);
__d("MAWGroupInfoStore",["MAWBridgeTypesCreators","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieCastToPromise","MAWDexieTable","MAWFolderTypes","MAWGetOrCreateThreadTxns","MAWIndexedDb","MAWLoadMsgsTxns","MAWLoadThreadsTxns","MAWThreadManagementTxns","MAWTransactionMode","WAResultOrError","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a!=null&&typeof a==="object"&&a.groupStatus!=null&&typeof a.groupStatus==="string"?a.groupStatus:void 0}function i(a){return a!=null&&typeof a==="object"&&a.clientThreadKey!=null&&typeof a.clientThreadKey==="string"?a.clientThreadKey:void 0}function j(a){return a!=null&&typeof a==="object"&&a.folder!=null&&typeof a.folder==="number"?a.folder:void 0}function k(a){return a!=null&&typeof a==="object"&&a.updateParticipantMedatadata!=null&&typeof a.updateParticipantMedatadata==="boolean"?a.updateParticipantMedatadata:void 0}function l(a){return a===null?{}:a}a=function(){function a(a){var b=this;this.get=function(a,c){c=j(c);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWThreadManagementTxns").getGroupThread(b.db,a,c).then(function(a){return a!=null?a:null}).then(function(a){return a==null?d("WAResultOrError").makeError("missing_group"):d("MAWLoadThreadsTxns").loadContentsForThreads(b.db,[a.thread],1,null,"getGroupInfoStore").then(function(){return a.groupInfo}).then(function(a){return d("WAResultOrError").makeResult(m(a))})}))};this.create=function(a,c){var e=h(c)==="added"?d("WATimeUtils").millisTime():d("WATimeUtils").castUnixTimeToMillisTime(a.creationTs);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWGetOrCreateThreadTxns").getOrCreateThread(b.db,{clientThreadKey:i(c),createTs:e,description:"MAWGroupInfoStore-create",folder:d("MAWFolderTypes").FOLDER_ID.INBOX,jid:a.jid}).then(function(c){var e=c.created,f=c.thread,g=n(a);return d("MAWDexieTable").dexieAll([b.db.groupInfo.put(g),d("MAWDbMsgTxns").getThreadNewestMessageId(b.db,f.jid)]).then(function(a){a[0];a=a[1];d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(g)});a!=null?d("MAWLoadMsgsTxns").loadMsgsAndMediaFromOffset(b.db,f.jid,a,10,!0):d("MAWDexieTable").dexieResolve()}).then(function(){return f.archived===!0?d("MAWDbThreadTxns").unarchiveThreads(b.db,[f.jid]):d("MAWDexieTable").dexieResolve()}).then(function(){return e?d("WAResultOrError").makeResult(g.groupJid):d("WAResultOrError").makeError("existing")})}))};this["delete"]=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([b.db.threads.get({jid:a}),b.db.groupInfo["delete"](a)]).then(function(a){a=a[0];return a==null?d("WAResultOrError").makeError("missing_group"):d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").deleteThreadRow(b.db,a.jid),b.db.participants.where("threadJid").equals(a.jid)["delete"]()]).then(function(){return d("WAResultOrError").makeResult()})}))};this.update=function(a,c,e){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.threads.get({jid:a}).then(function(f){return f==null?d("WAResultOrError").makeError("missing_group"):b.db.groupInfo.get(a).then(function(a){if(a==null)return d("WAResultOrError").makeError("missing_group");a=m(a);a=c(a);var g=n(a);return b.db.groupInfo.put(g).then(function(){d("MAWIndexedDb").afterTransaction({tag:"GroupInfoUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedGroupInfo(g)});k(e)===!0&&d("MAWIndexedDb").afterTransaction({tag:"UpdateE2EEMetadataParticipants",value:d("MAWBridgeTypesCreators").createBridgeUpdateE2EEMetadataParticipants(f.jid)});return d("WAResultOrError").makeResult()})})}))};this.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.groupInfo.clear())};this.db=a}var b=a.prototype;b.has=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.groupInfo.get(a).then(function(a){return a!=null?!0:!1}))};return a}();a.tableLocks={chunk:(b=d("MAWTransactionMode")).READONLY,editMsgHistory:b.READONLY,groupInfo:b.READWRITE,groupInvites:b.READONLY,media:b.READONLY,messages:b.READWRITE,participants:b.READWRITE,reactions:b.READONLY,receiverFetchInfo:b.READONLY,threads:b.READWRITE,xma:b.READONLY};function m(a){return babelHelpers["extends"]({jid:a.groupJid},l(a.creator!=null?{creator:a.creator}:null),{creationTs:a.creationTs},l(a.participantVersion!=null?{participantVersion:a.participantVersion}:null),{inviter:a.inviter,memberAddMode:a.memberAddMode,subject:babelHelpers["extends"]({content:a.name},l(a.nameOwner!=null?{user:a.nameOwner}:null),l(a.nameTs!=null?{ts:a.nameTs}:null))})}function n(a){var b=a.subject.content;b!=null&&b.length===0&&(b=void 0);return{creationTs:a.creationTs,creator:a.creator,groupJid:a.jid,inviter:a.inviter,memberAddMode:a.memberAddMode,name:b,nameOwner:a.subject.user,nameTs:a.subject.ts,participantVersion:a.participantVersion}}g.MAWGroupInfoStore=a}),98);
__d("MAWGetExpiredMsgs",["WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("WATimeUtils").unixTime();return a.messages.where("messageDeleteTs").belowOrEqual(b).toArray().then(function(a){return a.map(function(a){var b=a.author,c=a.externalId;a=a.threadJid;return a==null?null:{author:b,chat:a,externalId:c}}).filter(Boolean)})}g.getExpiredMsgs=a}),98);
__d("MAWMessageStore",["MAWAckLevel","MAWAuthor","MAWBridgeMsg","MAWDbMsgTxns","MAWDbThread","MAWDexieCastToPromise","MAWDexieTable","MAWFolderTypes","MAWGetExpiredMsgs","MAWIndexedDb","MAWLocalizationUtils","MAWMsgType","MAWThreadFetchAndEmitTxns","MAWTransactionMode","MAWWriteMsgTxns","WAJids","WALogger","WAResultOrError","WATimeUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Successfully deleted: "," reactions rows."]);h=function(){return a};return a}function i(a){if(a!=null&&typeof a==="object"&&a.optimisticMsg!=null){a=a.optimisticMsg;if(typeof a.msgId==="string"&&typeof a.ts==="number")return{msgId:a.msgId,ts:a.ts}}return void 0}function j(a){return a!=null&&typeof a==="object"&&a.openMessageOtid!=null&&typeof a.openMessageOtid==="string"?a.openMessageOtid:void 0}function k(a){if(a!=null&&typeof a==="object"&&a.folder!=null&&typeof a.folder==="number")if(a.folder===d("MAWFolderTypes").FOLDER_ID.INBOX)return d("MAWFolderTypes").FOLDER_ID.INBOX;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.PENDING)return d("MAWFolderTypes").FOLDER_ID.PENDING;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.OTHER)return d("MAWFolderTypes").FOLDER_ID.OTHER;else if(a.folder===d("MAWFolderTypes").FOLDER_ID.ARCHIVED)return d("MAWFolderTypes").FOLDER_ID.ARCHIVED;return null}a=function(){function a(a){this.db=a}var b=a.prototype;b.create=function(a,b){var e=this,f=i(b),g=j(b);b=k(b);return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWThreadFetchAndEmitTxns").fetchAndEmitThread(this.db,a.id.chat,b,void 0,"MAWMessageStore_DEPRECATED-create").then(function(b){if(b==null)return d("WAResultOrError").makeError({type:"missing_thread"});b=b.thread;if(a.type===d("MAWMsgType").MSG_TYPE.TEXT){var h=void 0;a.ephemeralSetting!=null&&(h={ephemeralExpirationInSec:a.ephemeralSetting.expirationTs,ephemeralLastUpdatedOrSetTimestamp:a.ephemeralSetting.updatedTs});h={ack:a.ack,altIndex:void 0,author:a.id.author,ephemeralSetting:h,externalId:a.id.externalId,forwardingScore:a.forwardingScore,isForwarded:a.forwardingScore>0,msgContent:{content:((h=a.msgContent)==null?void 0:h.content)||""},serverTs:a.serverTs,threadJid:b.jid,ts:a.ts,type:d("MAWMsgType").MSG_TYPE.TEXT};return d("MAWWriteMsgTxns").writeMsg(e.db,h,b,"MAWMessageStore::create",{openMessageOtid:g,optimisticMsg:f}).then(function(){return d("WAResultOrError").makeResult()})}else if(a.type===d("MAWMsgType").MSG_TYPE.ICDC_ALERT){h={ack:a.ack,altIndex:void 0,author:a.id.author,externalId:a.id.externalId,msgContent:{adminType:a.msgContent.adminType,authorName:a.msgContent.authorName},serverTs:a.serverTs,threadJid:b.jid,ts:a.ts,type:d("MAWMsgType").MSG_TYPE.ICDC_ALERT};return d("MAWWriteMsgTxns").writeMsg(e.db,h,b,"MAWMessageStore::create",{openMessageOtid:g,optimisticMsg:f}).then(function(){a.hasUnknownName&&!d("WAJids").isAuthorMe(a.id.author)&&!d("WAJids").isAuthorSystem(a.id.author)&&d("MAWIndexedDb").afterTransaction({tag:"SyncContacts",value:[d("WAJids").userIdFromJid(a.id.author)]});return d("WAResultOrError").makeResult()})}else if(a.type===d("MAWMsgType").MSG_TYPE.ADMIN){h={ack:a.ack,altIndex:void 0,author:d("WAJids").AUTHOR_SYSTEM,externalId:a.id.externalId,msgContent:babelHelpers["extends"]({},a.msgContent,{version:d("MAWLocalizationUtils").isAdminMsgNormalized(a.msgContent.adminType)?1:0}),serverTs:a.serverTs,threadJid:b.jid,ts:a.ts,type:a.type};return d("MAWWriteMsgTxns").writeMsg(e.db,h,b,"MAWMessageStore::create").then(function(){return d("WAResultOrError").makeResult()})}throw c("err")("non renderable store not implemented yet")}))};b.get=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([this.db.threads.get({jid:a.chat}),this.db.messages.where("externalId").equals(a.externalId).toArray()]).then(function(b){var c,e=b[0];b=b[1];if(e==null)return d("MAWDexieTable").dexieResolve(null);b=b.find(function(b){return b.threadJid===e.jid&&b.author===a.author});return b==null||b.type!=="Text"?d("MAWDexieTable").dexieResolve(null):d("MAWDexieTable").dexieResolve({ack:b.ack,forwardingScore:(c=b.forwardingScore)!=null?c:0,id:a,msgContent:{content:b.msgContent.content},ts:b.ts,type:b.type})}))};b.update=function(a){var b=this;return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDexieTable").dexieAll([this.db.threads.get({jid:a.id.chat}),this.db.messages.where("externalId").equals(a.id.externalId).toArray()]).then(function(c){var e=c[0];c=c[1];if(e==null)return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing"));var f=c.find(function(b){return b.threadJid===e.jid&&b.author===a.id.author});if(f==null||f.type!=="Text")return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing"));c=f.ack<d("MAWAckLevel").ACK.sent;f.ack=a.ack;f.ts=a.ts;f.serverTs=a.sentTs;var g=void 0;a.ephemeralSetting!=null&&(g={ephemeralExpirationInSec:a.ephemeralSetting.expirationTs,ephemeralLastUpdatedOrSetTimestamp:a.ephemeralSetting.updatedTs});f.ephemeralSetting=g;g=a.sentTs;g=g==null?g:d("WATimeUtils").castUnixTimeToMillisTime(g);c=g!=null&&c?b.db.threads.put(babelHelpers["extends"]({},e,{newestMsgTs:g,threadOrder:d("MAWDbThread").craftThreadOrder(g,e.jid)})):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([b.db.messages.put(f),c]).then(function(){var a=null;d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(f,void 0,a)});return d("WAResultOrError").makeResult()})}))};b.deleteReactionsForMsg=function(a){var b=this;return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.reactions.where("reactToExternalId").equals(a.externalId).filter(function(b){return d("MAWAuthor").getAuthorUserJid(b.reactToAuthor)===d("MAWAuthor").getAuthorUserJid(a.author)&&b.threadJid===a.chat}).toArray().then(function(a){return b.db.reactions.bulkDelete(a.map(function(a){return a.rowId}))}))};b.bulkGetExpiredMsgIds=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWGetExpiredMsgs").getExpiredMsgs(this.db))};b.bulkDelete=function(a){var b=this,c=d("MAWDexieTable").dexieAll(a.map(function(a){var c=a.author,e=a.chat;a=a.externalId;var f=d("MAWAuthor").getAuthorUserJid(c);return b.db.reactions.where("reactToExternalId").equals(a).filter(function(a){return d("MAWAuthor").getAuthorUserJid(a.reactToAuthor)===f&&a.threadJid===e}).toArray()})).then(function(a){return a.flat()}).then(function(a){d("WALogger").LOG(h(),a.length);return b.db.reactions.bulkDelete(a.map(function(a){return a.rowId}))});return d("MAWDexieCastToPromise").dexieCastToPromise(d("MAWDbMsgTxns").getMsgsByProtocolMsgId(this.db,a).then(function(a){var e=a.map(function(a){return a.rowId});return d("MAWDexieTable").dexieAll([b.db.messages.bulkDelete(e),c]).then(function(){return e.length})}))};b.bulkGetInGroup=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(this.db.messages.where("threadJid").equals(a).toArray()).then(function(b){return b==null||b.length===0?[]:b.map(function(b){return{author:b.author,chat:a,externalId:b.externalId}})})};return a}();a.tableLocks={chunk:(b=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:b.READWRITE,groupInfo:b.READWRITE,groupInvites:b.READONLY,media:b.READONLY,messages:b.READWRITE,participants:b.READWRITE,reactions:b.READWRITE,receiverFetchInfo:b.READONLY,threads:b.READWRITE,xma:b.READONLY};g.MAWMessageStore_DEPRECATED_DO_NOT_USE=a}),98);
__d("WAResultOrErrorUtils",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=[];a.forEach(function(a){a.success&&b.push(a.value)});return b}function b(a){var b=[];a.forEach(function(a){a.success||b.push(a.error)});return b}f.unpackValues=a;f.unpackErrors=b}),66);
__d("MAWParticipantsStore",["MAWBridgeParticipants","MAWBridgeTypesCreators","MAWDbParticipant","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieCastToPromise","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAArrayGroupBy","WAArrayZip","WAGlobals","WAResultOrError","WAResultOrErrorUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){var b=this;this.bulkGetInGroup=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.threads.get({jid:a}).then(function(a){return a!=null?d("MAWDbParticipantTxns").getParticipantsInThread(b.db,a.jid).then(function(b){return d("WAResultOrError").makeResult(b.map(function(b){return h(b,a.jid)}))}):d("WAResultOrError").makeError("missing_group")}))};this.bulkPut=function(a){return d("MAWDexieCastToPromise").dexieCastToPromise(k(b.db,a.map(function(a){a=a.chatJid;return a})).then(function(b){return d("WAResultOrErrorUtils").unpackValues(a.map(function(a){return!b.has(a.chatJid)?d("WAResultOrError").makeError():d("WAResultOrError").makeResult({participantId:d("MAWDbParticipant").craftParticipantId(a.chatJid,a.user),waParticipant:a})}))}).then(function(a){return b.db.participants.bulkGet(a.map(function(a){a=a.participantId;return a})).then(function(b){return d("WAArrayZip").zip(a,b).map(function(a){var b=a[0].waParticipant;a=a[1];return{chatJid:b.chatJid,dbParticipantToPut:babelHelpers["extends"]({deliveredWatermarkTs:d("WATimeUtils").castToUnixTime(0),lastReadWatermarkTs:d("WATimeUtils").castToUnixTime(0)},a,i(b)),existed:a!=null,participant:b}})})}).then(function(a){var c=a.map(function(a){a=a.dbParticipantToPut;return babelHelpers["extends"]({},a)});c.forEach(function(a){return d("MAWDbParticipantTxns").logIfIllegalParticipant(a,"MAWParticipantsStore::bulkPut")});return b.db.participants.bulkPut(c).then(function(){return l(b.db,a)})}))};this.bulkDelete=function(a,c){c=c||{};var e=c.remover,f=d("WAArrayGroupBy").groupBy(a.map(function(a,b){return{index:b,key:a}}),function(a){a=a.key;return a.groupJid});c=f.map(function(a){a=a[0];return a});return d("MAWDexieCastToPromise").dexieCastToPromise(k(b.db,c).then(function(a){return f.flatMap(function(b){var c=b[0];b=b[1];return b.map(function(b){var e=b.index;b=b.key;return!a.has(c)?d("WAResultOrError").makeError({index:e,message:"missing_group"}):d("WAResultOrError").makeResult({groupJid:c,index:e,participantId:d("MAWDbParticipant").craftParticipantId(c,b.userJid),participantKey:[c,b.userJid],userJid:b.userJid})})})}).then(function(a){var c=d("WAResultOrErrorUtils").unpackValues(a),e=d("WAResultOrErrorUtils").unpackErrors(a).map(function(a){return d("WAResultOrError").makeError(a)});a=c.map(function(a){a=a.participantId;return a});return b.db.participants.bulkGet(a).then(function(a){return d("WAArrayZip").zip(c,a).map(function(a){var b=a[0];a=a[1];return a==null?d("WAResultOrError").makeError({index:b.index,message:"missing_participant"}):d("WAResultOrError").makeResult(b)}).concat(e)})}).then(function(a){var c=d("WAResultOrErrorUtils").unpackValues(a),f=c.map(function(a){a=a.participantKey;return a}),g=c.map(function(a){var b=a.groupJid;a=a.userJid;return{groupJid:b,userJid:a}});return d("MAWDbParticipantTxns").bulkDeleteParticipants(b.db,f).then(function(){return m(b.db,g,e)}).then(function(){return a})}).then(function(a){return a.map(function(a){return a.success?{index:a.value.index,result:d("WAResultOrError").makeResult()}:{index:a.error.index,result:d("WAResultOrError").makeError(a.error.message)}}).sort(function(a,b){a=a.index;b=b.index;return a-b}).map(function(a){a=a.result;return a})}))};this.clear=function(){return d("MAWDexieCastToPromise").dexieCastToPromise(b.db.participants.clear())};this.db=a};a.tableLocks={participants:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE};function h(a,b){var c=a.addressable!=null?{addressable:a.addressable}:null;return babelHelpers["extends"]({chatJid:b,type:a.type,user:a.userJid},c)}function i(a){return{addressable:a.addressable,id:d("MAWDbParticipant").craftParticipantId(a.chatJid,a.user),threadJid:a.chatJid,type:a.type,userJid:a.user}}function j(a){return a.map(function(a){return a.user}).filter(function(a){return a===d("WAGlobals").getMyUserJid()||a==="@me"}).length>0}function k(a,b){a=a.threads;return a.where("jid").anyOf(b).toArray().then(function(a){return new Set(a.map(function(a){a=a.jid;return a}))})}function l(a,b){var c=b.filter(function(a){a=a.existed;return!a}).map(function(a){var b=a.chatJid;a=a.participant;return{chatJid:b,participant:a}});c=d("WAArrayGroupBy").groupBy(c,function(a){a=a.chatJid;return a}).map(function(a){var b=a[0];a=a[1];return[b,a.map(function(a){a=a.participant;return a})]});b.forEach(function(a){a=a.dbParticipantToPut;d("MAWIndexedDb").afterTransaction({tag:"ParticipantUpdated",value:d("MAWBridgeParticipants").createBridgeParticipant(a)})});b=c.filter(function(a){a[0];a=a[1];return j(a)}).map(function(a){a=a[0];return a});return d("MAWDbThreadTxns").subscribeToThreads(a,b)}function m(a,b,c){b=Array.from(b);b.forEach(function(a){a=a.groupJid;return d("MAWIndexedDb").afterTransaction({tag:"UpdateE2EEMetadataParticipants",value:d("MAWBridgeTypesCreators").createBridgeUpdateE2EEMetadataParticipants(a)})});var e=new Set(b.filter(function(a){return a.userJid===d("WAGlobals").getMyUserJid()&&(c===d("WAGlobals").getMyUserJid()||c==="@me")}).map(function(a){return a.groupJid}));b=new Set(b.filter(function(a){a=a.userJid;return a!==c&&(a===d("WAGlobals").getMyUserJid()||a==="@me")}).filter(function(a){a=a.groupJid;return!e.has(a)}).map(function(a){a=a.groupJid;return a}));return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").archiveThreads(a,Array.from(e),!0),d("MAWDbThreadTxns").unsubscribeFromThreads(a,Array.from(b))])}g.MAWParticipantsStore=a}),98);
__d("MAWRunInTransaction",["MAWDexie","MAWGroupInfoStore","MAWIndexedDb","MAWMessageStore","MAWParticipantsStore","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";var h={GroupInfoStore:d("MAWGroupInfoStore").MAWGroupInfoStore.tableLocks,MessagesStore:d("MAWMessageStore").MAWMessageStore_DEPRECATED_DO_NOT_USE.tableLocks,ParticipantsStore:d("MAWParticipantsStore").MAWParticipantsStore.tableLocks};a=function(a,b,e){var f=[];for(var g in a)a[g]===!0&&f.push(g);g=f.flatMap(function(a){return Object.entries(h[a])}).reduce(function(a,b){var c=b[0];b=b[1];if(a[c]===d("MAWTransactionMode").READWRITE)return a;c=c;return babelHelpers["extends"]({},a,(a={},a[""+c]=b,a))},{});g=d("MAWIndexedDb").makeMsgrTransactor(g,(f=e)!=null?f:"runInTransaction",function(e){return function(){var f={CollectionVersionStore:null,GroupInfoStore:a.GroupInfoStore===!0?new(d("MAWGroupInfoStore").MAWGroupInfoStore)(e):null,MessagesStore:a.MessagesStore===!0?new(d("MAWMessageStore").MAWMessageStore_DEPRECATED_DO_NOT_USE)(e):null,MissingKeyStore:null,ParticipantsStore:a.ParticipantsStore===!0?new(d("MAWParticipantsStore").MAWParticipantsStore)(e):null,PendingMutationStore:null,SyncActionStore:null,SyncKeyStore:null};return new(c("MAWDexie").Promise)(function(a){a(b(f))})}});return g()};g.runInTransaction=a}),98);
__d("MAWChangeGroupMemberAddModeApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"changeGroupMemberAddMode")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){var h=a.GroupInfoStore;a=a.MessagesStore;var i=(yield h.get(b));if(!i.success)return d("WAResultOrError").makeError("missing_group");yield h.update(b,function(a){return babelHelpers["extends"]({},a,{memberAddMode:e})});if(g==="create_admin_message"){i=d("MAWAdminMsgHelpers").createMemberAddModeChangeAdminMsg(b,e,c,f);i!=null&&(yield a.create(i))}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g){return a.apply(this,arguments)}}();g.changeGroupMemberAddMode=a;g.changeGroupMemberAddModeTransactor=h}),98);
__d("WASmaxInGroupsIQErrorResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","error");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQErrorResponseMixin=a}),98);
__d("WASmaxInGroupsIQErrorBadRequestMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","bad-request");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",400);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorBadRequestMixin=a}),98);
__d("WASmaxInGroupsIQErrorFallbackClientMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",400,499);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackClientMixin=a}),98);
__d("WASmaxInGroupsIQErrorForbiddenMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","forbidden");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",403);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorForbiddenMixin=a}),98);
__d("WASmaxInGroupsIQErrorItemNotFoundMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","item-not-found");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",404);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorItemNotFoundMixin=a}),98);
__d("WASmaxInGroupsIQErrorLockedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","locked");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",423);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorLockedMixin=a}),98);
__d("WASmaxInGroupsIQErrorNotAllowedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-allowed");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",405);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNotAllowedMixin=a}),98);
__d("WASmaxInGroupsIQErrorNotAuthorizedMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","not-authorized");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",401);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorNotAuthorizedMixin=a}),98);
__d("WASmaxInGroupsIQErrorRateOverlimitMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","rate-overlimit");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",429);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorRateOverlimitMixin=a}),98);
__d("WASmaxInGroupsIQErrorResourceLimitMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","resource-limit");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",419);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorResourceLimitMixin=a}),98);
__d("WASmaxInGroupsSetAddModeClientErrors",["WAResultOrError","WASmaxInGroupsIQErrorBadRequestMixin","WASmaxInGroupsIQErrorFallbackClientMixin","WASmaxInGroupsIQErrorForbiddenMixin","WASmaxInGroupsIQErrorItemNotFoundMixin","WASmaxInGroupsIQErrorLockedMixin","WASmaxInGroupsIQErrorNotAllowedMixin","WASmaxInGroupsIQErrorNotAuthorizedMixin","WASmaxInGroupsIQErrorRateOverlimitMixin","WASmaxInGroupsIQErrorResourceLimitMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorBadRequestMixin").parseIQErrorBadRequestMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorBadRequest",value:b.value});var c=d("WASmaxInGroupsIQErrorNotAuthorizedMixin").parseIQErrorNotAuthorizedMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAuthorized",value:c.value});var e=d("WASmaxInGroupsIQErrorForbiddenMixin").parseIQErrorForbiddenMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorForbidden",value:e.value});var f=d("WASmaxInGroupsIQErrorItemNotFoundMixin").parseIQErrorItemNotFoundMixin(a);if(f.success)return d("WAResultOrError").makeResult({name:"IQErrorItemNotFound",value:f.value});var g=d("WASmaxInGroupsIQErrorNotAllowedMixin").parseIQErrorNotAllowedMixin(a);if(g.success)return d("WAResultOrError").makeResult({name:"IQErrorNotAllowed",value:g.value});var h=d("WASmaxInGroupsIQErrorResourceLimitMixin").parseIQErrorResourceLimitMixin(a);if(h.success)return d("WAResultOrError").makeResult({name:"IQErrorResourceLimit",value:h.value});var i=d("WASmaxInGroupsIQErrorLockedMixin").parseIQErrorLockedMixin(a);if(i.success)return d("WAResultOrError").makeResult({name:"IQErrorLocked",value:i.value});var j=d("WASmaxInGroupsIQErrorRateOverlimitMixin").parseIQErrorRateOverlimitMixin(a);if(j.success)return d("WAResultOrError").makeResult({name:"IQErrorRateOverlimit",value:j.value});var k=d("WASmaxInGroupsIQErrorFallbackClientMixin").parseIQErrorFallbackClientMixin(a);return k.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackClient",value:k.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorBadRequest","IQErrorNotAuthorized","IQErrorForbidden","IQErrorItemNotFound","IQErrorNotAllowed","IQErrorResourceLimit","IQErrorLocked","IQErrorRateOverlimit","IQErrorFallbackClient"],[b,c,e,f,g,h,i,j,k])}g.parseSetAddModeClientErrors=a}),98);
__d("WASmaxInGroupsSetMemberAddModeResponseClientError",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsSetAddModeClientErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsSetAddModeClientErrors").parseSetAddModeClientErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorSetAddModeClientErrors:b.value}))}g.parseSetMemberAddModeResponseClientError=a}),98);
__d("WASmaxInGroupsIQErrorFallbackServerMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").attrString(a,"text");if(!b.success)return b;a=d("WASmaxParseUtils").attrIntRange(a,"code",500,599);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorFallbackServerMixin=a}),98);
__d("WASmaxInGroupsIQErrorInternalServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","internal-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",500);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorInternalServerErrorMixin=a}),98);
__d("WASmaxInGroupsIQErrorPartialServerErrorMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","partial-server-error");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",530);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorPartialServerErrorMixin=a}),98);
__d("WASmaxInGroupsIQErrorServiceUnavailableMixin",["WAResultOrError","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxParseUtils").assertTag(a,"error");if(!b.success)return b;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"text","service-unavailable");if(!b.success)return b;a=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrInt,a,"code",503);return!a.success?a:d("WAResultOrError").makeResult({text:b.value,code:a.value})}g.parseIQErrorServiceUnavailableMixin=a}),98);
__d("WASmaxInGroupsServerErrors",["WAResultOrError","WASmaxInGroupsIQErrorFallbackServerMixin","WASmaxInGroupsIQErrorInternalServerErrorMixin","WASmaxInGroupsIQErrorPartialServerErrorMixin","WASmaxInGroupsIQErrorServiceUnavailableMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a){var b=d("WASmaxInGroupsIQErrorInternalServerErrorMixin").parseIQErrorInternalServerErrorMixin(a);if(b.success)return d("WAResultOrError").makeResult({name:"IQErrorInternalServerError",value:b.value});var c=d("WASmaxInGroupsIQErrorServiceUnavailableMixin").parseIQErrorServiceUnavailableMixin(a);if(c.success)return d("WAResultOrError").makeResult({name:"IQErrorServiceUnavailable",value:c.value});var e=d("WASmaxInGroupsIQErrorPartialServerErrorMixin").parseIQErrorPartialServerErrorMixin(a);if(e.success)return d("WAResultOrError").makeResult({name:"IQErrorPartialServerError",value:e.value});var f=d("WASmaxInGroupsIQErrorFallbackServerMixin").parseIQErrorFallbackServerMixin(a);return f.success?d("WAResultOrError").makeResult({name:"IQErrorFallbackServer",value:f.value}):d("WASmaxParseUtils").errorMixinDisjunction(a,["IQErrorInternalServerError","IQErrorServiceUnavailable","IQErrorPartialServerError","IQErrorFallbackServer"],[b,c,e,f])}g.parseServerErrors=a}),98);
__d("WASmaxInGroupsBaseServerErrorMixin",["WAResultOrError","WASmaxInGroupsIQErrorResponseMixin","WASmaxInGroupsServerErrors","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseUtils").flattenedChildWithTag(a,"error");if(!c.success)return c;a=d("WASmaxInGroupsIQErrorResponseMixin").parseIQErrorResponseMixin(a,b);if(!a.success)return a;b=d("WASmaxInGroupsServerErrors").parseServerErrors(c.value);return!b.success?b:d("WAResultOrError").makeResult(babelHelpers["extends"]({},a.value,{errorServerErrors:b.value}))}g.parseBaseServerErrorMixin=a}),98);
__d("WASmaxInGroupsSetMemberAddModeResponseServerError",["WASmaxInGroupsBaseServerErrorMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsBaseServerErrorMixin").parseBaseServerErrorMixin(a,b);return!c.success?c:c}g.parseSetMemberAddModeResponseServerError=a}),98);
__d("WASmaxInGroupsIQResultResponseMixin",["WAResultOrError","WASmaxParseReference","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["id"]);if(!c.success)return c;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"id",c.value);if(!c.success)return c;c=d("WASmaxParseReference").attrStringFromReference(b,["to"]);if(!c.success)return c;b=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"from",c.value);if(!b.success)return b;c=d("WASmaxParseUtils").literal(d("WASmaxParseUtils").attrString,a,"type","result");return!c.success?c:d("WAResultOrError").makeResult({type:c.value})}g.parseIQResultResponseMixin=a}),98);
__d("WASmaxInGroupsSetMemberAddModeResponseSuccess",["WASmaxInGroupsIQResultResponseMixin","WASmaxParseUtils"],(function(a,b,c,d,e,f,g){function a(a,b){var c=d("WASmaxParseUtils").assertTag(a,"iq");if(!c.success)return c;c=d("WASmaxInGroupsIQResultResponseMixin").parseIQResultResponseMixin(a,b);return!c.success?c:c}g.parseSetMemberAddModeResponseSuccess=a}),98);
__d("WASmaxOutGroupsBaseIQSetRequestMixin",["WASmaxJsx","WASmaxMixins","WAWap"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("iq",{id:d("WAWap").generateId(),type:"set"});return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseIQSetRequestMixin=a}),98);
__d("WASmaxOutGroupsBaseSetGroupMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutGroupsBaseIQSetRequestMixin","WAWap"],(function(a,b,c,d,e,f,g){function h(a){a=a.iqTo;a=d("WASmaxOutGroupsBaseIQSetRequestMixin").mergeBaseIQSetRequestMixin(d("WASmaxJsx").smax("iq",{to:d("WAWap").GROUP_JID(a),xmlns:"w:g2"}));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeBaseSetGroupMixin=a}),98);
__d("WASmaxOutGroupsAdminAddModeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("member_add_mode",null,"admin_add");return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAdminAddModeMixin=a}),98);
__d("WASmaxOutGroupsAllMembersAddModeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(){var a=d("WASmaxJsx").smax("member_add_mode",null,"all_member_add");return a}function a(a){var b=h();return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeAllMembersAddModeMixin=a}),98);
__d("WASmaxOutGroupsUnknownAddModeMixin",["WASmaxJsx","WASmaxMixins"],(function(a,b,c,d,e,f,g){function h(a){a=a.memberAddModeElementValue;a=d("WASmaxJsx").smax("member_add_mode",null,a);return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeUnknownAddModeMixin=a}),98);
__d("WASmaxOutGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup",["WASmaxMixinGroupExhaustiveError","WASmaxOutGroupsAdminAddModeMixin","WASmaxOutGroupsAllMembersAddModeMixin","WASmaxOutGroupsUnknownAddModeMixin"],(function(a,b,c,d,e,f,g){function a(a,b){if(b.isAdminAddMode)return d("WASmaxOutGroupsAdminAddModeMixin").mergeAdminAddModeMixin(a);if(b.isAllMembersAddMode)return d("WASmaxOutGroupsAllMembersAddModeMixin").mergeAllMembersAddModeMixin(a);if(b.unknownAddMode)return d("WASmaxOutGroupsUnknownAddModeMixin").mergeUnknownAddModeMixin(a,b.unknownAddMode);throw new(d("WASmaxMixinGroupExhaustiveError").SmaxMixinGroupExhaustiveError)()}g.mergeAdminOrAllMembersOrUnknownAddModeMixinGroup=a}),98);
__d("WASmaxOutGroupsGroupMemberAddModeMixin",["WASmaxJsx","WASmaxMixins","WASmaxOutGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup"],(function(a,b,c,d,e,f,g){function h(a){a=a.adminOrAllMembersOrUnknownAddModeMixinGroupArgs;a=d("WASmaxJsx").smax("smax$any",null,d("WASmaxOutGroupsAdminOrAllMembersOrUnknownAddModeMixinGroup").mergeAdminOrAllMembersOrUnknownAddModeMixinGroup(d("WASmaxJsx").smax("member_add_mode",null),a));return a}function a(a,b){b=h(b);return d("WASmaxMixins").mergeStanzas(a,b)}g.mergeGroupMemberAddModeMixin=a}),98);
__d("WASmaxOutGroupsSetMemberAddModeRequest",["WASmaxJsx","WASmaxOutGroupsBaseSetGroupMixin","WASmaxOutGroupsGroupMemberAddModeMixin"],(function(a,b,c,d,e,f,g){function a(a){a=d("WASmaxOutGroupsGroupMemberAddModeMixin").mergeGroupMemberAddModeMixin(d("WASmaxOutGroupsBaseSetGroupMixin").mergeBaseSetGroupMixin(d("WASmaxJsx").smax("iq",null),a),a);return a}g.makeSetMemberAddModeRequest=a}),98);
__d("WASmaxGroupsSetMemberAddModeRPC",["WAComms","WASmaxInGroupsSetMemberAddModeResponseClientError","WASmaxInGroupsSetMemberAddModeResponseServerError","WASmaxInGroupsSetMemberAddModeResponseSuccess","WASmaxOutGroupsSetMemberAddModeRequest","WASmaxParsingFailure","WASmaxRpcUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WASmaxOutGroupsSetMemberAddModeRequest").makeSetMemberAddModeRequest(a);b=(yield d("WAComms").sendSmaxStanza(a,b));var c=d("WASmaxInGroupsSetMemberAddModeResponseSuccess").parseSetMemberAddModeResponseSuccess(b,a);if(c.success)return{name:"SetMemberAddModeResponseSuccess",value:c.value};var e=d("WASmaxInGroupsSetMemberAddModeResponseClientError").parseSetMemberAddModeResponseClientError(b,a);if(e.success)return{name:"SetMemberAddModeResponseClientError",value:e.value};b=d("WASmaxInGroupsSetMemberAddModeResponseServerError").parseSetMemberAddModeResponseServerError(b,a);if(b.success)return{name:"SetMemberAddModeResponseServerError",value:b.value};throw new(d("WASmaxParsingFailure").SmaxParsingFailure)(d("WASmaxRpcUtils").errorMessageRpcParsing("SetMemberAddMode",{Success:c,ClientError:e,ServerError:b}))});return h.apply(this,arguments)}g.sendSetMemberAddModeRPC=a}),98);
__d("WAGroupSetMemberAddModeProtocol",["WAAssertUnreachable","WAResultOrError","WASmaxGroupsSetMemberAddModeRPC","WATagsLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["client error sending setMemberAddMode iq: ",", ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["server error sending setMemberAddMode iq: ",", ",""]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["GroupMetadata","SetMemberAddModeProtocol"]);function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=l(b);a=(yield d("WASmaxGroupsSetMemberAddModeRPC").sendSetMemberAddModeRPC({iqTo:a,adminOrAllMembersOrUnknownAddModeMixinGroupArgs:babelHelpers["extends"]({},b)}));switch(a.name){case"SetMemberAddModeResponseSuccess":return d("WAResultOrError").makeResult();case"SetMemberAddModeResponseServerError":b=a.value.errorServerErrors.value;var c=b.code;b=b.text;j.WARN(i(),c,b);return d("WAResultOrError").makeError({type:"server-error",code:c});default:a.name;b=a.value.errorSetAddModeClientErrors.value;c=b.code;a=b.text;j.WARN(h(),c,a);return d("WAResultOrError").makeError({type:"client-error",code:c})}});return k.apply(this,arguments)}function l(a){switch(a){case"admin_add":return{isAdminAddMode:!0};case"all_member_add":return{isAllMembersAddMode:!0};default:a;throw c("WAAssertUnreachable")(a)}}g.setMemberAddModeProtocol=a}),98);
__d("MAWGroupSetMemberAddMode",["MAWChangeGroupMemberAddModeApi","MAWODSProxy","WAGlobals","WAGroupSetMemberAddModeProtocol","WAOdsEnums","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.groupJid;a=a.memberAddMode;return h({groupJid:b,memberAddMode:a})}function h(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.groupJid;a=a.memberAddMode;var c=(yield d("WAGroupSetMemberAddModeProtocol").setMemberAddModeProtocol(b,a));if(c.success===!1){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_SET_MEMBER_ADD_MODE,key:"fail."+c.error.code});return d("WAResultOrError").makeError(c.error.type)}d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.GROUP_SET_MEMBER_ADD_MODE,key:"success"});yield d("MAWChangeGroupMemberAddModeApi").changeGroupMemberAddMode(b,d("WAGlobals").getMyUserJid(),a,d("WATimeUtils").unixTime(),"skip_admin_message");return c});return i.apply(this,arguments)}g.setMemberAddModeFn=a}),98);
__d("MAWLoadMessagesRequest",["FBLogger","MAWMessagesCompare","MAWMessagesDirection","MessagesRangesV2ExternalIds","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,e){if(a.length===0)return[];e=d("MAWMessagesCompare").getSortComparisonFunctionForDirection(d("MAWMessagesDirection").translateMawDirectionToMwpDirection(e));a=[].concat(a).sort(e);if(b.lowerBoundExternalId!=null&&((e=b.lowerBoundExternalId)==null?void 0:e.toString())!==d("MessagesRangesV2ExternalIds").MIN_EXTERNAL_ID&&((e=b.lowerBoundExternalId)==null?void 0:e.toString())!==d("MessagesRangesV2ExternalIds").MAX_EXTERNAL_ID){e=a.findIndex(function(a){return a.externalId===b.lowerBoundExternalId});e!==-1?a=a.slice(e):c("FBLogger")("messenger_e2ee_web").mustfix("Get messages for range: no external id in source msgs list")}a=i(a,b);return a.slice(0,b.numMsgs)}function a(a,b,c,e){a=a.filter(function(a){var c;return((c=a.sortOrderMs)!=null?c:Number.MAX_SAFE_INTEGER)>=b.gte[0]&&((c=a.sortOrderMs)!=null?c:Number.MIN_SAFE_INTEGER)<=b.lte[0]});var f=d("MAWMessagesDirection").switchOnMAWMessagesDirection(c,{after:[b.gte,b.lte],before:[b.lte,b.gte]}),g=f[0],i=g[0];g=g[1];f=f[1];f[0];var j=f[1];f=h(a,{includeLowerBoundMsg:!0,lowerBoundExternalId:d("WAStanzaUtils").toStanzaId(g),lowerBoundSortOrderMs:i,numMsgs:e},c);if(j!==d("MessagesRangesV2ExternalIds").MIN_EXTERNAL_ID&&j!==d("MessagesRangesV2ExternalIds").MAX_EXTERNAL_ID){a=f.findIndex(function(a){return a.externalId===j});if(a!==-1)return f.slice(0,a)}return f}function i(a,b){if(b.includeLowerBoundMsg||a.length===0)return a;return a[0].externalId===b.lowerBoundExternalId||a[0].sortOrderMs===b.lowerBoundSortOrderMs?a.slice(1):a}g.getMsgsForRange=h;g.getMsgsForBounds=a}),98);
__d("MAWLoadMsgsDedupper",["MAWDbMsgUtil","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a=new Set();return function(b){b=d("MAWDbMsgUtil").getProtocolMsgIdFromDbMsg(b);if(b==null)return!0;b=d("WAMsg").craftWAMsgIdString(b);if(b!=null){if(a.has(b))return!1;a.add(b)}return!0}}g["default"]=a}),98);
__d("MAWLoadMsgsUtil",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){var d=0,e=0,f=!1,g=null;return function(h){e++;if(g!=null&&g===h.sortOrderMs)return!1;if(e>b&&h.sortOrderMs!==a)return!0;h.msgId===c&&(f=!0);f&&d++;if(d>b)return!0;g=h.sortOrderMs;return!1}}function b(a){var b=!0,c=0,d=null;return function(e){if(d===null)c++;else if(d===e.sortOrderMs){c+=b?0:1;return!1}else c++,b=!1;if(c>a)return!0;d=e.sortOrderMs;return!1}}f.makeUntilWithRangeExtension=a;f.makeUntilWithRangeExtensionBothDirections=b}),66);
__d("MAWLoadMsgsTxnsV2",["FBLogger","MAWBridgeMsg","MAWBridgeMsgCountdown","MAWBridgeReceiverFetchInfo","MAWBridgeTypesCreators","MAWBridgeXMA","MAWDbChunkTxns","MAWDbEditMsgHistoryTxns","MAWDbMediaTxns","MAWDbReactionsTxns","MAWDbReceiverFetchTxns","MAWDbXMATxns","MAWDexieTable","MAWGetIsMediaDownloadStatusEnabled","MAWHandleXmaTransactionUtil","MAWLoadMessagesRequest","MAWLoadMsgsDedupper","MAWLoadMsgsUtil","MAWLoadReplyMediaTxns","MAWLoggerUtils","MAWMediaUtils","MAWMessagesDirection","MAWODSProxy","MAWRavenUtils","MAWXMAUtils","WAMsgType","WAOdsEnums","WATagsLogger","WATimeUtils","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMsgsByExternalId: From: externalId:",". ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs, result: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs: From:"," orignalMsgId:",".}"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["LoadMoreMsgs, range: ",".}"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["EphemeralCounter: Showing UI counter for ",""]);l=function(){return a};return a}function m(a,b,d,e,f,g){switch(d){case"before":return h();case"after":return i().then(function(a){return a.reverse()})}function h(){var d=c("MAWLoadMsgsDedupper")();return a.messages.where(["threadJid","sortOrderMs"]).between([b,0],[b,e],!0,!0).reverse().filter(f).filter(d).filter(function(a){return c("justknobx")._("3227")?a.source!=="media_restore":a!=null}).until(g,!0).toArray()}function i(){var d=c("MAWLoadMsgsDedupper")();return a.messages.where(["threadJid","sortOrderMs"]).between([b,e],[b,Number.MAX_SAFE_INTEGER],!0,!0).filter(f).filter(d).filter(function(a){return c("justknobx")._("3227")?a.source!=="media_restore":a!=null}).until(g,!0).toArray()}}function n(a,b){return d("MAWDbReactionsTxns").getReactionsFromMessages(a,b).then(function(a){return a.map(function(a){var b=a.author,c=a.reaction,e=a.reactToMsgId,f=a.threadJid;a=a.ts;if(e==null)return;return c==null?{reaction:d("MAWBridgeTypesCreators").createBridgeDeleteReaction({author:b,chatJid:f,reactToMsgId:e}),type:"delete"}:{reaction:d("MAWBridgeTypesCreators").createBridgeUpsertReaction({author:b,chatJid:f,reaction:c||"",reactToMsgId:e,ts:a}),type:"upsert"}}).filter(Boolean)})}function o(a,b){return d("MAWDbMediaTxns").getMsgMediaPairFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b[0],e=b[1];return d("MAWDbChunkTxns").hasMediaChunk(a,e.hashedPlaintextHash).then(function(b){return p(a,c.threadJid,e).then(function(f){var g=f.map(function(a){return a.msgId}),h=d("MAWMediaUtils").createHdTypesForBridgeMedia(f);g=c.ravenEphemeralType!=null&&c.ravenEphemeralMediaState!=null?d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:c.threadJid,filteredMsgIds:g,hasMediaForUI:b,hdTypes:h,media:e,ravenSettings:d("MAWRavenUtils").deriveRavenSettings(c.ravenEphemeralType,c.ravenEphemeralMediaState),sortOrderMs:c.sortOrderMs}):d("MAWBridgeTypesCreators").createBridgeMedia({chatJid:c.threadJid,filteredMsgIds:g,hasMediaForUI:b,hdTypes:h,media:e,sortOrderMs:c.sortOrderMs});return d("MAWMediaUtils").getBridgeMediaAnnotatedForDisplay(a,g,f)})})}))})}function p(a,b,c){return a.messages.where("msgId").anyOf(c.msgIds).toArray().then(function(a){return a.filter(function(a){return a.threadJid===b})})}function q(a,b){return d("MAWDbXMATxns").getXMAFromMsgs(a,b).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){if(d("MAWXMAUtils").isXMAStoryReply(b.targetType))return d("MAWDexieTable").dexieResolve(null);if(d("MAWGetIsMediaDownloadStatusEnabled").getIsMediaDownloadStatusForXMAsEnabledWithChunkVerification()){var c=[b.defaultPreviewMediaId,b.faviconMediaId,b.headerMediaId].filter(Boolean);return d("MAWDbMediaTxns").maybeBulkGetMediaFromMediaId(a,c).then(function(c){if(c.size===0)return d("MAWBridgeXMA").createBridgeXMA(null,b,{hasMedia:!1,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1});var e=b.defaultPreviewMediaId!=null?c.get(b.defaultPreviewMediaId):null,f=b.headerMediaId!=null?c.get(b.headerMediaId):null;c=b.faviconMediaId!=null?c.get(b.faviconMediaId):null;return d("MAWHandleXmaTransactionUtil").verifyAllMediaChunksForXMA(e,c,f,a).then(function(a){var c=a.hasMedia,f=a.hasXmaFaviconMedia;a=a.hasXmaHeaderMedia;return d("MAWBridgeXMA").createBridgeXMA(e,b,{hasMedia:c,hasXmaFaviconMedia:f,hasXmaHeaderMedia:a})})})}return d("MAWDbMediaTxns").maybeGetMediaFromMediaId(a,b.defaultPreviewMediaId).then(function(c){return c==null?d("MAWBridgeXMA").createBridgeXMA(c,b,{hasMedia:!1,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1}):d("MAWDexieTable").dexieAll([c,d("MAWDbChunkTxns").hasMediaChunk(a,c==null?void 0:c.hashedPlaintextHash)]).then(function(a){var c=a[0];a=a[1];return d("MAWBridgeXMA").createBridgeXMA(c,b,{hasMedia:a,hasXmaFaviconMedia:!1,hasXmaHeaderMedia:!1})})})}))}).then(function(a){return a.filter(Boolean)})}function r(a,b){return d("MAWDexieTable").dexieAll(b.map(function(b){return b.receiverFetchId==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbReceiverFetchTxns").maybeGetReceiverFetchInfoFromReceiverFetchId(a,b.receiverFetchId).then(function(a){return a==null?d("MAWDexieTable").dexieResolve(null):d("MAWBridgeReceiverFetchInfo").createBridgeReceiverFetchInfoPayloadFromDbInfo(b,a)})})).then(function(a){return a.filter(Boolean)})}function s(a,b,c,e,f,g,h){h===void 0&&(h=function(){return!0});var i=d("WATimeUtils").unixTime(),j=function(a){return a.messageExpirationTs==null||a.messageExpirationTs>i};c=d("MAWLoadMsgsUtil").makeUntilWithRangeExtension(f,c,g);return m(a,b,e,f,function(a){return h(a)&&j(a)},c).then(function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)})).then(function(a){return{msgs:b,replyMediaInfo:a}})})}function t(a,b){return a.messages.where("externalId").equals(b).toArray()}function u(a,b){return t(a,b).then(function(e){e.length>1&&c("FBLogger")("messenger_web_pinned_messages").warn("duplicate MAW msg returned for externalId",b);return d("MAWDexieTable").dexieAll(e.map(function(b){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,b)})).then(function(a){return{msgs:e,replyMediaInfo:a}})})}function v(a){a=a.filter(function(a){return a.ephemeralCounterStarted});if(a.length>0){d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.Countdown,d("MAWLoggerUtils").Tag.OnLoad]).LOG(l(),a.map(function(a){return a.msgId}));return d("MAWBridgeMsgCountdown").createBridgeMsgsStartCountdown(a).msgs}return[]}function w(a,b){return a!=null?a:d("MAWMessagesDirection").switchOnMAWMessagesDirection(b,{after:Number.MIN_SAFE_INTEGER,before:Number.MAX_SAFE_INTEGER})}function a(a){var b=a.chatJid,c=a.config,e=a.db,f=a.direction,g=a.range,h=d("WATimeUtils").unixTime();a=function(a){var b=a.messageExpirationTs!=null&&a.messageExpirationTs>h;a=a.type===d("WAMsgType").MSG_TYPE.ADMIN&&!c.admin;return!b&&!a};var i=g.includeLowerBoundMsg?g.numMsgs:g.numMsgs+1;i=d("MAWLoadMsgsUtil").makeUntilWithRangeExtensionBothDirections(i);var j=w(g.lowerBoundSortOrderMs,f);return m(e,b,f,j,a,i).then(function(a){var b=d("MAWLoadMessagesRequest").getMsgsForRange(a,g,f);return d("MAWDexieTable").dexieAll(b.map(function(a){return d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(e,a)})).then(function(a){return{msgsForRange:b,replyMediaInfo:a}})}).then(function(a){var b=a.msgsForRange;a=a.replyMediaInfo;d("WATagsLogger").TAGS(["MAWSecureLocalDBDataSource"]).LOG(k(),g);return x(e,b,a,f,g.numMsgs,c)})}function b(a,b,c,e,f,g,h,i){var k=w(f,e);return s(a,b,c,e,k,h,function(a){return i.admin||a.type!==d("WAMsgType").MSG_TYPE.ADMIN}).then(function(b){var f=b.msgs;b=b.replyMediaInfo;var l=f;g||(l=l.filter(function(a){return a.msgId!==h}),l.length===f.length&&f.length!==0&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.LOAD_MORE_NO_ORIGINAL_MSG_IN_MAW,key:"mismatch"}));d("WATagsLogger").TAGS(["MAWSecureLocalDBDataSource"]).LOG(j(),k,h);return x(a,l,b,e,c,i)})}function x(a,b,c,e,f,g){var h=b.length;if(h===0)return d("MAWDexieTable").dexieResolve({editMsgHistory:[],expiringCountdown:[],hasMoreAfter:z(h,f,e),hasMoreBefore:y(h,f,e),medias:[],msgs:[],reactions:[],receiverFetchInfoPayloads:[],xmas:[]});var j=b.map(function(a,b){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return;return d("MAWBridgeMsg").createBridgeMsg(a,void 0,(c||[])[b])}).filter(Boolean),k=v(b);d("WATagsLogger").TAGS(["MAWSecureLocalDBDataSource"]).LOG(i(),j.map(function(a){return a.msgId+":"+a.sortOrderMs}));return d("MAWDexieTable").dexieAll([g.reactions?n(a,b):d("MAWDexieTable").dexieResolve([]),g.media?o(a,b):d("MAWDexieTable").dexieResolve([]),g.xma?q(a,b):d("MAWDexieTable").dexieResolve([]),g.editMsgHistory?d("MAWDbEditMsgHistoryTxns").loadEditMsgHistory(a,b):d("MAWDexieTable").dexieResolve([]),g.receiverFetch?r(a,b):d("MAWDexieTable").dexieResolve([])]).then(function(a){var b=a[0],c=a[1],d=a[2],g=a[3];a=a[4];return{editMsgHistory:g,expiringCountdown:k,hasMoreAfter:z(h,f,e),hasMoreBefore:y(h,f,e),medias:c,msgs:j,reactions:b,receiverFetchInfoPayloads:a,xmas:d}})}function y(a,b,c){switch(c){case"before":return a>=b;default:c;return!0}}function z(a,b,c){switch(c){case"after":return a>=b;default:c;return!0}}function e(a,b,c){return u(a,b).then(function(e){var f=e.msgs,g=e.replyMediaInfo;if(f.length===0)return{editMsgHistory:[],medias:[],msgs:[],reactions:[],receiverFetchInfoPayloads:[],xmas:[]};var i=f.map(function(a,b){if(d("MAWXMAUtils").isXMAStoryReply(a.xmaMessageType))return;return d("MAWBridgeMsg").createBridgeMsg(a,void 0,(g||[])[b])}).filter(Boolean);d("WATagsLogger").TAGS(["MAWFetchMessageByPinnedExternalId"]).LOG(h(),b,i.map(function(a){return""+a.msgId}));return d("MAWDexieTable").dexieAll([c.reactions?n(a,f):d("MAWDexieTable").dexieResolve([]),c.media?o(a,f):d("MAWDexieTable").dexieResolve([]),c.xma?q(a,f):d("MAWDexieTable").dexieResolve([]),c.editMsgHistory?d("MAWDbEditMsgHistoryTxns").loadEditMsgHistory(a,f):d("MAWDexieTable").dexieResolve([]),c.receiverFetch?r(a,f):d("MAWDexieTable").dexieResolve([])]).then(function(a){var b=a[0],c=a[1],d=a[2],e=a[3];a=a[4];return{editMsgHistory:e,medias:c,msgs:i,reactions:b,receiverFetchInfoPayloads:a,xmas:d}})})}g.loadMoreMsgsAndMediaForRange=a;g.loadMoreMsgsAndMediaFromTs=b;g.loadMsgsAndMediaByExternalId=e}),98);
__d("MAWLoadMsgsApi",["MAWIndexedDb","MAWLoadMsgsTxns","MAWLoadMsgsTxnsV2","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";c=(a=d("MAWIndexedDb")).makeMsgrTransactor({chunk:(b=d("MAWTransactionMode")).READONLY,editMsgHistory:b.READONLY,media:b.READONLY,messages:b.READONLY,reactions:b.READONLY,receiverFetchInfo:b.READONLY,threads:b.READONLY,xma:b.READONLY},"loadMsgsFromTs",function(a){return function(b,c,e,f,g,h,i){return d("MAWLoadMsgsTxnsV2").loadMoreMsgsAndMediaFromTs(a,b,c,e,f,g,h,i)}});e=a.makeMsgrTransactor({chunk:b.READONLY,editMsgHistory:b.READONLY,media:b.READONLY,messages:b.READONLY,reactions:b.READONLY,receiverFetchInfo:b.READONLY,threads:b.READONLY,xma:b.READONLY},"loadMsgsRange",function(a){return function(b,c,e,f){return d("MAWLoadMsgsTxnsV2").loadMoreMsgsAndMediaForRange({chatJid:b,config:c,db:a,direction:e,range:f})}});f=a.makeMsgrTransactor({chunk:b.READONLY,editMsgHistory:b.READONLY,media:b.READONLY,messages:b.READONLY,reactions:b.READONLY,receiverFetchInfo:b.READONLY,threads:b.READONLY,xma:b.READONLY},"loadMsgs",function(a){return function(b,c,e,f){return d("MAWLoadMsgsTxns").loadMsgsAndMediaFromOffset(a,b,c,e,!0,(b=f)!=null?b:"before").then(function(a){var b=a.hasMoreAfter;a=a.hasMoreBefore;return{hasMoreAfter:b,hasMoreBefore:a}})}});var h=a.makeMsgrTransactor({chunk:b.READONLY,editMsgHistory:b.READONLY,media:b.READONLY,messages:b.READONLY,reactions:b.READONLY,receiverFetchInfo:b.READONLY,threads:b.READONLY,xma:b.READONLY},"loadMsgsByExternalId",function(a){return function(b,c){return d("MAWLoadMsgsTxnsV2").loadMsgsAndMediaByExternalId(a,b,c)}});a=a.makeMsgrTransactor({chunk:b.READONLY,editMsgHistory:b.READONLY,media:b.READONLY,messages:b.READONLY,reactions:b.READONLY,receiverFetchInfo:b.READONLY,threads:b.READONLY,xma:b.READONLY},"getMsgsCount",function(a){return function(b,c,e,f,g){return d("MAWLoadMsgsTxns").loadMsgsAndMediaFromOffset(a,b,c,e,!0,(b=f)!=null?b:"before",g).then(function(a){var b=a.hasMoreAfter,c=a.hasMoreBefore;a=a.msgs;return{hasMoreAfter:b,hasMoreBefore:c,msgsCount:a.length}})}});g.loadMsgsFromTs=c;g.loadMsgsRange=e;g.loadMsgs=f;g.loadMsgsByExternalId=h;g.getMsgsCount=a}),98);
__d("MAWGetSyncResponseBackoffInfoByJidApi",["MAWIndexedDb","MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({ephemeralSettings:d("MAWTransactionMode").READONLY},"getSyncResponseBackoffInfoByJid",function(a){return function(b){return a.ephemeralSettings.get({userJid:b}).then(function(a){return a==null?null:a.ephemeralSyncResponseBackoffInfo})}});g.getSyncResponseBackoffInfoByJid=a}),98);
__d("MAWMessageSendScheduler",["WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){h==null&&(h=d("WorkerScheduler").makeScheduler("message-send",{concurrency:5,maxConcurrency:5,maxThrottleMs:500,timeToStuckMs:12e4}));return h}g.messageSendScheduler=a}),98);
__d("MAWMarkMsgDroppedApi",["MAWAckLevel","MAWDbMsgTxns","MAWDbReactionsTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","gkx"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READWRITE,reactions:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,xma:a.READONLY},"markMsgDropped",function(a){return function(b,e){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b)]).then(function(b){var f=b[0];b=b[1];if(f!=null){var g=(e==null?void 0:e.isRetriable)===!0?d("MAWAckLevel").ACK.failedRetryable:d("MAWAckLevel").ACK.expired,h=c("gkx")("7471");return d("MAWDbMsgTxns").updateSystemAck(a,f.msgId,g,void 0,void 0,h&&(e==null?void 0:e.applicationErrorCode)!=null?e==null?void 0:e.applicationErrorCode:void 0).then(function(a){return a==null?"missing":a.ack<=d("MAWAckLevel").ACK.clock?"dropped":"sent"})}return b!=null?d("MAWDbReactionsTxns").deleteReaction(a,b).then(function(){return"dropped"}):"missing"})}});g.markMsgDropped=b}),98);
__d("MAWMessageSendsCommon",["MAWMarkMsgDroppedApi","MAWMessageSendScheduler","MAWQplProxy","WAGetSafeQPLError","WAPromiseDelays","WAResultOrError","WATagsLogger","WATimeUtils","WAWaitForComms","WorkerScheduler","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Guard: should not happen, result is null"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message send fails: ",". Error text: ",""]);i=function(){return a};return a}var j=1e3,k=d("WATagsLogger").TAGS(["MessageSend"]);function l(a,b,c,d,e){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){d("MAWQplProxy").sendQplPointThroughBridge(a,"backend_reached",{annotations:{bool:{backendSetupReadyFromWorker:!d("WAWaitForComms").isStillWaitingForComms()}},instanceKey:b});var g;try{d("MAWQplProxy").sendQplPointThroughBridge(a,"wait_for_comms_start",{annotations:{},instanceKey:b});yield d("WAWaitForComms").waitForComms();d("MAWQplProxy").sendQplPointThroughBridge(a,"wait_for_comms_end",{annotations:{},instanceKey:b});d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_start",{annotations:{},instanceKey:b});g=(yield d("MAWMessageSendScheduler").messageSendScheduler().runTask({customFlags:{runtimeReliability:!0},fn:function(){return c(d("WATimeUtils").unixTime())},name:e,priority:d("WorkerScheduler").BLOCKING_PRIORITY}));if(g.success===!0)d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_end",{instanceKey:b});else{var m;d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{annotations:{string:{errorType:(m=(m=g.error)==null?void 0:m.type)!=null?m:"unknown-error"}},instanceKey:b})}}catch(c){k.ERROR(i(),c,d("WAGetSafeQPLError").getSafeQPLErrorMessage(c));d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{annotations:{string:{errorDescription:d("WAGetSafeQPLError").getSafeQPLErrorMessage(c),errorType:"runtime-error"}},instanceKey:b});f!=null&&(yield d("MAWMarkMsgDroppedApi").markMsgDropped(f));throw c}if(!g){m="null-response-from-message-send";k.ERROR(h());d("MAWQplProxy").sendQplPointThroughBridge(a,"message_send_fail",{instanceKey:b});return d("WAResultOrError").makeError({applicationErrorCode:null,details:m,isRetriable:!0,type:"unexpected-message-codepath"})}if(g.success===!0)return g;g.success;f!=null&&(yield d("MAWMarkMsgDroppedApi").markMsgDropped(f,g.error));if(((m=g.error)==null?void 0:m.type)==="retryable-error"){m=(m=g.error.backoff)!=null?m:j;yield d("WAPromiseDelays").delayMs(m);return l(a,b,c,e,f)}else return g});return m.apply(this,arguments)}g.messageSendLogger=k;g.messageSendObserver=l}),98);
__d("MAWDebugMsg",["MAWBridgeMsg","MAWDbMsg","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLocalizationType","MAWLocalizationUtils","MAWMsgType","MAWTransactionMode","MAWTransactor","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWTransactor").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READONLY,threads:a.READWRITE},"writeDebugMsg",function(a){return function(b,e,f){return!c("gkx")("23958")?d("MAWDexieTable").dexieResolve():d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success)return;var c=b.value;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getThreadNewestMessageBySortOrder(a,c.jid),d("MAWDbMsgTxns").getThreadNewestMessageTs(a,c),(f==null?void 0:f.decryptionError)==="errDuplicateMsg"?d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f.protocolMsgId).then(function(a){if(a==null)return", no existing message";return a.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?", existing ciphertext message":",  existing message"}):d("MAWDexieTable").dexieResolve(""),d("MAWDbMsgTxns").getNextMsgIdNumberForThread(a,c)]).then(function(a){var b=a[0],f=a[1],g=a[2];a=a[3];a=d("MAWDbMsg").craftDebugMsgId(c.chatId,a-1);f=d("WATimeUtils").castToMillisTime(((b=(b=b==null?void 0:b.sortOrderMs)!=null?b:f)!=null?b:0)+1);b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:["[fb-only][DEBUG]: "+(e+g)],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.DEBUG_MSG,version:0},c.jid);d("MAWIndexedDb").afterTransaction({tag:"NewMsg",value:d("MAWBridgeMsg").createBridgeMsg(babelHelpers["extends"]({},b,{msgId:a,sortOrderMs:f}))})})})}});g.writeDebugMsg=b}),98);
__d("MAWGetEditMsgForSending",["MAWAckLevel","MAWAsMessageApplication","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWTransactionMode","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsg"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get thread (success:",")"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get originalMsgProtocolMsgId"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendEditMsg] Failed to get edit history"]);k=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:(a=d("MAWTransactionMode")).READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READONLY,threads:a.READONLY},"getEditMsgForSending",function(a){return function(b,e){return l(a,b,e).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var e=d("MAWAsMessageApplication").asEditMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("err")("This cannot happen because there are no system edit");return{dbMsg:a,editOriginalExternalId:a.originalMsgExternalId,messageApplication:e,messageType:{isRevoked:!1,type:"text"},protocolMsgId:b,type:"unsent"}})}});function l(a,b,c){return d("MAWDbEditMsgHistoryTxns").getEditHistoryMsgByEditedProtocolMsgId(a,b,c).then(function(b){if(b==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("missing_history")}else if(b.sendStatus!=null&&b.sendStatus>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var c=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.threadJid,b.originalMsgExternalId);if(c==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_msg")}return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,b.threadJid),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,c)]).then(function(a){var c=a[0];a=a[1];if(!c.success){d("WALogger").ERROR(i(),c.success);return d("WAResultOrError").makeError("missing_thread")}if(a==null){d("WALogger").ERROR(h());return d("WAResultOrError").makeError("missing_msg")}return a.ack>d("MAWAckLevel").ACK.clock?d("WAResultOrError").makeError("sent"):d("WAResultOrError").makeResult({msg:b,thread:c.value})})})}g.getEditMsgForSending=b}),98);
__d("MAWMediaType",["WAServerMediaType"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case"XMA":return"xma-image";case"EphemeralScreenshotAction":case"Raven":case"RavenAction":case"EditAction":case"BumpExistingMessage":return null;default:return d("WAServerMediaType").getMediaType(a)}}g.getMediaType=a}),98);
__d("MAWSendMsgUtil",["MAWMediaType","WAMsgType"],(function(a,b,c,d,e,f,g){"use strict";({});function h(a){var b=d("MAWMediaType").getMediaType(a),c=a===d("WAMsgType").MSG_TYPE.REVOKED;if(b!=null)return{mediaType:b,type:"media"};else if(a===d("WAMsgType").MSG_TYPE.SK_DISTRIBUTION)return{isInvisible:!0,isRevoked:!1,type:"text"};else return{isRevoked:c,type:"text"}}function a(a){var b=d("MAWMediaType").getMediaType(a);if(b!=null)return{mediaType:b,type:"media"};switch(a){case"XMA":case"Raven":case"RavenAction":case"EphemeralScreenshotAction":case"EditAction":case"BumpExistingMessage":return{isRevoked:!1,type:"text"};default:return h(a)}}g.waGetMessageTypeFromMsg=h;g.getMessageTypeFromMsg=a}),98);
__d("MAWGetMsgForSendingApi",["MAWAckLevel","MAWAsMessageApplication","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsg","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbUnrenderedMsgTxns","MAWDbXMATxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWSendMsgUtil","MAWTransactionMode","MAWXMAUtils","WAJids","WALogger","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get XMA: isXma: ",", type: "," "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[SendMsg] Failed to get message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Done"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Unrecognized type ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg "," -- MAWGetMsgForSendingAPI -- Error: ",""]);l=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:(a=d("MAWTransactionMode")).READONLY,media:a.READONLY,messages:a.READONLY,participants:a.READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY,xma:a.READONLY},"getMsgForSending",function(a){return function(b){return m(a,b).then(function(a){if(!a.success){d("WALogger").LOG(l(),b,a.error);return{type:a.error}}a=a.value;var e=a.contactsInThread,f=a.groupInvite,g=a.isReplyMsg,h=a.media,i=a.msg;a=a.xmaPayload;if(!d("MAWDbMsg").NO_CONTENT_MESSAGE_TYPES_ALLOWLIST.includes(i.type)&&!d("MAWDbMsg").isContentMsg(i)){d("WALogger").LOG(k(),b,i.type);throw c("err")("We do not support message sending with "+i.type+" type")}var m=d("MAWAsMessageApplication").asMessageApplication(i,h,f,a),n=null;i.type===d("MAWMsgType").MSG_TYPE.GROUP_INVITE&&f?n={invitedParticipantUserJid:f.inviteeJid,isRevoked:!1,type:"text"}:n=d("MAWSendMsgUtil").getMessageTypeFromMsg(i.type);if(d("WAJids").isAuthorSystem(i.author))throw c("err")("A system message cannot be sent");d("WALogger").LOG(j(),b);return{contactsInThread:e,dbMsg:i,isReplyMsg:g,isXMAMsg:a!=null,media:h,messageApplication:m,messageType:n,protocolMsgId:{author:i.author,chat:i.threadJid,externalId:a!=null&&a.associatedMessage!=null?a.associatedMessage.externalId:i.externalId},type:"unsent",xmaPayload:a}})}});function m(a,b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(c){var e=c[0];c=c[1];var f=c.value,g=e||f;if(g==null){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("missing_msg")}else if(g.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");var j=d("MAWXMAUtils").maybeXMAMessage(e),k=g.quote!=null;return d("MAWDexieTable").dexieAll([e?d("MAWDbMediaTxns").getAndCheckMediaFromMsg(a,e):d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeResult()),c.success?d("MAWDbGroupInviteTxns").getAndCheckGroupInviteFromMsg(a,c.value):d("MAWDexieTable").dexieResolve(),j?d("MAWDbXMATxns").maybeGetXMAPayloadFromProtocolMsgId(a,b):null,d("MAWDbParticipantTxns").getParticipantsInThread(a,g.threadJid).then(function(a){return a.map(function(a){return a.userJid})})]).then(function(a){var b=a[0],c=a[1],e=a[2];a=a[3];if(!b.success)return b;if(e!=null&&!e.success){d("WALogger").ERROR(h(),j,g.type);return d("WAResultOrError").makeError("missing_xma")}b=b.value;return d("WAResultOrError").makeResult({contactsInThread:a,groupInvite:c,isReplyMsg:k,media:b,msg:g,xmaPayload:e!=null?e.value:null})})})}g.getMsgForSending=b}),98);
__d("MAWGetReactionForSending",["MAWAckLevel","MAWAsMessageApplication","MAWDbReactionsTxns","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WAJids","WAResultOrError","err"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return d("MAWDbReactionsTxns").getReaction(a,b).then(function(b){if(b==null)return d("WAResultOrError").makeError("missing");else if(b.ack>d("MAWAckLevel").ACK.clock)return d("WAResultOrError").makeError("sent");return d("MAWDbThreadTxns").getThread(a,b.threadJid).then(function(a){return!a.success?d("WAResultOrError").makeError(a.error):d("WAResultOrError").makeResult({msg:b})})})}a=d("MAWIndexedDb").makeMsgrTransactor({reactions:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"getReactionForSending",function(a){return function(b){return h(a,b).then(function(a){if(!a.success)return{type:a.error};a=a.value.msg;var b=d("MAWAsMessageApplication").asReactionMessageApplication(a);if(d("WAJids").isAuthorSystem(a.author))throw c("err")("This cannot happen because there are no system reactions");return{chat:a.threadJid,dbMsg:a,externalId:a.externalId,messageApplication:b,messageType:{isInvisible:!0,type:"reaction"},protocolMsgId:{author:a.author,chat:a.threadJid,externalId:a.externalId},type:"unsent"}})}});g.getReactionForSending=a}),98);
__d("MAWLoadThreadParticipantsApi",["MAWDbParticipantTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWLoadThreadParticipantsApi -- loadThreadParticipants -- there is no thread in db"]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({participants:d("MAWTransactionMode").READONLY,threads:d("MAWTransactionMode").READONLY},"loadThreadParticipants",function(a){return function(b){return a.threads.get({jid:b}).then(function(b){if(b==null){d("WALogger").ERROR(h());return[]}return d("MAWDbParticipantTxns").getParticipantsInThread(a,b.jid).then(function(a){return a.map(function(a){return a.userJid})})})}});g.loadThreadParticipants=a}),98);
__d("MAWMarkEditMsgDroppedApi",["FBLogger","MAWAckLevel","MAWBridgeMsg","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWJidUtils","MAWTransactionMode","WAGlobals","WAJids","WALogger","WAMsgType","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] editMsgHistory updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is not a text message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] thread is null"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is not the newest edit"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] previousEditedMsg is null"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] newestEditedMsg is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalMsg is null"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgDropped] originalProtocolMsgId is null"]);o=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({editMsgHistory:d("MAWTransactionMode").READWRITE,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE},"markEditMsgDropped",function(a){return function(b,e){var f=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(f==null){d("WALogger").ERROR(o());return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing_original_protocol_msg_id"))}return d("MAWDexieTable").dexieAll([a.threads.get({jid:b.chat}),d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,f),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,f)]).then(function(f){var g=f[0],o=f[1],p=f[2];f=p.sort(function(a,b){return b.editTs-a.editTs});var q=p.find(function(a){return a.editExternalId===b.externalId}),r=f[1];if(o==null){d("WALogger").ERROR(n());return d("WAResultOrError").makeError("missing_original_msg")}if(q==null){d("WALogger").ERROR(m());return d("WAResultOrError").makeError("missing_newest_edited_msg")}if(r==null){d("WALogger").ERROR(l());return d("WAResultOrError").makeError("missing_previous_edited_msg")}if(q.editExternalId!==f[0].editExternalId){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("invalid_newest_edited_msg")}if(g==null){d("WALogger").ERROR(j());return d("WAResultOrError").makeError("missing_thread")}if(o.type!==d("WAMsgType").MSG_TYPE.TEXT){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("invalid_original_msg")}return a.messages.where("quoteExternalId").equals(e).toArray().then(function(e){var f,g=babelHelpers["extends"]({},o,{ack:d("MAWAckLevel").ACK.sent,editCount:((f=o.editCount)!=null?f:0)-1,msgContent:r.msgContent}),i=d("WAGlobals").getMyUserJid(),j=[];f=e.find(function(a){var c;return(((c=a.quote)==null?void 0:c.content.author)===d("WAJids").AUTHOR_ME||((c=a.quote)==null?void 0:c.content.author)===i)&&a.threadJid===b.chat});if(f!=null){e=f.quote;var k=f.quoteExternalId;if(e==null)c("FBLogger")("messenger_e2ee_web").warn("[markEditMsgDropped] Failed to get the quoted content for a msg that has been quoted.",k);else{k=babelHelpers["extends"]({},f,{quote:babelHelpers["extends"]({},e,{content:babelHelpers["extends"]({},e.content,{msgContent:babelHelpers["extends"]({},g.msgContent)})})});j.push(k)}}f=[];o.editCount===1&&p.length===2&&f.push(r.editMsgHistoryId);f.push(q.editMsgHistoryId);return d("MAWDexieTable").dexieAll([a.messages.put(g),a.editMsgHistory.bulkDelete(f)]).then(function(){d("WALogger").LOG(h());d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(g)});j.forEach(function(a){d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(a)})});return d("WAResultOrError").makeResult()})})})}});g.markEditMsgDropped=a}),98);
__d("MAWMarkEditMsgSentApi",["ArmadilloDataTraceType","MAWAckLevel","MAWBridgeMsg","MAWBridgeTrace","MAWBridgeTraceEvent","MAWDbEditMsgHistory","MAWDbEditMsgHistoryTxns","MAWDbMsgTxns","MAWDexieTable","MAWFTSTxns","MAWIndexedDb","MAWJidUtils","MAWLoadReplyMediaTxns","MAWTransactionMode","WAJids","WALogger","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory updated"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] on incoming message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editMsgHistory has already been sent"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] editedMsg?.editExternalId is null"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsgHistory is null"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalMsg is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[markEditMsgSent] originalProtocolMsgId is null"]);n=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,editMsgHistory:a.READWRITE,ftsBackloggedMessages:a.READWRITE,media:a.READONLY,messages:a.READWRITE,receiverFetchInfo:a.READONLY,xma:a.READONLY},"markEditMsgSent",function(a){return function(b,e,f,g){var o=d("MAWJidUtils").maybeToProtocolMsgId(b.author,b.chat,e);if(o==null){d("WALogger").ERROR(n());return d("MAWDexieTable").dexieResolve(d("WAResultOrError").makeError("missing_original_protocol_msg_id"))}return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,o),d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId(a,o),d("MAWFTSTxns").maybePutMessageToBacklog(a,e)]).then(function(n){var o=n[0];n=n[1];var p=n.find(function(a){return a.editExternalId===e}),q=n.find(function(a){return a.editExternalId===b.externalId});if(o==null){d("WALogger").ERROR(m());return d("WAResultOrError").makeError("missing_original_msg")}if(p==null){d("WALogger").ERROR(l());return d("WAResultOrError").makeError("missing_original_msg_edit_history")}if((q==null?void 0:q.editExternalId)==null){d("WALogger").ERROR(k());return d("WAResultOrError").makeError("missing_edit_external_id")}if(q.sendStatus!=null&&q.sendStatus>d("MAWAckLevel").ACK.clock&&o.ack>d("MAWAckLevel").ACK.clock){d("WALogger").LOG(j());return d("WAResultOrError").makeError("already_sent")}if(q.author!==d("WAJids").AUTHOR_ME){d("WALogger").ERROR(i());return d("WAResultOrError").makeError("not_author")}d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([q.editExternalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});var r=[];if(n.length===2&&o.editCount===1){n=babelHelpers["extends"]({},p,{sendStatus:d("MAWAckLevel").ACK.sent});r.push(n)}p=babelHelpers["extends"]({},q,{editTs:f,sendStatus:d("MAWAckLevel").ACK.sent});r.push(p);var s=r.map(function(a){return babelHelpers["extends"]({},a,{editMsgHistoryId:d("MAWDbEditMsgHistory").convertToEditMsgHistoryId64(a.editMsgHistoryId),originalMsgId:o.msgId})}),t=babelHelpers["extends"]({},o,{ack:d("MAWAckLevel").ACK.sent});g!=null&&(t.reportingMeta=g);return d("MAWDexieTable").dexieAll([a.editMsgHistory.bulkPut(r),a.messages.put(t),d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,t)]).then(function(a){a[0];a=a[2];d("WALogger").LOG(h());d("MAWIndexedDb").afterTransaction({tag:"MsgUpdated",value:d("MAWBridgeMsg").createBridgeMsg(t,void 0,a)});d("MAWIndexedDb").afterTransaction({tag:"EditMsgHistoryAdded",value:s});return d("WAResultOrError").makeResult()})})}});g.markEditMsgSent=b}),98);
__d("MAWMarkMsgSentApi",["ArmadilloDataTraceType","MAWAckLevel","MAWBridgeTrace","MAWBridgeTraceEvent","MAWDbMsgTxns","MAWDbThread","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWEphemeralMsgTxns","MAWEphemeralSettingsTxns","MAWFolderTypes","MAWIndexedDb","MAWMsgType","MAWThreadNewestMsgOrReactionUtils","MAWThreadUpdateMiddlewareGatingUtil","MAWTransactionMode","MAWUpdateThreadBumpTimestamp","WALogger","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Thread missing from DB"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Found both regular and unrendered message with the same protocol msg ID"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Msg missing from DB"]);j=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,reactions:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"markMsgSent",function(a){return function(b,e,f){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(g){var l=g[0];g=g[1];if(l==null&&!g.success){d("WALogger").LOG(j());return}else if(l!=null){d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData([l.externalId],c("MAWBridgeTraceEvent").ReceivedSent,d("ArmadilloDataTraceType").armadilloMessageSend)});g.success&&d("WALogger").ERROR(i());var m=l.ack<d("MAWAckLevel").ACK.sent;return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").updateSystemAck(a,l.msgId,d("MAWAckLevel").ACK.sent,e,f),d("MAWDbThreadTxns").getThread(a,l.threadJid)]).then(function(b){var f=b[0];b=b[1];if(!b.success){d("WALogger").ERROR(h());return}b=b.value;var g=d("WATimeUtils").castUnixTimeToMillisTime(e);g=babelHelpers["extends"]({},b,{lastReadMsgTs:g,newestMsgTs:g,threadOrder:d("MAWDbThread").craftThreadOrder(g,b.jid)});g=m?d("MAWDbThreadTxns").updateThread(a,g):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([k(a,b),d("MAWEphemeralMsgTxns").markEphemeralMessageAsSent(a,f),g]).then(c("emptyFunction"))})}else if(g.success){var n=g.value;return d("MAWDbUnrenderedMsgTxns").updateSystemAckForUnrenderedMsg(a,n.msgId,d("MAWAckLevel").ACK.sent).then(function(){if(n.type===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE)return d("MAWEphemeralSettingsTxns").updateContactWhenEphemeralSettingChangeMarkedSent(a,b.chat,e)})}}).then(c("emptyFunction"))}});function k(a,b){return!d("MAWThreadUpdateMiddlewareGatingUtil").isNewMiThreadCreationFlowEnabled("exposure_logging_enabled","outgoing_msg_from_HIM")?d("MAWDexieTable").dexieResolve():d("MAWThreadNewestMsgOrReactionUtils").getNewestMsgOrReactionForBump(a,b.jid).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"CreateE2EEMetadataThread",value:{bumpTimestampMs:d("MAWUpdateThreadBumpTimestamp").getBumpTimestampMs(a),creationSource:"outgoing_message",folderId:(a=b.folder)!=null?a:d("MAWFolderTypes").INBOX,jid:b.jid,threadKeys:{authoritative:b.authoritativeThreadKey,optimistic:b.optimisticThreadKey}}})})}g.markMsgSent=b}),98);
__d("MpsTypes",["$InternalEnum","WAStanzaUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a}function c(a){return a}function e(a){return a}function f(a){return a}function h(a){return d("WAStanzaUtils").toStanzaId(a)}function i(a){return a}function j(a){return a}function k(a){return a}function l(a){return a}b=b("$InternalEnum")({Unknown:0,Noop:1,UpsertTopLevel:2,UpsertSupplemental:3,DeleteTopLevel:4,DeleteTopLevelWithPlaceholder:5,Preprocess:6,DeleteSupplemental:7,DeleteThread:8});g.toBytes=a;g.toTimestamp=c;g.toMessageId=e;g.fromMessageId=f;g.messageIdToStanzaId=h;g.toThreadId=i;g.fromThreadId=j;g.toSupplementalKey=k;g.fromSupplementalKey=l;g.ActionType=b}),98);
__d("WAQPLProxy",["WALogger","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAQPLProxy: Proxy implementation is not provided for ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["WAQPLProxy: Proxy implementation is not provided for ",""]);i=function(){return a};return a}function a(a,b,e,f,g){g===void 0&&(g=!0);if(j==null){d("WALogger").ERROR(i(),a);throw c("err")("WAQPLProxy: Proxy implementation is not provided")}return j.start(a,b,e,f,g)}function b(a,b){if(j==null){d("WALogger").ERROR(h(),a);throw c("err")("WAQPLProxy: Proxy implementation is not provided")}return j.resume(a,b)}var j=null;function e(a){j=a}g.waQPLProxyStart=a;g.waQPLProxyStartResume=b;g.provideProxyImplementationForWAQPLProxy=e}),98);
__d("WormMemoryDriver",["Promise","WAResolvable","WormStoreFunctions","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=0;function j(){i+=1;return i}function a(){i=0}e=function(){function a(a){this.$1={};this.$2={};this.$3=(h||(h=b("Promise"))).resolve();this.$1=a;for(a of Object.keys(a))this.$2[a]=new Map()}var c=a.prototype;c.runInTransaction=function(a,c,e,f){var g=this,h=new(d("WAResolvable").Resolvable)();this.$3=this.$3.then(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b={};for(var d of Object.keys(g.$1))b[d]=new Map(g.$2[d]);d=a.reduce(function(a,c){return babelHelpers["extends"]({},a,(a={},a[c]=new k(c,b[c],g.$1[c]),a))},{});d={abort:function(){},commit:function(){return h.promise.then(function(){})},stores:d};d=(yield e(d));c==="readwrite"&&(g.$2=b);h.resolve(d)}))["catch"](function(a){h.reject(a)});return h.promise};c.close=function(){};c.init=function(a){return(h||(h=b("Promise"))).resolve()};return a}();var k=function(){function a(a,b,c){this.$1=b,this.$2=a,this.$3=c}var e=a.prototype;e.bulkAdd=function(a){var d=this;for(var e of a){this.$3.autoIncrement===!0&&e[this.$3.primaryKey]===void 0&&(e[this.$3.primaryKey]=j());if(this.$1.has(e[this.$3.primaryKey]))throw c("err")("Item with key already exists");this.$4(e);this.$1.set(e[this.$3.primaryKey],e)}return(h||(h=b("Promise"))).resolve(a.map(function(a){return a[d.$3.primaryKey]}))};e.bulkPut=function(a){for(a of a)this.$4(a),this.$1.set(a[this.$3.primaryKey],a);return(h||(h=b("Promise"))).resolve()};e.$4=function(a){var b=this,d=this.$3.indexes;if(d==null)return;for(d of Object.values(d)){if(typeof d!=="object"||d==null)continue;var e=d.fields,f=d.unique;if(f===!1)continue;if(!Array.isArray(e))return;var g=e.map(function(b){return a[b]}).join(":");f=function(d){if(d[b.$3.primaryKey]===a[b.$3.primaryKey])return"continue";var f=e.map(function(a){return d[a]}).join(":");if(g===f)throw c("err")("ConstraintError")};for(var h of this.$1.values()){var i=f(h);if(i==="continue")continue}}};e.bulkGet=function(a){var c=this;return(h||(h=b("Promise"))).resolve(a.map(function(a){return c.$1.get(a)}))};e.get=function(a){return(h||(h=b("Promise"))).resolve(this.$1.get(a))};e.getByIndex=function(a,b,c){return d("WormStoreFunctions").getByIndex(this,a,b,c)};e.readByKeyRange=function(a,c){var d;d=l(Array.from(this.$1.values()),(d=a.lessThan)!=null?d:a.lessThanOrEqual,a.lessThanOrEqual!=null,(d=a.greaterThan)!=null?d:a.greaterThanOrEqual,a.greaterThanOrEqual!=null,this.$3.primaryKey);return(h||(h=b("Promise"))).resolve(this.$5(d,c))};e.bulkDelete=function(a){for(a of a)this.$1["delete"](a);return(h||(h=b("Promise"))).resolve()};e["delete"]=function(a){this.$1["delete"](a);return(h||(h=b("Promise"))).resolve()};e.bulkUpsert=function(a,b){return d("WormStoreFunctions").bulkUpsert(this,this.$3,a,b)};e.readIndexRange=function(a,d,e){var f=this.$3.indexes;if(f==null)throw c("err")("No indexes found");f=f[a];if(f==null)throw c("err")("Index not found");var g=Array.from(this.$1.values());if(d!=null){var i;g=m(g,(i=(i=d.lessThan)!=null?i:d.lessThanOrEqual)!=null?i:d.only,d.lessThanOrEqual!=null||d.only!=null,(i=(i=d.greaterThan)!=null?i:d.greaterThanOrEqual)!=null?i:d.only,d.greaterThanOrEqual!=null||d.only!=null,f)}return(h||(h=b("Promise"))).resolve(this.$5(g,e,a))};e.readKeysByIndexRange=function(a,b,c){var d=this;return this.readIndexRange(a,b,c).then(function(a){return a.map(function(a){return a[d.$3.primaryKey]})})};e.getIndexRangeIterator=function(a,b,c,e){return d("WormStoreFunctions").getIndexRangeIterator(this,this.$3,a,b,c,e)};e.$5=function(a,b,c){a=a;(b==null?void 0:b.filter)!=null&&(a=a.filter(b.filter));(b==null?void 0:b.order)!=null&&c!=null&&(a=a.sort(function(a,d){a=a[c];d=d[c];if(a===d)return 0;if(b.order==="desc")return d>a?1:-1;else return a>d?1:-1}));(b==null?void 0:b.limit)!=null&&(a=a.slice(0,b.limit));return a};e.readIndex=function(a,d,e){var f=this.$3.indexes;if(f==null)throw c("err")("No indexes found");var g=f[a];if(g==null)throw c("err")("Index not found");f=Array.from(this.$1.values());d!=null&&(f=f.filter(function(a){for(var b=0;b<g.fields.length;b++)if(a[g.fields[b]]!==d[b])return!1;return!0}));return(h||(h=b("Promise"))).resolve(this.$5(f,e,a))};e.readIndexKeys=function(a,b,c){var d=this;return this.readIndex(a,b,c).then(function(a){return a.map(function(a){return a[d.$3.primaryKey]})})};e.readAll=function(a){var c=this,d=Array.from(this.$1.values());(a==null?void 0:a.filter)!=null&&(d=d.filter(a.filter));(a==null?void 0:a.order)!=null&&(d=d.sort(function(b,d){b=b[c.$3.primaryKey];d=d[c.$3.primaryKey];if(b===d)return 0;if(a.order==="desc")return d>b?1:-1;else return b>d?1:-1}));(a==null?void 0:a.limit)!=null&&(d=d.slice(0,a.limit));return(h||(h=b("Promise"))).resolve(d)};e.readKeys=function(a){var b=this;return this.readAll(a).then(function(a){return a.map(function(a){return a[b.$3.primaryKey]})})};e.clear=function(){this.$1.clear();return(h||(h=b("Promise"))).resolve()};e.count=function(){return(h||(h=b("Promise"))).resolve(this.$1.size)};return a}();function l(a,b,c,d,e,f){return a.filter(function(a){if(d!=null&&d>a[f])return!1;if(b!=null&&b<a[f])return!1;if(b!=null&&c===!1&&a[f]===b)return!1;return d!=null&&e===!1&&a[f]===d?!1:!0})}function m(a,b,c,d,e,f){return a.filter(function(a){for(var g=0;g<f.fields.length;g++){if(d!=null&&d[g]>a[f.fields[g]])return!1;if(b!=null&&b[g]<a[f.fields[g]])return!1;if(g===f.fields.length-1){if(b!=null&&c===!1&&a[f.fields[g]]===b[g])return!1;if(d!=null&&e===!1&&a[f.fields[g]]===d[g])return!1}}return!0})}g.TEST_ONLY_resetPK=a;g.WormMemoryDriver=e;g.WormMemoryStore=k}),98);
__d("WebReverbSchema",["WAHex","Worm","WormEAR","WormIDbDriver","WormMemoryDriver"],(function(a,b,c,d,e,f,g){"use strict";c={autoIncrement:!0,indexes:{"[threadId+messageId]":{fields:["threadId","messageId"],unique:!0},"[threadId+timestampMs+messageId]":{fields:["threadId","timestampMs","messageId"],unique:!1},expiryTimestampMs:{fields:["expiryTimestampMs"],unique:!1},timestampMs:{fields:["timestampMs"],unique:!1}},nonEncryptedFields:new Set(["timestampMs","expiryTimestampMs","messageId"]),primaryKey:"pk",secure:!0};e={autoIncrement:!0,indexes:{"[threadId+topLevelMessageId]":{fields:["threadId","topLevelMessageId"],unique:!1},"[threadId+topLevelMessageId+supplementalKey]":{fields:["threadId","topLevelMessageId","supplementalKey"],unique:!0}},nonEncryptedFields:new Set(["topLevelMessageId","supplementalKey"]),primaryKey:"pk",secure:!0};f={autoIncrement:!0,indexes:{"[threadId+deletedMessageId]":{fields:["threadId","deletedMessageId"],unique:!0},"[threadId+topLevelMessageId+supplementalKey]":{fields:["threadId","topLevelMessageId","supplementalKey"],unique:!1},deletionTimestampMs:{fields:["deletionTimestampMs"],unique:!1}},nonEncryptedFields:new Set(["topLevelMessageId","supplementalKey","deletionTimestampMs"]),primaryKey:"pk",secure:!0};var h={autoIncrement:!0,indexes:{"[threadId+messageId+tag]":{fields:["threadId","messageId","tag"],unique:!0},"[threadId+tag+timestampMs]":{fields:["threadId","tag","timestampMs"],unique:!1}},nonEncryptedFields:new Set(["messageId","timestampMs","messagePk","tag"]),primaryKey:"pk",secure:!0},i={deleted:f,message:c,supplemental:e,tags:h};function a(a,b,c,e){b=d("WAHex").parseHex(b);b=new(d("WormEAR").WormEAR)(i,b);return new(d("Worm").WormDatabase)(new(d("WormIDbDriver").WormIDbDriver)(a,i,b,{blockingErrorThreshold:c,onBlockingError:e}))}function b(){return new(d("Worm").WormDatabase)(new(d("WormMemoryDriver").WormMemoryDriver)(i))}g.makeWebReverbSchema=a;g.makeInMemoryReverbSchema_TEST_ONLY=b}),98);
__d("WebReverbDB",["FBLogger","WAResolvable","WebReverbSchema","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new(d("WAResolvable").Resolvable)();function a(a,b,c,d){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){try{a=d("WebReverbSchema").makeWebReverbSchema(a,b,e,f);h=a;yield a.init();i.resolve(a);return a}catch(a){c("FBLogger")("mps").catching(a).mustfix("Error performing WebReverb init: %s",a);throw a}});return j.apply(this,arguments)}function e(){if(h==null)throw c("err")("Reverb DB is not initialized");return h}function f(){return i.promise}function k(a){return"WebReverb - "+a}g.makeWebReverb=a;g.getWebReverbDB=e;g.getDbPromise=f;g.mpsOp=k}),98);
__d("WebMpsReverbWrites",["WebReverbDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,d,e,f){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f,g,h){var i=[g,f,e];yield d("WebReverbDB").getWebReverbDB().runInTransaction(["message","supplemental","deleted"],"readwrite",function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var d=(yield b.stores.supplemental.getByIndex("[threadId+topLevelMessageId+supplementalKey]",i));if(((d=d==null?void 0:d.timestampMs)!=null?d:0)>=h)return;d={messageId:a,payload:c,supplementalKey:e,threadId:g,timestampMs:h,topLevelMessageId:f};yield b.stores.supplemental.bulkUpsert("[threadId+topLevelMessageId+supplementalKey]",[{item:d,selector:i}])});return function(a){return d.apply(this,arguments)}}(),"mps-upsert-supplemental")});return h.apply(this,arguments)}function c(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=a.messageId,f=a.threadId;yield d("WebReverbDB").getWebReverbDB().runInTransaction(["message","deleted","tags"],"readwrite",function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var d,g=(yield b.stores.message.getByIndex("[threadId+messageId]",[f,e]));if(g!=null&&!g.isTransportErrorPlaceholder)return;var h=(yield b.stores.deleted.getByIndex("[threadId+deletedMessageId]",[a.threadId,a.messageId])),i=babelHelpers["extends"]({},a,{expiryTimestampMs:c.expiryTimestampMs,isLocalOnlyMessage:c.isLocalOnly,isTransportErrorPlaceholder:c.isTransportErrorPlaceholder,timestampMs:(d=g==null?void 0:g.timestampMs)!=null?d:a.timestampMs});if(!h){d=(yield b.stores.message.bulkUpsert("[threadId+messageId]",[{item:i,selector:[f,e]}]));var j=d[0];d=(yield b.stores.tags.readIndexRange("[threadId+messageId+tag]",{only:[f,e]}));d.length>0&&(yield b.stores.tags.bulkDelete(d.map(function(a){return a.pk})));c.tags.length>0&&(yield b.stores.tags.bulkAdd(c.tags.map(function(a){return{messageId:i.messageId,messagePk:j,tag:a,threadId:i.threadId,timestampMs:i.timestampMs}})))}else h.payload=i.payload,yield b.stores.deleted.bulkPut([h]),g!=null&&(g.timestampMs=a.timestampMs,yield b.stores.message.bulkPut([g]))});return function(a){return d.apply(this,arguments)}}(),"mps-upsert-top-level")});return i.apply(this,arguments)}g.upsertSupplementalToReverb=a;g.upsertTopLevelToReverb=c}),98);
__d("WebMpsInsertionFlow",["MpsTypes","Promise","WebMpsReverbWrites","WebReverbDB","asyncToGeneratorRuntime","err","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=new Map(),c=function*(a){yield j(a)["catch"](function(c){b.set(a.message.messageId,c)})};for(a of a)yield* c(a);return b});return i.apply(this,arguments)}function j(a){var e=c("nullthrows")(a.directive);switch(e.actionType){case d("MpsTypes").ActionType.UpsertTopLevel:return k(a);case d("MpsTypes").ActionType.UpsertSupplemental:return m(a);case d("MpsTypes").ActionType.DeleteTopLevel:return q(a);case d("MpsTypes").ActionType.DeleteTopLevelWithPlaceholder:return r(a);case d("MpsTypes").ActionType.DeleteSupplemental:return s(a);case d("MpsTypes").ActionType.DeleteThread:return u(a);case d("MpsTypes").ActionType.Noop:return(h||(h=b("Promise"))).resolve();case d("MpsTypes").ActionType.Unknown:case d("MpsTypes").ActionType.Preprocess:return(h||(h=b("Promise"))).reject(c("err")("this should not happen"))}}function k(a){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.message;a=c("nullthrows")(a.directive);yield d("WebMpsReverbWrites").upsertTopLevelToReverb(b,a)});return l.apply(this,arguments)}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.message;a=c("nullthrows")(a.directive);var e=c("nullthrows")(a.supplementalKey);yield d("WebMpsReverbWrites").upsertSupplementalToReverb(b.messageId,b.payload,e,a.targetMessageId,b.threadId,b.timestampMs)});return n.apply(this,arguments)}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=a.message;a=c("nullthrows")(a.directive);var g=a.targetMessageId,h=[f.threadId,g];yield d("WebReverbDB").getWebReverbDB().runInTransaction(["message","deleted"],"readwrite",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield a.stores.message.getByIndex("[threadId+messageId]",h)),c=(yield a.stores.deleted.getByIndex("[threadId+deletedMessageId]",h));if(((c=c==null?void 0:c.deletionTimestampMs)!=null?c:0)>=f.timestampMs)return;c={deletedMessageId:g,deletionMessageId:f.messageId,deletionMessagePayload:f.payload,deletionTimestampMs:f.timestampMs,isLocalOnlyMessage:!1,payload:b==null?void 0:b.payload,threadId:f.threadId,timestampMs:b==null?void 0:b.timestampMs};yield a.stores.deleted.bulkUpsert("[threadId+deletedMessageId]",[{item:c,selector:h}]);if(e){c={isLocalOnlyMessage:!1,isTransportErrorPlaceholder:!1,messageId:g,payload:f.payload,senderId:f.senderId,threadId:f.threadId,timestampMs:-1};b&&(c.timestampMs=b.timestampMs);yield a.stores.message.bulkUpsert("[threadId+messageId]",[{item:c,selector:h}])}else b&&(yield a.stores.message.bulkDelete([b.pk]))});return function(b){return a.apply(this,arguments)}}(),"mps-delete-generic")});return p.apply(this,arguments)}function q(a){return o(a,!0)}function r(a){return o(a,!0)}function s(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.message,f=c("nullthrows")(a.directive),g=c("nullthrows")(f.supplementalKey),h=f.targetMessageId,i=[e.threadId,h,g];yield d("WebReverbDB").getWebReverbDB().runInTransaction(["supplemental","deleted"],"readwrite",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield a.stores.supplemental.getByIndex("[threadId+topLevelMessageId+supplementalKey]",i));if(b==null)return;var c=(yield a.stores.deleted.getByIndex("[threadId+topLevelMessageId+supplementalKey]",i,{filter:function(a){return a.deletionTimestampMs>=e.timestampMs}}));if(c)return;c={deletedMessageId:b.messageId,deletionMessageId:e.messageId,deletionMessagePayload:e.payload,deletionTimestampMs:e.timestampMs,isLocalOnlyMessage:f.isLocalOnly,payload:b.payload,supplementalKey:g,threadId:e.threadId,timestampMs:b.timestampMs,topLevelMessageId:h};yield a.stores.deleted.bulkUpsert("[threadId+topLevelMessageId+supplementalKey]",[{item:c,selector:i}]);yield a.stores.supplemental.bulkDelete([b.pk])});return function(b){return a.apply(this,arguments)}}(),"mps-delete-supplemental")});return t.apply(this,arguments)}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.message;yield d("WebReverbDB").getWebReverbDB().runInTransaction(["message","deleted","supplemental","tags"],"readwrite",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield a.stores.supplemental.readKeysByIndexRange("[threadId+topLevelMessageId]",{only:[c.threadId]}));yield a.stores.supplemental.bulkDelete(b);b=(yield a.stores.message.readIndexRange("[threadId+messageId]",{only:[c.threadId]}));yield a.stores.message.bulkDelete(b.map(function(a){return a.pk}));var d=(yield a.stores.tags.readKeysByIndexRange("[threadId+messageId+tag]",{only:[c.threadId]}));yield a.stores.tags.bulkDelete(d);d=(yield a.stores.deleted.readKeysByIndexRange("[threadId+deletedMessageId]",{only:[c.threadId]}));yield a.stores.message.bulkDelete(d);yield a.stores.deleted.bulkAdd(b.map(function(a){return{deletedMessageId:a.messageId,deletionMessageId:c.messageId,deletionMessagePayload:c.payload,deletionTimestampMs:c.timestampMs,isLocalOnlyMessage:a.isLocalOnlyMessage,payload:a.payload,threadId:a.threadId,timestampMs:a.timestampMs}}))});return function(b){return a.apply(this,arguments)}}(),"mps-delete-thread")});return v.apply(this,arguments)}g.persistNewMessages=a}),98);
__d("WebMpsLoadMessage",["FBLogger","MpsTypes","Promise","WAJids","WAResultOrError","WebMpsReverbWrites","WebReverbDB","asyncToGeneratorRuntime","err","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){f===void 0&&(f=!0);try{var g=d("WebReverbDB").getWebReverbDB();g=(yield g.runInTransaction(["message","supplemental"],"readonly",function(c){var d=c.stores.message.readIndex("[threadId+messageId]",[a,e],{limit:1});c=f?c.stores.supplemental.readIndex("[threadId+topLevelMessageId]",[a,e]):[];return(h||(h=b("Promise"))).all([d,c])},"mps-load-message"));var i=g[0];i=i[0];g=g[1];if(i==null)return null;i.expiryTimestampMs;i.isLocalOnlyMessage;i.isTransportErrorPlaceholder;i.pk;i=babelHelpers.objectWithoutPropertiesLoose(i,["expiryTimestampMs","isLocalOnlyMessage","isTransportErrorPlaceholder","pk"]);var j=new Map();g.forEach(function(a){a.pk;var b=a.supplementalKey;a.threadId;a.topLevelMessageId;a=babelHelpers.objectWithoutPropertiesLoose(a,["pk","supplementalKey","threadId","topLevelMessageId"]);j.set(b,a)});return{supplementalProtobufs:j,toplevelProtobuf:i}}catch(a){c("FBLogger")("mps").catching(a).mustfix("Runtime error performing loadMessageFromReverb: %s",a);throw a}});return j.apply(this,arguments)}function k(a,b,c,d){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){try{e=e.messagePointQuery;var g=d("MpsTypes").fromThreadId(a),h=d("WAJids").validateChatJid(g);h=c("nullthrows")(h,"invalid threadId passed to validateThreadId: "+g);g=(yield e({chatJid:h,messageId:d("MpsTypes").fromMessageId(b)}));if(g.success&&g.value.messages!=null){e=f(g.value.messages,a);h=e[0];return h}return null}catch(a){c("FBLogger")("mps").catching(a).mustfix("Runtime error performing loadMessageFromEB: %s",a);throw a}});return l.apply(this,arguments)}function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){try{var f=[];f.push(d("WebMpsReverbWrites").upsertTopLevelToReverb(a.toplevelProtobuf,{actionType:d("MpsTypes").ActionType.UpsertTopLevel,isLocalOnly:!1,isTransportErrorPlaceholder:!1,tags:[],targetMessageId:a.toplevelProtobuf.messageId}));a.supplementalProtobufs.forEach(function(b,c){f.push(d("WebMpsReverbWrites").upsertSupplementalToReverb(b.messageId,b.payload,c,a.toplevelProtobuf.messageId,e,b.timestampMs))});yield (h||(h=b("Promise"))).all(f)}catch(a){c("FBLogger")("mps").catching(a).mustfix("Runtime error performing persistMessageFromEB: %s",a);throw a}});return n.apply(this,arguments)}function a(a,b,c,d){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){var j=f.decodeAndParseEbProtobufs;f=f.eb;var l=g.shouldFetchEB;g=g.shouldFetchSupplementals;try{var n=f.isEbEnabled;n=n();g=i(a,e,g);l=n&&l?k(a,e,f,j):null;e=(yield (h||(h=b("Promise"))).allSettled([g,l]));f=e[0];j=e[1];if(n){if(f.status==="fulfilled"&&j.status==="fulfilled"){if(f.value!=null&&j.value!=null){g=f.value.toplevelProtobuf.timestampMs;l=j.value.toplevelProtobuf.timestampMs;if(l>g){void m(j.value,a);return d("WAResultOrError").makeResult(j.value)}return d("WAResultOrError").makeResult(f.value)}if(f.value!=null&&j.value==null)return d("WAResultOrError").makeResult(f.value);else if(f.value==null&&j.value!=null){void m(j.value,a);return d("WAResultOrError").makeResult(j.value)}else return d("WAResultOrError").makeResult()}if(j.status==="fulfilled"&&f.status==="rejected"){j.value!=null&&void m(j.value,a);return d("WAResultOrError").makeResult(j.value)}return f.status==="fulfilled"&&j.status==="rejected"?d("WAResultOrError").makeResult(f.value):d("WAResultOrError").makeError("data-fetching-error",c("err")("Error fetching from reverb: %s and EB: %s",f.reason,j.reason))}else return f.status==="fulfilled"?d("WAResultOrError").makeResult(f.value):d("WAResultOrError").makeError("data-fetching-error",f.reason)}catch(a){c("FBLogger")("mps").catching(a).mustfix("Runtime error performing loadMessage: %s",a);return d("WAResultOrError").makeError("runtime-error",a)}});return o.apply(this,arguments)}g.loadMessage=a}),98);
__d("WebMpsLoadMessages",["FBLogger","MpsTypes","Promise","WAJids","WAResultOrError","WebReverbDB","asyncToGeneratorRuntime","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,e,f,g){var i=e[0],j=e[1];try{e=d("WebReverbDB").getWebReverbDB();return e.runInTransaction(["message","supplemental"],"readonly",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(c){var d=c.stores.message.getIndexRangeIterator("[threadId+timestampMs+messageId]",f,{greaterThanOrEqual:[a],lessThanOrEqual:[a]}),e=j==null?[a,i]:[a,i,j];d=(yield d.read(e,g));e=d.cursorInfo;d=d.data;d=(yield (h||(h=b("Promise"))).all(d.map(function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b.expiryTimestampMs;b.isLocalOnlyMessage;b.isTransportErrorPlaceholder;b.pk;var d=babelHelpers.objectWithoutPropertiesLoose(b,["expiryTimestampMs","isLocalOnlyMessage","isTransportErrorPlaceholder","pk"]);b=(yield c.stores.supplemental.readIndex("[threadId+topLevelMessageId]",[a,b.messageId]));var e=new Map();b.forEach(function(a){a.pk;var b=a.supplementalKey;a.threadId;a.topLevelMessageId;a=babelHelpers.objectWithoutPropertiesLoose(a,["pk","supplementalKey","threadId","topLevelMessageId"]);e.set(b,a)});return{supplementalProtobufs:e,toplevelProtobuf:d}});return function(a){return d.apply(this,arguments)}}())));return{cursorInfo:{endCursor:e.endCursor!=null?[e.endCursor[1],e.endCursor[2]]:null,hasNext:e.hasNext,hasPrevious:e.hasPrevious,startCursor:e.startCursor!=null?[e.startCursor[1],e.startCursor[2]]:null},messages:d}});return function(a){return c.apply(this,arguments)}}(),"mps-load-messages")}catch(a){c("FBLogger")("mps").catching(a).mustfix("Runtime error performing loadMessagesFromReverb: %s",a);throw a}}function j(a,b,c,d,e,f){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h){try{f=g.messageRangeQuery;g=d("MpsTypes").fromThreadId(a);var i=d("WAJids").validateChatJid(g);i=c("nullthrows")(i,"invalid threadId passed to validateThreadId: "+g);g=(yield f({after:[""+b[0],void 0],chatJid:i,direction:e==="asc"?"after":"before"}));if(g.success){f=g.value;b=f.cursorInfo;i=b.endCursor;e=b.hasNext;g=b.hasPrevious;b=b.startCursor;f=f.messages;h=f!=null?h(f,a):[];return{cursorInfo:{endCursor:i!=null?[Number(i[0]),d("MpsTypes").toMessageId(i[1])]:void 0,hasNext:e,hasPrevious:g,startCursor:b!=null?[Number(b[0]),d("MpsTypes").toMessageId(b[1])]:void 0},messages:h}}return null}catch(a){c("FBLogger")("mps").catching(a).mustfix("Runtime error performing loadMessageFromEB: %s",a);throw a}});return k.apply(this,arguments)}function a(a,b,c,d,e){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,k){var l=k.decodeAndParseEbProtobufs;k=k.eb;try{var m=k.isEbEnabled;m=m();var n=i(a,e,f,g);m=m?j(a,e,f,g,k,l):null;a=(yield (h||(h=b("Promise"))).allSettled([n,m]));e=a[0];a[1];return e.status==="fulfilled"?d("WAResultOrError").makeResult(e.value):d("WAResultOrError").makeError("data-fetching-error")}catch(a){c("FBLogger")("mps").catching(a).mustfix("Runtime error performing loadMessages: %s",a);return d("WAResultOrError").makeError("runtime-error",a)}});return l.apply(this,arguments)}g.loadMessages=a}),98);
__d("WebMpsPostprocess",["FBLogger","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a,d=new Map();a=function*(a){var b=(yield a(c));b.size>0&&(b.forEach(function(a,b){d.set(b,a)}),c=c.filter(function(a){return!b.has(a.message.messageId)}))};for(b of b)yield* a(b);return{errors:d,msgs:c}});return i.apply(this,arguments)}function d(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,d){yield (h||(h=b("Promise"))).all(d.map(function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=(yield b(a)["catch"](function(a){c("FBLogger")("mps").catching(a).mustfix("[PostProcessor] Runtime failure: %s",a)}));b!=null&&b.size>0&&b.forEach(function(a){c("FBLogger")("mps").catching(a).mustfix("PostProcessor fails")})});return function(a){return d.apply(this,arguments)}}()))});return j.apply(this,arguments)}g.runCriticalPostprocessor=a;g.runNonCriticalPostprocessor=d}),98);
__d("WebMpsPreprocess",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a,b){return g.apply(this,arguments)}function g(){g=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=a;var c=new Map();for(b of b){var d=b.process!=null?b.process(a):yield b.processAsync(a);a=d.payload;d.errors.forEach(function(a,b){c.set(b,a)})}return{errors:c,msgs:a}});return g.apply(this,arguments)}f.preprocess=a}),66);
__d("WebMpsPurgeDeletions",["DateConsts","Promise","QPLUserFlow","WebReverbDB","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=30*d("DateConsts").MS_PER_DAY;function a(){var a=c("qpl")._(521474688,"2714"),e={instanceKey:Date.now()};c("QPLUserFlow").start(a,e);try{return d("WebReverbDB").getWebReverbDB().runInTransaction(["deleted","supplemental","tags","message"],"readwrite",function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(d){var f=Date.now()-i;f=(yield d.stores.deleted.readIndexRange("deletionTimestampMs",{lessThanOrEqual:[f]}));var g=f.map(function(a){return[a.threadId,a.deletedMessageId]});c("QPLUserFlow").addAnnotations(a,{"int":{num_deletions:f.length}},e);var j=(h||(h=b("Promise"))).all(g.map(function(a){return d.stores.supplemental.readIndexKeys("[threadId+topLevelMessageId]",a)})).then(function(a){return a.flat()}).then(function(a){return d.stores.supplemental.bulkDelete(a)});g=h.all(g.map(function(a){return d.stores.tags.readKeysByIndexRange("[threadId+messageId+tag]",{only:a})})).then(function(a){return a.flat()}).then(function(a){return d.stores.tags.bulkDelete(a)});f=d.stores.deleted.bulkDelete(f.map(function(a){return a.pk}));yield h.all([j,g,f]);c("QPLUserFlow").endSuccess(a,e)});return function(a){return d.apply(this,arguments)}}(),"web-mps-purge-deletions")}catch(b){c("QPLUserFlow").endFailure(a,b,e);throw b}}g.purgeDeletions=a}),98);
__d("WebMpsPurgeExpiredMessages",["Promise","QPLUserFlow","WebReverbDB","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){var a=c("qpl")._(521484777,"2715"),e={instanceKey:Date.now()};c("QPLUserFlow").start(a,e);try{return d("WebReverbDB").getWebReverbDB().runInTransaction(["message","deleted"],"readwrite",function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(d){var f=Date.now(),g=(yield d.stores.message.readIndexRange("expiryTimestampMs",{lessThanOrEqual:[f]}));c("QPLUserFlow").addAnnotations(a,{"int":{num_expired_messages:g.length}},e);var i=(yield (h||(h=b("Promise"))).all(g.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.messageId;if(b!=null){a=(yield d.stores.deleted.getByIndex("[threadId+deletedMessageId]",[a.threadId,b]));return a==null?void 0:a.pk}return null});return function(b){return a.apply(this,arguments)}}())).then(function(a){return a.filter(Boolean)}));yield d.stores.deleted.bulkDelete(i);i=g.map(function(a){return{deletedMessageId:a.messageId,deletionMessageId:a.messageId,deletionMessagePayload:a.payload,deletionTimestampMs:f,isLocalOnlyMessage:!0,payload:a.payload,threadId:a.threadId,timestampMs:a.timestampMs}});yield d.stores.deleted.bulkAdd(i);yield d.stores.message.bulkDelete(g.map(function(a){return a.pk}));c("QPLUserFlow").endSuccess(a,e)});return function(a){return d.apply(this,arguments)}}(),"web-mps-purge-deletions")}catch(b){c("QPLUserFlow").endFailure(a,b,e);throw b}}g.purgeExpiredMessages=a}),98);
__d("WebMpsScheduler",["WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){h==null&&(h=d("WorkerScheduler").makeScheduler("MPS",{concurrency:5,maxConcurrency:5,maxThrottleMs:500,timeToStuckMs:2e4}));return h}g.mpsScheduler=a}),98);
__d("mergeMaps",[],(function(a,b,c,d,e,f){"use strict";function a(){var a=new Map();for(var b=arguments.length,c=new Array(b),d=0;d<b;d++)c[d]=arguments[d];for(var e=0;e<c.length;e++){var f=c[e].keys(),g;while(!(g=f.next()).done)a.set(g.value,c[e].get(g.value))}return a}f["default"]=a}),66);
__d("schedulePeriodicTask",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function a(a,c){var d=function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield a()}finally{globalThis.setTimeout(d,c)}});return function(){return e.apply(this,arguments)}}();globalThis.setTimeout(d,0)}f.schedulePeriodicTask=a}),66);
__d("WebMps",["DateConsts","FBLogger","MpsTypes","WebMpsInsertionFlow","WebMpsLoadMessage","WebMpsLoadMessages","WebMpsPostprocess","WebMpsPreprocess","WebMpsPurgeDeletions","WebMpsPurgeExpiredMessages","WebMpsScheduler","WebReverbDB","WorkerScheduler","asyncToGeneratorRuntime","err","justknobx","mergeMaps","schedulePeriodicTask"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.db,e=a.dependencies;a=a.extensionConfiguration;if(h!=null)throw c("err")("MPS already initialised");yield d("WebReverbDB").makeWebReverb(b.name,b.strEncKey,b.blockingErrorThreshold,b.onBlockingError);b=new j(a,e);h=b;return b});return i.apply(this,arguments)}var j=function(){function a(a,b){this.extensionConfiguration=a,this.$1=b,this.$2()}var e=a.prototype;e.saveNewMessages=function(a){var e=this;return d("WebMpsScheduler").mpsScheduler().runTask({customFlags:{runtimeReliability:!0},fn:function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=(yield d("WebMpsPreprocess").preprocess(a,e.extensionConfiguration.preprocessors)),f=b.errors;b=b.msgs;f.size>0&&f.forEach(function(a,b){c("FBLogger")("mps").catching(a).mustfix("Preprocessor failed for message %s",d("MpsTypes").fromMessageId(b))});var g=(yield d("WebMpsInsertionFlow").persistNewMessages(b));b=(yield e.$3(b));return c("mergeMaps")(f,g,b)});function g(){return f.apply(this,arguments)}return g}(),name:"save-new-messages",priority:d("WorkerScheduler").BLOCKING_PRIORITY})};e.loadMessage=function(a,b,c){var e=this;c===void 0&&(c={shouldFetchEB:!0,shouldFetchSupplementals:!0});return d("WebMpsScheduler").mpsScheduler().runTask({customFlags:{runtimeReliability:!0},fn:function(){return d("WebMpsLoadMessage").loadMessage(a,b,e.$1,c)},name:"load-message",priority:d("WorkerScheduler").BLOCKING_PRIORITY})};e.$3=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=this,e,f;try{a=(yield d("WebMpsPostprocess").runCriticalPostprocessor(a,this.extensionConfiguration.postProcessors.critical));e=a.errors;f=a.msgs}catch(a){c("FBLogger")("mps").catching(a).mustfix("Message postprocessor failed with runtime error %s",a);throw a}d("WebMpsScheduler").mpsScheduler().runTask({fn:function(){return d("WebMpsPostprocess").runNonCriticalPostprocessor(f,b.extensionConfiguration.postProcessors.nonCritical)},name:"non-critical-postprocessors"})["catch"](function(a){c("FBLogger")("mps").catching(a).mustfix("Non-critical postprocessor failed with runtime error %s",a)});return e});function e(b){return a.apply(this,arguments)}return e}();e.loadMessages=function(a,b,e){var f=this,g=c("justknobx")._("3177");return d("WebMpsScheduler").mpsScheduler().runTask({customFlags:{runtimeReliability:!0},fn:function(){return d("WebMpsLoadMessages").loadMessages(a,b,e,g,f.$1)},name:"load-messages",priority:d("WorkerScheduler").BLOCKING_PRIORITY})};e.purgeDeletions=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield d("WebMpsScheduler").mpsScheduler().runTask({fn:d("WebMpsPurgeDeletions").purgeDeletions,name:"purge-deletions",priority:d("WorkerScheduler").BACKGROUND_PRIORITY})}catch(a){c("FBLogger")("mps").catching(a).mustfix("failed running purgeDeletions")}});function e(){return a.apply(this,arguments)}return e}();e.purgeExpiredMessages=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){try{yield d("WebMpsScheduler").mpsScheduler().runTask({fn:d("WebMpsPurgeExpiredMessages").purgeExpiredMessages,name:"purge-expired-messages",priority:d("WorkerScheduler").BACKGROUND_PRIORITY})}catch(a){c("FBLogger")("mps").catching(a).mustfix("failed running purgeExpiredMessages")}});function e(){return a.apply(this,arguments)}return e}();e.$2=function(){var a=this;d("schedulePeriodicTask").schedulePeriodicTask(function(){return a.purgeDeletions()},d("DateConsts").MS_PER_DAY);d("schedulePeriodicTask").schedulePeriodicTask(function(){return a.purgeExpiredMessages()},d("DateConsts").MS_PER_HOUR)};return a}();function e(){if(h==null)throw c("err")("MPS not initialised");return h}function f(){h=void 0}g.makeMps=a;g.mps=e;g.resetMps_TEST_ONLY=f}),98);
__d("MAWSendWrittenMsg",["EBAPI","FBLogger","I64","MAWBridge","MAWDebugMsg","MAWExtractMsFromExternalId","MAWGetEditMsgForSending","MAWGetMsgForSendingApi","MAWGetReactionForSending","MAWJobManager","MAWLoadThreadParticipantsApi","MAWMarkEditMsgDroppedApi","MAWMarkEditMsgSentApi","MAWMarkMsgDroppedApi","MAWMarkMsgSentApi","MAWMessageSendsCommon","MAWMpsGating","MAWODSProxy","MAWSendMsgUtil","MpsTypes","WAAPI","WAArmadilloBackupMessage.pb","WAAsMessageApplication","WAFrankingTypes","WAGlobals","WAJids","WAMsgApplication.pb","WAOdsEnums","WAQPLProxy","WAResultOrError","WebMps","asyncToGeneratorRuntime","encodeProtobuf","err","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to save message to MPS: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg END "," : ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg not sending message: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg(","): drop result: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendWrittenMsg(","): too old, dropping"]);n=function(){return a};return a}a=24*60*60;function o(a,b,c){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){d("MAWMessageSendsCommon").messageSendLogger.LOG(l(),a.protocolMsgId);b.addPoint("get_msg_for_sending_start",{string:{type:a.type}});var f,g,m,n,o=null;if(e==null){if(a.type==="message"||a.type==="revoke")o=(yield d("MAWGetMsgForSendingApi").getMsgForSending(a.protocolMsgId));else if(a.type==="reaction")o=(yield d("MAWGetReactionForSending").getReactionForSending(a.protocolMsgId));else if(a.type==="edit")o=(yield d("MAWGetEditMsgForSending").getEditMsgForSending(a.protocolMsgId,a.referencedOriginalExternalId));else{a.type;throw c("err")("This cannot happen because type has `message` as default argument but flow does not know that")}if(o.type!=="unsent"){d("MAWMessageSendsCommon").messageSendLogger.LOG(k(),o.type);return d("WAResultOrError").makeError({details:o.type,isRetriable:!0,type:"wrong-message-state"})}var p=o,q=p.dbMsg,r=p.isReplyMsg;p=p.isXMAMsg;f=o.messageApplication;m=o.messageType;g=q==null?void 0:q.type;n=o.editOriginalExternalId;q=(q==null?void 0:q.ephemeralSetting)!=null&&((q=(q=q.ephemeralSetting)==null?void 0:q.ephemeralExpirationInSec)!=null?q:0)>0;b.addPoint("get_msg_for_sending_end",{bool:{isEditMsg:n!=null,isEphemeralMsg:q,isReplyMsg:r,isXMAMsg:p},string:{msgType:m.type}});q&&d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_OLD_MESSAGE_SEND,key:"sendEphemeralMsg"},!0)}else f=e.messageApplication,g=e.type,m=d("MAWSendMsgUtil").getMessageTypeFromMsg(g),n=null;r=d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,f).readBuffer();p={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(new Uint8Array(r)),version:"v3"};b.addPoint("wa_send_msg_start");q=a.protocolMsgId;a=(yield c("WAAPI").sendChatMessage({loadThreadParticipants:d("MAWLoadThreadParticipantsApi").loadThreadParticipants,messagePayload:{backupDirective:null,frankingKey:((e=f.metadata)==null?void 0:e.frankingKey)?d("WAFrankingTypes").castToFrankingKey(new Uint8Array((a=f.metadata)==null?void 0:a.frankingKey)):null,frankingVersion:(e=f.metadata)==null?void 0:e.frankingVersion,messageBytes:p,messageType:m,protocolMsgId:q}},b));if(a.success===!1){b.addPoint("wa_send_msg_fail",{string:{errorType:a.error.type,msgType:g}});n!=null?yield d("MAWMarkEditMsgDroppedApi").markEditMsgDropped(q,n):yield d("MAWMarkMsgDroppedApi").markMsgDropped(q,a.error);d("MAWMessageSendsCommon").messageSendLogger.ERROR(j(),a.error.type,(e=a.payload)!=null?e:"");switch(a.error.type){case"non-retryable-error":if(a.error.applicationErrorCode!=null&&a.error.applicationErrorCode===10009)try{d("MAWBridge").getBridge().fireAndForget("event","uiUpdate",{events:[{tag:"RefreshContact",value:(h||(h=d("I64"))).of_string(d("WAJids").threadIdForChatJid(q.chat))}]})}catch(a){c("FBLogger")("labyrinth_web").catching(a).mustfix("Failed to call bridge handler RefreshContact for JID %s and mediaType %s",q.chat,g)}return a;case"missing-receipt":case"wrong-message-state":case"unexpected-message-codepath":case"result-parsing-error":case"retryable-error":case"no-recipients":case"encryption-error":case"too-many-retries":return a;default:a.error.type;throw c("err")("Unreachable code")}}a.success;b.addPoint("wa_send_msg_end");((m=a.value.meta)==null?void 0:m.pOrDhashMismatch)&&(b.addPoint("dhash_phash_mismatch"),c("promiseDone")(d("MAWDebugMsg").writeDebugMsg(q.chat,"Outgoing msg "+q.externalId+" got a phash mismatch")));o!=null&&(b.addPoint("mark_edit_msg_sent_start"),n!=null?yield d("MAWMarkEditMsgSentApi").markEditMsgSent(q,n,a.value.serverTs,a.value.reportingMeta):yield d("MAWMarkMsgSentApi").markMsgSent(q,a.value.serverTs,a.value.reportingMeta),b.addPoint("mark_edit_msg_sent_end"));if(d("MAWMpsGating").isMpsEnabled())try{e=a.value.serverTs*1e3+d("MAWExtractMsFromExternalId").extractMsFromStanzaId(q.externalId);g=d("encodeProtobuf").encodeProtobuf(d("WAArmadilloBackupMessage.pb").BackupMessageSpec,{encryptedTransportMessage:r,metadata:{frankingMetadata:null,messageId:q.externalId,payloadVersion:3,senderId:q.author,timestampMs:e}}).readBuffer();yield d("WebMps").mps().saveNewMessages([{directive:null,message:{messageId:d("MpsTypes").toMessageId(q.externalId),payload:g,senderId:d("WAGlobals").getMyUserJid(),threadId:d("MpsTypes").toThreadId(q.chat),timestampMs:a.value.serverTs*1e3+d("MAWExtractMsFromExternalId").extractMsFromStanzaId(q.externalId)}}])}catch(a){d("MAWMessageSendsCommon").messageSendLogger.ERROR(i(),a)}if(o!=null&&!d("MAWMpsGating").isFullMpsEnabled()){b.addPoint("eb_upload_scheduling_start");m=o;n=m.dbMsg;r=m.isXMAMsg;e=m.media;g=m.xmaPayload;yield c("EBAPI").uploadSentMessage({dbMsg:n,instanceKey:q.externalId,isXMAMsg:r,media:e,messageApplication:f,messageApplicationBytes:p.bytes,protocolMsgId:q,serverTs:a.value.serverTs,xmaPayload:g});b.addPoint("eb_upload_scheduling_end")}return a});return p.apply(this,arguments)}function q(a,b,c,d){b.addAnnotations({bool:{is_secure:!0},string:{description:c,jid:a.protocolMsgId.chat}});return o(a,b,d)}e=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("encryptAndSend",{code:function(a){var b=a.s2sInstanceKey;a=babelHelpers.objectWithoutPropertiesLoose(a,["s2sInstanceKey"]);return q(a,d("WAQPLProxy").waQPLProxyStartResume(c("qpl")._(25313175,"1551"),b),"sendWrittenMsg")},stopRetryIf:{onStopRetry:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.protocolMsgId;d("MAWMessageSendsCommon").messageSendLogger.LOG(n(),a);var b=(yield d("MAWMarkMsgDroppedApi").markMsgDropped(a));d("MAWMessageSendsCommon").messageSendLogger.LOG(m(),a,b);return d("WAResultOrError").makeError({isRetriable:!1,type:"too-many-retries"})});function c(b){return a.apply(this,arguments)}return c}(),timePassedSeconds:a}}).end();g.sendWrittenMsgExternal=q;g.sendWrittenMsg=e}),98);
__d("MAWBuildNewMsgPayload",["MAWAuthor","MAWDbMsg","MAWMsgType","WAArmadilloXMA.pb","WAAssertUnreachable","WAJids","WALogger","WAStanzaUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["msgToQuotedMsg: Unsupported message type ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["BumpExistingMessage does not have quote content when replying"]);i=function(){return a};return a}function a(a,b,e,f){if(d("MAWDbMsg").isUnrenderedMsgType(a))throw c("err")("getNewMsg called for wrong message type "+a);var g,h;if(e.quote!=null&&(f==null?void 0:f.content)!=null){var i;h=f==null?void 0:(i=f.content)==null?void 0:i.externalId;g={content:f==null?void 0:f.content,remoteJid:(i=f==null?void 0:f.remoteJid)!=null?i:void 0}}f=babelHelpers["extends"]({},b,{quote:g,quoteExternalId:h});i=e.mediaGroupMetadata;switch(a){case"Text":return babelHelpers["extends"]({},f,{msgContent:{commands:e.commands,content:e.content!=null?e.content:"",mentionedJids:e.mentionedJids},type:d("MAWMsgType").MSG_TYPE.TEXT});case"Image":return babelHelpers["extends"]({},f,{hdType:e.hdType,type:d("MAWMsgType").MSG_TYPE.IMAGE},i);case"Video":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.VIDEO});case"Ptt":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.PTT});case"Gif":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.GIF});case"Sticker":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.STICKER});case"DocumentFile":return babelHelpers["extends"]({},f,{type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case"XMA":if(e.xmaMessageType==null)throw c("err")("XMA Message Missing xmaMessageType");b=e.content!=null&&e.xmaMessageType===d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.MSG_EXTERNAL_LINK_SHARE?e.content:"";return babelHelpers["extends"]({},f,{msgContent:{commands:e.commands,content:b,mentionedJids:e.mentionedJids},type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:e.xmaMessageType});case"EditAction":throw c("err")("EditAction is not supported yet");case"BumpExistingMessage":throw c("err")("BumpExistingMessage is not supported yet");case"ReceiverFetch":throw c("err")("ReceiverFetch is not supported yet");case"GroupPollCreate":throw c("err")("GroupPollCreate is not supported yet");case"GroupPollUpdate":throw c("err")("GroupPollUpdate is not supported yet");case"Revoked":case"DeleteForMe":case"Ciphertext":case"Futureproof":case"Unavailable":case"Admin":case"ExpiredEphemeral":case"EphemeralSettingAdmin":case"EphemeralScreenshotAction":case"AlertICDC":case"GroupInvite":case"Reaction":case"Raven":case"RavenAction":throw c("err")("Should not be writing ciphertext, futureproof, unsent, admin,\n        ephemeral setting messages, ephemeral screenshot action, group invite messages");default:throw c("WAAssertUnreachable")(a)}}function b(a,b,e,f){if(!d("MAWDbMsg").isUnrenderedMsgType(a))throw c("err")("getNewUnrenderedMsg called for wrong message type "+a);switch(a){case"EphemeralSyncResponse":if(e.ephemeralSetting==null)throw c("err")("Ephemeral Sync Response without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE});case"EphemeralSettingChangeFromCurrentDevice":var g;if(e.ephemeralSetting==null)throw c("err")("Ephemeral Setting Change without ephemeral settings");return babelHelpers["extends"]({},b,{ephemeralSetting:e.ephemeralSetting,isEphemeralSettingReset:(g=e.isEphemeralSettingReset)!=null?g:!1,type:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE});case"GroupInvite":g=d("WAJids").interpretAsGroupJid(b.threadJid);if(g==null)throw c("err")("Group Invite without valid group jid");if(e.invitedParticipantUserJid==null)throw c("err")("Group Invite without invited user jid");return babelHelpers["extends"]({},b,{groupName:e.groupName==null?void 0:e.groupName,invitedParticipantUserJid:e.invitedParticipantUserJid,type:d("MAWMsgType").MSG_TYPE.GROUP_INVITE});case"SenderKeyDistribution":return babelHelpers["extends"]({},b,{type:d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION});case"RavenAction":if(f==null)throw c("err")("Raven Action without Raven Message External Id");if(e.actionType==null)throw c("err")("Raven Action without Action Type");return babelHelpers["extends"]({},b,{actionType:e.actionType,ravenActionToMsgExternalId:d("WAStanzaUtils").toStanzaId(f),type:d("MAWMsgType").MSG_TYPE.RAVEN_ACTION});case"EditAction":throw c("err")("Edit action not implemented yet");default:throw c("WAAssertUnreachable")(a)}}function e(a){var b,e={author:d("MAWAuthor").getAuthorUserJid(a.author)||d("WAJids").AUTHOR_ME,externalId:a.externalId,mediaId:a.mediaId,msgId:a.msgId,plaintextHash:a.plaintextHash,specialTextSize:a.specialTextSize,ts:a.ts,xmaMessageType:a.xmaMessageType};switch(a.type){case d("MAWMsgType").MSG_TYPE.IMAGE:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.IMAGE});case d("MAWMsgType").MSG_TYPE.VIDEO:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.VIDEO});case d("MAWMsgType").MSG_TYPE.PTT:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.PTT});case d("MAWMsgType").MSG_TYPE.TEXT:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.TEXT});case d("MAWMsgType").MSG_TYPE.STICKER:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.STICKER});case d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.DOCUMENT_FILE});case d("MAWMsgType").MSG_TYPE.GIF:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.GIF});case d("MAWMsgType").MSG_TYPE.XMA:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.XMA,xmaMessageType:a.xmaMessageType});case d("MAWMsgType").MSG_TYPE.REVOKED:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.UNAVAILABLE});case d("MAWMsgType").MSG_TYPE.BUMP_EXISTING_MESSAGE:if(((b=a.quote)==null?void 0:b.content)==null){d("WALogger").ERROR(i());return null}return babelHelpers["extends"]({},a.quote.content,{author:d("MAWAuthor").getAuthorUserJid(a.quote.content.author)||d("WAJids").AUTHOR_ME});case d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH:return babelHelpers["extends"]({},e,{msgContent:a.msgContent,type:d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH});case d("MAWMsgType").MSG_TYPE.RAVEN:return babelHelpers["extends"]({},e,{ravenEphemeralMediaState:a.ravenEphemeralMediaState,ravenEphemeralType:a.ravenEphemeralType,ravenMediaType:a.ravenMediaType,type:d("MAWMsgType").MSG_TYPE.RAVEN});default:d("WALogger").ERROR(h(),a.type);throw c("err")("Trying to reply to a message type that does not support replies")}}g.buildNewMsg=a;g.getNewUnrenderedMsg=b;g.msgToQuotedMsg=e}),98);
__d("MAWWriteOutgoingMsgApi",["MAWAckLevel","MAWBuildNewMsgPayload","MAWDbMsg","MAWDbMsgTxns","MAWDbRavenActionTxns","MAWDexieTable","MAWIndexedDb","MAWLoadReplyMediaTxns","MAWMsgType","MAWQplProxy","MAWTransactionMode","MAWVault","MAWWriteMsgTxns","WAJids","WALogger","WATimeUtils","emptyFunction","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeOutgoingMsg: "," is not identical for partial optimistic upsert: "," vs ",""]);h=function(){return a};return a}var i=function(a,b,c,e){b!=null&&d("MAWQplProxy").sendQplPointThroughBridge(c,a,{annotations:e,instanceKey:b})};function j(a,b,c){if(b===c)return;d("WALogger").WARN(h(),a,b,c)}b=d("MAWIndexedDb").makeMsgrTransactor({chunk:(a=d("MAWTransactionMode")).READONLY,ephemeralSettings:a.READWRITE,ftsBackloggedMessages:a.READWRITE,groupInfo:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READONLY,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"writeOutgoingMsg",function(a){return function(b,e,f,g,h,m,n){g.content!=null&&(g.content=d("MAWVault").vault(g.content));i("write_outgoing_msg_start",n,m);return d("MAWDexieTable").dexieAll([a.threads.get({jid:e}),a.messages.where("externalId").equals(b).toArray(),k(a,g.quote,e),d("MAWDbRavenActionTxns").maybeGetRavenMsgQueryByProtocolMsgId(a,g.ravenProtocolMsgId,h)]).then(function(e){var k=e[0],o=e[1],p=e[2];e=e[3];i("write_outgoing_msg_data_fetched",n,m,{bool:{isUnrenderedMsgType:d("MAWDbMsg").isUnrenderedMsgType(h)}});if(k==null)return{type:"missing_thread"};var q=o.find(function(a){return a.threadJid===k.jid&&a.author===d("WAJids").AUTHOR_ME});if(q!=null&&q.ack!==d("MAWAckLevel").ACK.partialOptimistic)return q.ack>=d("MAWAckLevel").ACK.sent?{msgId:q.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:q.externalId},type:"already_sent"}:{msgId:q.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:q.externalId},type:"not_sent"};else{var r=q==null?void 0:q.rowId;q&&(j("ts",q.ts,f),j("threadJid",q.threadJid,k.jid));if(!d("MAWDbMsg").isUnrenderedMsgType(h)){o={ack:d("MAWAckLevel").ACK.clock,altIndex:void 0,author:d("WAJids").AUTHOR_ME,ephemeralSetting:g.ephemeralSetting,externalId:b,isForwarded:g.isForwarded,specialTextSize:g.specialTextSize,threadJid:k.jid,ts:f};var s=d("MAWBuildNewMsgPayload").buildNewMsg(h,o,g,p),t=g.isFirstMsg,u=g.openMessageOtid,v=g.openMessageParticipantCount,w=g.optimisticMsg,x=g.participantCount;o=d("MAWLoadReplyMediaTxns").getReplyMediaForMsgQuote(a,s).then(function(b){return d("MAWWriteMsgTxns").writeMsg(a,s,k,"MAWWriteOutgoingMsgApi",{isCurrentDeviceSendingMsg:!0,isFirstMsg:t,isOutgoing:!0,openMessageOtid:u,openMessageParticipantCount:v,optimisticMsg:w,participantCount:x,quotedReplyAttachmentMeta:b,s2sInstanceKey:n,upsertRowData:r!=null?{msgId:c("nullthrows")(q==null?void 0:q.msgId),rowId:r}:void 0})})}else{p={ack:d("MAWAckLevel").ACK.clock,author:d("WAJids").AUTHOR_ME,externalId:b,threadJid:k.jid,ts:f};p=d("MAWBuildNewMsgPayload").getNewUnrenderedMsg(h,p,g,e==null?void 0:e.externalId);o=d("MAWWriteMsgTxns").writeUnrenderedMsg(a,p,k)}return o.then(function(c){i("write_outgoing_msg_promise_resolved",n,m);return l(a,h,k.jid,f).then(function(){return{msgId:c.msgId,protocolMsgId:{author:d("WAJids").AUTHOR_ME,chat:k.jid,externalId:b},type:"not_sent"}})})}})}});function k(a,b,c){return b==null?d("MAWDexieTable").dexieResolve(null):d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(b){return b==null?null:a.threads.get({jid:b.threadJid}).then(function(a){var e=d("MAWBuildNewMsgPayload").msgToQuotedMsg(b);if(e==null)return null;b.messageExpirationTs!=null&&b.messageExpirationTs<d("WATimeUtils").unixTime()&&(e=babelHelpers["extends"]({},e,{mediaId:void 0,msgContent:void 0,type:d("MAWMsgType").MSG_TYPE.EXPIRED_EPHEMERAL,xmaMessageType:void 0}));if(a==null||a.jid===c)return{content:e,remoteJid:null};a=d("WAJids").interpretAndValidateJid(a.jid);a=a.jidType==="group"?a.groupJid:null;return{content:e,remoteJid:a}})})}function l(a,b,e,f){if(b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE)return d("WAJids").switchOnMsgrChatJidType(e,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){var c;if(b==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo={syncResponseRetries:((c=(c=b.ephemeralSyncResponseBackoffInfo)==null?void 0:c.syncResponseRetries)!=null?c:0)+1,syncResponseSentTs:f};return a.ephemeralSettings.put(b)}).then(c("emptyFunction"))}});return b===d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE?d("WAJids").switchOnMsgrChatJidType(e,{group:function(){return d("MAWDexieTable").dexieResolve()},user:function(b){return a.ephemeralSettings.get({userJid:b}).then(function(b){if(b==null||b.ephemeralSyncResponseBackoffInfo==null)return d("MAWDexieTable").dexieResolve();b.ephemeralSyncResponseBackoffInfo=void 0;return a.ephemeralSettings.put(b).then(c("emptyFunction"))})}}):d("MAWDexieTable").dexieResolve()}g.writeOutgoingMsg=b;g.getQuoteInfo=k}),98);
__d("MAWSendEphemeralSettingMsg",["MAWGetSyncResponseBackoffInfoByJidApi","MAWJobManager","MAWLoggerUtils","MAWMessageSendScheduler","MAWMessageSendsCommon","MAWMsgType","MAWODSProxy","MAWSendWrittenMsg","MAWWriteOutgoingMsgApi","WAAPI","WAJids","WAOdsEnums","WAQPLProxy","WAResultOrError","WATagsLogger","WATimeUtils","WorkerScheduler","asyncToGeneratorRuntime","err","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg cannot send to a non-existent thread"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendMsg already sent message"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["send ephemeral setting message: chatJid ",", type ",", externalId ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["ephemeral sync response backed off"]);k=function(){return a};return a}var l=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.SettingSync]);function m(a,b,c,d,e,f){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,m){if(a.isForSyncResponse){var n=(yield d("WAJids").switchOnMsgrChatJidType(b,{group:function(){throw c("err")("ChatJid is not supposed to be a group")},user:function(a){return d("MAWGetSyncResponseBackoffInfoByJidApi").getSyncResponseBackoffInfoByJid(a)}}));if(o(f,n)){l.LOG(k());return d("WAResultOrError").makeResult({description:"send not needed",messageType:"fixMe"})}}n=a.isForSyncResponse?d("MAWMsgType").MSG_TYPE.EPHEMERAL_SYNC_RESPONSE:d("MAWMsgType").MSG_TYPE.EPHEMERAL_SETTING_CHANGE_FROM_CURRENT_DEVICE;yield c("WAAPI").getDevicesBeforeSend({chatJid:b,reason:"SendEphemeralSettings"});f=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(e,b,f,a,n,g,m));l.LOG(j(),b,n,e);if(f.type==="already_sent"){l.LOG(i());return d("WAResultOrError").makeError({isRetriable:!1,type:"already-sent"})}else if(f.type==="missing_thread"){l.LOG(h());return d("WAResultOrError").makeError({isRetriable:!1,type:"missing-thread"})}b=(yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:f.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(g,m),"MAWSendEphemeralSettingMsg"));if(b.success===!1)return d("WAResultOrError").makeError(b.error);else return d("WAResultOrError").makeResult({chatJid:f.protocolMsgId.chat,content:a.content,ephemeralSetting:a.ephemeralSetting,externalId:f.protocolMsgId.externalId,initiatingSource:a.initiatingSource,messageType:"sendMsg",quote:a.quote,source:a.source,specialTextSize:a.specialTextSize,xmaMessageType:a.xmaMessageType})});return n.apply(this,arguments)}function a(a){var b=a.args,c=a.chatJid,e=a.externalId,f=a.qplEventType,g=a.qplInstanceKey;return d("MAWMessageSendsCommon").messageSendObserver(f,g,function(a){return m(b,c,e,a,f,g)},"ephemeral",{author:d("WAJids").AUTHOR_ME,chat:c,externalId:e})}e=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("sendEphemeralSettingMsg",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){var g=a.args,h=a.chatJid,i=a.externalId;d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.MAW_OLD_MESSAGE_SEND,key:"sendEphemeralSettingMsg"},!0);yield d("MAWMessageSendScheduler").messageSendScheduler().runTask({customFlags:{runtimeReliability:!0},fn:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=g.s2sInstanceKey,b=g.s2sUserFlowQPLEvent,d=babelHelpers.objectWithoutPropertiesLoose(g,["s2sInstanceKey","s2sUserFlowQPLEvent"]);yield m(d,h,i,f.jobStartTime,(d=b)!=null?d:c("qpl")._(25313175,"1551"),a)});function d(){return a.apply(this,arguments)}return d}(),name:"ephemeral",priority:d("WorkerScheduler").BLOCKING_PRIORITY})});return function(b,c,d){return a.apply(this,arguments)}}()).end();function o(a,b){if(b==null)return!1;var c=b.syncResponseRetries;b=b.syncResponseSentTs;switch(c){case 1:return d("WATimeUtils").happenedWithinAt(a,b,3*60);case 2:return d("WATimeUtils").happenedWithinAt(a,b,15*60);default:return!0}}g.sendEphemeralSettingMsgFn=a;g.sendEphemeralSettingMsg=e}),98);
__d("MAWSendSenderKeyDistributionMsg",["MAWDebugMsg","MAWMsgType","MAWSendWrittenMsg","MAWWriteOutgoingMsgApi","Promise","WAQPLProxy","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=new Set();function a(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){if(i.has(a))return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());yield d("MAWDebugMsg").writeDebugMsg(a,"Sending key distribution msg");e=(yield d("MAWWriteOutgoingMsgApi").writeOutgoingMsg(e,a,d("WATimeUtils").unixTime(),{},d("MAWMsgType").MSG_TYPE.SK_DISTRIBUTION,c("qpl")._(25313175,"1551"),f));if(e.type==="already_sent")return d("WAResultOrError").makeError("already_sent");else if(e.type==="missing_thread")return d("WAResultOrError").makeError("missing_thread");yield d("MAWSendWrittenMsg").sendWrittenMsgExternal({protocolMsgId:e.protocolMsgId,type:"message"},d("WAQPLProxy").waQPLProxyStartResume(c("qpl")._(25313175,"1551"),f),"MAWSendSenderKeyDistributionMsg");return d("WAResultOrError").makeResult()});return j.apply(this,arguments)}g.sendSenderKeyDistributionMsg=a}),98);
__d("WAAbPropConverters",[],(function(a,b,c,d,e,f){"use strict";function a(a){if(!a)return{};var b={};Object.keys(a).forEach(function(c){var d=a[c];d!=null&&(b[c]=d)});return b}f.convertAbPropsToPlainObject=a}),66);
__d("WAAbPropsCache",["WAAbPropConverters"],(function(a,b,c,d,e,f,g){"use strict";var h=86400;a=function(){function a(a){var b=a.abKey,c=a.abHash,d=a.lastSyncTime,e=a.expoKeyStr,f=a.refresh,g=a.internalExpoKeys,h=a.propExpoKeys,i=a.propValues;a=a.overridePropValues;this.$1=a!=null?a:{};this.$2=i;this.$4=c;this.$3=b;this.$5=d;this.$7=f;this.$6=e;this.$8=g;this.$9=h}var b=a.prototype;b.getAbProp=function(a){var b;return this.$1[a]!=null?this.$1[a]:(b=this.$2)==null?void 0:b[a]};b.getHash=function(){return this.$4};b.getRefreshSecs=function(){var a;return(a=this.$7)!=null?a:h};b.overrideAbProp=function(a,b){this.$1[a]=b};b.readAll=function(){var a={abKey:this.$3,hash:this.getHash(),refresh:this.getRefreshSecs(),lastSyncTime:this.$5||0};this.$9!=null&&(a.propExpoKeys=this.$9);this.$8!=null&&(a.internalExpoKeys=this.$8);this.$6!=null&&(a.expoKeyStr=this.$6);if(this.$2!=null){var b=this.$2;b!=null&&(a.propValues=d("WAAbPropConverters").convertAbPropsToPlainObject(b),this.$1!=null&&(a.propValues=babelHelpers["extends"]({},a.propValues,d("WAAbPropConverters").convertAbPropsToPlainObject(this.$1))))}return a};b.rewrite=function(a){var b=a.abKey,c=a.abHash,d=a.lastSyncTime,e=a.expoKeyStr,f=a.refresh,g=a.internalExpoKeys,h=a.propExpoKeys;a=a.propValues;this.$2=a;this.$4=c;this.$3=b;this.$5=d;this.$7=f;this.$6=e;this.$8=g;this.$9=h};return a}();g.AbPropsCache=a}),98);
__d("WAAbPropsConverters",["WAAbPropsTypes","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["convertDbAbPropsToParsed: unsure how to read ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["convertAbPropsParsedToDbEntity: unsure how to read ",""]);i=function(){return a};return a}function a(a){var b={expoKeyStr:a.expoKeyStr,internalExpoKeys:a.internalExpoKeys?Array.from(a.internalExpoKeys):[],lastSyncTime:a.lastSyncTime,refresh:a.refresh};a.abHash!=null&&(b.abHash=a.abHash);a.abKey!=null&&(b.abKey=a.abKey);if(a.propExpoKeys){var c=a.propExpoKeys,e=[];Object.keys(c).forEach(function(a){a=Number(a);var b={expoKey:a};c[a]!=null&&(b.value=c[a]);e.push(b)});b.propExpoKeys=e}if(a.propValues){var f=a.propValues,g=[];Object.keys(f).forEach(function(a){var b={name:a,value:{}};switch(typeof f[a]){case"boolean":b.value.boolValue=f[a];break;case"number":b.value.intValue=f[a];break;case"string":b.value.strValue=f[a];break;default:d("WALogger").WARN(i(),f[a]);return}g.push(b)});b.propValues=g}return b}function b(a){var b={expoKeyStr:a.expoKeyStr,internalExpoKeys:a.internalExpoKeys,lastSyncTime:a.lastSyncTime,propExpoKeys:a.propExpoKeys,refresh:a.refresh};a.hash!=null&&(b.abHash=a.hash);a.abKey!=null&&(b.abKey=a.abKey);if(a.propValues){var c=a.propValues,d={};Object.keys(c).forEach(function(a){c[a]!=null&&(d[a]=c[a])});b.propValues=d}return b}function c(a){var b=a.abHash,c=a.abKey,e=a.expoKeyStr,f=a.internalExpoKeys,g=a.lastSyncTime,i=a.propExpoKeys,j=a.propValues;a=a.refresh;b={abHash:b,abKey:c,expoKeyStr:e,lastSyncTime:g,refresh:a};f!=null&&(b.internalExpoKeys=new Set(f));if(i!=null){var k={};i.forEach(function(a){a.expoKey!=null&&(k[a.expoKey]=a.value)});b.propExpoKeys=k}if(j!=null){var l={};j.forEach(function(a){var b=a.name,c=d("WAAbPropsTypes").ABPropConfigs[b];if(c==null||c.length<3)return;c=c[2];switch(typeof c){case"boolean":l[b]=a.value.boolValue;return;case"number":l[b]=a.value.intValue;return;case"string":l[b]=a.value.strValue;return;default:d("WALogger").WARN(h(),c);return}});b.propValues=l}return b}g.convertAbPropsParsedToDbEntity=a;g.convertAbPropsDataToParsed=b;g.convertDbAbPropsToParsed=c}),98);
__d("WAGetAbPropsApi",["WADexieToWormMigration","WAGetMetaApi","WAGetMetaApiV2"],(function(a,b,c,d,e,f,g){"use strict";a=function(){return(d("WADexieToWormMigration").isWorm("WAGetAbPropsApi")?d("WAGetMetaApiV2").getMeta():d("WAGetMetaApi").getMeta()).then(function(a){a=a.abProps;return a})};g.getAbProps=a}),98);
__d("WASetAbPropsApi",["WADexieToWormMigration","WASetMetaApi","WASetMetaApiV2"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WADexieToWormMigration").isWorm("WASetAbPropsApi")?d("WASetMetaApiV2").setMeta({abProps:a}):d("WASetMetaApi").setMeta({abProps:a})};g.setAbProps=a}),98);
__d("WAAbPropsInit",["Promise","WAAbProps","WAAbPropsCache","WAAbPropsConverters","WAAbPropsToUI","WAAbPropsTypes","WABridge","WAGetAbPropsApi","WALogger","WASetAbPropsApi","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["ABProps inited"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Starting ABProps store"]);j=function(){return a};return a}var k;function a(){if(!k)throw c("err")("Trying to get hash before AbProps gets initialized");return(h||(h=b("Promise"))).resolve(k.getHash())}function e(){if(!k)throw c("err")("Trying to get refresh secs before AbProps gets initialized");return(h||(h=b("Promise"))).resolve(k.getRefreshSecs())}var l={getAbProps:function(){if(!k)throw c("err")("Trying to read ABProps before they gets initialized");return(h||(h=b("Promise"))).resolve(k.readAll())},getHash:a,getRefreshSecs:e,setAbProps:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;a=d("WAAbPropsConverters").convertAbPropsDataToParsed(a);(b=k)==null?void 0:b.rewrite(a);yield d("WASetAbPropsApi").setAbProps(d("WAAbPropsConverters").convertAbPropsParsedToDbEntity(a));m(a)});function c(b){return a.apply(this,arguments)}return c}()};function m(a){if(!a.propValues)return;a=d("WAAbPropsToUI").prepareAbPropsForUI(a.propValues);d("WABridge").getBridge().fireAndForget("event","abPropsUpdated",{abProps:a})}function f(){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){d("WALogger").LOG(j());var a=(yield d("WAGetAbPropsApi").getAbProps()),b={};a&&(b=d("WAAbPropsConverters").convertDbAbPropsToParsed(a));k=new(d("WAAbPropsCache").AbPropsCache)(b);d("WAAbProps").startAbProps(l,d("WAAbPropsTypes").ABPropConfigs);m(b);d("WALogger").LOG(i())});return n.apply(this,arguments)}function o(a,b){if(k==null)throw c("err")("Trying to override ABProp before they get initialized");var e=k;e.overrideAbProp(a,b);m(d("WAAbPropsConverters").convertAbPropsDataToParsed(e.readAll()))}function p(a){return d("WAAbPropsTypes").ABPropConfigs[a][2]}function q(){if(!k)throw c("err")("Trying to read ABProps before they get initialized");return k.readAll()}function r(a){if(!k)throw c("err")("Trying to read ABProp "+a+" before AbProps gets initialized");var b=k.getAbProp(a);return b!=null?b:p(a)}g.getHash=a;g.getRefreshSecs=e;g.initAbProps=f;g.overrideAbProp=o;g.getAbDefault=p;g.getAbProps=q;g.getAbProp=r}),98);
__d("WADbContactsTxns",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.contacts.where("contactJid").anyOf(b).toArray()}function b(a,b){return a.contacts.get({contactJid:b})}f.getContacts=a;f.getContact=b}),66);
__d("WAGetContactAndIdentitiesApi",["MAWDexieTable","MAWTransactionMode","WADbContactsTxns","WADbIdentityTxns","WADbTransactor","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({contacts:d("MAWTransactionMode").READONLY,identity:d("MAWTransactionMode").READONLY},"getContactAndIdentitiesForUser",function(a){return function(b){return d("MAWDexieTable").dexieAll([d("WADbContactsTxns").getContact(a,b),d("WADbIdentityTxns").getIdentitiesForUser(a,b)]).then(function(a){var b=a[0];a=a[1];if(b==null)return d("WAResultOrError").makeError("missing_contact");else{b={contact:{dhash:b.dhash,icdcInfo:b.icdcInfo},identities:a.map(function(a){return{deviceJid:a.deviceJid,identity:a.identity}})};return d("WAResultOrError").makeResult(b)}})}});g.getContactAndIdentitiesForUser=a}),98);
/**
 * License: https://www.facebook.com/legal/license/MDzNl_j9yvg/
 */
__d("fflate-0.6.10",[],(function(a,b,c,d,e,f){"use strict";var g={},h={exports:g};function i(){var a,b="";try{a={}.Worker}catch(a){}g["default"]=a?function(c,d,e,f,g){var h=!1,i=new a(c+b,{eval:!0}).on("error",function(a){return g(a,null)}).on("message",function(a){return g(null,a)}).on("exit",function(a){a&&!h&&g(new Error("exited with code "+a),null)});i.postMessage(e,f);i.terminate=function(){h=!0;return a.prototype.terminate.call(i)};return i}:function(a,b,c,d,e){setImmediate(function(){return e(new Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});a=function(){};return{terminate:a,postMessage:a}}}var j=!1;function k(){j||(j=!0,i());return h.exports}var l={},m={exports:l};function n(){var a=k(),b=Uint8Array,c=Uint16Array,d=Uint32Array,e=new b([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),f=new b([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),g=new b([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=function(a,b){var e=new c(31);for(var f=0;f<31;++f)e[f]=b+=1<<a[f-1];a=new d(e[30]);for(var f=1;f<30;++f)for(b=e[f];b<e[f+1];++b)a[b]=b-e[f]<<5|f;return[e,a]},i=h(e,2),j=i[0],m=i[1];j[28]=258,m[258]=28;i=h(f,0);var n=i[0],o=i[1],p=new c(32768);for(h=0;h<32768;++h){i=(h&43690)>>>1|(h&21845)<<1;i=(i&52428)>>>2|(i&13107)<<2;i=(i&61680)>>>4|(i&3855)<<4;p[h]=((i&65280)>>>8|(i&255)<<8)>>>1}var q=function(a,b,d){var e=a.length,f=0,g=new c(b);for(;f<e;++f)++g[a[f]-1];var h=new c(b);for(f=0;f<b;++f)h[f]=h[f-1]+g[f-1]<<1;if(d){g=new c(1<<b);d=15-b;for(f=0;f<e;++f)if(a[f]){var i=f<<4|a[f],j=b-a[f],k=h[a[f]-1]++<<j;for(j=k|(1<<j)-1;k<=j;++k)g[p[k]>>>d]=i}}else{g=new c(e);for(f=0;f<e;++f)a[f]&&(g[f]=p[h[a[f]-1]++]>>>15-a[f])}return g},r=new b(288);for(h=0;h<144;++h)r[h]=8;for(h=144;h<256;++h)r[h]=9;for(h=256;h<280;++h)r[h]=7;for(h=280;h<288;++h)r[h]=8;var s=new b(32);for(h=0;h<32;++h)s[h]=5;var t=q(r,9,0),u=q(r,9,1),v=q(s,5,0),w=q(s,5,1),x=function(a){var b=a[0];for(var c=1;c<a.length;++c)a[c]>b&&(b=a[c]);return b},y=function(a,b,c){var d=b/8|0;return(a[d]|a[d+1]<<8)>>(b&7)&c},z=function(a,b){var c=b/8|0;return(a[c]|a[c+1]<<8|a[c+2]<<16)>>(b&7)},aa=function(a){return(a/8|0)+(a&7&&1)},A=function(a,e,f){(e==null||e<0)&&(e=0);(f==null||f>a.length)&&(f=a.length);var g=new(a instanceof c?c:a instanceof d?d:b)(f-e);g.set(a.subarray(e,f));return g},B=function(a,c,d){var h=a.length;if(!h||d&&!d.l&&h<5)return c||new b(0);var i=!c||d,k=!d||d.i;d||(d={});c||(c=new b(h*3));var l=function(a){var d=c.length;if(a>d){d=new b(Math.max(d*2,a));d.set(c);c=d}},m=d.f||0,o=d.p||0,p=d.b||0,r=d.l,s=d.d,t=d.m,v=d.n,B=h*8;do{if(!r){d.f=m=y(a,o,1);var C=y(a,o+1,3);o+=3;if(!C){var D=aa(o)+4,E=a[D-4]|a[D-3]<<8,F=D+E;if(F>h){if(k)throw"unexpected EOF";break}i&&l(p+E);c.set(a.subarray(D,F),p);d.b=p+=E,d.p=o=F*8;continue}else if(C==1)r=u,s=w,t=9,v=5;else if(C==2){E=y(a,o,31)+257;F=y(a,o+10,15)+4;C=E+y(a,o+5,31)+1;o+=14;var G=new b(C),H=new b(19);for(var I=0;I<F;++I)H[g[I]]=y(a,o+I*3,7);o+=F*3;F=x(H);var J=(1<<F)-1;H=q(H,F,1);for(var I=0;I<C;){F=H[y(a,o,J)];o+=F&15;var D=F>>>4;if(D<16)G[I++]=D;else{F=0;var K=0;D==16?(K=3+y(a,o,3),o+=2,F=G[I-1]):D==17?(K=3+y(a,o,7),o+=3):D==18&&(K=11+y(a,o,127),o+=7);while(K--)G[I++]=F}}D=G.subarray(0,E);K=G.subarray(E);t=x(D);v=x(K);r=q(D,t,1);s=q(K,v,1)}else throw"invalid block type";if(o>B){if(k)throw"unexpected EOF";break}}i&&l(p+131072);J=(1<<t)-1;H=(1<<v)-1;C=o;for(;;C=o){F=r[z(a,o)&J];G=F>>>4;o+=F&15;if(o>B){if(k)throw"unexpected EOF";break}if(!F)throw"invalid length/literal";if(G<256)c[p++]=G;else if(G==256){C=o,r=null;break}else{E=G-254;if(G>264){var I=G-257;D=e[I];E=y(a,o,(1<<D)-1)+j[I];o+=D}F=s[z(a,o)&H];G=F>>>4;if(!F)throw"invalid distance";o+=F&15;K=n[G];if(G>3){D=f[G];K+=z(a,o)&(1<<D)-1,o+=D}if(o>B){if(k)throw"unexpected EOF";break}i&&l(p+131072);F=p+E;for(;p<F;p+=4)c[p]=c[p-K],c[p+1]=c[p+1-K],c[p+2]=c[p+2-K],c[p+3]=c[p+3-K];p=F}}d.l=r,d.p=C,d.b=p;r&&(m=1,d.m=t,d.d=s,d.n=v)}while(!m);return p==c.length?c:A(c,0,p)},C=function(a,b,c){c<<=b&7;b=b/8|0;a[b]|=c;a[b+1]|=c>>>8},D=function(a,b,c){c<<=b&7;b=b/8|0;a[b]|=c;a[b+1]|=c>>>8;a[b+2]|=c>>>16},E=function(a,d){var e=[];for(var f=0;f<a.length;++f)a[f]&&e.push({s:f,f:a[f]});a=e.length;var g=e.slice();if(!a)return[L,0];if(a==1){var h=new b(e[0].s+1);h[e[0].s]=1;return[h,1]}e.sort(function(a,b){return a.f-b.f});e.push({s:-1,f:25001});h=e[0];var i=e[1],j=0,k=1,l=2;e[0]={s:-1,f:h.f+i.f,l:h,r:i};while(k!=a-1)h=e[e[j].f<e[l].f?j++:l++],i=e[j!=k&&e[j].f<e[l].f?j++:l++],e[k++]={s:-1,f:h.f+i.f,l:h,r:i};h=g[0].s;for(var f=1;f<a;++f)g[f].s>h&&(h=g[f].s);var m=new c(h+1);i=F(e[k-1],m,0);if(i>d){var f=0;j=0;l=i-d;h=1<<l;g.sort(function(a,b){return m[b.s]-m[a.s]||a.f-b.f});for(;f<a;++f){e=g[f].s;if(m[e]>d)j+=h-(1<<i-m[e]),m[e]=d;else break}j>>>=l;while(j>0){k=g[f].s;m[k]<d?j-=1<<d-m[k]++-1:++f}for(;f>=0&&j;--f){e=g[f].s;m[e]==d&&(--m[e],++j)}i=d}return[new b(m),i]},F=function(a,b,c){return a.s==-1?Math.max(F(a.l,b,c+1),F(a.r,b,c+1)):b[a.s]=c},G=function(a){var b=a.length;while(b&&!a[--b]);var d=new c(++b),e=0,f=a[0],g=1,h=function(a){d[e++]=a};for(var i=1;i<=b;++i)if(a[i]==f&&i!=b)++g;else{if(!f&&g>2){for(;g>138;g-=138)h(32754);g>2&&(h(g>10?g-11<<5|28690:g-3<<5|12305),g=0)}else if(g>3){h(f),--g;for(;g>6;g-=6)h(8304);g>2&&(h(g-3<<5|8208),g=0)}while(g--)h(f);g=1;f=a[i]}return[d.subarray(0,e),b]},H=function(a,b){var c=0;for(var d=0;d<b.length;++d)c+=a[d]*b[d];return c},I=function(a,b,c){var d=c.length;b=aa(b+2);a[b]=d&255;a[b+1]=d>>>8;a[b+2]=a[b]^255;a[b+3]=a[b+1]^255;for(var e=0;e<d;++e)a[b+e+4]=c[e];return(b+4+d)*8},J=function(a,b,d,h,i,j,k,l,m,n,o){C(b,o++,d);++i[256];d=E(i,15);var p=d[0];d=d[1];var u=E(j,15),w=u[0];u=u[1];var x=G(p),y=x[0];x=x[1];var z=G(w),aa=z[0];z=z[1];var A=new c(19);for(var B=0;B<y.length;++B)A[y[B]&31]++;for(var B=0;B<aa.length;++B)A[aa[B]&31]++;var F=E(A,7),J=F[0];F=F[1];var K=19;for(;K>4&&!J[g[K-1]];--K);var L=n+5<<3,M=H(i,r)+H(j,s)+k;i=H(i,p)+H(j,w)+k+14+3*K+H(A,J)+(2*A[16]+3*A[17]+7*A[18]);if(L<=M&&L<=i)return I(b,o,a.subarray(m,m+n));C(b,o,1+(i<M)),o+=2;if(i<M){j=q(p,d,0),k=p,A=q(w,u,0),L=w;a=q(J,F,0);C(b,o,x-257);C(b,o+5,z-1);C(b,o+10,K-4);o+=14;for(var B=0;B<K;++B)C(b,o+3*B,J[g[B]]);o+=3*K;m=[y,aa];for(n=0;n<2;++n){i=m[n];for(var B=0;B<i.length;++B){M=i[B]&31;C(b,o,a[M]),o+=J[M];M>15&&(C(b,o,i[B]>>>5&127),o+=i[B]>>>12)}}}else j=t,k=r,A=v,L=s;for(var B=0;B<l;++B)if(h[B]>255){M=h[B]>>>18&31;D(b,o,j[M+257]),o+=k[M+257];M>7&&(C(b,o,h[B]>>>23&31),o+=e[M]);d=h[B]&31;D(b,o,A[d]),o+=L[d];d>3&&(D(b,o,h[B]>>>5&8191),o+=f[d])}else D(b,o,j[h[B]]),o+=k[h[B]];D(b,o,j[256]);return o+k[256]},K=new d([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),L=new b(0),M=function(a,g,h,i,j,k){var l=a.length,n=new b(i+l+5*(1+Math.ceil(l/7e3))+j),p=n.subarray(i,n.length-j),q=0;if(!g||l<8)for(var r=0;r<=l;r+=65535){var s=r+65535;s<l?q=I(p,q,a.subarray(r,s)):(p[r]=k,q=I(p,q,a.subarray(r,l)))}else{s=K[g-1];g=s>>>13;s=s&8191;var t=(1<<h)-1,u=new c(32768),v=new c(t+1),w=Math.ceil(h/3),x=2*w;h=function(b){return(a[b]^a[b+1]<<w^a[b+2]<<x)&t};var y=new d(25e3),z=new c(288),B=new c(32),C=0,D=0,r=0,E=0,F=0,G=0;for(;r<l;++r){var H=h(r),M=r&32767,N=v[H];u[M]=N;v[H]=M;if(F<=r){var O=l-r;if((C>7e3||E>24576)&&O>423){q=J(a,p,0,y,z,B,D,E,G,r-G,q);E=C=D=0,G=r;for(var P=0;P<286;++P)z[P]=0;for(var P=0;P<30;++P)B[P]=0}var Q=2,R=0,ba=s,S=M-N&32767;if(O>2&&H==h(r-S)){H=Math.min(g,O)-1;var ca=Math.min(32767,r);O=Math.min(258,O);while(S<=ca&&--ba&&M!=N){if(a[r+Q]==a[r+Q-S]){var T=0;for(;T<O&&a[r+T]==a[r+T-S];++T);if(T>Q){Q=T,R=S;if(T>H)break;T=Math.min(S,T-2);var da=0;for(var P=0;P<T;++P){var U=r-S+P+32768&32767,V=u[U];V=U-V+32768&32767;V>da&&(da=V,N=U)}}}M=N,N=u[M];S+=M-N+32768&32767}}if(R){y[E++]=268435456|m[Q]<<18|o[R];V=m[Q]&31;U=o[R]&31;D+=e[V]+f[U];++z[257+V];++B[U];F=r+Q;++C}else y[E++]=a[r],++z[a[r]]}}q=J(a,p,k,y,z,B,D,E,G,r-G,q);!k&&q&7&&(q=I(p,q+1,L))}return A(n,0,i+aa(q)+j)},N=function(){var a=new Int32Array(256);for(var b=0;b<256;++b){var c=b,d=9;while(--d)c=(c&1&&-306674912)^c>>>1;a[b]=c}return a}(),O=function(){var a=-1;return{p:function(b){var c=a;for(var d=0;d<b.length;++d)c=N[c&255^b[d]]^c>>>8;a=c},d:function(){return~a}}},P=function(){var a=1,b=0;return{p:function(c){var d=a,e=b,f=c.length;for(var g=0;g!=f;){var h=Math.min(g+2655,f);for(;g<h;++g)e+=d+=c[g];d=(d&65535)+15*(d>>16),e=(e&65535)+15*(e>>16)}a=d,b=e},d:function(){a%=65521,b%=65521;return(a&255)<<24|a>>>8<<16|(b&255)<<8|b>>>8}}},Q=function(a,b,c,d,e){return M(a,b.level==null?6:b.level,b.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(a.length)))*1.5):12+b.mem,c,d,!e)},R=function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c},ba=function(b,c,a){var d=b();b=b.toString();b=b.slice(b.indexOf("[")+1,b.lastIndexOf("]")).replace(/ /g,"").split(",");for(var e=0;e<d.length;++e){var f=d[e],g=b[e];if(typeof f=="function"){c+=";"+g+"=";var h=f.toString();if(f.prototype)if(h.indexOf("[native code]")!=-1){var i=h.indexOf(" ",8)+1;c+=h.slice(i,h.indexOf("(",i))}else{c+=h;for(i in f.prototype)c+=";"+g+".prototype."+i+"="+f.prototype[i].toString()}else c+=h}else a[g]=f}return[c,a]},S=[],ca=function(a){var e=[];for(var f in a)(a[f]instanceof b||a[f]instanceof c||a[f]instanceof d)&&e.push((a[f]=new a[f].constructor(a[f])).buffer);return e},T=function(c,d,e,f){var b;if(!S[e]){var g="",h={},i=c.length-1;for(var j=0;j<i;++j)b=ba(c[j],g,h),g=b[0],h=b[1];S[e]=ba(c[i],g,h)}b=R({},S[e][1]);return a["default"](S[e][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+d.toString()+"}",e,b,ca(b),f)},da=function(){return[b,c,d,e,f,g,j,n,u,w,p,q,x,y,z,aa,A,B,za,ha,ia]},U=function(){return[b,c,d,e,f,g,m,o,t,r,v,s,p,K,L,q,C,D,E,F,G,H,I,J,aa,A,M,Q,wa,ha]},V=function(){return[ma,pa,Z,O,N]},ea=function(){return[na,oa]},fa=function(){return[qa,Z,P]},ga=function(){return[ra]},ha=function(a){return postMessage(a,[a.buffer])},ia=function(a){return a&&a.size&&new b(a.size)},ja=function(a,b,c,d,e,f){var g=T(c,d,e,function(b,a){g.terminate(),f(b,a)});g.postMessage([a,b],b.consume?[a.buffer]:[]);return function(){g.terminate()}},W=function(a){a.ondata=function(a,b){return postMessage([a,b],[a.buffer])};return function(b){return a.push(b.data[0],b.data[1])}},ka=function(a,b,c,d,e){var f,g=T(a,d,e,function(a,c){a?(g.terminate(),b.ondata.call(b,a)):(c[1]&&g.terminate(),b.ondata.call(b,a,c[0],c[1]))});g.postMessage(c);b.push=function(a,c){if(f)throw"stream finished";if(!b.ondata)throw"no stream handler";g.postMessage([a,f=c],[a.buffer])};b.terminate=function(){g.terminate()}},X=function(a,b){return a[b]|a[b+1]<<8},Y=function(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16|a[b+3]<<24)>>>0},la=function(a,b){return Y(a,b)+Y(a,b+4)*4294967296},Z=function(a,b,c){for(;c;++b)a[b]=c,c>>>=8},ma=function(a,b){var c=b.filename;a[0]=31,a[1]=139,a[2]=8,a[8]=b.level<2?4:b.level==9?2:0,a[9]=3;b.mtime!=0&&Z(a,4,Math.floor(new Date(b.mtime||Date.now())/1e3));if(c){a[3]=8;for(b=0;b<=c.length;++b)a[b+10]=c.charCodeAt(b)}},na=function(a){if(a[0]!=31||a[1]!=139||a[2]!=8)throw"invalid gzip data";var b=a[3],c=10;b&4&&(c+=a[10]|(a[11]<<8)+2);for(var d=(b>>3&1)+(b>>4&1);d>0;d-=!a[c++]);return c+(b&2)},oa=function(a){var b=a.length;return(a[b-4]|a[b-3]<<8|a[b-2]<<16|a[b-1]<<24)>>>0},pa=function(a){return 10+(a.filename&&a.filename.length+1||0)},qa=function(a,b){b=b.level;b=b==0?0:b<6?1:b==9?3:2;a[0]=120,a[1]=b<<6|(b?32-2*b:1)},ra=function(a){if((a[0]&15)!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(a[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function sa(a,b){!b&&typeof a=="function"&&(b=a,a={});this.ondata=b;return a}var ta=function(){function a(a,b){!b&&typeof a=="function"&&(b=a,a={}),this.ondata=b,this.o=a||{}}a.prototype.p=function(a,b){this.ondata(Q(a,this.o,0,0,!b),b)};a.prototype.push=function(a,b){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=b;this.p(a,b||!1)};return a}();l.Deflate=ta;var ua=function(){function a(a,b){ka([U,function(){return[W,ta]}],this,sa.call(this,a,b),function(a){a=new ta(a.data);onmessage=W(a)},6)}return a}();l.AsyncDeflate=ua;function va(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[U],function(a){return ha(wa(a.data[0],a.data[1]))},0,c)}l.deflate=va;function wa(a,b){return Q(a,b||{},0,0)}l.deflateSync=wa;var $=function(){function a(a){this.s={},this.p=new b(0),this.ondata=a}a.prototype.e=function(a){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var c=this.p.length,d=new b(c+a.length);d.set(this.p),d.set(a,c),this.p=d};a.prototype.c=function(a){this.d=this.s.i=a||!1;a=this.s.b;var b=B(this.p,this.o,this.s);this.ondata(A(b,a,this.s.b),this.d);this.o=A(b,this.s.b-32768),this.s.b=this.o.length;this.p=A(this.p,this.s.p/8|0),this.s.p&=7};a.prototype.push=function(a,b){this.e(a),this.c(b)};return a}();l.Inflate=$;var xa=function(){function a(a){this.ondata=a,ka([da,function(){return[W,$]}],this,0,function(){var a=new $();onmessage=W(a)},7)}return a}();l.AsyncInflate=xa;function ya(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[da],function(a){return ha(za(a.data[0],ia(a.data[1])))},1,c)}l.inflate=ya;function za(a,b){return B(a,b)}l.inflateSync=za;var Aa=function(){function a(a,b){this.c=O(),this.l=0,this.v=1,ta.call(this,a,b)}a.prototype.push=function(a,b){ta.prototype.push.call(this,a,b)};a.prototype.p=function(a,b){this.c.p(a);this.l+=a.length;a=Q(a,this.o,this.v&&pa(this.o),b&&8,!b);this.v&&(ma(a,this.o),this.v=0);b&&(Z(a,a.length-8,this.c.d()),Z(a,a.length-4,this.l));this.ondata(a,b)};return a}();l.Gzip=Aa;l.Compress=Aa;i=function(){function a(a,b){ka([U,V,function(){return[W,ta,Aa]}],this,sa.call(this,a,b),function(a){a=new Aa(a.data);onmessage=W(a)},8)}return a}();l.AsyncGzip=i;l.AsyncCompress=i;function Ba(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[U,V,function(){return[Ca]}],function(a){return ha(Ca(a.data[0],a.data[1]))},2,c)}l.gzip=Ba;l.compress=Ba;function Ca(a,b){b||(b={});var c=O(),d=a.length;c.p(a);a=Q(a,b,pa(b),8);var e=a.length;return ma(a,b),Z(a,e-8,c.d()),Z(a,e-4,d),a}l.gzipSync=Ca;l.compressSync=Ca;var Da=function(){function a(a){this.v=1,$.call(this,a)}a.prototype.push=function(a,b){$.prototype.e.call(this,a);if(this.v){a=this.p.length>3?na(this.p):4;if(a>=this.p.length&&!b)return;this.p=this.p.subarray(a),this.v=0}if(b){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}$.prototype.c.call(this,b)};return a}();l.Gunzip=Da;var Ea=function(){function a(a){this.ondata=a,ka([da,ea,function(){return[W,$,Da]}],this,0,function(){var a=new Da();onmessage=W(a)},9)}return a}();l.AsyncGunzip=Ea;function Fa(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[da,ea,function(){return[Ga]}],function(a){return ha(Ga(a.data[0]))},3,c)}l.gunzip=Fa;function Ga(a,c){return B(a.subarray(na(a),-8),c||new b(oa(a)))}l.gunzipSync=Ga;var Ha=function(){function a(a,b){this.c=P(),this.v=1,ta.call(this,a,b)}a.prototype.push=function(a,b){ta.prototype.push.call(this,a,b)};a.prototype.p=function(a,b){this.c.p(a);a=Q(a,this.o,this.v&&2,b&&4,!b);this.v&&(qa(a,this.o),this.v=0);b&&Z(a,a.length-4,this.c.d());this.ondata(a,b)};return a}();l.Zlib=Ha;h=function(){function a(a,b){ka([U,fa,function(){return[W,ta,Ha]}],this,sa.call(this,a,b),function(a){a=new Ha(a.data);onmessage=W(a)},10)}return a}();l.AsyncZlib=h;function Ia(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[U,fa,function(){return[Ja]}],function(a){return ha(Ja(a.data[0],a.data[1]))},4,c)}l.zlib=Ia;function Ja(a,b){b||(b={});var c=P();c.p(a);a=Q(a,b,2,4);return qa(a,b),Z(a,a.length-4,c.d()),a}l.zlibSync=Ja;var Ka=function(){function a(a){this.v=1,$.call(this,a)}a.prototype.push=function(a,b){$.prototype.e.call(this,a);if(this.v){if(this.p.length<2&&!b)return;this.p=this.p.subarray(2),this.v=0}if(b){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}$.prototype.c.call(this,b)};return a}();l.Unzlib=Ka;var La=function(){function a(a){this.ondata=a,ka([da,ga,function(){return[W,$,Ka]}],this,0,function(){var a=new Ka();onmessage=W(a)},11)}return a}();l.AsyncUnzlib=La;function Ma(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return ja(a,b,[da,ga,function(){return[Na]}],function(a){return ha(Na(a.data[0],ia(a.data[1])))},5,c)}l.unzlib=Ma;function Na(a,b){return B((ra(a),a.subarray(2,-4)),b)}l.unzlibSync=Na;var Oa=function(){function a(a){this.G=Da,this.I=$,this.Z=Ka,this.ondata=a}a.prototype.push=function(a,c){if(!this.ondata)throw"no stream handler";if(!this.s){if(this.p&&this.p.length){var d=new b(this.p.length+a.length);d.set(this.p),d.set(a,this.p.length)}else this.p=a;if(this.p.length>2){var e=this;d=function(){e.ondata.apply(e,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(d):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(d):new this.Z(d);this.s.push(this.p,c);this.p=null}}else this.s.push(a,c)};return a}();l.Decompress=Oa;i=function(){function a(a){this.G=Ea,this.I=xa,this.Z=La,this.ondata=a}a.prototype.push=function(a,b){Oa.prototype.push.call(this,a,b)};return a}();l.AsyncDecompress=i;function Pa(a,b,c){c||(c=b,b={});if(typeof c!="function")throw"no callback";return a[0]==31&&a[1]==139&&a[2]==8?Fa(a,b,c):(a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?ya(a,b,c):Ma(a,b,c)}l.decompress=Pa;function Qa(a,b){return a[0]==31&&a[1]==139&&a[2]==8?Ga(a,b):(a[0]&15)!=8||a[0]>>4>7||(a[0]<<8|a[1])%31?za(a,b):Na(a,b)}l.decompressSync=Qa;var Ra=function(a,c,d,e){for(var f in a){var g=a[f],h=c+f;g instanceof b?d[h]=[g,e]:Array.isArray(g)?d[h]=[g[0],R(e,g[1])]:Ra(g,h+"/",d,e)}},Sa=typeof TextEncoder!="undefined"&&new TextEncoder(),Ta=typeof TextDecoder!="undefined"&&new TextDecoder(),Ua=0;try{Ta.decode(L,{stream:!0}),Ua=1}catch(a){}var Va=function(a){for(var b="",c=0;;){var d=a[c++],e=(d>127)+(d>223)+(d>239);if(c+e>a.length)return[b,A(a,c-1)];!e?b+=String.fromCharCode(d):e==3?(d=((d&15)<<18|(a[c++]&63)<<12|(a[c++]&63)<<6|a[c++]&63)-65536,b+=String.fromCharCode(55296|d>>10,56320|d&1023)):e&1?b+=String.fromCharCode((d&31)<<6|a[c++]&63):b+=String.fromCharCode((d&15)<<12|(a[c++]&63)<<6|a[c++]&63)}};Ba=function(){function a(a){this.ondata=a,Ua?this.t=new TextDecoder():this.p=L}a.prototype.push=function(a,c){if(!this.ondata)throw"no callback";c=!!c;if(this.t){this.ondata(this.t.decode(a,{stream:!0}),c);if(c){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var d=new b(this.p.length+a.length);d.set(this.p);d.set(a,this.p.length);a=Va(d);d=a[0];a=a[1];if(c){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(d,c)};return a}();l.DecodeUTF8=Ba;h=function(){function a(a){this.ondata=a}a.prototype.push=function(a,b){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Wa(a),this.d=b||!1)};return a}();l.EncodeUTF8=h;function Wa(a,c){if(c){var d=new b(a.length);for(var e=0;e<a.length;++e)d[e]=a.charCodeAt(e);return d}if(Sa)return Sa.encode(a);d=a.length;var f=new b(a.length+(a.length>>1)),g=0,h=function(a){f[g++]=a};for(var e=0;e<d;++e){if(g+5>f.length){var i=new b(g+8+(d-e<<1));i.set(f);f=i}i=a.charCodeAt(e);i<128||c?h(i):i<2048?(h(192|i>>6),h(128|i&63)):i>55295&&i<57344?(i=65536+(i&1023<<10)|a.charCodeAt(++e)&1023,h(240|i>>18),h(128|i>>12&63),h(128|i>>6&63),h(128|i&63)):(h(224|i>>12),h(128|i>>6&63),h(128|i&63))}return A(f,0,g)}l.strToU8=Wa;function Xa(a,b){if(b){b="";for(var c=0;c<a.length;c+=16384)b+=String.fromCharCode.apply(null,a.subarray(c,c+16384));return b}else if(Ta)return Ta.decode(a);else{c=Va(a);b=c[0];a=c[1];if(a.length)throw"invalid utf-8 data";return b}}l.strFromU8=Xa;var Ya=function(a){return a==1?3:a<6?2:a==9?1:0},Za=function(a,b){return b+30+X(a,b+26)+X(a,b+28)},$a=function(a,b,c){var d=X(a,b+28),e=Xa(a.subarray(b+46,b+46+d),!(X(a,b+8)&2048));d=b+46+d;var f=Y(a,b+20);c=c&&f==4294967295?ab(a,d):[f,Y(a,b+24),Y(a,b+42)];f=c[0];var g=c[1];c=c[2];return[X(a,b+10),f,g,e,d+X(a,b+30)+X(a,b+32),c]},ab=function(a,b){for(;X(a,b)!=1;b+=4+X(a,b+2));return[la(a,b+12),la(a,b+4),la(a,b+20)]},bb=function(a){var b=0;if(a)for(var c in a){var d=a[c].length;if(d>65535)throw"extra field too long";b+=d+4}return b},cb=function(b,c,d,e,f,g,h,i){var a=e.length,j=d.extra,k=i&&i.length,l=bb(j);Z(b,c,h!=null?33639248:67324752),c+=4;h!=null&&(b[c++]=20,b[c++]=d.os);b[c]=20,c+=2;b[c++]=d.flag<<1|(g==null&&8),b[c++]=f&&8;b[c++]=d.compression&255,b[c++]=d.compression>>8;f=new Date(d.mtime==null?Date.now():d.mtime);var m=f.getFullYear()-1980;if(m<0||m>119)throw"date not in range 1980-2099";Z(b,c,m<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),c+=4;g!=null&&(Z(b,c,d.crc),Z(b,c+4,g),Z(b,c+8,d.size));Z(b,c+12,a);Z(b,c+14,l),c+=16;h!=null&&(Z(b,c,k),Z(b,c+6,d.attrs),(Z(b,c+10,h),c+=14));b.set(e,c);c+=a;if(l)for(m in j){f=j[m];g=f.length;Z(b,c,+m);Z(b,c+2,g);b.set(f,c+4),c+=4+g}k&&(b.set(i,c),c+=k);return c},db=function(a,b,c,d,e){Z(a,b,101010256),Z(a,b+8,c),Z(a,b+10,c),Z(a,b+12,d),Z(a,b+16,e)},eb=function(){function a(a){this.filename=a,this.c=O(),this.size=0,this.compression=0}a.prototype.process=function(a,b){this.ondata(null,a,b)};a.prototype.push=function(a,b){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(a);this.size+=a.length;b&&(this.crc=this.c.d());this.process(a,b||!1)};return a}();l.ZipPassThrough=eb;Ia=function(){function a(a,b){var c=this;b||(b={});eb.call(this,a);this.d=new ta(b,function(a,b){c.ondata(null,a,b)});this.compression=8;this.flag=Ya(b.level)}a.prototype.process=function(a,b){try{this.d.push(a,b)}catch(a){this.ondata(a,null,b)}};a.prototype.push=function(a,b){eb.prototype.push.call(this,a,b)};return a}();l.ZipDeflate=Ia;i=function(){function a(a,b){var c=this;b||(b={});eb.call(this,a);this.d=new ua(b,function(a,b,d){c.ondata(a,b,d)});this.compression=8;this.flag=Ya(b.level);this.terminate=this.d.terminate}a.prototype.process=function(a,b){this.d.push(a,b)};a.prototype.push=function(a,b){eb.prototype.push.call(this,a,b)};return a}();l.AsyncZipDeflate=i;Pa=function(){function a(a){this.ondata=a,this.u=[],this.d=1}a.prototype.add=function(c){var d=this;if(this.d&2)throw"stream finished";var e=Wa(c.filename),a=e.length,f=c.comment,g=f&&Wa(f);f=a!=c.filename.length||g&&f.length!=g.length;var h=a+bb(c.extra)+30;if(a>65535)throw"filename too long";a=new b(h);cb(a,0,c,e,f);var i=[a],j=function(){for(var a=0,b=i;a<b.length;a++){var c=b[a];d.ondata(null,c,!1)}i=[]},k=this.d;this.d=0;var l=this.u.length,m=R(c,{f:e,u:f,o:g,t:function(){c.terminate&&c.terminate()},r:function(){j();if(k){var a=d.u[l+1];a?a.r():d.d=1}k=1}}),n=0;c.ondata=function(a,e,f){if(a)d.ondata(a,e,f),d.terminate();else{n+=e.length;i.push(e);if(f){a=new b(16);Z(a,0,134695760);Z(a,4,c.crc);Z(a,8,n);Z(a,12,c.size);i.push(a);m.c=n,m.b=h+n+16,m.crc=c.crc,m.size=c.size;k&&m.r();k=1}else k&&j()}};this.u.push(m)};a.prototype.end=function(){var a=this;if(this.d&2){if(this.d&1)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){if(!(a.d&1))return;a.u.splice(-1,1);a.e()},t:function(){}});this.d=3};a.prototype.e=function(){var c=0,d=0,e=0;for(var f=0,a=this.u;f<a.length;f++){var g=a[f];e+=46+g.f.length+bb(g.extra)+(g.o?g.o.length:0)}a=new b(e+22);for(var f=0,h=this.u;f<h.length;f++){var g=h[f];cb(a,c,g,g.f,g.u,g.c,d,g.o);c+=46+g.f.length+bb(g.extra)+(g.o?g.o.length:0),d+=g.b}db(a,c,this.u.length,e,d);this.ondata(null,a,!0);this.d=2};a.prototype.terminate=function(){for(var b=0,a=this.u;b<a.length;b++){var c=a[b];c.t()}this.d=2};return a}();l.Zip=Pa;function fb(a,c,d){d||(d=c,c={});if(typeof d!="function")throw"no callback";var e={};Ra(a,"",e,c);var f=Object.keys(e),g=f.length,h=0,i=0,j=g,k=new Array(g),l=[],m=function(){for(var a=0;a<l.length;++a)l[a]()},n=function(){var a=new b(i+22),c=h,e=i-h;i=0;for(var f=0;f<j;++f){var g=k[f];try{var l=g.c.length;cb(a,i,g,g.f,g.u,l);var m=30+g.f.length+bb(g.extra),n=i+m;a.set(g.c,n);cb(a,h,g,g.f,g.u,l,i,g.m),h+=16+m+(g.m?g.m.length:0),i=n+l}catch(a){return d(a,null)}}db(a,h,k.length,e,c);d(null,a)};g||n();a=function(b){var c=f[b],a=e[c],j=a[0],o=a[1],p=O(),q=j.length;p.p(j);var r=Wa(c),s=r.length,t=o.comment,u=t&&Wa(t),v=u&&u.length,w=bb(o.extra),x=o.level==0?0:8;a=function(a,e){if(a)m(),d(a,null);else{a=e.length;k[b]=R(o,{size:q,crc:p.d(),c:e,f:r,m:u,u:s!=c.length||u&&t.length!=v,compression:x});h+=30+s+w+a;i+=76+2*(s+w)+(v||0)+a;--g||n()}};s>65535&&a("filename too long",null);if(!x)a(null,j);else if(q<16e4)try{a(null,wa(j,o))}catch(b){a(b,null)}else l.push(va(j,o,a))};for(c=0;c<j;++c)a(c);return m}l.zip=fb;function gb(c,d){d||(d={});var e={},f=[];Ra(c,"",e,d);c=0;d=0;for(var g in e){var a=e[g],h=a[0];a=a[1];var i=a.level==0?0:8,j=Wa(g),k=j.length,l=a.comment,m=l&&Wa(l),n=m&&m.length,o=bb(a.extra);if(k>65535)throw"filename too long";var p=i?wa(h,a):h,q=p.length,r=O();r.p(h);f.push(R(a,{size:h.length,crc:r.d(),c:p,f:j,m:m,u:k!=g.length||m&&l.length!=n,o:c,compression:i}));c+=30+k+o+q;d+=76+2*(k+o)+(n||0)+q}a=new b(d+22);h=c;r=d-c;for(p=0;p<f.length;++p){var j=f[p];cb(a,j.o,j,j.f,j.u,j.c.length);m=30+j.f.length+bb(j.extra);a.set(j.c,j.o+m);cb(a,c,j,j.f,j.u,j.c.length,j.o,j.m),c+=16+m+(j.m?j.m.length:0)}db(a,c,f.length,r,h);return a}l.zipSync=gb;var hb=function(){function a(){}a.prototype.push=function(a,b){this.ondata(null,a,b)};a.compression=0;return a}();l.UnzipPassThrough=hb;Qa=function(){function a(){var a=this;this.i=new $(function(b,c){a.ondata(null,b,c)})}a.prototype.push=function(a,b){try{this.i.push(a,b)}catch(c){this.ondata(c,a,b)}};a.compression=8;return a}();l.UnzipInflate=Qa;Ba=function(){function a(a,b){var c=this;b<32e4?this.i=new $(function(a,b){c.ondata(null,a,b)}):(this.i=new xa(function(a,b,d){c.ondata(a,b,d)}),this.terminate=this.i.terminate)}a.prototype.push=function(a,b){this.i.terminate&&(a=A(a,0)),this.i.push(a,b)};a.compression=8;return a}();l.AsyncUnzipInflate=Ba;h=function(){function a(a){this.onfile=a,this.k=[],this.o={0:hb},this.p=L}a.prototype.push=function(a,c){var d=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var e=Math.min(this.c,a.length),f=a.subarray(0,e);this.c-=e;this.d?this.d.push(f,!this.c):this.k[0].push(f);a=a.subarray(e);if(a.length)return this.push(a,c)}else{f=0;var g=0;e=void 0;var h=void 0;!this.p.length?h=a:!a.length?h=this.p:(h=new b(this.p.length+a.length),(h.set(this.p),h.set(a,this.p.length)));var i=h.length,j=this.c;a=j&&this.d;var k=function(){var a=Y(h,g);if(a==67324752){f=1,e=g;l.d=null;l.c=0;var b=X(h,g+6),c=X(h,g+8),k=b&2048;b=b&8;var m=X(h,g+26),n=X(h,g+28);if(i>g+30+m+n){var o=[];l.k.unshift(o);f=2;var p=Y(h,g+18),q=Y(h,g+22),r=Xa(h.subarray(g+30,g+=30+m),!k);p==4294967295?(m=b?[-2]:ab(h,g),p=m[0],q=m[1]):b&&(p=-1);g+=n;l.c=p;var s,t={name:r,compression:c,start:function(){if(!t.ondata)throw"no callback";if(!p)t.ondata(null,L,!0);else{var a=d.o[c];if(!a)throw"unknown compression type "+c;s=p<0?new a(r):new a(r,p,q);s.ondata=function(c,b,a){t.ondata(c,b,a)};for(var a=0,b=o;a<b.length;a++){var e=b[a];s.push(e,!1)}d.k[0]==o&&d.c?d.d=s:s.push(L,!0)}},terminate:function(){s&&s.terminate&&s.terminate()}};p>=0&&(t.size=p,t.originalSize=q);l.onfile(t)}return"break"}else if(j)if(a==134695760){e=g+=12+(j==-2&&8),f=3,l.c=0;return"break"}else if(a==33639248){e=g-=4,f=3,l.c=0;return"break"}},l=this;for(;g<i-4;++g){var m=k();if(m==="break")break}this.p=L;if(j<0){m=f?h.subarray(0,e-12-(j==-2&&8)-(Y(h,e-16)==134695760&&4)):h.subarray(0,g);a?a.push(m,!!f):this.k[+(f==2)].push(m)}if(f&2)return this.push(h.subarray(g),c);this.p=h.subarray(g)}if(c){if(this.c)throw"invalid zip file";this.p=null}};a.prototype.register=function(a){this.o[a.compression]=a};return a}();l.Unzip=h;function ib(a,c){if(typeof c!="function")throw"no callback";var d=[],e=function(){for(var a=0;a<d.length;++a)d[a]()},f={},g=a.length-22;for(;Y(a,g)!=101010256;--g)if(!g||a.length-g>65558){c("invalid zip file",null);return}var h=X(a,g+8);h||c(null,{});var i=h,j=Y(a,g+16),k=j==4294967295;if(k){g=Y(a,g-12);if(Y(a,g)!=101075792){c("invalid zip file",null);return}i=h=Y(a,g+32);j=Y(a,g+48)}g=function(g){g=$a(a,j,k);var i=g[0],l=g[1],m=g[2],n=g[3],o=g[4];g=g[5];g=Za(a,g);j=o;o=function(a,b){a?(e(),c(a,null)):(f[n]=b,--h||c(null,f))};if(!i)o(null,A(a,g,g+l));else if(i==8){g=a.subarray(g,g+l);if(l<32e4)try{o(null,za(g,new b(m)))}catch(a){o(a,null)}else d.push(ya(g,{size:m},o))}else o("unknown compression type "+i,null)};for(var l=0;l<i;++l)g(l);return e}l.unzip=ib;function jb(c){var d={},e=c.length-22;for(;Y(c,e)!=101010256;--e)if(!e||c.length-e>65558)throw"invalid zip file";var f=X(c,e+8);if(!f)return{};var g=Y(c,e+16),h=g==4294967295;if(h){e=Y(c,e-12);if(Y(c,e)!=101075792)throw"invalid zip file";f=Y(c,e+32);g=Y(c,e+48)}for(e=0;e<f;++e){var a=$a(c,g,h),i=a[0],j=a[1],k=a[2],l=a[3],m=a[4];a=a[5];a=Za(c,a);g=m;if(!i)d[l]=A(c,a,a+j);else if(i==8)d[l]=za(c.subarray(a,a+j),new b(k));else throw"unknown compression type "+i}return d}l.unzipSync=jb}var o=!1;function p(){o||(o=!0,n());return m.exports}function a(a){switch(a){case void 0:return p()}}e.exports=a}),null);
__d("fflate",["fflate-0.6.10"],(function(a,b,c,d,e,f){e.exports=b("fflate-0.6.10")()}),null);
__d("WAGzip",["Promise","err","fflate"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this,a)||this;c.$GzipWrapper$p_2=[];c.ondata=function(a,b){c.$GzipWrapper$p_2.push(a);if(!b)return;var d=0;c.$GzipWrapper$p_2.forEach(function(a){d+=a.length});var e=new Uint8Array(d),f=0;c.$GzipWrapper$p_2.forEach(function(a){e.set(a,f),f+=a.length});c.$GzipWrapper$p_1=e};return c}var e=a.prototype;e.push=function(a,e){if(this.$GzipWrapper$p_1!=null)throw c("err")("Tried to push chunk to compressor after final block");a instanceof Uint8Array?b.prototype.push.call(this,a,e):a instanceof ArrayBuffer?b.prototype.push.call(this,new Uint8Array(a),e):b.prototype.push.call(this,d("fflate").strToU8(a),e)};e.result=function(){if(this.$GzipWrapper$p_1==null)throw c("err")("Tried to access result before adding final block");return this.$GzipWrapper$p_1};return a}(d("fflate").Gzip);function a(a){a===void 0&&(a={});return new i(a)}function j(a){return d("fflate").decompressSync(a)}function e(a){return(h||(h=b("Promise"))).resolve(j(a))}g.GzipWrapper=i;g.createDeflate=a;g.inflate=j;g.gzipInflate=e}),98);
__d("WATestBenchmark",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){var g=function(){return performance.now()};function a(a,b,c){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,d){var e={},f=[],h=function(){var d=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,d){f.push(b);e[b]=[];for(var h=0;h<a;h++){var i=g();for(var j=0;j<c;j++)yield d(h,j);j=g();e[b].push((j-i)/c)}});return function(a,b){return d.apply(this,arguments)}}();yield d(h);return f.map(function(a){var b=e[a].sort(),c=b.length;return{name:a,min:b[0],p50:b[Math.floor(c/2)],avg:b.reduce(function(a,b){return a+b},0)/c}})});return h.apply(this,arguments)}function i(a){if(a<1){var b=Math.round(a*1e4);return b+"\u03bcs"}b=Math.round(a);return b+"ms"}function c(a,b){b.forEach(function(b){var c=b.name,d=b.min,e=b.avg;b=b.p50;a("["+c+"] min: "+i(d)+", avg: "+i(e)+", p50: "+i(b))})}f.createBenchmark=a;f.printReport=c}),66);
__d("WARunStorageBenchmark",["Promise","WATestBenchmark","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=1024;var i=10,j=500,k=new Blob([new Uint8Array(a).fill(255)]);c=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c,e=(yield n());yield q(e);yield w();var f=(yield s());yield E();var g=(yield y());a("start write benchmark...");var k=(yield (c=d("WATestBenchmark")).createBenchmark(i,j,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a("IndexedDB write",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield o(e,a+"_"+b)});return function(b,c){return a.apply(this,arguments)}}()),yield a("Web Cache write",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield t(f,a+"_"+b)});return function(b,c){return a.apply(this,arguments)}}()),yield a("OPFS write",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){yield A(g,a+"_"+b)});return function(b,c){return a.apply(this,arguments)}}())});return function(b){return a.apply(this,arguments)}}()));a("end write benchmark...");c.printReport(a,k);a("start read benchmark...");k=(yield c.createBenchmark(i,j,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c;yield a("IndexedDB read",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){c=(yield p(e,a+"_"+b))});return function(b,c){return a.apply(this,arguments)}}());var d;yield a("Web Cache read",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){d=(yield u(f,a+"_"+b))});return function(b,c){return a.apply(this,arguments)}}());var i;yield a("OPFS read",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){i=(yield C(g,a+"_"+b))});return function(b,c){return a.apply(this,arguments)}}());if(c instanceof ArrayBuffer&&d instanceof ArrayBuffer&&i instanceof ArrayBuffer)return;return(h||(h=b("Promise"))).reject("read result is not ArrayBuffer")});return function(b){return a.apply(this,arguments)}}()));a("end write benchmark...");c.printReport(a,k)});return function(b){return a.apply(this,arguments)}}();var l="storage-benchmark",m="storage-benchmark-store";function n(){return new(h||(h=b("Promise")))(function(a,b){var c=indexedDB.open(l);c.onerror=function(a){b(a.target.error)};c.onupgradeneeded=function(a){a=a.target.result;a.createObjectStore(m)};c.onsuccess=function(b){b=b.target.result;a(b)}})}function o(a,c){return new(h||(h=b("Promise")))(function(b,d){var e=a.transaction([m],"readwrite");e.oncomplete=function(){b()};e.onerror=function(a){d(a.target.error)};e.onabort=function(a){d(a.target.error)};e=e.objectStore(m);e=e.add(k,c);e.onerror=function(a){d(a.target.error)};e.onsuccess=function(){b()}})}function p(a,c){return new(h||(h=b("Promise")))(function(b,d){var e=a.transaction([m],"readonly");e.onerror=function(a){d(a.target.error)};e.onabort=function(a){d(a.target.error)};e=e.objectStore(m);var f=e.get(c);f.onerror=function(a){d(a.target.error)};f.onsuccess=function(){var a=f.result;b(a.arrayBuffer())}})}function q(a){return new(h||(h=b("Promise")))(function(b,c){var d=a.transaction([m],"readwrite");d.oncomplete=function(){b()};d.onerror=function(a){c(a.target.error)};d.onabort=function(a){c(a.target.error)};d=d.objectStore(m);d=d.clear();d.onerror=function(a){c(a.target.error)};d.onsuccess=function(){b()}})}var r="storage-benchmark-cache";function s(){return caches.open(r)}function t(a,b){var c=new Response(k);return a.put(""+b,c)}function u(a,b){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield a.match(""+b));return a.arrayBuffer()});return v.apply(this,arguments)}function w(){return caches["delete"](r).then(function(){})}var x="storage-benchmark-filesystem";function y(){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;if((navigator==null?void 0:(a=navigator.storage)==null?void 0:a.getDirectory)==null)return(h||(h=b("Promise"))).reject("OPFS is not supported");a=(yield navigator.storage.getDirectory());a=(yield a.getDirectoryHandle(x,{create:!0}));return a});return z.apply(this,arguments)}function A(a,b){return B.apply(this,arguments)}function B(){B=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield a.getFileHandle(""+b,{create:!0}));b=(yield a.createWritable());yield b.write(k);return b.close()});return B.apply(this,arguments)}function C(a,b){return D.apply(this,arguments)}function D(){D=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield a.getFileHandle(""+b,{create:!0}));b=(yield a.getFile());return b.arrayBuffer()});return D.apply(this,arguments)}function E(){return F.apply(this,arguments)}function F(){F=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a;if((navigator==null?void 0:(a=navigator.storage)==null?void 0:a.getDirectory)==null)return(h||(h=b("Promise"))).reject("OPFS is not supported");a=(yield navigator.storage.getDirectory());return a.removeEntry(x,{recursive:!0})});return F.apply(this,arguments)}g.runStorageBenchmark=c}),98);
__d("WormDbDebuggingUtils",["WAJids","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["stanzaQueue"],"readonly",function(a){return a.stores.stanzaQueue.readAll()},"debug-get-stanza-queue")});return h.apply(this,arguments)}function c(){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["danglingQueue"],"readonly",function(a){return a.stores.danglingQueue.readAll()},"debug-get-dangling-queue")});return i.apply(this,arguments)}function j(){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["identity"],"readonly",function(a){return a.stores.identity.readAll()},"debug-get-identities")});return k.apply(this,arguments)}function l(){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["contacts"],"readonly",function(a){return a.stores.contacts.readAll()},"debug-get-contacts")});return m.apply(this,arguments)}function n(){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["session"],"readonly",function(a){return a.stores.session.readAll()},"debug-get-sessions")});return o.apply(this,arguments)}function p(){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["senderKeySessions"],"readonly",function(a){return a.stores.senderKeySessions.readAll()},"debug-get-sender-key-sessions")});return q.apply(this,arguments)}function e(){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["prekey"],"readonly",function(a){return a.stores.prekey.readAll()},"debug-get-prekeys")});return r.apply(this,arguments)}function f(){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["prekeyGeneration"],"readonly",function(a){return a.stores.prekeyGeneration.readAll()},"debug-get-prekey-generations")});return s.apply(this,arguments)}function t(){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["signedPrekey"],"readonly",function(a){return a.stores.signedPrekey.readAll()},"debug-get-signed-prekeys")});return u.apply(this,arguments)}function v(){return w.apply(this,arguments)}function w(){w=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WASignalDB").getDbPromise());return a.runInTransaction(["meta"],"readonly",function(a){return a.stores.meta.readAll()},"debug-get-meta-rows")});return w.apply(this,arguments)}function x(a){return j().then(function(b){return b.filter(function(b){return b.userJid===a})})}function y(a){return l().then(function(b){return b.find(function(b){return b.contactJid===a})})}function z(a){return n().then(function(b){return b.filter(function(b){return d("WAJids").extractUserJid(b.id)===a})})}function A(a){return p().then(function(b){return b.filter(function(b){return b.userJid===a})})}g.getStanzaQueue=a;g.getDanglingQueue=c;g.getIdentities=j;g.getContacts=l;g.getSessions=n;g.getSenderKeySessions=p;g.getPrekeys=e;g.getPrekeyGenerations=f;g.getSignedPrekeys=t;g.getMetaRows=v;g.getIdentitiesForUser=x;g.getContact=y;g.getSessionsForUser=z;g.getSenderKeySessionsForUser=A}),98);
__d("MAWDebug",["EBWorkerEBSMStateUtils","ExecutionEnvironment","LSMEBTaskCreationSource","MAWAdminWriteCutoverThreadMsgTxn","MAWArmadilloPollTableSchema.pb","MAWBridge","MAWBulkHandleIncomingMsgApi","MAWConfig","MAWCreateThreadThroughMI","MAWDbAddDeviceChangeAlertsTxn","MAWDbAppDataTxns","MAWDbChunkTxns","MAWDbEditMsgHistoryTxns","MAWDbGetDeviceChangeAlertsByOptionsTxn","MAWDbGetDeviceChangeAlertsTxn","MAWDbGetUnArchivedDeviceChangeAlertsCountTxn","MAWDbGroupInfoTxns","MAWDbGroupInviteTxns","MAWDbMediaTxns","MAWDbMsgTxns","MAWDbMsgTypeVersionTxns","MAWDbObjDecode","MAWDbObjEncode","MAWDbParticipantTxns","MAWDbPendingReceiptTxns","MAWDbPoll","MAWDbReactionsTxns","MAWDbThreadTxns","MAWDbUnrenderedMsgTxns","MAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWDbUpdateDeviceChangeAlertsTxn","MAWDbVersion","MAWDbXMATxns","MAWDebugHydrateOfflineQueue","MAWDebugSendMultipleMsgs","MAWDexieTable","MAWEncryptedBackupCacheManager","MAWEphemeralCleaner","MAWEphemeralSettingsTxns","MAWExternalId","MAWGroupSetMemberAddMode","MAWHandleEchoMsgsRestoreApiV2","MAWJobDefinitions","MAWJobManager","MAWKeychainNaClCrypto","MAWLoadMsgsApi","MAWLoggerUtils","MAWMediaUtils","MAWRotateDTSG","MAWSendEphemeralSettingMsg","MAWSendSenderKeyDistributionMsg","MAWTransactionMode","MAWTransactor","MAWVault","OfflineThreadingId","Promise","WAAPI","WAAbPropsInit","WAArmadilloXMA.pb","WACompareIdentity","WADbContactsTxns","WADbIdentityTxns","WADbMetaTxns","WADbPersonalSenderKeyStatusTxns","WADbPrekeyTxns","WADbSenderKeySessionTxns","WADbSessionTxns","WADbSignal","WADbSignedPrekeyTxns","WADbTransactor","WADevicesState","WAExceededStorageQuota","WAGatherMediaInfo","WAGetContactAndIdentitiesApi","WAGetPlatformFromStanzaId","WAGlobals","WAGzip","WAHandleFailureUtils","WAJids","WAJobOrchestratorTypes","WALogger","WAMediaUtils","WAPREList","WAPREMetrics","WAProtocolQueue","WARotateSignedPreKey","WARunStorageBenchmark","WASignalDB","WASignalKeys","WASignalOther","WATimeUtils","WebStorageEstimator","WormDbDebuggingUtils","asyncToGeneratorRuntime","emptyFunction","err","gkx","promiseDone","qpl","unrecoverableViolation","vulture"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);j=function(){return a};return a}var k={UNSAFE_changeMyIdentity:function(){void n({meta:d("MAWTransactionMode").READWRITE})(function(a){return a.meta.put({key:d("WADbSignal").MetaKeysEnum.identityKeyPair,value:{identityKeyPair:d("WASignalKeys").makeKeyPair()}}).then(c("emptyFunction"))})()},addBadProtocolQueueInstruction:function(){var a={instruction:"bad",type:"instruction"};return d("WAProtocolQueue").protocolQueue().addAndCommit([a])},addDeviceChangeAlerts:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn)(a))},addGroupParticipants:function(a,b,c){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.addGroupParticipants(a,b,c))},addICDCAlert:function(a){return d("WAGlobals").getWaOneQueue().enqueue(function(){d("WAProtocolQueue").pqFlushable.enqueue({instruction:"icdcError",jid:a,notificationTs:d("WATimeUtils").unixTime(),priority:d("WAProtocolQueue").WAProtocolQueuePriorityLow,type:"instruction"});return(i||(i=b("Promise"))).resolve()},{flush:!0,operationType:"debug_operation"}).then(c("emptyFunction"))},benchmarkStorage:function(){void d("WARunStorageBenchmark").runStorageBenchmark(function(a){return!1})},checkStorageQuota:function(){return d("WAExceededStorageQuota").checkStorageQuota()},clearICDCInfo:function(a){return l(n({contacts:d("MAWTransactionMode").READWRITE})(function(b){return b.contacts.get(a).then(function(a){if(a!=null){a.icdcInfo=void 0;a.icdcFails=void 0;a.lastSyncTs=d("WATimeUtils").unixTime();return b.contacts.put(a).then(function(){return"contact-updated"})}return"contact-missing"})})())},compareIdentity:function(){return l(n({identity:d("MAWTransactionMode").READONLY,meta:d("MAWTransactionMode").READONLY})(d("WACompareIdentity").compareIdentityDexie)())},createGroup:function(a,b,c){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").createStartJobInfo("createGroup",{extras:{clientThreadKey:c,platform:"msgr"},key:c,s2sInstanceKey:d("MAWLoggerUtils").getInstanceKey(),subject:a,users:b}))},createTestPoll:function(a){void m({poll:d("MAWTransactionMode").READWRITE})(function(b){return b.poll.put({chatJid:a,encKey:new ArrayBuffer(0),pollAuthor:"@me",pollOptions:new Map([[d("MAWDbPoll").convertStringToOptionHash("option1Hash"),{optionText:"option1",pollVotes:new Map([["@me",d("WATimeUtils").millisTime()]])}]]),pollParticipantCount:2,pollStanzaId:d("MAWExternalId").generateExternalId(),pollState:d("MAWArmadilloPollTableSchema.pb").POLL_STATE.OPEN,selectableOptionsCount:0,title:"Test Poll"})})(a)},createThread:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","createThread",{contactFbid:a,description:"MAWDebug",threadKey:d("OfflineThreadingId").createOfflineThreadingID()})},createThreadThroughMI:function(a,b,e,f){c("vulture")("kSmv3NehuU0eXmAyrNaciQYRcgA=");return d("MAWCreateThreadThroughMI").createThreadThroughMI({authoritativeThreadKey:a,chatJid:b,description:"MAWDebug",lastActivityTimestampMs:e,lastReadWatermarkTimestampMs:f,numOfMsgsToLoad:1}).then(c("emptyFunction"))},decodeEAR:function(a,b){return d("MAWDbObjDecode").decodeDbObj(a,b)},deflate:function(a){var b=d("WAGzip").createDeflate();b.push(a,!0);return b.result()},deleteGroupInvitesByThreadAndInvitedParticipant:function(a,b){return l(m({groupInvites:d("MAWTransactionMode").READWRITE})(d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant)(a,b))},demoteGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.demoteGroupParticipants(a,b))},deregisterPhone:function(){c("promiseDone")(d("WAHandleFailureUtils").deregisterPhone())},dropExpiredMessagesFromDB:function(){var a=d("MAWEphemeralCleaner").getEphemeralCleaner_FOR_TESTING_ONLY();if(a)a.backend.update(d("WATimeUtils").futureUnixTime(5));else throw c("err")("Cannot delete expired msgs as cleaner is not initialized!")},dropExpiredMessagesFromUI:function(){var a=d("MAWEphemeralCleaner").getEphemeralCleaner_FOR_TESTING_ONLY();if(a)a.ui.update(d("WATimeUtils").futureUnixTime(5));else throw c("err")("Cannot delete expired msgs as cleaner is not initialized!")},encodeEAR:function(a,b){return d("MAWDbObjEncode").encodeDbObj(a,b)},encryptEARTweetNaCl:function(a,b,c){return d("MAWKeychainNaClCrypto").encryptTweetNaCl(a,b,c)},establishOutgoingSession:function(a,b){return c("WAAPI").preEstablishSession({groupJid:a,userJids:b})},estimateStorage:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WebStorageEstimator").estimateStorage());return a});function c(){return a.apply(this,arguments)}return c}(),executeQuery:function(a){var b=Object.keys(d("MAWDbVersion").CURRENT_MAW_STORES).filter(function(a){return d("MAWDbVersion").CURRENT_MAW_STORES[a]!=null}).reduce(function(a,b){return babelHelpers["extends"]({},a,(a={},a[b+""]=d("MAWTransactionMode").READWRITE,a))},{});return m(b)(a)()},forwardMsg:function(a,b){return d("MAWBridge").getBridge().sendAndReceive("backend","forwardMsg",{args:{args:{},chatJid:a,externalId:d("MAWExternalId").generateExternalId(),protocolMsgId:b},qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:d("MAWLoggerUtils").getInstanceKey()})},fromUnixTime:function(a){return d("WATimeUtils").toDate(a)},gatherMediaInfo:function(){c("promiseDone")(d("WAGatherMediaInfo").gatherMediaInfo())},generateAndUploadPreKeys:function(){return c("WAAPI").generateAndUploadPreKeys({reason:"test"})},generateAndUploadPreKeysMultipleCalls:function(){return(i||(i=b("Promise"))).all([c("WAAPI").generateAndUploadPreKeys({reason:"test"}),c("WAAPI").generateAndUploadPreKeys({reason:"test"}),c("WAAPI").generateAndUploadPreKeys({reason:"test"})])},generateDuplicateMessagesForChat:function(a,b){return k.generateMessagesForChat(a,b).then(function(a){var b=a.msgResults.values().map(function(a){return(a=a.value)==null?void 0:a.protocolMsgId.externalId}).filter(Boolean),e=b[0];return m({messages:d("MAWTransactionMode").READWRITE})(function(a){return d("MAWDexieTable").dexieAll(b.map(function(b){return a.messages.get({externalId:b}).then(function(b){if(b!=null)return a.messages.put(babelHelpers["extends"]({},b,{externalId:e,protocolMsgId:void 0}))})})).then(c("emptyFunction"))})(b)})},generateMessagesForChat:function(a,b){return d("MAWBulkHandleIncomingMsgApi").bulkHandleIncomingMsgs(Array.from({length:b}).map(function(b,c){b=d("WATimeUtils").castMilliSecondsToUnixTime(Date.now());var e=d("MAWExternalId").generateExternalId();c={ack:2,altIndex:void 0,author:"@me",externalId:e,msgContent:{content:"Stub message #"+c},serverTs:b,ts:b,type:"Text"};return{msgData:{device:{id:d("WAJids").extractDeviceId(d("WAGlobals").getMyDeviceJid()),identity:null},folder:null,id:{author:"@me",chat:a,externalId:e},msg:{encoded:new Uint8Array(0),version:"v2"},recipientsCount:null,reportingMeta:null,ts:b,type:"IncomingMsg"},receiveFlow:d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE,{}),stanzaSource:"wa",unstoredContent:{unstoredDbMedia:null,unstoredDbMsg:c,unstoredDbReaction:null,unstoredDbReceiverFetchInfo:null}}}),c("LSMEBTaskCreationSource").TEST_ONLY)},getAbProp:function(a){return d("WAAbPropsInit").getAbProp(a)},getAbProps:function(){return d("WAAbPropsInit").getAbProps()},getAllMessageIdsAndRangesForThread:function(a,b){return d("MAWBridge").getBridge().sendAndReceive("backend","getAllMessageIdsAndRangesForThread",{chatJid:a,limit:b})},getAppDatas:function(a){return l(m({appData:d("MAWTransactionMode").READONLY})(d("MAWDbAppDataTxns").bulkGetAppData)(a))},getAppMetaByKey:function(a){return l(m({appMeta:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTypeVersionTxns").getAppMetaValue)(a))},getChunksByChunkId:function(a){return l(m({chunk:d("MAWTransactionMode").READONLY})(d("MAWDbChunkTxns").bulkGetChunks)(a))},getConfig:function(){return Object.fromEntries(Object.entries(d("MAWConfig").getConfig()).map(function(a){var b=a[0];a=a[1];var c;a;try{c=a()}catch(b){c=a}return[b,c]}))},getContacts:function(a){return l(n({contacts:d("MAWTransactionMode").READONLY})(d("WADbContactsTxns").getContacts)(a))},getCurrentUserDeviceList:function(){return c("WAAPI").getCurrentUserDeviceList()},getDeviceChangeAlerts:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetDeviceChangeAlertsTxn").getDeviceChangeAlertsTxn)(a))},getDeviceChangeAlertsByOptions:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetDeviceChangeAlertsByOptionsTxn").getDeviceChangeAlertsByOptionsTxn)(a))},getDeviceChangeAlertsByOptionsLLA:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","getDeviceChangeAlertsByOptions",{options:a})},getDevices:function(a,b){return c("WAAPI").getDevices({ignoreDhash:b,reason:"debug",users:new Set(a)})},getDevicesState:function(){return d("WADevicesState").getDevicesState()},getEBRestoreCache:function(){return d("MAWEncryptedBackupCacheManager").restoredCache},getEBSMWorkerState:function(){return(h||(h=c("ExecutionEnvironment"))).isInWorker?d("EBWorkerEBSMStateUtils").getEBSMWorkerState():d("MAWBridge").getBridge().sendAndReceive("backend","getEBSMWorkerState")},getEditMsgHistoryByEditMsgHistoryId:function(a){return l(m({editMsgHistory:d("MAWTransactionMode").READONLY})(d("MAWDbEditMsgHistoryTxns").bulkGetEditMsgHistorys)(a))},getEditMsgHistoryByProtocolMsgId:function(a){return l(m({editMsgHistory:d("MAWTransactionMode").READONLY})(d("MAWDbEditMsgHistoryTxns").maybeGetEditMsgHistoryFromProtocolMsgId)(a))},getGroupInfosByGroupJid:function(a){return l(m({groupInfo:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInfoTxns").getGroupInfos)(a))},getGroupInvite:function(a,b){return l(m({groupInvites:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInviteTxns").maybeGetGroupInvite)(a,b))},getGroupInvitesByThreadAndInvitedParticipant:function(a,b){return l(m({groupInvites:d("MAWTransactionMode").READONLY})(d("MAWDbGroupInviteTxns").getGroupInvitesByThreadAndInvitedParticipant)(a,b))},getHmacKeyFromGlobals:function(){return d("WAGlobals").getHMACKey()},getIdentityByDeviceJid:function(a){return l(n({identity:d("MAWTransactionMode").READONLY})(d("WADbIdentityTxns").bulkGetIdentityRows)(a))},getMediaBackupForObjectId:function(a){return l(m({mediaBackup:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").maybeGetMediaBackupRowFromObjectId)(a))},getMediaByIdWithDecodedMediaEntries:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield m({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").bulkGetMedias)(a));a.forEach(function(a){if(!(a==null?void 0:a.mediaEntries))return;a.mediaEntries=new Map(Array.from(a.mediaEntries,function(a){var b=a[0];a=a[1];return[b,d("WAMediaUtils").decodeMediaEntryData(a)]}))});return l((i||(i=b("Promise"))).resolve(a))});function c(b){return a.apply(this,arguments)}return c}(),getMediaByMediaId:function(a){return l(m({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").bulkGetMedias)(a))},getMediaByPlaintextHash:function(a){return l(m({media:d("MAWTransactionMode").READONLY})(d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash)(a))},getMessagesByMsgIds:function(a){return l(m({messages:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("msgId").anyOf(a).toArray().then(function(a){return a.filter(Boolean)})})(a))},getMeta:function(){return l(n({meta:d("MAWTransactionMode").READONLY})(d("WADbMetaTxns").getAllMeta)())},getMsgsByChat:function(a){return l(m({messages:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("threadJid").equals(a).toArray()})())},getMsgsByMsgId:function(a){return l(m({messages:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTxns").getMsgsByMsgIds)(a))},getMsgsByProtocolMsgId:function(a){return l(m({messages:d("MAWTransactionMode").READONLY})(d("MAWDbMsgTxns").getMsgsByProtocolMsgId)(a))},getNewDTSG:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return(yield d("MAWRotateDTSG").getNewDTSG()).token});function c(){return a.apply(this,arguments)}return c}(),getParticipantsByParticipantKeys:function(a){return l(m({participants:d("MAWTransactionMode").READONLY})(d("MAWDbParticipantTxns").bulkGetParticipants)(a))},getPendingReceipts:function(a){return l(m({pendingReceipts:d("MAWTransactionMode").READONLY})(d("MAWDbPendingReceiptTxns").getPendingReceipts)(a))},getPersonalSenderKeyStatusesByGroupJid:function(a){return l(n({personalSenderKeyStatuses:d("MAWTransactionMode").READONLY})(d("WADbPersonalSenderKeyStatusTxns").bulkGetPersonalSenderKeyStatuses)(a))},getPlatform:function(a){return d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(a)},getPrekeyByPrekeyId:function(a){return l(n({prekey:d("MAWTransactionMode").READONLY})(d("WADbPrekeyTxns").getPrekeys)(a))},getPrekeyGenerationByGenerationId:function(a){return l(n({prekeyGeneration:d("MAWTransactionMode").READONLY})(d("WADbPrekeyTxns").getPrekeyGenerations)(a))},getProtocolMsgId:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:a})},getReactionByReactToExternalId:function(a){return l(m({reactions:d("MAWTransactionMode").READONLY})(function(b){return b.reactions.where("reactToExternalId").anyOf(a).toArray()})(a))},getReactionByReactToMsgId:function(a){return l(m({messages:d("MAWTransactionMode").READONLY,reactions:d("MAWTransactionMode").READONLY})(function(b){return b.messages.where("msgId").anyOf(a).toArray().then(function(a){return d("MAWDbReactionsTxns").getReactionsFromMessages(b,a)})})(a))},getReceiptByWAMsgId:function(a){return l(n({receipts:d("MAWTransactionMode").READONLY})(function(a,b){return a.receipts.get({waMsgId:b})})(a))},getSenderKeySessionsBySenderKeySessionId:function(a){return l(n({senderKeySessions:d("MAWTransactionMode").READWRITE})(d("WADbSenderKeySessionTxns").getSenderKeySessionsBySenderKeySessionId)(a))},getSessionsByDeviceJid:function(a){return l(n({session:d("MAWTransactionMode").READONLY})(d("WADbSessionTxns").bulkGetSessions)(a))},getSignedPrekesByPrekeyId:function(a){return l(n({signedPrekey:d("MAWTransactionMode").READONLY})(d("WADbSignedPrekeyTxns").getSignedPrekeys)(a))},getThreadsByChatJids:function(a){return l(m({threads:d("MAWTransactionMode").READONLY})(d("MAWDbThreadTxns").getThreads)(a))},getUnArchivedDeviceChangeAlertsCount:function(){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn)())},getUnrenderedMsgsByMsgId:function(a){return l(m({unrenderedMessages:d("MAWTransactionMode").READONLY})(d("MAWDbUnrenderedMsgTxns").getUnrenderedMsgsByMsgIds)(a))},getXMAByXMAId:function(a){return l(m({xma:d("MAWTransactionMode").READONLY})(d("MAWDbXMATxns").bulkGetXMAs)(a))},handleEchoMsgsBulkRestore:function(a,b,c,e,f,g,h,i){return l(d("MAWHandleEchoMsgsRestoreApiV2").handleEchoMsgsBulkRestore(a,b,c,e,f,g,h,i,void 0,void 0,void 0,void 0,void 0,!1))},hmacPlaintextHash:function(a){return d("MAWMediaUtils").genHMACPlaintextHash(a)},hydrateOfflineQueue:d("MAWDebugHydrateOfflineQueue").hydrateOfflineQueue.execute,inflate:function(a){return d("WAGzip").inflate(a)},leaveGroups:function(a){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.leaveGroups(a))},loadMsgs:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b;b=(yield d("MAWLoadMsgsApi").loadMsgsFromTs(a.chatJid,(b=a.numMsgs)!=null?b:10,a.direction,a.sortOrderMs,a.loadOriginalMsg,a.msgId,{admin:!0,editMsgHistory:!0,media:!0,reactions:!0,receiverFetch:!0,xma:!0}));return babelHelpers["extends"]({},b,{msgs:b.msgs.map(function(a){return babelHelpers["extends"]({},a,{content:a.content!=null?d("MAWVault").unvault(a.content):""})})})});function c(b){return a.apply(this,arguments)}return c}(),makeError:function(a){throw c("unrecoverableViolation")(a,"messenger_web_devx",{error:c("err")(a)})},makeWAError:function(a){d("WALogger").ERROR(j(),a)},markThreadAsRead:function(a,b,c){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.markThreadAsRead(a,null,!1,!1,b,c,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION}))},maybeGetChunksByPlaintextHash:function(a){return l(m({chunk:d("MAWTransactionMode").READONLY})(d("MAWDbChunkTxns").maybeGetChunkByPlaintextHash)(a))},maybeGetXMAFromProtocolMsgId:function(a){return l(m({xma:d("MAWTransactionMode").READONLY})(d("MAWDbXMATxns").maybeGetXMAFromProtocolMsgId)(a))},notifyDeviceChange:function(a){return c("WAAPI").notifyDeviceChange({users:a})},overrideAbProp:function(a,b){d("WAAbPropsInit").overrideAbProp(a,b)},promoteGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.promoteGroupParticipants(a,b))},protocolQueue:function(){return d("WAProtocolQueue").protocolQueue()},putGroupInvite:function(a){return l(m({groupInvites:d("MAWTransactionMode").READWRITE})(d("MAWDbGroupInviteTxns").putGroupInvite)(a))},putNewPersonalSenderKeyStatus:function(a){return n({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE})(d("WADbPersonalSenderKeyStatusTxns").putNewPersonalSenderKeyStatus)(a)},queryAllGroups:function(){return c("WAAPI").queryGroups({type:"all"}).then(c("emptyFunction"))},readProtocolQueue:function(){return d("WAProtocolQueue").protocolQueue().read()},readWormStore:function(a){return d("WASignalDB").getDb().runInTransaction([a],"readonly",function(b){return b.stores[a].readAll()},"Debug - read "+a)},removeDevice:function(a,b){return c("WAAPI").removeDevice({deviceId:a,identity:b})},removeGroupParticipants:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.removeGroupParticipants(a,b))},reportUserSpam:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.reportUserSpam(a,"frx",b,!1,["harassment"],"fake debug context"))},reregisterPhone:function(){return d("WAHandleFailureUtils").reregisterPhone()},restoreMessagesFromEncryptedBackups:function(a,b,c,e,f,g,h,i,j,k){return l(d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,b,c,e,f,g,h,i,j,k)))},revokeMsg:function(a){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.revokeMsgs({msgIds:[a],s2sInstanceKey:d("MAWLoggerUtils").getInstanceKey()}))},rotateSignedPreKey:function(){return d("WARotateSignedPreKey").rotateSignedPreKey()},sendAppData:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendAppData({contents:a,deviceJids:b}))},sendEditMsg:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendEditMsg(a,b))},sendEphemeralSettingMsg:function(a,b){return d("MAWSendEphemeralSettingMsg").sendEphemeralSettingMsgFn({args:b,chatJid:a,externalId:d("MAWExternalId").generateExternalId(),qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:d("MAWLoggerUtils").getInstanceKey()})},sendInvisibleMsg:function(a){return d("MAWSendSenderKeyDistributionMsg").sendSenderKeyDistributionMsg(a,d("MAWExternalId").generateExternalId(),d("MAWLoggerUtils").getInstanceKey())},sendInvisibleMsgToAllExistingGroups:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield m({groupInfo:d("MAWTransactionMode").READONLY})(function(a){return a.groupInfo.toArray()})()),b=[];for(a of a)b.push(d("MAWSendSenderKeyDistributionMsg").sendSenderKeyDistributionMsg(a.groupJid,d("MAWExternalId").generateExternalId(),d("MAWLoggerUtils").getInstanceKey()));return b});function c(){return a.apply(this,arguments)}return c}(),sendMessageTooAllExistingGroups:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield m({groupInfo:d("MAWTransactionMode").READONLY})(function(a){return a.groupInfo.toArray()})()),b=[];for(a of a)b.push(k.sendMsg(a.groupJid,{content:"message to "+a.groupJid+" at "+new Date().getTime(),s2sInstanceKey:d("MAWLoggerUtils").getInstanceKey()}));return b});function c(){return a.apply(this,arguments)}return c}(),sendMsg:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendMsg(a,b))},sendMultipleMsgs:d("MAWDebugSendMultipleMsgs").sendMultipleMsgs.execute,sendReaction:function(a,b,c,e){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendReactionMsg(a,b,c,d("MAWLoggerUtils").getInstanceKey(),e))},sendXMAShareMsg:function(a,b,c,e){var f=new File(["Hello"],"aaa",{type:"image/jpeg"});return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendXMAShareMsg(a,{file:f,height:0,width:0},void 0,void 0,(a=c)!=null?a:"hey",babelHelpers["extends"]({},b,{xmaMessageType:d("WAArmadilloXMA.pb").EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.FB_STORY_REPLY}),void 0,void 0,e))},setEphemeralSettingWithoutUpdate:function(a,b,c,e){c=c==null?d("WATimeUtils").unixTime():d("WATimeUtils").futureUnixTime(c);return l(m({ephemeralSettings:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(d("MAWEphemeralSettingsTxns").handleAndWriteOutgoingUserEphemeralSettingChange)(a,b,c,e))},setGroupSubject:function(a,b){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.setGroupSubject(a,b))},setICDCData:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=(yield d("WAGetContactAndIdentitiesApi").getContactAndIdentitiesForUser(a));if(!e.success)return"generateICDCInfo failed with error "+e.error;else if(e.value==null)return"Could not find contact info";var f=e.value.contact,g=f.icdcInfo;if(g==null)return"Could not find contact ICDC info";var h=g.sequence;c.sequenceInc!=null&&(h=g.sequence+c.sequenceInc);var i=d("WAJids").interpretAsDeviceId(999);yield d("WAGlobals").getWaOneQueue().enqueue(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b.cryptoManager;if(c.additionDevices==="inject"){var f=d("WASignalOther").makeBytes(33);f[0]=5;e.value.identities.push({deviceJid:d("WAJids").toDeviceJid(a,i),identity:f});yield b.storage.updateUserDevicesInfo([{devices:e.value.identities.map(function(a){var b=a.deviceJid;a=a.identity;return{id:d("WAJids").extractDeviceId(b),identity:a}}),dhash:null,icdcInfo:null,jid:a,lastSyncTs:d("WATimeUtils").unixTime(),notificationTs:null}])}else c.additionDevices==="clear"&&(yield b.storage.updateUserDevicesInfo([{devices:e.value.identities.filter(function(b){return b.deviceJid!==d("WAJids").toDeviceJid(a,i)}).map(function(a){var b=a.deviceJid;a=a.identity;return{id:d("WAJids").extractDeviceId(b),identity:a}}),dhash:null,icdcInfo:null,jid:a,lastSyncTs:d("WATimeUtils").unixTime(),notificationTs:null}]))});return function(a){return f.apply(this,arguments)}}(),{afterInit:!0,flush:!0,operationType:"debug_operation"});return l(n({contacts:d("MAWTransactionMode").READWRITE})(function(b){return b.contacts.get(a).then(function(a){if(a!=null){a.icdcInfo=babelHelpers["extends"]({},g,{sequence:h});c.resetICDCError===!0&&(a.icdcFails=void 0);a.lastSyncTs=d("WATimeUtils").unixTime();return b.contacts.put(a).then(function(){return"contact-updated"})}return"contact-missing"})})())});function c(b,c){return a.apply(this,arguments)}return c}(),setMemberAddMode:function(a,b){return d("MAWGroupSetMemberAddMode").setMemberAddModeFn({groupJid:a,memberAddMode:b})},syncAbProps:function(a){a=a!==!0;return c("WAAPI").syncAbProps({sendHash:a})},updateDeviceChangeAlerts:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbUpdateDeviceChangeAlertsTxn").updateDeviceChangeAlertsTxn)(a))},updateDeviceChangeAlertsLLA:function(a){return d("MAWBridge").getBridge().sendAndReceive("backend","updateDeviceChangeAlerts",{alert:a})},updateDeviceChangeAlertsLogInStatus:function(a){return l(m({deviceChangeAlerts:d("MAWTransactionMode").READWRITE})(d("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn)(a))},uploadRetroactiveThreadsAndMessages:function(){return l(d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.uploadRetroactiveThreadsAndMessages()))},wormGetContact:function(a){return d("WormDbDebuggingUtils").getContact(a)},wormGetContacts:function(){return d("WormDbDebuggingUtils").getContacts()},wormGetDanglingQueue:function(){return d("WormDbDebuggingUtils").getDanglingQueue()},wormGetIdentities:function(){return d("WormDbDebuggingUtils").getIdentities()},wormGetIdentitiesForUser:function(a){return d("WormDbDebuggingUtils").getIdentitiesForUser(a)},wormGetMetaRows:function(){return d("WormDbDebuggingUtils").getMetaRows()},wormGetPrekeyGenerations:function(){return d("WormDbDebuggingUtils").getPrekeyGenerations()},wormGetPrekeys:function(){return d("WormDbDebuggingUtils").getPrekeys()},wormGetSenderKeySessions:function(){return d("WormDbDebuggingUtils").getSenderKeySessions()},wormGetSenderKeySessionsForUser:function(a){return d("WormDbDebuggingUtils").getSenderKeySessionsForUser(a)},wormGetSessions:function(){return d("WormDbDebuggingUtils").getSessions()},wormGetSessionsForUser:function(a){return d("WormDbDebuggingUtils").getSessionsForUser(a)},wormGetSignedPrekeys:function(){return d("WormDbDebuggingUtils").getSignedPrekeys()},wormGetStanzaQueue:function(){return d("WormDbDebuggingUtils").getStanzaQueue()},wormICDCData:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){var e=(yield d("WormDbDebuggingUtils").getContacts()),f=(yield d("WormDbDebuggingUtils").getIdentities());e=e.find(function(b){return b.contactJid===a});var g=f.filter(function(b){return b.userJid===a});if(e==null)return"Could not find contact info";var h=e.icdcInfo;if(h==null)return"Could not find contact ICDC info";var i=h.sequence;c.sequenceInc!=null&&(i=h.sequence+c.sequenceInc);var j=d("WAJids").interpretAsDeviceId(999);yield d("WAGlobals").getWaOneQueue().enqueue(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=b.cryptoManager;if(c.additionDevices==="inject"){var e=d("WASignalOther").makeBytes(33);e[0]=5;g.push({deviceJid:d("WAJids").toDeviceJid(a,j),identity:e,userJid:a});yield b.storage.updateUserDevicesInfo([{devices:g.map(function(a){var b=a.deviceJid;a=a.identity;return{id:d("WAJids").extractDeviceId(b),identity:a}}),dhash:null,icdcInfo:null,jid:a,lastSyncTs:d("WATimeUtils").unixTime(),notificationTs:null}])}else c.additionDevices==="clear"&&(yield b.storage.updateUserDevicesInfo([{devices:g.filter(function(b){return b.deviceJid!==d("WAJids").toDeviceJid(a,j)}).map(function(a){var b=a.deviceJid;a=a.identity;return{id:d("WAJids").extractDeviceId(b),identity:a}}),dhash:null,icdcInfo:null,jid:a,lastSyncTs:d("WATimeUtils").unixTime(),notificationTs:null}]))});return function(a){return e.apply(this,arguments)}}(),{afterInit:!0,flush:!0,operationType:"debug_operation"});return l(n({contacts:d("MAWTransactionMode").READWRITE})(function(b){return b.contacts.get(a).then(function(a){if(a!=null){a.icdcInfo=babelHelpers["extends"]({},h,{sequence:i});c.resetICDCError===!0&&(a.icdcFails=void 0);a.lastSyncTs=d("WATimeUtils").unixTime();return b.contacts.put(a).then(function(){return"contact-updated"})}return"contact-missing"})})())});function c(b,c){return a.apply(this,arguments)}return c}(),writeCutoverThreadAdminMsg:function(a,b){var c;return l(m({chunk:(c=d("MAWTransactionMode")).READONLY,ftsBackloggedMessages:c.READWRITE,groupInfo:c.READONLY,media:c.READONLY,messages:c.READWRITE,threads:c.READWRITE})(d("MAWAdminWriteCutoverThreadMsgTxn").writeCutoverThreadAdminMsg)(a,b))},writeRollbackCutoverThreadAdminMsg:function(a){a=m({threads:d("MAWTransactionMode").READONLY})(d("MAWDbThreadTxns").getThread)(a);return a.then(function(a){if(!a.success)return(i||(i=b("Promise"))).resolve();a=a.value;return l(m({chunk:d("MAWTransactionMode").READONLY,ftsBackloggedMessages:d("MAWTransactionMode").READWRITE,groupInfo:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,threads:d("MAWTransactionMode").READWRITE})(d("MAWAdminWriteCutoverThreadMsgTxn").writeRollbackCutoverAdminMsg)(a))})}};function l(a){return a.then(function(a){return a})}c("gkx")("23903")&&(self.Debug=k,self.WAAPI=c("WAAPI"));function m(a){return function(b){return d("MAWTransactor").makeMsgrTransactor(a,"debug",function(a){return function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b.apply(void 0,[a].concat(d))}})}}function n(a){return function(b){return d("WADbTransactor").makeSignalTransactor(a,"debug",function(a){return function(){for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return b.apply(void 0,[a].concat(d))}})}}g.MAWDebugFuncs=k}),98);
__d("XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/api/v1/direct_v2/restoration_cdn_url/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("endpoints",["CSRFGuard","PolarisConfig","Promise","XHRRequest","XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder","getAsyncParams"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return new(h||(h=b("Promise")))(function(b,e){var f=c("getAsyncParams")("POST"),g=new(c("XHRRequest"))(c("XPolarisIGXAPIDirectInstamadilloRestoreCDNUrlControllerRouteBuilder").buildURL({}));g.setMethod("POST").setRequestHeader("X-IG-App-ID",d("PolarisConfig").getIGAppID()).setData(babelHelpers["extends"]({},f,{payload:a})).setResponseHandler(function(a){try{a=a.trim();d("CSRFGuard").exists(a)&&(a=d("CSRFGuard").clean(a));a=JSON.parse(a);b(a.payload.restoration_cdn_url)}catch(a){e(a)}}).setErrorHandler(function(a){e(a)}).send()})}g.fetchEBRestoreCDNUrl=a}),98);
__d("IGDAWDebug",["I64","IGDAWProtocolQueueInstructions","MAWDebug","MAWReStoreDb","MAWUnsafeCoerce","WAJids","WAProtocolQueue","WASignalKeys","asyncToGeneratorRuntime","cr:7711","endpoints"],(function(a,b,c,d,e,f,g){"use strict";var h;a={UNSAFE_triggerICDCErrorForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("WAJids").toMsgrUserJid(a);var b=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),c=d("MAWUnsafeCoerce").unsafeCoerce(42);a={instruction:"icdcError",jid:a,notificationTs:b,priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:c,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([a])});function c(b){return a.apply(this,arguments)}return c}(),UNSAFE_triggerIdentityAddedForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAJids").toMsgrUserJid(a);b=d("WAJids").toMsgrDeviceJid(a,b);var c=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),e=d("MAWUnsafeCoerce").unsafeCoerce(42);b={device:b,identity:d("WASignalKeys").makeSerializedKeyPair().serializedPubKey,instruction:"identityAdded",jid:a,model:"Chrome",notificationTs:c,platform:"Instagram",priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:e,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([b])});function c(b,c){return a.apply(this,arguments)}return c}(),UNSAFE_triggerIdentityChangedForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAJids").toMsgrUserJid(a);b=d("WAJids").toMsgrDeviceJid(a,b);var c=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),e=d("MAWUnsafeCoerce").unsafeCoerce(42);b={device:b,identity:d("WASignalKeys").makeSerializedKeyPair().serializedPubKey,instruction:"identityChanged",jid:a,model:"Chrome",notificationTs:c,platform:"Instagram",priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:e,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([b])});function c(b,c){return a.apply(this,arguments)}return c}(),UNSAFE_triggerIdentityRemovedForIGD:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=d("WAJids").toMsgrUserJid(a);b=d("WAJids").toMsgrDeviceJid(a,b);var c=d("MAWUnsafeCoerce").unsafeCoerce(Math.floor(Date.now()/1e3)),e=d("MAWUnsafeCoerce").unsafeCoerce(42);b={device:b,instruction:"identityRemoved",jid:a,notificationTs:c,priority:d("WAProtocolQueue").WAProtocolQueuePriorityHigh,stanzaQueueId:e,type:"instruction"};yield d("IGDAWProtocolQueueInstructions").handleInstructions([b])});function c(b,c){return a.apply(this,arguments)}return c}(),fetchEBRestoreCDNUrl:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{a=(yield d("endpoints").fetchEBRestoreCDNUrl(a))}catch(a){}});function c(b){return a.apply(this,arguments)}return c}(),fetchInstamadilloMessage:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e){try{var g=(yield d("MAWReStoreDb").getDB(f.id+":144"));yield b("cr:7711")==null?void 0:b("cr:7711")(g,(h||(h=d("I64"))).of_float(a),c,e)}catch(a){}});function c(b,c,d){return a.apply(this,arguments)}return c}()};Object.assign(d("MAWDebug").MAWDebugFuncs,a)}),34);
__d("MAWParseXMAIGConfig",["WAArmadilloXMA.pb"],(function(a,b,c,d,e,f,g){"use strict";b=new Set([(a=d("WAArmadilloXMA.pb")).EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_CLIPS_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_MULTIPOST_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_SINGLE_IMAGE_POST_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_HIGHLIGHT_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_HIGHLIGHT_SHARE,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REPLY,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_REACTION,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_PHOTO_MENTION,a.EXTENDED_CONTENT_MESSAGE_EXTENDED_CONTENT_TYPE.IG_STORY_VIDEO_MENTION]);g.IGD_SUPPORTED_TARGET_TYPES=b}),98);
__d("IGDAWMainWebWorkerConfig",["MAWGK","MAWParseXMAIGConfig","WADbDeviceRegistration","WorkerUtils","getOrchestratorVersion","gkx","justknobx","qex"],(function(a,b,c,d,e,f,g){"use strict";var h,i=1;a={armadilloWebProcessFutureproof:function(){return c("MAWGK").armadillo_web_process_futureproof},batchSize:function(){return 500},getDevicesV2:function(){return c("gkx")("4551")},getSignalFutureMessagesMax:function(){return c("justknobx")._("847")},icdcAlertTriggerFailureCounter:function(){return c("justknobx")._("1970")},icdcCooldownIntervalInMinutes:function(){return 1e4},icdcIntervalInMinutes:function(){return c("justknobx")._("1972")},ignoreReadReceipts:function(){return c("qex")._("3109")===!1},isDocumentReceiveEnabled:function(){return!1},isEphemeralMessagesEnabled:function(){return!0},isFrankingDropOnInvalid:function(){return c("gkx")("23973")},isFrankingDropOnMissing:function(){return c("gkx")("23974")},isFrankingEnabled:function(){return c("justknobx")._("1347")},isGifEnabled:function(){return c("justknobx")._("1147")},isHttpFetchCacheEnabled:function(){return c("gkx")("5483")},isICDCErrorEnabled:function(){return c("gkx")("23975")},isImageHDSupportedEnabled:function(){return!1},isMediaFallbackToAlternativeHmacSaltsEnabled:function(){return c("gkx")("23976")},isOctetStreamAttachmentMimeTypeEnabled:function(){return c("gkx")("4644")},isPollsFallbackExperienceEnabled:function(){return!1},isPreEstablishSessionEnabled:function(){return c("gkx")("23979")},isProgressiveJpegSendEnabled:function(){return c("justknobx")._("2412")},isSenderKeyPredistributionEnabled:function(){return c("gkx")("23981")},isSharedWorkerContext:function(){return(h||(h=d("WorkerUtils"))).isSharedWorkerContext()},isStickerEnabled:function(){return c("justknobx")._("2619")},isStickerReceiverFetchEnabled:function(){return!1},isStoryMentionXMAEnabled:function(){return!1},jpegThumbnailTargetByteSizeKB:function(){return c("justknobx")._("2338")},maxPrekeysToUpload:function(){return 200},maxUsersForNotifyDeviceChange:function(){return d("WADbDeviceRegistration").MAX_USERS_FOR_NOTIFY_DEVICE_CHANGE},offlineQueueStuckTimeoutMs:function(){return c("justknobx")._("3264")},oneQueueTimeoutMs:function(){return c("justknobx")._("2583")},orchestratorVersion:function(){return c("getOrchestratorVersion")()},pjpegPreviewAvoidLastScan:function(){return c("justknobx")._("67")},sendMsgWithoutJob:function(){return c("gkx")("7854")},sessionDropIfTooOld:function(){return c("justknobx")._("2240")},shouldDeviceStateTimesout:function(){return c("justknobx")._("2592")},simplifyPQ:function(){return!1},skipDownloadablePreviewForProgressiveJpeg:function(){return c("justknobx")._("2371")},useLongSessionDrop:function(){return c("gkx")("1244")},useProtocolMediaKey:function(){return c("gkx")("3718")},waDanglingQueue:function(){return c("justknobx")._("1921")},workerScheduler:function(){return!1}};b={productTypeForEBAttachments:"igd",shouldFallbackToPreviewForFailedProgressiveJpeg:function(){return c("gkx")("2909")},supportedTypesVersion:function(){return c("MAWGK").armadillo_web_process_futureproof?i+1:i},supportedXMATargetTypes:function(){return d("MAWParseXMAIGConfig").IGD_SUPPORTED_TARGET_TYPES}};g.waConfig=a;g.mawConfig=b}),98);
__d("IGDBridgedAPIHandler",["JSResourceForInteraction","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["igdapi: unsupported api call ",""]);h=function(){return a};return a}function a(a){var b=a.args;a=a.type;switch(a){case"46":return c("JSResourceForInteraction")("IGDSendMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"33":return c("JSResourceForInteraction")("IGDUnsendMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendEditMessage":return c("JSResourceForInteraction")("IGDEditMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendMediaMessage":return c("JSResourceForInteraction")("IGDSendMediaMessageTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendOrRemoveReaction":return c("JSResourceForInteraction")("IGDSendRemoveReactionTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});case"sendXmaReceiverFetch":return c("JSResourceForInteraction")("IGDSendXmaReceiverFetchTaskHandler").__setRef("IGDBridgedAPIHandler").load().then(function(a){a=a.handleTask;return a.apply(void 0,b)});default:d("WALogger").DEV(h(),a).devConsole(b);return}}g.igdapi=a}),98);
__d("MAWEncryptedBackupsClearRecoveryCode",["Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return(h||(h=b("Promise"))).all([d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_recovery_code_data)),d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_recovery_code_status))]).then(function(c){var d=c[0],e=c[1];if(d!=null||e!=null)return a.runInTransaction(function(a){return(h||(h=b("Promise"))).all([(d==null?void 0:d.taskId)!=null?a.secure_recovery_code_data["delete"](d.taskId):(h||(h=b("Promise"))).resolve(),(e==null?void 0:e.pk)!=null?a.secure_encrypted_backups_recovery_code_status["delete"](e.pk):(h||(h=b("Promise"))).resolve()])},"readwrite",void 0,void 0,f.id+":27")})}g.encryptedBackupsClearRecoveryCode=a}),98);
__d("MAWAddGroupParticipantsApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"addGroupParticipants")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h,i){h=a.GroupInfoStore;var j=a.MessagesStore;a=a.ParticipantsStore;var k=(yield h.get(c));if(!k.success)return d("WAResultOrError").makeError("missing_group");k=f.map(function(a){return{addressable:a.addressable,chatJid:c,type:a.type,user:a.user}});yield a.bulkPut(k);if(b!=null){f=d("MAWAdminMsgHelpers").createParticipantAddAdminMessage(c,k.map(function(a){return a.user}),e,i);yield j.create(f);yield h.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})},{updateParticipantMedatadata:g})}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g,h,i){return a.apply(this,arguments)}}();g.addGroupParticipants=a;g.addGroupParticipantsTransactor=h}),98);
__d("MAWGetMsgIdByProtocolMsgId",["MAWDbMsgTxns","MAWDbReactionsTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWIndexedDb","MAWMsgType","MAWTransactionMode","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({messages:(a=d("MAWTransactionMode")).READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getMsgIdByProtocolMsgId",function(a){return function(b){return d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").maybeGetMsgResultByProtocolMsgId(a,b),d("MAWDbReactionsTxns").maybeGetReactionByProtocolMsgId(a,b),d("MAWDbUnrenderedMsgTxns").maybeGetUnrenderedMsgByProtocolMsgId(a,b)]).then(function(a){var b=a[0],c=a[1];a=a[2];if(b.success)return d("WAResultOrError").makeResult(b.value.msgId);else if(c!=null)return d("WAResultOrError").makeResult(c.reactionId);else if(a.success&&a.value.type===d("MAWMsgType").MSG_TYPE.DELETE_FOR_ME)return d("WAResultOrError").makeResult(a.value.msgId);var e="missing_msg_in_db";b=b.error;a=a.error;if(b==="missing_msg"&&c==null&&a==="missing_unrendered_msg")e="missing_all_db_msg";else if(b==="missing_thread_msg"&&a==="missing_thread_unrendered_msg")e="missing_all_thread";else if(b==="missing_thread_msg"||a==="missing_thread_unrendered_msg"){e=b+"__"+((c=a)!=null?c:"unrenderedMsgResultNoError")}return d("WAResultOrError").makeError(e)})}});g.getMsgIdByProtocolMsgId=b}),98);
__d("WAIsDownloadMediaErrorRetryable",[],(function(a,b,c,d,e,f){"use strict";a=function(a){switch(a){case"media-entry-invalid":case"media-entry-invalid-direct-path":case"media-entry-invalid-file-enc-sha256":case"media-entry-invalid-file-sha256":case"media-entry-invalid-media-key":case"media-entry-invalid-server-media-type":case"hash-mismatch":case"ciphertext-hash-mismatch":case"enc-hash-mismatch":case"decryption-error":case"invalid-webp":case"invalid-mp4":return!1;case"create-payload-failed":case"resign-cdn-url-request-error":case"resign-cdn-url-runtime-error":case"direct-path-undefined":case"direct-path-corrupted":case"direct-path-empty":case"missing-media-entry":case"missing-media-entry-for-restore":case"missing-sort-order-ms-for-restore":case"signature-expired":case"max-attempts-exceeded":case"request-error":case"download-throttled":case"media-not-found":case"no-host":case"backoff":case"body-network-error":case"disconnected":case"runtime-error":case"access-expired":case"http-fetch-exception":case"unspecified-http-error":case"server-timeout":case"preview-not-supported":return!0;default:a;return!0}};f.isDownloadMediaErrorRetryable=a}),66);
__d("MAWDownloadAndHandleMedia",["MAWAckLevel","MAWCastToMsgrServerMediaType","MAWConfig","MAWDbMsgTxns","MAWEBSwitch","MAWGetMostRescentDecodedMediaEntry","MAWGetMsgByProtocolIdApi","MAWGetMsgIdByProtocolMsgId","MAWHandleEchoMediaMsgsRestoreV2","MAWHandleMediaDownloadApi","MAWHandleMediaPreviewBeforeDownloadApi","MAWHandleMediaPreviewDownloadApi","MAWHandleMediaPreviewDownloadAsFailedApi","MAWIndexedDb","MAWIsMsgDeletedWithReason","MAWJobDefinitions","MAWJobManager","MAWLoggerUtils","MAWMediaDownloadStatus","MAWMediaDownloadStatusForUI","MAWMediaManager","MAWTransactionMode","MAWUpdateMediaEntryForMsgApi","MAWVideoAudioValidationUtils","Promise","WAAPI","WAErrorMessage","WAHashUtils","WAIsDownloadMediaErrorRetryable","WAIsMediaExpiredError","WAIsMp4","WAIsWebP","WAJids","WAJobOrchestratorTypes","WAMediaCrypto","WAMediaManager","WAMediaUtils","WAParseWav","WAPrewarmMediaValidate","WAResultOrError","WAStartMediaDownloadQplFlow","WATagsLogger","WAValidateMedia","asyncToGeneratorRuntime","cr:10071","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["media validation audioStreamReport: ",", videoStreamReport: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["media validation was skipped: ",", setup_failed: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to validate media: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to validate for msg ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media for msg ",", error: "," "]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["fail to resign cdn url. ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url sproc start. ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql error: ",". ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql success. ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql failed: ",". ",""]);r=function(){return a};return a}function s(){var a=babelHelpers.taggedTemplateLiteralLoose(["resign cdn url gql start. ",""]);s=function(){return a};return a}function t(){var a=babelHelpers.taggedTemplateLiteralLoose(["media key expired, resign cdn url for msgId: ",". isEBDownloadEnforced: ",""]);t=function(){return a};return a}function u(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to prewarm media validate: ",""]);u=function(){return a};return a}function v(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadAndHandleMedia: Failed to get DecodedMediaEntry - reason: ",""]);v=function(){return a};return a}function w(){var a=babelHelpers.taggedTemplateLiteralLoose(["downloadAndHandleMedia: Missing msgId in Db - reason: "," msgType: ",""]);w=function(){return a};return a}function x(){var a=babelHelpers.taggedTemplateLiteralLoose(["DownloadAndHandleMedia: "," hash with "," msgId, entry ",""]);x=function(){return a};return a}function y(){var a=babelHelpers.taggedTemplateLiteralLoose(["start legacy downloadAndHandleMedia"]);y=function(){return a};return a}function z(){var a=babelHelpers.taggedTemplateLiteralLoose(["Persist media runtime-error: ",""]);z=function(){return a};return a}function A(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media for ",""]);A=function(){return a};return a}function B(){var a=babelHelpers.taggedTemplateLiteralLoose(["fullsize download runtime-error: ",""]);B=function(){return a};return a}function C(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to download media preview: ",""]);C=function(){return a};return a}function D(){var a=babelHelpers.taggedTemplateLiteralLoose(["preview not supported"]);D=function(){return a};return a}function E(){var a=babelHelpers.taggedTemplateLiteralLoose(["start Media Manager downloadAndHandleMedia. msgType: ",""]);E=function(){return a};return a}var F=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.MediaDownload,d("MAWLoggerUtils").Tag.MessageReceive]),G=0;a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("downloadAndHandleMedia",function(a){var b=a.hash,c=a.msgType,e=a.protocolMsgId;a=a.qplEntryPoint;var f=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:a,msgType:c,protocolMsgId:e,triggerUIView:null});return H({downloadEntry:a,hash:b,mediaDownloadFlow:f,msgType:c,protocolMsgId:e})}).end();function H(a){var b=a.downloadEntry,d=a.hash,e=a.mediaDownloadFlow,f=a.msgType;a=a.protocolMsgId;O(d,"download_and_handle_media");return c("gkx")("5850")?I({downloadEntry:b,hash:d,mediaDownloadFlow:e,msgType:f,protocolMsgId:a}):K({hash:d,mediaDownloadFlow:e,msgType:f,protocolMsgId:a})}function I(a){return J.apply(this,arguments)}function J(){J=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=a.downloadEntry,e=a.hash,f=a.mediaDownloadFlow,g=a.msgType,i=a.protocolMsgId;F.DEV(E(),g);f.addAnnotations({string:{msgType:g}});a=(yield d("MAWMediaManager").mawMediaManager.enqueueDownloadFullSizeAndPreview({fullSizePlaintextHash:e,mediaDownloadFlow:f,priority:S(c)}));g=a.fullsizePromise;var j=a.previewPromise;void d("MAWHandleMediaPreviewBeforeDownloadApi").handleMediaPreviewBeforeDownload(e).then(function(){return j}).then(function(a){if(a.success===!1){if(a.error==="preview-not-supported"){F.DEV(D());return}return(h||(h=b("Promise"))).reject(a.error)}else{var c=d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(a.value.serverMediaType);return c==null?(h||(h=b("Promise"))).reject("unsupported preview media type "+a.value.serverMediaType):d("MAWHandleMediaPreviewDownloadApi").handleMediaPreviewDownload(e,a.value.validatedResult.validatedPlaintext,c,i)}})["catch"](function(a){F.LOG(C(),a);return d("MAWHandleMediaPreviewDownloadAsFailedApi").handleMediaPreviewDownloadFailed(e,a.toString())});c=(yield g["catch"](function(a){F.ERROR(B(),a);return d("WAResultOrError").makeError("runtime-error",a)}));if(c.success===!1){F.LOG(A(),i);f.endFail(c.error,{string:{failReason:c.payload==null?c.error:d("WAErrorMessage").maybeGetMessageFromError(c.payload)}});d("WAIsDownloadMediaErrorRetryable").isDownloadMediaErrorRetryable(c.error)?Q(e,c.error):R(e,c.error);return}g=(a=c.value.validatedResult.mimeType)!=null?a:c.value.unvalidatedMimeType;f.addPoint("handle_media_download_start");a=(yield d("MAWHandleMediaDownloadApi").handleMediaDownload(e,g,c.value.validatedResult.validatedPlaintext,i,c.value.validatedResult)["catch"](function(a){F.ERROR(z(),a);return d("WAResultOrError").makeError("runtime-error",a)}));a.success||(f.endFail("handle_media_download_fail",{string:{failReason:a.payload==null?a.error:d("WAErrorMessage").maybeGetMessageFromError(a.payload)}}),Q(e,a.error));f.addPoint("handle_media_download_end");f.endSuccess();P(e,c.value.validatedResult)});return J.apply(this,arguments)}function K(a){return L.apply(this,arguments)}function L(){L=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.hash,f=a.mediaDownloadFlow,g=a.msgType,h=a.protocolMsgId;F.LOG(y());F.LOG(x(),d("WAHashUtils").sanitisePlaintextHash(e),h,f.downloadEntry);f.addPoint("maw_pre_download_start");a=(yield d("MAWGetMsgIdByProtocolMsgId").getMsgIdByProtocolMsgId(h));if(!a.success){var z=(yield d("MAWIsMsgDeletedWithReason").isMsgDeletedWithReason(h));if(z){f.addPoint("media_deleted");f.endSuccess();R(e,"media_deleted");return}f.addPoint("maw_pre_download_fail");f.endFail(a.error,{string:{failReason:a.error}});F.ERROR(w(),a.error,g);R(e,a.error);return}var A=a.value;z=(yield d("MAWGetMostRescentDecodedMediaEntry").getMostRecentDecodedMediaEntry(e));if(!z.success){f.addPoint("maw_pre_download_fail");f.endFail(z.error,{string:{failReason:z.error}});F.ERROR(v(),z.error);yield M(A);R(e,z.error);return}g=z.value;try{d("WAPrewarmMediaValidate").prewarmMediaValidate(g.serverMediaType)}catch(a){F.ERROR(u(),a)}f.addPoint("maw_pre_download_end");a=c("MAWEBSwitch").isEnabled()&&c("gkx")("23960");a&&f.addPoint("forcing_eb_download");z=function(){G++;f.addAnnotations({"int":{fileCount:G}});return d("MAWHandleMediaPreviewDownloadApi").handleMediaPreviewDownload.apply(void 0,arguments)["finally"](function(){G--})};z=a?d("WAResultOrError").makeError("signature-expired"):yield c("WAAPI").downloadMedia({downloadMediaMetric:f,handleMediaPreviewBeforeDownload:d("MAWHandleMediaPreviewBeforeDownloadApi").handleMediaPreviewBeforeDownload,handleMediaPreviewDownload:z,handleMediaPreviewDownloadFailed:d("MAWHandleMediaPreviewDownloadAsFailedApi").handleMediaPreviewDownloadFailed,hash:e,mediaEntry:g,protocolMsgId:h,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg});f.addPoint("maw_post_download_start");if(z.success===!1){var B=g.objectId;g=g.serverMediaType;var C=d("MAWCastToMsgrServerMediaType").castToMsgrServerMediaType(g);c("MAWEBSwitch").isEnabled()&&d("WAIsMediaExpiredError").isMediaExpiredError(z.error)&&B!=null&&C!=null?(F.LOG(t(),A,a),void d("MAWGetMsgByProtocolIdApi").getMsgsByProtocolMsgIdsTxn([h]).then(function(a){a=a[0]||{};a=a.sortOrderMs;if(a==null){f.addPoint("resign_cdn_url_missing_sort_order");return}var c=d("WAMediaUtils").stringToDeliveryObjectId(B),g=f.getFlowDetails().instanceKey.toString(),i={string:{externalId:h.externalId,mediaType:C,objectId:c,restoreEntry:"downloadAndHandleMedia",restoreMethod:b("cr:10071")==null?"sproc":"gql"}};f.addPoint("resign_cdn_url_start",i);var j="hash: "+d("WAHashUtils").sanitisePlaintextHash(e)+". msgId: "+A+". traceId: "+g;if(b("cr:10071")!==null)F.LOG(s(),j),f.addPoint("resign_cdn_url_gql_start"),void b("cr:10071").eblsResignCdnUrlWithGraphQL({chatJid:h.chat,deliveryObjectId:c,externalId:h.externalId,mediaType:C,sortOrderMs:a}).then(function(a){if(a.success===!1){a.error==="direct-path-undefined"?Q(e,a.error):R(e,a.error);F.LOG(r(),a.error,j);f.endFail(a.error,{string:{failReason:a.error}});return}F.LOG(q(),j);f.addPoint("resign_cdn_url_gql_success");a=d("MAWJobDefinitions").createStartJobInfo("downloadAndRestoreMedia",{deliveryObjectId:c,mediaDownloadFlow:f,msgId:A,plaintextHash:e,restorationCdnUrl:a.value,scheduleConfig:{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},traceId:f.getFlowDetails().instanceKey});f.addPoint("download_and_restore_media_fire");return d("MAWJobManager").getJobManager().fireAndForget(a)})["catch"](function(a){Q(e,"resign_gql_"+a),F.ERROR(p(),a,j),f.endFail("runtime-error",{string:{failReason:a.toString()}})});else{F.LOG(o(),j);f.addPoint("resign_cdn_url_sproc_start");i={attachmentObjectId:c,mediaType:C,messageId:h.externalId,messageTimeStamp:a,msgId:A,plaintextHash:e,productType:d("MAWConfig").getConfig().productTypeForEBAttachments,threadId:d("WAJids").threadIdForChatJid(h.chat),threadJid:h.chat};void d("MAWHandleEchoMediaMsgsRestoreV2").invokeRestoreAccessCheckSprocToDownloadAttachment(h.externalId,i,f)}})["catch"](function(a){Q(e,"resign_sproc_"+a),F.ERROR(n(),a),f.endFail("resign_cdn_url_fail",{string:{failReason:a.toString()}})})):(d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:z.error,hash:e,status:d("MAWMediaDownloadStatusForUI").getStatusFromWAAPIDownloadMediaError(z.error),type:"main"}),f.endFail("maw_post_download_fail",{string:{failReason:z.error}}),F.EXPECTED_ERROR(m(),A,z.error),yield M(A));return}z.success;g=z.value;a=g.mimeType;z=g.plaintext;g=d("WAIsWebP").isWebP(new Uint8Array(z))||d("WAIsMp4").isMp4(new Uint8Array(z))||d("WAParseWav").validateWav(z)!=null&&c("gkx")("8785");var D=null;if(g){D=(yield d("WAValidateMedia").validateMedia(z,f));if(D.success===!1){f.endFail(D.error,{string:{failReason:D.error}});F.LOG(l(),A);F.ERROR(k(),D.error);yield M(A);d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:D.error,hash:e,status:c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE,type:"main",validationResult:{audioAvgBitsPerSecond:null,audioNumberOfChannels:null,audioSamplingRate:null,audioStreamType:null,validatedMimeType:D.error,videoAvgBitsPerSecond:null,videoCalculatedFps:null,videoDuration:null,videoHeight:null,videoNominalFps:null,videoStreamType:null,videoWidth:null}});return}g=D.value;var E=g.audioStreamReport,H=g.mimeType,I=g.skipValidation;g.validatedPlaintext;var J=g.validationSetupFailed;g=g.videoStreamReport;F.LOG(j(),I,J);F.DEV(i(),E,g);d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"media_validation_success",hash:e,status:c("MAWMediaDownloadStatus").DOWNLOADING,type:"main",validationResult:d("MAWVideoAudioValidationUtils").normalizeValidationResult({audioAvgBitsPerSecond:E==null?void 0:E.avgBitsPerSecond,audioNumberOfChannels:E==null?void 0:E.numberOfChannels,audioSamplingRate:E==null?void 0:E.samplingRate,audioStreamType:E==null?void 0:E.streamType,validatedMimeType:H,videoAvgBitsPerSecond:g==null?void 0:g.avgBitsPerSecond,videoCalculatedFps:g==null?void 0:g.calculatedFps,videoDuration:g==null?void 0:g.duration,videoHeight:g==null?void 0:g.videoHeight,videoNominalFps:g==null?void 0:g.nominalFps,videoStreamType:g==null?void 0:g.streamType,videoWidth:g==null?void 0:g.videoWidth})})}I=z;f.addPoint("handle_media_download_start");E=(yield d("MAWHandleMediaDownloadApi").handleMediaDownload(e,a,I,h,(J=D)==null?void 0:J.value));if(E.success){f.addPoint("handle_media_download_end");P(e,(H=D)==null?void 0:H.value)}else f.addPoint("maw_post_download_fail"),f.endFail("handle_media_download_fail_"+E.error,{string:{failReason:E.error}}),Q(e,E.error);f.addPoint("maw_post_download_end");f.endSuccess()});return L.apply(this,arguments)}function M(a){return N.apply(this,arguments)}function N(){N=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(c("gkx")("4219")&&c("justknobx")._("2092"))return;if(c("gkx")("2943"))return;yield d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY,media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READWRITE,receiverFetchInfo:d("MAWTransactionMode").READONLY,xma:d("MAWTransactionMode").READONLY},"downloadMedia",function(a){return function(b,c){return d("MAWDbMsgTxns").updateSystemAck(a,b,c)}})(a,d("MAWAckLevel").ACK.failed)});return N.apply(this,arguments)}function O(a,b){d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:b,hash:a,status:c("MAWMediaDownloadStatus").DOWNLOADING,type:"main"})}function P(a,b){b=(b=b)!=null?b:{};var e=b.audioStreamReport,f=b.mimeType;b=b.videoStreamReport;d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:"handle_media_download_end",hash:a,status:c("MAWMediaDownloadStatus").SUCCESS,type:"main",validationResult:d("MAWVideoAudioValidationUtils").normalizeValidationResult({audioAvgBitsPerSecond:e==null?void 0:e.avgBitsPerSecond,audioNumberOfChannels:e==null?void 0:e.numberOfChannels,audioSamplingRate:e==null?void 0:e.samplingRate,audioStreamType:e==null?void 0:e.streamType,validatedMimeType:f,videoAvgBitsPerSecond:b==null?void 0:b.avgBitsPerSecond,videoCalculatedFps:b==null?void 0:b.calculatedFps,videoDuration:b==null?void 0:b.duration,videoHeight:b==null?void 0:b.videoHeight,videoNominalFps:b==null?void 0:b.nominalFps,videoStreamType:b==null?void 0:b.streamType,videoWidth:b==null?void 0:b.videoWidth})})}function Q(a,b){d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:b,hash:a,status:c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,type:"main"})}function R(a,b){d("MAWMediaDownloadStatusForUI").sendMediaDownloadStatusToUI({details:b,hash:a,status:c("MAWMediaDownloadStatus").NOT_MANUAL_RETRYABLE_FAILURE,type:"main"})}function S(a){switch(a){case"UILayout":return d("WAMediaManager").MediaTaskPriority.HIGH;case"MebWAMediaDownloader":case"InstamadilloAddMessageMediaContent":case"MAWDyiDownloadMedia":case"WAIncomingMsg":return d("WAMediaManager").MediaTaskPriority.MEDIUM;case"MAWHandleFutureproofMsg":case"handleEchoMediaMsgsRestore":case"SyncMedia":case"EBRestore":return d("WAMediaManager").MediaTaskPriority.LOW}}g.downloadAndHandleMedia=a;g.downloadAndHandleMediaImpl=H}),98);
__d("MAWFTSIsMessageValidForSearch",["MAWMsgType"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return a.ephemeralSetting!=null&&a.ephemeralSetting.ephemeralExpirationInSec>0}function a(a){var b=a.msgContent,c=a.sortOrderMs,e=a.type;b=b==null?void 0:b.content;if(b==null||c==null)return null;if(e!==d("MAWMsgType").MSG_TYPE.TEXT&&e!==d("MAWMsgType").MSG_TYPE.XMA)return null;return h(a)?null:{content:b,sortOrderMs:c}}g.verifyMessageValidity=a}),98);
__d("MAWBridgeSearchMsg",["MAWCurrentUser","MAWDbMsg","MAWFTSIsMessageValidForSearch","MAWVault","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){var e;c===void 0&&(c=!0);var f=d("MAWFTSIsMessageValidForSearch").verifyMessageValidity(a);if(f==null)return null;var g=d("MAWCurrentUser").getID(),h=a.author,i=a.externalId,j=a.msgId;e=(e=a.threadJid)!=null?e:b;if(e==null)return null;b=f.content;f=f.sortOrderMs;e={chatJid:e,externalId:i,msg:{msgId:j,sender:d("WAJids").authorToUserId(h,g),ts:d("MAWDbMsg").getCanonicalTsFromMsg(a)},sortOrderMs:f};i=b;return babelHelpers["extends"]({},e,{msg:babelHelpers["extends"]({},e.msg,{content:i!=null?d("MAWVault").isVaulted(i)?c?i:d("MAWVault").unvault(i):c?d("MAWVault").vault(i):i:void 0})})}b="message_content_search";c="non_message_content_search";g.createBridgeSearchMsg=a;g.MESSAGE_CONTENT_SEARCH=b;g.NON_MESSAGE_CONTENT_SEARCH=c}),98);
__d("WAFtsTokenizerBaseNormalizer",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){var b=this,c=[];this.$1=new Map();a.forEach(function(a){var d=a[0];a=a[1];b.$1.set(d,a);c.push(d)});this.$2=new RegExp(c.join("|"),"g")}var b=a.prototype;b.normalize=function(a){var b=this;a===void 0&&(a="");return a.replace(this.$2,function(a){var c=b.$1.get(a);return c!=null?c:a})};return a}();f["default"]=a}),66);
__d("WAFtsTokenizerPostLowercaseNormalizer",["WAFtsTokenizerBaseNormalizer"],(function(a,b,c,d,e,f,g){"use strict";a=[["\u0131","i"],["\u0629","\u0647"],["\u0640",""],["\u0649","\u064a"],["\u0671","\u0627"],["\u06a4","\u0641"],["\u06a9","\u0643"],["\u06ba","\u0646"],["\u06be","\u0647"],["\u06c3","\u06c2"],["\u06cc","\u064a"],["\u06d2","\u064a"],["\u06d5","\u0647"],["\u06f0","\u0660"],["\u06f1","\u0661"],["\u06f2","\u0662"],["\u06f3","\u0663"],["\u06f4","\u0664"],["\u06f5","\u0665"],["\u06f6","\u0666"],["\u06f7","\u0667"],["\u06f8","\u0668"],["\u06f9","\u0669"],["\u08bb","\u0641"],["\u08bc","\u0642"],["\u08bd","\u0646"],["\u200c",""],["\u0966","0"],["\u0967","1"],["\u0968","2"],["\u0969","3"],["\u096a","4"],["\u096b","5"],["\u096c","6"],["\u096d","7"],["\u096e","8"],["\u096f","9"],["\u0901","\u0902"],["\u0903",""],["\u093c",""],["\u09e6","0"],["\u09e7","1"],["\u09e8","2"],["\u09e9","3"],["\u09ea","4"],["\u09eb","5"],["\u09ec","6"],["\u09ed","7"],["\u09ee","8"],["\u09ef","9"],["\u0a66","0"],["\u0a67","1"],["\u0a68","2"],["\u0a69","3"],["\u0a6a","4"],["\u0a6b","5"],["\u0a6c","6"],["\u0a6d","7"],["\u0a6e","8"],["\u0a6f","9"],["\u0c66","0"],["\u0c67","1"],["\u0c68","2"],["\u0c69","3"],["\u0c6a","4"],["\u0c6b","5"],["\u0c6c","6"],["\u0c6d","7"],["\u0c6e","8"],["\u0c6f","9"],["\u0ae6","0"],["\u0ae7","1"],["\u0ae8","2"],["\u0ae9","3"],["\u0aea","4"],["\u0aeb","5"],["\u0aec","6"],["\u0aed","7"],["\u0aee","8"],["\u0aef","9"],["\u0ce6","0"],["\u0ce7","1"],["\u0ce8","2"],["\u0ce9","3"],["\u0cea","4"],["\u0ceb","5"],["\u0cec","6"],["\u0ced","7"],["\u0cee","8"],["\u0cef","9"],["\u0d66","0"],["\u0d67","1"],["\u0d68","2"],["\u0d69","3"],["\u0d6a","4"],["\u0d6b","5"],["\u0d6c","6"],["\u0d6d","7"],["\u0d6e","8"],["\u0d6f","9"],["\u0142","l"]];b=new(c("WAFtsTokenizerBaseNormalizer"))(a);d=b;g["default"]=d}),98);
__d("WAFtsTokenizerPreNFKDNormalizer",["WAFtsTokenizerBaseNormalizer"],(function(a,b,c,d,e,f,g){"use strict";a=[["\u0675","\u0674\u0627"],["\u0676","\u0674\u0648"],["\u0677","\u0674\u06c7"],["\u0678","\u0674\u0649"],["\u0905\u0946","\u0904"],["\u0905\u093e","\u0906"],["\u0930\u094d\u0907","\u0908"],["\u0909\u0941","\u090a"],["\u090f\u0945","\u090d"],["\u090f\u0946","\u090e"],["\u090f\u0947","\u0910"],["\u0905\u0949","\u0911"],["\u0906\u0945","\u0911"],["\u0905\u094a","\u0912"],["\u0906\u0946","\u0912"],["\u0905\u094b","\u0913"],["\u0906\u0947","\u0913"],["\u0905\u094c","\u0914"],["\u0906\u0948","\u0914"],["\u0905\u0945","\u0972"],["\u0905\u093a","\u0973"],["\u0905\u093b","\u0974"],["\u0906\u093a","\u0974"],["\u0905\u094f","\u0975"],["\u0905\u0956","\u0976"],["\u0905\u0957","\u0977"],["\u0985\u09be","\u0986"],["\u098b\u09c3","\u09e0"],["\u098c\u09e2","\u09e1"],["\u0a05\u0a3e","\u0a06"],["\u0a72\u0a3f","\u0a07"],["\u0a72\u0a40","\u0a08"],["\u0a73\u0a41","\u0a09"],["\u0a73\u0a42","\u0a0a"],["\u0a72\u0a47","\u0a0f"],["\u0a05\u0a48","\u0a10"],["\u0a73\u0a4b","\u0a13"],["\u0a05\u0a4c","\u0a14"],["\u0a85\u0abe","\u0a86"],["\u0a85\u0ac5","\u0a8d"],["\u0a85\u0ac7","\u0a8f"],["\u0a85\u0ac8","\u0a90"],["\u0a85\u0ac9","\u0a91"],["\u0a85\u0acb","\u0a93"],["\u0a85\u0abe\u0ac5","\u0a93"],["\u0a85\u0acc","\u0a94"],["\u0a85\u0abe\u0ac8","\u0a94"],["\u0ac5\u0abe","\u0ac9"],["\u0b05\u0b3e","\u0b06"],["\u0b0f\u0b57","\u0b10"],["\u0b13\u0b57","\u0b14"],["\u0bb8\u0bcd\u0bb0\u0bc0","\u0bb6\u0bcd\u0bb0\u0bc0"],["\u0c12\u0c55","\u0c13"],["\u0c12\u0c4c","\u0c14"],["\u0c3f\u0c55","\u0c40"],["\u0c46\u0c55","\u0c47"],["\u0c4a\u0c55","\u0c4b"],["\u0c89\u0cbe","\u0c8a"],["\u0c92\u0ccc","\u0c94"],["\u0c8b\u0cbe","\u0ce0"],["\u0d07\u0d57","\u0d08"],["\u0d09\u0d57","\u0d0a"],["\u0d0e\u0d46","\u0d10"],["\u0d12\u0d3e","\u0d13"],["\u0d12\u0d57","\u0d14"],["\u0d23\u0d4d\u200d","\u0d7a"],["\u0d28\u0d4d\u200d","\u0d7b"],["\u0d30\u0d4d\u200d","\u0d7c"],["\u0d32\u0d4d\u200d","\u0d7d"],["\u0d33\u0d4d\u200d","\u0d7e"],["\u0d85\u0dcf","\u0d86"],["\u0d85\u0dd0","\u0d87"],["\u0d85\u0dd1","\u0d88"],["\u0d8b\u0ddf","\u0d8c"],["\u0d8d\u0dd8","\u0d8e"],["\u0d8f\u0ddf","\u0d90"],["\u0d91\u0dca","\u0d92"],["\u0d91\u0dd9","\u0d93"],["\u0d94\u0ddf","\u0d96"]];b=new(c("WAFtsTokenizerBaseNormalizer"))(a);d=b;g["default"]=d}),98);
__d("WAFtsMultiLangTokenizer",["WAFtsTokenizerPostLowercaseNormalizer","WAFtsTokenizerPreNFKDNormalizer"],(function(a,b,c,d,e,f,g){"use strict";var h={NFC_CHARACTER:/(?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u3005\u3007\u3021-\u3029\u3030\u3038-\u303B\u303D\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u31F0-\u31FF\u3297\u3299\u32D0-\u32FE\u3300-\u3357\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFF66-\uFF6F\uFF71-\uFF9D]|\uD81B[\uDFF0\uDFF1]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDED5-\uDED7\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEFC\uDFE0-\uDFEB]|\uD83E[\uDD0C-\uDD3A\uDD3C-\uDD45\uDD47-\uDD78\uDD7A-\uDDCB\uDDCD-\uDDFF\uDE70-\uDE74\uDE78-\uDE7A\uDE80-\uDE86\uDE90-\uDEA8\uDEB0-\uDEB6\uDEC0-\uDEC2\uDED0-\uDED6]|[\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])/g,NFC_WORD:/((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1100-\u11FF\u302E\u302F\u3131-\u318E\u3200-\u321E\u3260-\u327E\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0E01-\u0E3A\u0E40-\u0E5B])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u0F00-\u0F47\u0F49-\u0F6C\u0F71-\u0F97\u0F99-\u0FBC\u0FBE-\u0FCC\u0FCE-\u0FD4\u0FD9\u0FDA])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1000-\u109F\uA9E0-\uA9FE\uAA60-\uAA7F])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u1780-\u17DD\u17E0-\u17E9\u17F0-\u17F9\u19E0-\u19FF])+|((?!(?:[0-9\xB2\xB3\xB9\xBC-\xBE\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u09F4-\u09F9\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0B72-\u0B77\u0BE6-\u0BF2\u0C66-\u0C6F\u0C78-\u0C7E\u0CE6-\u0CEF\u0D58-\u0D5E\u0D66-\u0D78\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F33\u1040-\u1049\u1090-\u1099\u1369-\u137C\u16EE-\u16F0\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1946-\u194F\u19D0-\u19DA\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2CFD\u3007\u3021-\u3029\u3038-\u303A\u3192-\u3195\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\uA620-\uA629\uA6E6-\uA6EF\uA830-\uA835\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]|\uD800[\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDEE1-\uDEFB\uDF20-\uDF23\uDF41\uDF4A\uDFD1-\uDFD5]|\uD801[\uDCA0-\uDCA9]|\uD802[\uDC58-\uDC5F\uDC79-\uDC7F\uDCA7-\uDCAF\uDCFB-\uDCFF\uDD16-\uDD1B\uDDBC\uDDBD\uDDC0-\uDDCF\uDDD2-\uDDFF\uDE40-\uDE48\uDE7D\uDE7E\uDE9D-\uDE9F\uDEEB-\uDEEF\uDF58-\uDF5F\uDF78-\uDF7F\uDFA9-\uDFAF]|\uD803[\uDCFA-\uDCFF\uDD30-\uDD39\uDE60-\uDE7E\uDF1D-\uDF26\uDF51-\uDF54\uDFC5-\uDFCB]|\uD804[\uDC52-\uDC6F\uDCF0-\uDCF9\uDD36-\uDD3F\uDDD0-\uDDD9\uDDE1-\uDDF4\uDEF0-\uDEF9]|\uD805[\uDC50-\uDC59\uDCD0-\uDCD9\uDE50-\uDE59\uDEC0-\uDEC9\uDF30-\uDF3B]|\uD806[\uDCE0-\uDCF2\uDD50-\uDD59]|\uD807[\uDC50-\uDC6C\uDD50-\uDD59\uDDA0-\uDDA9\uDFC0-\uDFD4]|\uD809[\uDC00-\uDC6E]|\uD81A[\uDE60-\uDE69\uDF50-\uDF59\uDF5B-\uDF61]|\uD81B[\uDE80-\uDE96]|\uD834[\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDFCE-\uDFFF]|\uD838[\uDD40-\uDD49\uDEF0-\uDEF9]|\uD83A[\uDCC7-\uDCCF\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]))[\u02EA\u02EB\u3105-\u312F\u31A0-\u31BF])+/g},i=/(?![\u0902\u094D])(?:[\^`\xA8\xAF\xB4\xB7\xB8\u02B0-\u034E\u0350-\u0357\u035D-\u0362\u0374\u0375\u037A\u0384\u0385\u0483-\u0487\u0559\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u064B-\u0652\u0657\u0658\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F5\u0818\u0819\u08E3-\u08FE\u093C\u094D\u0951-\u0954\u0971\u09BC\u09CD\u0A3C\u0A4D\u0ABC\u0ACD\u0AFD-\u0AFF\u0B3C\u0B4D\u0B55\u0BCD\u0C4D\u0CBC\u0CCD\u0D3B\u0D3C\u0D4D\u0DCA\u0E47-\u0E4C\u0E4E\u0EBA\u0EC8-\u0ECC\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F82-\u0F84\u0F86\u0F87\u0FC6\u1037\u1039\u103A\u1063\u1064\u1069-\u106D\u1087-\u108D\u108F\u109A\u109B\u135D-\u135F\u17C9-\u17D3\u17DD\u1939-\u193B\u1A75-\u1A7C\u1A7F\u1AB0-\u1ABD\u1B34\u1B44\u1B6B-\u1B73\u1BAA\u1BAB\u1C36\u1C37\u1C78-\u1C7D\u1CD0-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1D2C-\u1D6A\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1DFF\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u2CEF-\u2CF1\u2E2F\u302A-\u302F\u3099-\u309C\u30FC\uA66F\uA67C\uA67D\uA67F\uA69C\uA69D\uA6F0\uA6F1\uA700-\uA721\uA788-\uA78A\uA7F8\uA7F9\uA8C4\uA8E0-\uA8F1\uA92B-\uA92E\uA953\uA9B3\uA9C0\uA9E5\uAA7B-\uAA7D\uAABF-\uAAC2\uAAF6\uAB5B-\uAB5F\uAB69-\uAB6B\uABEC\uABED\uFB1E\uFE20-\uFE2F\uFF3E\uFF40\uFF70\uFF9E\uFF9F\uFFE3]|\uD800\uDEE0|\uD802[\uDEE5\uDEE6]|\uD803[\uDD22-\uDD27\uDF46-\uDF50]|\uD804[\uDCB9\uDCBA\uDD33\uDD34\uDD73\uDDC0\uDDCA-\uDDCC\uDE35\uDE36\uDEE9\uDEEA\uDF3C\uDF4D\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC42\uDC46\uDCC2\uDCC3\uDDBF\uDDC0\uDE3F\uDEB6\uDEB7\uDF2B]|\uD806[\uDC39\uDC3A\uDD3D\uDD3E\uDD43\uDDE0\uDE34\uDE47\uDE99]|\uD807[\uDC3F\uDD42\uDD44\uDD45\uDD97]|\uD81A[\uDEF0-\uDEF4\uDF30-\uDF36]|\uD81B[\uDF8F-\uDF9F\uDFF0\uDFF1]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD]|\uD838[\uDD30-\uDD36\uDEEC-\uDEEF]|\uD83A[\uDCD0-\uDCD6\uDD44-\uDD46\uDD48-\uDD4A])+/g,j=/(?:[!-#%-\/:-@\[-`\{-~\xA1\xA7\xA8\xAB\xAC\xAF\xB1\xB4\xB6-\xB8\xBB\xBF\xD7\xF7\u02C2-\u02C5\u02D2-\u02DF\u02E5-\u02EB\u02ED\u02EF-\u02FF\u0375\u037E\u0384\u0385\u0387\u03F6\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0606-\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u1FBD\u1FBF-\u1FC1\u1FCD-\u1FCF\u1FDD-\u1FDF\u1FED-\u1FEF\u1FFD\u1FFE\u200D\u2010-\u2027\u2030-\u205E\u207A-\u207E\u208A-\u208E\u2118\u2140-\u2144\u214B\u2190-\u2194\u219A\u219B\u21A0\u21A3\u21A6\u21AE\u21CE\u21CF\u21D2\u21D4\u21F4-\u22FF\u2308-\u230B\u2320\u2321\u2329\u232A\u237C\u239B-\u23B3\u23DC-\u23E1\u25B7\u25C1\u25F8-\u25FF\u266F\u2768-\u2775\u27C0-\u27FF\u2900-\u2AFF\u2B30-\u2B44\u2B47-\u2B4C\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u309B\u309C\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA700-\uA716\uA720\uA721\uA789\uA78A\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uAB5B\uAB6A\uAB6B\uABEB\uFB29\uFBB2-\uFBC1\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0F\uFF1A-\uFF20\uFF3B-\uFF40\uFF5B-\uFF65\uFFE2\uFFE3\uFFE9-\uFFEC]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD835[\uDEC1\uDEDB\uDEFB\uDF15\uDF35\uDF4F\uDF6F\uDF89\uDFA9\uDFC3]|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]|\uD83B[\uDEF0\uDEF1]|\uD83C[\uDFFB-\uDFFF])/g,k=/(^|(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]))((?:[0-9A-Z\^`-z\xA8\xAA\xAF\xB2-\xB5\xB7-\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u034E\u0350-\u0357\u035D-\u0362\u0370-\u0377\u037A-\u037D\u037F\u0384-\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u05D0-\u05EA\u05EF-\u05F2\u0620-\u0652\u0657\u0658\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u06EE-\u06FC\u06FF\u0710\u0712-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u0815\u0818-\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08E3-\u08FE\u0904-\u0939\u093C\u093D\u094D\u0950-\u0954\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC\u09BD\u09CD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A4D\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC\u0ABD\u0ACD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0AFD-\u0AFF\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C\u0B3D\u0B4D\u0B55\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BCD\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C4D\u0C58-\u0C5A\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC\u0CBD\u0CCD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3D\u0D4D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E4C\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBA\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECC\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F33\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F82-\u0F84\u0F86-\u0F8C\u0FC6\u1000-\u102A\u1037\u1039\u103A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1063-\u1066\u1069-\u1070\u1075-\u1081\u1087-\u109B\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17C9-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1939-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A75-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B05-\u1B34\u1B44-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B83-\u1BA0\u1BAA\u1BAB\u1BAE-\u1BE5\u1C00-\u1C23\u1C36\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CFA\u1D00-\u1DBF\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA67C\uA67D\uA67F-\uA69D\uA6A0-\uA6F1\uA700-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA92B-\uA92E\uA930-\uA946\uA953\uA960-\uA97C\uA984-\uA9B3\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAABF-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB6B\uAB70-\uABE2\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE20-\uFE2F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3E\uFF40-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE3]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE6\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD27\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF54\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC83-\uDCAF\uDCB9\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD33\uDD34\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD73\uDD76\uDD83-\uDDB2\uDDC0-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE35\uDE36\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEE9\uDEEA\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C\uDF3D\uDF4D\uDF50\uDF5D-\uDF61\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC34\uDC42\uDC46-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC2-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDBF\uDDC0\uDDD8-\uDDDB\uDE00-\uDE2F\uDE3F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB6-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF2B\uDF30-\uDF3B]|\uD806[\uDC00-\uDC2B\uDC39\uDC3A\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3D-\uDD3F\uDD41\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE34\uDE3A\uDE47\uDE50\uDE5C-\uDE89\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC3F\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD42\uDD44-\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD97\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD838[\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCD6\uDD00-\uDD46\uDD48-\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])+)[\"\'\xAB\xBB\u2018-\u201F\u2039\u203A\u2E42\u300C-\u300F\u301D-\u301F\uFE41-\uFE44\uFF02\uFF07\uFF62\uFF63]((?:[0-9A-Z\^`-z\xA8\xAA\xAF\xB2-\xB5\xB7-\xBA\xBC-\xBE\xC0-\xD6\xD8-\xF6\xF8-\u034E\u0350-\u0357\u035D-\u0362\u0370-\u0377\u037A-\u037D\u037F\u0384-\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05A1\u05A3-\u05BD\u05BF\u05C1\u05C2\u05C4\u05D0-\u05EA\u05EF-\u05F2\u0620-\u0652\u0657\u0658\u0660-\u0669\u066E\u066F\u0671-\u06D3\u06D5\u06DF\u06E0\u06E5\u06E6\u06EA-\u06EC\u06EE-\u06FC\u06FF\u0710\u0712-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u0815\u0818-\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u08E3-\u08FE\u0904-\u0939\u093C\u093D\u094D\u0950-\u0954\u0958-\u0961\u0966-\u096F\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC\u09BD\u09CD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09E6-\u09F1\u09F4-\u09F9\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A4D\u0A59-\u0A5C\u0A5E\u0A66-\u0A6F\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC\u0ABD\u0ACD\u0AD0\u0AE0\u0AE1\u0AE6-\u0AEF\u0AF9\u0AFD-\u0AFF\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C\u0B3D\u0B4D\u0B55\u0B5C\u0B5D\u0B5F-\u0B61\u0B66-\u0B6F\u0B71-\u0B77\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BCD\u0BD0\u0BE6-\u0BF2\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C4D\u0C58-\u0C5A\u0C60\u0C61\u0C66-\u0C6F\u0C78-\u0C7E\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC\u0CBD\u0CCD\u0CDE\u0CE0\u0CE1\u0CE6-\u0CEF\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3D\u0D4D\u0D4E\u0D54-\u0D56\u0D58-\u0D61\u0D66-\u0D78\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DE6-\u0DEF\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E4C\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBA\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECC\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F33\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F82-\u0F84\u0F86-\u0F8C\u0FC6\u1000-\u102A\u1037\u1039\u103A\u103F-\u1049\u1050-\u1055\u105A-\u105D\u1061\u1063-\u1066\u1069-\u1070\u1075-\u1081\u1087-\u109B\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u137C\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17C9-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u17F0-\u17F9\u1810-\u1819\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1939-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A16\u1A20-\u1A54\u1A75-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B05-\u1B34\u1B44-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B83-\u1BA0\u1BAA\u1BAB\u1BAE-\u1BE5\u1C00-\u1C23\u1C36\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CFA\u1D00-\u1DBF\u1DC4-\u1DCF\u1DF5-\u1DF9\u1DFD-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2070\u2071\u2074-\u2079\u207F-\u2089\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2150-\u2189\u2460-\u249B\u24EA-\u24FF\u2776-\u2793\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2CFD\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u3192-\u3195\u31A0-\u31BF\u31F0-\u31FF\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA67C\uA67D\uA67F-\uA69D\uA6A0-\uA6F1\uA700-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA830-\uA835\uA840-\uA873\uA882-\uA8B3\uA8C4\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA8FE\uA900-\uA925\uA92B-\uA92E\uA930-\uA946\uA953\uA960-\uA97C\uA984-\uA9B3\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAABF-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB6B\uAB70-\uABE2\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE20-\uFE2F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3E\uFF40-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\uFFE3]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD07-\uDD33\uDD40-\uDD78\uDD8A\uDD8B\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0-\uDEFB\uDF00-\uDF23\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC58-\uDC76\uDC79-\uDC9E\uDCA7-\uDCAF\uDCE0-\uDCF2\uDCF4\uDCF5\uDCFB-\uDD1B\uDD20-\uDD39\uDD80-\uDDB7\uDDBC-\uDDCF\uDDD2-\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE40-\uDE48\uDE60-\uDE7E\uDE80-\uDE9F\uDEC0-\uDEC7\uDEC9-\uDEE6\uDEEB-\uDEEF\uDF00-\uDF35\uDF40-\uDF55\uDF58-\uDF72\uDF78-\uDF91\uDFA9-\uDFAF]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDCFA-\uDD27\uDD30-\uDD39\uDE60-\uDE7E\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF27\uDF30-\uDF54\uDFB0-\uDFCB\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC52-\uDC6F\uDC83-\uDCAF\uDCB9\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD03-\uDD26\uDD33\uDD34\uDD36-\uDD3F\uDD44\uDD47\uDD50-\uDD73\uDD76\uDD83-\uDDB2\uDDC0-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDDE1-\uDDF4\uDE00-\uDE11\uDE13-\uDE2B\uDE35\uDE36\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDEE9\uDEEA\uDEF0-\uDEF9\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C\uDF3D\uDF4D\uDF50\uDF5D-\uDF61\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC34\uDC42\uDC46-\uDC4A\uDC50-\uDC59\uDC5F-\uDC61\uDC80-\uDCAF\uDCC2-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDAE\uDDBF\uDDC0\uDDD8-\uDDDB\uDE00-\uDE2F\uDE3F\uDE44\uDE50-\uDE59\uDE80-\uDEAA\uDEB6-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF2B\uDF30-\uDF3B]|\uD806[\uDC00-\uDC2B\uDC39\uDC3A\uDCA0-\uDCF2\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3D-\uDD3F\uDD41\uDD43\uDD50-\uDD59\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE34\uDE3A\uDE47\uDE50\uDE5C-\uDE89\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC3F\uDC40\uDC50-\uDC6C\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD42\uDD44-\uDD46\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD97\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF2\uDFB0\uDFC0-\uDFD4]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF5B-\uDF61\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE96\uDF00-\uDF4A\uDF50\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3\uDFF0\uDFF1]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD834[\uDD67-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDEE0-\uDEF3\uDF60-\uDF78]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD838[\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCC7-\uDCD6\uDD00-\uDD46\uDD48-\uDD4B\uDD50-\uDD59]|\uD83B[\uDC71-\uDCAB\uDCAD-\uDCAF\uDCB1-\uDCB4\uDD01-\uDD2D\uDD2F-\uDD3D\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD83C[\uDD00-\uDD0C]|\uD83E[\uDFF0-\uDFF9]|\uD869[\uDC00-\uDEDD\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])+)($|(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]))/g,l=/(?:[\t\n\r -#%-\*,-\/:;\?@\[-\]_\{\}\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD803[\uDEAD\uDF55-\uDF59]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC8\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5A\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD806[\uDC3B\uDD44-\uDD46\uDDE2\uDE3F-\uDE46\uDE9A-\uDE9C\uDE9E-\uDEA2]|\uD807[\uDC41-\uDC45\uDC70\uDC71\uDEF7\uDEF8\uDFFF]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD81B[\uDE97-\uDE9A\uDFE2]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F])+/g,m=/(?:[\$\xA2-\xA5\u058F\u060B\u07FE\u07FF\u09F2\u09F3\u09FB\u0AF1\u0BF9\u0E3F\u17DB\u20A0-\u20BF\uA838\uFDFC\uFE69\uFF04\uFFE0\uFFE1\uFFE5\uFFE6]|\uD807[\uDFDD-\uDFE0]|\uD838\uDEFF|\uD83B\uDCB0)+/g;function n(a){return a.replace(k,function(a,b,c,d,e){return" "+c+d+" "+c+" "+d+" "})}function o(a){return a.split(l)}function p(a){return a.replace(j,"")}function q(a){return a.replace(i,"")}function r(a){return a.normalize("NFC").replace(h.NFC_CHARACTER,function(a){return" "+a+" "})}function s(a){return a.normalize("NFC").replace(h.NFC_WORD,function(a){return" "+a+" "})}function t(a){return a.replace(m,function(a){return" "+a+" "})}a=function(){function a(){}var b=a.prototype;b.tokenize=function(a){a===void 0&&(a="");a=n(a);a=t(r(s(a)));a=o(a);a=a.map(function(a){a=a;a=p(a);if(!a.length)return a;else a.match(h.NFC_CHARACTER)?a=a.normalize("NFC"):a.match(h.NFC_WORD)?a=a.normalize("NFC"):(a=q(c("WAFtsTokenizerPreNFKDNormalizer").normalize(a).normalize("NFKD")),a=a.toLocaleLowerCase("en-US"),a=c("WAFtsTokenizerPostLowercaseNormalizer").normalize(a));return a});return new Set(a.filter(function(a){return!!a&&!!a.trim()&&!a.match(l)}))};return a}();g["default"]=a}),98);
__d("MAWGetDownloadableThumbnailForMediaApi",["MAWOptimisticUploadManager","WALogger","WAMediaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["GetDownloadableThumbnail - previewEntry optimistedPromise rejected with ",""]);h=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a);if(a==null)return null;a=a.previewPlaintextHash;if(a==null)return null;var b=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a);if(b==null)return null;try{yield b.optimisticUploadPromise}catch(a){d("WALogger").ERROR(h(),a);return null}a=(b=d("MAWOptimisticUploadManager").getOptimisticUploadManager().get(a))==null?void 0:b.mediaEntry;if(a==null)return null;b=d("WAMediaUtils").decodeMediaEntryData(a);a=b.directPath;var c=b.fileEncSha256,e=b.fileSha256,f=b.mediaKey,g=b.mediaKeyTimestamp;b=b.objectId;return{directPath:a,fileEncSha256:c,fileSha256:e,mediaKey:f,mediaKeyTimestamp:g,objectId:b}});return function(b){return a.apply(this,arguments)}}();g.getDownloadableThumbnailForMedia=a}),98);
__d("MAWGetMediaPlaintextApi",["MAWIndexedDb","MAWMediaUtils","MAWOptimisticUploadManager","MAWTransactionMode","Promise","WALogger"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media blob does not exist for the given hashedPlaintextHash"]);i=function(){return a};return a}a=function(a){var c=d("MAWOptimisticUploadManager").getOptimisticUploadManager();c=c.get(a);if(c==null)return j(a);else return(h||(h=b("Promise"))).resolve(c.file)};function j(a){return d("MAWIndexedDb").makeMsgrTransactor({chunk:d("MAWTransactionMode").READONLY},"getMediaPlaintextFromDb",function(a){return function(b){b=d("MAWMediaUtils").genHMACPlaintextHash(b);return a.chunk.where("hashedPlaintextHash").equals(b).first().then(function(a){if(!a){d("WALogger").WARN(i());return null}return new Blob([a.blobData],{type:a.mimetype})})}})(a)}g.getMediaPlaintext=a}),98);
__d("MAWGetMediaKnownEntriesApi",["MAWDbMediaTxns","MAWDbMsgTxns","MAWDexieTable","MAWIndexedDb","MAWTransactionMode","WAHashUtils","WAJids","WAMsgMap","WAResultOrError","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Message missing in messages table for given msgId for plaintextHash ",". Skipping..."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for plaintextHash ",". Returning new MsgMap."]);i=function(){return a};return a}var j=d("WATagsLogger").TAGS(["GetMediaKnownEntries"]);a=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY},"getMediaKnownEntries",function(a){return function(b){return k(a,b)}});function k(a,b){return d("MAWDbMediaTxns").maybeGetMediaFromPlaintextHash(a,b).then(function(c){if(!c){j.LOG(i(),d("WAHashUtils").sanitisePlaintextHash(b));return d("WAResultOrError").makeError("no-media-entry-by-plaintext-hash")}var e=Array.from(c.mediaEntries.keys());return d("MAWDexieTable").dexieAll(e.map(function(b){return d("MAWDbMsgTxns").maybeGetMsgListByMsgId_I_KNOW_WHAT_I_AM_DOING(a,b)})).then(function(a){a=a.map(function(a){return a.find(function(a){return(a==null?void 0:a.mediaId)===c.mediaId})});var f=[];a=a.reduce(function(a,g,i){if(!g){j.WARN(h(),d("WAHashUtils").sanitisePlaintextHash(b));f.push(e[i]);return a}i=c.mediaEntries.get(g.msgId);var k=g.author,l=g.threadJid;i&&!d("WAJids").isAuthorSystem(k)&&l!=null&&a.set({author:k,chat:l,externalId:g.externalId},i);return a},new(d("WAMsgMap").MsgMap)());return{missingMessages:f,msgMap:a,numEntries:e.length}}).then(d("WAResultOrError").makeResult)})}g.getMediaKnownEntries=a;g.getMediaKnownEntriesTxn=k}),98);
__d("MAWGetOrCreateMediaKnownEntriesApi",["MAWGetMediaKnownEntriesApi","MAWIndexedDb","MAWTransactionMode","WAMsgMap"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({media:d("MAWTransactionMode").READONLY,messages:d("MAWTransactionMode").READONLY},"getOrCreateMediaKnownEntries",function(a){return function(b){return d("MAWGetMediaKnownEntriesApi").getMediaKnownEntriesTxn(a,b).then(function(a){if(a.success===!1)return new(d("WAMsgMap").MsgMap)();else return a.value.msgMap})}});g.getOrCreateMediaKnownEntries=a}),98);
__d("MAWStartMediaUploadQplFlow",["WAGetStorageQplAnnotations","WAJids","WAMediaQplHelper","WAPREList","WAPREMetrics","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.chatJid,e=a.fileSize,f=a.serverMediaType;a=a.uploadEntry;var g=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.MEDIA_UPLOAD,{string:{chat_type:d("WAJids").switchOnMsgrChatJidType(b,{group:function(){return"group"},user:function(){return"user"}}),jid:b,media_size:d("WAMediaQplHelper").convertIntegerSizeToStringBucket(e),media_type:f,upload_entry:a}},void 0);c("promiseDone")(d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){g.addAnnotations(a)}));return g}g.startMediaUploadQplFlow=a}),98);
__d("getProtocolMsgIdByMsgIdCommon",["MAWDexieTable","WAJids"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWDexieTable").dexieAll([a.messages.get({msgId:b}),a.unrenderedMessages.get({msgId:b}),a.reactions.get({reactionId:b})]).then(function(b){var c=b[0],e=b[1];b=b[2];if(b!=null)if(d("WAJids").isAuthorSystem(b.author))return null;else return{author:b.author,chat:b.threadJid,externalId:b.externalId};var f=c||e;return f==null?null:a.threads.get({jid:f.threadJid}).then(function(a){if(a==null)return null;return d("WAJids").isAuthorSystem(f.author)?null:{author:f.author,chat:a.jid,externalId:f.externalId}})})}g.getProtocolMsgIdByMsgIdCommon=a}),98);
__d("MAWGetProtocolMsgIdByMsgId",["MAWIndexedDb","MAWTransactionMode","getProtocolMsgIdByMsgIdCommon"],(function(a,b,c,d,e,f,g){"use strict";b=d("MAWIndexedDb").makeMsgrTransactor({messages:(a=d("MAWTransactionMode")).READONLY,reactions:a.READONLY,threads:a.READONLY,unrenderedMessages:a.READONLY},"getProtocolMsgByMsgId",function(a){return function(b){return d("getProtocolMsgIdByMsgIdCommon").getProtocolMsgIdByMsgIdCommon(a,b)}});g.getProtocolMsgIdByMsgId=b}),98);
__d("MAWUpdateMediaEntryForOptimisticUploadApi",["MAWGetProtocolMsgIdByMsgId","MAWOptimisticUploadManager","MAWUpdateMediaEntryForMsgApi","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f){var g=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),h=g.get(a),i=h==null?void 0:h.msgId,j=b();if(i!=null){i=(yield d("MAWGetProtocolMsgIdByMsgId").getProtocolMsgIdByMsgId(i));i&&(yield d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg(a,i,b,e,f))}else{if(!h)throw c("err")("Cannot update mediaEntry without both uploadEntry and msgId");g.set(a,babelHelpers["extends"]({},h,{mediaEntry:j}))}return});return function(b,c,d,e){return a.apply(this,arguments)}}();g.updateMediaEntryForOptimisticUpload=a}),98);
__d("MessengerInfraReport",["ErrorPubSub","MAWBridge","gkx","promiseDone","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i;b=i||d("react");var j=b.useEffect,k=b.useState,l=new Map(),m=function(){return c("gkx")("23390")},n=10;e=function(a,b,c){var d=l.get(a)||new Map(),e=d.get(c);b=babelHelpers["extends"]({},b,{latestTimestampMs:Date.now(),startTimestampMs:(e==null?void 0:e.startTimestampMs)!=null?e==null?void 0:e.startTimestampMs:Date.now()});d.set(c,babelHelpers["extends"]({},e,b));if(d.size>=n){c=n/2;for(var e=d.keys(),b=Array.isArray(e),f=0,e=b?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(b){if(f>=e.length)break;g=e[f++]}else{f=e.next();if(f.done)break;g=f.value}g=g;d["delete"](g);c--;if(c<=0)break}}l.set(a,d)};f=function(a,b){var c;if(!l.has(a))return;if(!((c=l.get(a))==null?void 0:c.has(b)))return;return(c=l.get(a))==null?void 0:c.get(b)};b=function(a,b){(a=l.get(a))==null?void 0:a["delete"](b)};function a(a){var b=a.shouldLog;a=k();var e=a[0],f=a[1];j(function(){if(m()||!b||!c("gkx")("6843"))return;c("promiseDone")(d("MAWBridge").getBridge().sendAndReceive("backend","getReportedQplEvents",{}),function(a){a=q(l,a);f(babelHelpers["extends"]({},o(a),p()))})},[b]);return e}function o(a){var b={},c=function(){if(e){if(f>=d.length)return"break";g=d[f++]}else{f=d.next();if(f.done)return"break";g=f.value}var a=g,c=a[0];a=a[1];a.forEach(function(a){b[c]||(b[c]=[]);var d=a.status==="START"?"UNFINISHED":a.status;b[c].push(babelHelpers["extends"]({},a,{durationMs:d==="UNFINISHED"?Date.now()-a.startTimestampMs:d==="SUCCESS"?void 0:a.latestTimestampMs-a.startTimestampMs,lastPoints:(a=a.lastPoints)==null?void 0:a.slice(-10).join(" -> "),status:d}))})};for(var d=a.entries(),e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;a=c();if(a==="break")break}return b}function p(){var a=new Set();(h||(h=c("ErrorPubSub"))).history.forEach(function(b){(b.type==="fatal"||b.type==="error")&&a.add(b.messageFormat)});return{errors:Array.from(a)}}function q(a,b){var c=new Map();a.entries().forEach(function(a){var b=a[0];a=a[1];c.set(b,a)});b.entries().forEach(function(a){var b=a[0];a=a[1];var d=c.get(b);!d?c.set(b,a):a.forEach(function(a,b){d.has(b)||d.set(b,a)})});return c}g.reportedEvents=l;g.isEPD=m;g.MAX_SIZE=n;g.storeEventData=e;g.getEventData=f;g.deleteEventData=b;g.useMessengerInfraReport=a;g.mergeReportedEvents=q}),98);
__d("MAWSharedCOPLogger",["WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";a=d("WATagsLogger").TAGS(["COP"]);g["default"]=a}),98);
__d("MAWDbStaleQueue",["MAWODSProxy","MAWSharedCOPLogger","WADexiePersistedQueueApi","WAGetPlatformFromStanzaId","WAOdsEnums","WAPersistedQueue","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Dropping: ",", error: ",". Source: ",""]);h=function(){return a};return a}var i=null;function j(){if(i)return i;var a=d("WAPersistedQueue").initPersistedQueue("staleQueue",d("WADexiePersistedQueueApi").dexieApiForPersistedQueue());i=a;return a}function a(a,b){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.type==="message"?a.subtype!=null?d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(a.stanzaId):d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(a.message.details.externalId):null;c("MAWSharedCOPLogger").EXPECTED_ERROR(h(),a.type,b,e);d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.POISON_QUEUE_ENTTITY,key:""+a.type});e=j();if(a.type!=="message")return;return e.addAndCommit([{exception:b,stanza:a}])});return k.apply(this,arguments)}e=function(){return j().read({limit:1}).then(function(a){return a.length===0})};f=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=500);a=j().read({limit:a});a=(yield a.then(function(a){return a.flatMap(function(a){return a})}));return a});return function(b){return a.apply(this,arguments)}}();g.mawAddStaleStanza=a;g.isEmpty=e;g.read=f}),98);
__d("MAWIsQuotaExceededError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){return a.name==="QuotaExceededError"||a.inner&&a.inner.name==="QuotaExceededError"};f.isQuotaExceededError=a}),66);
__d("MAWMessageReceiveReliabilityLogger",["WAHashStringToNumber","WAQPLProxy","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(1056840931,"814"),i=c("qpl")._(521477947,"2395"),j=60*1e3;function a(a){a.forEach(function(a){d("WAQPLProxy").waQPLProxyStart(a.incomingType==="wa"?h:i,{bool:{rrv2:!0},"int":{msgId:d("WAHashStringToNumber").hashStringToNumber(a.stanzaId)},string:{incomingType:a.incomingType,jid:a.jid,msgType:a.type}},d("WAHashStringToNumber").hashStringToNumber(a.stanzaId),j)})}b=5*60*1e3;g.logRRStart=a;g.RECEIVE_RELIABILITY_TIMEOUT=b}),98);
__d("MAWMediaSizeCheck",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a>100*1024}f.isMinSizeForImagePreviewGeneration=a}),66);
__d("MAWOptimisticUploadMedia",["MAWConfig","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWGetMediaPlaintextApi","MAWGetOrCreateMediaKnownEntriesApi","MAWMediaSizeCheck","MAWMediaUtils","MAWOptimisticUploadManager","MAWStartMediaUploadQplFlow","MAWUpdateMediaEntryForMsgApi","MAWUpdateMediaEntryForOptimisticUploadApi","WAAPI","WABlobToArrayBuffer","WAHashUtils","WAMediaCrypto","WAProgressiveJpegGetScanLengths","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["fileUploadResult success, setting with previewPlaintextHash"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["previewUploadResult success"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["unsupported preview media type ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["preview uploading"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["thumbnail_exists: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["File is already being uploaded"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["fileUploadResult success"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["file uploading"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Expected chatJid in optimisticUploadMedia"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Skipping preview upload for media type ",""]);q=function(){return a};return a}var r=d("WATagsLogger").TAGS(["OptimisticUploadMedia"]);function s(a,b,c){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=(yield d("MAWMediaUtils").hashBlob(a));f=d("WAHashUtils").toPlaintextHash(f);var g=d("MAWOptimisticUploadManager").getOptimisticUploadManager();g=g.get(f);if(g!=null)return d("WAResultOrError").makeError("already_uploading");if(b==null){r.ERROR(p());return d("WAResultOrError").makeError("missing_chat_jid")}g=e.type==="regular"?e.mediaType:"preview";var h=(yield d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:b,fileSize:a.size,serverMediaType:g,uploadEntry:"optimisticUploadMedia"}));b=c("WAAPI").uploadMedia({chatJid:b,filename:g==="document"?a.name:void 0,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("MAWGetOrCreateMediaKnownEntriesApi").getOrCreateMediaKnownEntries,getMediaPlaintext:d("MAWGetMediaPlaintextApi").getMediaPlaintext,hash:f,mediaTypeDetails:e,protocolMsgId:null,size:a.size,updateMediaEntryForMsg:d("MAWUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,uploadMediaMetric:h});return d("WAResultOrError").makeResult({plaintextHash:f,uploadPromise:b})});return t.apply(this,arguments)}function a(a){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=a.file,c=a.jid;a=a.thumbnail;var e=d("MAWOptimisticUploadManager").getOptimisticUploadManager(),f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(b.type);f=f.serverMediaType;r.LOG(o());var g=(yield s(b,c,{mediaType:f,type:"regular"}));if(g.success===!0)r.LOG(n()),e.set(g.value.plaintextHash,{file:b,optimisticUploadPromise:g.value.uploadPromise,previewPlaintextHash:null});else{var p=g.error;switch(p){case"already_uploading":r.LOG(m());break;case"missing_chat_jid":break}}p=null;r.LOG(l(),a!=null);var q=new Uint8Array(yield d("WABlobToArrayBuffer").blobToArrayBuffer(b));if(a&&v(f,b.size,q)){r.LOG(k());q=d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(f);if(q==null){r.ERROR(j(),f);return}f=(yield s(a,c,{messageType:q,type:"preview"}));f.success===!0&&(r.LOG(i()),p=f.value.plaintextHash,e.set(f.value.plaintextHash,{file:a,optimisticUploadPromise:f.value.uploadPromise}),g.success===!0&&(r.LOG(h()),e.set(g.value.plaintextHash,{file:b,optimisticUploadPromise:g.value.uploadPromise,previewPlaintextHash:p})))}});return u.apply(this,arguments)}function v(a,b,c){switch(a){case"gif":return w();case"image":return x(b,c);case"video":return!0;default:r.DEV(q(),a);return!1}}function w(){return c("gkx")("8554")===!0?!1:!0}function x(a,b){if(!d("MAWMediaSizeCheck").isMinSizeForImagePreviewGeneration(a))return!1;return!y(b)&&d("MAWConfig").getConfig().shouldFallbackToPreviewForFailedProgressiveJpeg()===!0?!0:!1}function y(a){a=d("WAProgressiveJpegGetScanLengths").getProgressiveJpegScanLengths(a);return a.length>0}g.optimisticUploadMedia=a;g.shouldUploadPreview=v}),98);
__d("MAWRemoveGroupParticipantsApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAAPI","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,e=new Array(a),f=0;f<a;f++)e[f]=arguments[f];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(e))},"removeGroupParticipants").then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.success&&(yield c("WAAPI").setRotateSenderKeyToTrue([e[1]]));return a});return function(b){return a.apply(this,arguments)}}())};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){var i=a.GroupInfoStore,j=a.MessagesStore;a=a.ParticipantsStore;var k=(yield i.get(c));if(!k.success)return d("WAResultOrError").makeError("missing_group");k=f.map(function(a){return a.user});f=k.map(function(a){return{groupJid:c,userJid:a}});yield a.bulkDelete(f,{remover:e});if(b!=null){a=d("MAWAdminMsgHelpers").createParticipantRemoveAdminMsg(c,k,e,h);yield j.create(a);yield i.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})},{updateParticipantMedatadata:g})}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g,h){return a.apply(this,arguments)}}();g.removeGroupParticipants=a;g.removeGroupParticipantsTransactor=h}),98);
__d("WAGetRemotePublicIdentityV2",["WAJids","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,c){return d("WASignalDB").getDb().runInTransaction(["identity"],"readonly",function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=d("WAJids").toMsgrUserJid(c);e=d("WAJids").toDeviceJid(e,a);b=(yield b.stores.identity.get(e));return b==null?void 0:b.identity});return function(a){return e.apply(this,arguments)}}(),d("WASignalDB").signalOp("getRemotePublicIdentityKey"))};g.getRemotePublicIdentity=a}),98);
__d("IGDLowLevelApiBridgeHandlers",["EncryptedBackupsUploadQueue","MAWBridgeHandlers","MAWEbUploadQueueWrapper","Promise","WALogger","asyncToGeneratorRuntime","cr:8399"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[DYI] Instamadillo DYI is not enabled"]);i=function(){return a};return a}a=babelHelpers["extends"]({},d("MAWBridgeHandlers").bridgeHandlers,{backupWriteCompletionHook:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("EncryptedBackupsUploadQueue").ebUploadQueue();yield a.queueIds.map(function(a){return b.ack([a])});c("MAWEbUploadQueueWrapper").scheduleNextRun()});function e(b){return a.apply(this,arguments)}return e}(),handleInstamadilloDYIRangeQueryRestore:function(a){if(b("cr:8399")==null){d("WALogger").LOG(i());return(h||(h=b("Promise"))).resolve()}return b("cr:8399")(a.threadId,a.messages,a.hasMoreBefore,a.nextMessageTimestampMsBefore)}});g.igdBridgeHandlers=a}),98);
__d("IGDBackendBridgeHandlers",["EBBridgedAPIHandler","IGDBridgedAPIHandler","IGDLowLevelApiBridgeHandlers","MAWJobManager","Promise","WABridgedAPIHandler","WAMockServerShell","WAWaitForComms","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handle with type "," not found"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handle with type "," not found"]);j=function(){return a};return a}function a(a){return babelHelpers["extends"]({},d("IGDLowLevelApiBridgeHandlers").igdBridgeHandlers,{ebapi:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield d("WAWaitForComms").waitForComms();var c=d("EBBridgedAPIHandler").ebapi[b.type];c==null&&a.TAGS(["EBBridgedAPI"]).ERROR(j(),b.type);return c.apply(void 0,b.args)});function e(a){return c.apply(this,arguments)}return e}(),igdapi:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("IGDBridgedAPIHandler").igdapi(a)});function c(b){return a.apply(this,arguments)}return c}(),initMockServer:function(a){return d("WAMockServerShell").getMockServer==null?(h||(h=b("Promise"))).reject("Mock server is not available. Make sure you use worker v2"):d("WAMockServerShell").getMockServer().init(a)},runJobFireAndForget:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("MAWJobManager").getJobManager().fireAndForget(a)});function c(b){return a.apply(this,arguments)}return c}(),runJobWaitUntilCompleted:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("MAWJobManager").getJobManager().waitUntilCompleted(a)});function c(b){return a.apply(this,arguments)}return c}(),runJobWaitUntilPersisted:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("WAWaitForComms").waitForComms();return d("MAWJobManager").getJobManager().waitUntilPersisted(a)});function c(b){return a.apply(this,arguments)}return c}(),runMock:function(a){return d("WAMockServerShell").getMockServer==null?(h||(h=b("Promise"))).reject("Mock server is not available. Make sure you use worker v2"):d("WAMockServerShell").getMockServer().runMock(a)},setMockVariables:function(a){if(d("WAMockServerShell").getMockServer==null)throw c("err")("Mock server is not available. Make sure you use worker v2");d("WAMockServerShell").getMockServer().setVariables(a.variables)},waapi:function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){yield d("WAWaitForComms").waitForComms();var c=d("WABridgedAPIHandler").waapi[b.type];c==null&&a.TAGS(["WABridgedAPI"]).ERROR(i(),b.type);return c.apply(void 0,b.args)});function e(a){return c.apply(this,arguments)}return e}()})}g.getIGDBridgeHandlers=a}),98);
__d("IGDCOP",["MAWSharedCOP","cr:10748","cr:5112"],(function(a,b,c,d,e,f,g){"use strict";c=(a=b("cr:5112"))!=null?a:b("cr:10748");e=d("MAWSharedCOP").makeCOP(c.processProtocolQueueEntries);g.cop=e}),98);
__d("IGDGetMediaKnownEntriesApi",["I64","MAWDbMsg","MAWJids","MAWMediaUtils","MAWReStoreDb","Promise","WAJids","WALogger","WAMsgMap","WAStanzaUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["No existing media entry found for hashedPlaintextHash ",". Returning new MsgMap."]);j=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield d("MAWReStoreDb").getDB(f.id+":35")),e=d("MAWMediaUtils").genHMACPlaintextHash(a);a=(yield c.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var c=(yield a.e2ee_media.index("hashedPlaintextHash").get(e));if(c==null){d("WALogger").ERROR(j(),e);return new(d("WAMsgMap").MsgMap)()}var f=Array.from(c.mediaEntries.keys());f=(yield (i||(i=b("Promise"))).all(f.map(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){b=(yield a.messages.index("messageId").get(b));return b});return function(a){return c.apply(this,arguments)}}())));f=f.reduce(function(a,b){if(b!=null){var e=c.mediaEntries.get(d("MAWDbMsg").instamadilloMsgIdToMsgId(b.messageId)),f=d("WAJids").validateUserJid(d("WAJids").toMsgrUserJid((h||(h=d("I64"))).to_string(b.threadKey))),g=d("WAStanzaUtils").toStanzaId(b.offlineThreadingId);if(e&&!b.isAdminMessage&&f!=null){b={author:d("MAWJids").toUserJid((h||(h=d("I64"))).to_string(b.senderId)),chat:f,externalId:g};a.set(b,e)}}return a},new(d("WAMsgMap").MsgMap)());return f});return function(b){return a.apply(this,arguments)}}(),"readonly",void 0,void 0,f.id+":38"));return a});return function(b){return a.apply(this,arguments)}}();g.getMediaKnownEntries=a}),98);
__d("IGDGetMediaPlaintextApi",["MAWMediaUtils","MAWReStoreDb","WALogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media blob does not exist for the given hashedPlaintextHash"]);h=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWReStoreDb").getDB(f.id+":25"));a=d("MAWMediaUtils").genHMACPlaintextHash(a);b=(yield b.tables.e2ee_chunk.index("hashedPlaintextHash").get(a));if(!b){d("WALogger").ERROR(h());return null}return new Blob([b.blobData],{type:b.mimetype})});return function(b){return a.apply(this,arguments)}}();g.getMediaPlaintext=a}),98);
__d("IGDUpdateMediaEntryForMsgApi",["FBLogger","MAWDbMsg","MAWMediaUtils","MAWReStoreDb","WALogger","WAMediaUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Nothing to update if updatedMediaEntry is null"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose([""," msgId does not exist within media entries"]);i=function(){return a};return a}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,g,j,k){var l=(yield d("MAWReStoreDb").getDB(f.id+":37"));if(!k){c("FBLogger")("igd_web_on_msgr","unsupported_media").mustfix("unsupported media type");throw c("err")("Media type unsupported: "+((k=k)!=null?k:""))}var m=d("MAWMediaUtils").genHMACPlaintextHash(a);return l.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield a.e2ee_media.index("hashedPlaintextHash").get(m)),f=(yield a.messages.index("messageId").get(e.externalId));if(!f)throw c("err")("Message does not exist for the given protocolMsgId");if(!b)throw c("err")("Media does not exist for the given hashedPlaintextHash");if(!b.msgIds.includes(f.messageId)){d("WALogger").LOG(i(),f.messageId);return}f=d("MAWDbMsg").stanzaIdToMsgId(e.externalId);var k=b.mediaEntries.get(f);k=g(k);if(k==null){d("WALogger").LOG(h());return}f=b.mediaEntries.set(f,k);k=babelHelpers["extends"]({},b,{mediaEntries:f});j!=null&&(k=babelHelpers["extends"]({},k,{objectId:d("WAMediaUtils").stringToDeliveryObjectId(j)}));yield a.e2ee_media.put(k)});return function(b){return a.apply(this,arguments)}}(),"readonly",void 0,void 0,f.id+":47")});return function(b,c,d,e,f){return a.apply(this,arguments)}}();g.updateMediaEntryForMsg=a}),98);
__d("InstamadilloMediaUpload",["FBLogger","IGDGetMediaKnownEntriesApi","IGDGetMediaPlaintextApi","IGDUpdateMediaEntryForMsgApi","LSIntEnum","MAWFetchXMABlob","MAWFrontendMediaUtils","MAWGetDownloadableThumbnailForMediaApi","MAWMediaUtils","MAWOptimisticUploadMedia","MAWStartMediaUploadQplFlow","MAWUpdateMediaEntryForOptimisticUploadApi","MessagingAttachmentType","WAAPI","WABlobToArrayBuffer","WAHashUtils","WAMediaCrypto","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){var f=(yield d("MAWMediaUtils").hashBlob(b));f=d("WAHashUtils").toPlaintextHash(f);var g=e.type==="regular"?e.mediaType:"preview",h=(yield d("MAWStartMediaUploadQplFlow").startMediaUploadQplFlow({chatJid:a.chat,fileSize:b.size,serverMediaType:g,uploadEntry:"InstamadilloMediaUpload"}));return c("WAAPI").uploadMedia({chatJid:a.chat,filename:g==="document"?b.name:void 0,getDownloadableThumbnailForMedia:d("MAWGetDownloadableThumbnailForMediaApi").getDownloadableThumbnailForMedia,getMediaKnownEntries:d("IGDGetMediaKnownEntriesApi").getMediaKnownEntries,getMediaPlaintext:d("IGDGetMediaPlaintextApi").getMediaPlaintext,hash:f,mediaTypeDetails:e,protocolMsgId:a,size:b.size,updateMediaEntryForMsg:d("IGDUpdateMediaEntryForMsgApi").updateMediaEntryForMsg,updateMediaEntryForOptimisticUpload:d("MAWUpdateMediaEntryForOptimisticUploadApi").updateMediaEntryForOptimisticUpload,uploadMediaMetric:h})});return j.apply(this,arguments)}function a(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){if(e.playableUrlMimeType==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("instamadilloUpload: mimeType is null");var f=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(e.playableUrlMimeType);f=f.serverMediaType;var g=(yield i(a,b,{mediaType:f,type:"regular"}));if(g.success!==!0)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("instamadilloUpload: Failed to upload media");var j=null,k=(h||(h=d("LSIntEnum"))).unwrapIntEnum(e.attachmentType);e=(yield d("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"InstamadilloMediaUpload",url:e.previewUrl}));if(e!=null){e=(yield e.arrayBuffer());k=k===c("MessagingAttachmentType").IMAGE||k===c("MessagingAttachmentType").VIDEO?d("MAWMediaUtils").convertJpegThumbnailArrayBufferToFile(e):null;e=new Uint8Array(yield d("WABlobToArrayBuffer").blobToArrayBuffer(b));if(k&&d("MAWOptimisticUploadMedia").shouldUploadPreview(f,b.size,e)){b=d("WAMediaCrypto").convertServerMediaTypeToPreviewMediaType(f);if(b==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("unsupported preview media type %s",f);e=(yield i(a,k,{messageType:b,type:"preview"}));if(e.success!==!0)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("instamadilloUpload: Failed to upload preview media");j=e.value}}return{mediaEntry:g.value,thumbnailMediaEntry:j}});return k.apply(this,arguments)}g.instamadilloUpload=a}),98);
__d("createInstamadilloMediaPayload",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.directPath,d=a.duration,e=a.fileEncSha256,f=a.fileLength,g=a.fileSha256,m=a.height,n=a.isAnimated,o=a.isSticker,p=a.mediaId,q=a.mediaKey,r=a.mediaKeyTimestamp,s=a.mediaType,t=a.mimetype,u=a.objectId,v=a.sidecar,w=a.thumbnail,x=a.waveforms,y=a.waveformSamplingFrequencyHz;a=a.width;b={directPath:b,fileEncSha256:e,fileLength:f,fileSha256:g,mediaId:p,mediaKey:q,mediaKeyTimestamp:r,mimetype:t,objectId:u,sidecar:v};switch(s){case"Image":return h(m,a,b,w);case"Video":return i(m,a,b,w);case"Ptt":if(x==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("createInstamadilloMedia: waveforms is null");return j(d,b,x,y);case"Gif":return k(m,a,b,o);case"Sticker":return l(b,n);default:throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("createInstamadilloMedia: mediaType is unsupported")}}function h(a,b,c,d){return{staticPhoto:{height:a,mediaTransport:c,thumbnail:d,width:b}}}function i(a,b,c,d){return{video:{height:a,mediaTransport:c,thumbnail:d,width:b}}}function j(a,b,c,d){return{voice:{duration:a,mediaTransport:b,waveforms:c,waveformSamplingFrequencyHz:d}}}function k(a,b,c,d){return{gif:{height:a,isSticker:d,mediaTransport:c,width:b}}}function l(a,b){return{avatarSticker:{isAnimated:b,mediaTransport:a}}}g.createInstamadilloMediaEncode=a}),98);
__d("InstamadilloSendMediaMessageUtils",["FBLogger","I64","InstamadilloMediaUpload","LSIntEnum","MAWDbMsg","MAWFetchXMABlob","MAWFrontendMediaUtils","MAWMediaUtils","MAWReStoreDb","MessagingAttachmentType","ReQL","WABase64","WABlobToArrayBuffer","WAMediaUtils","WASortedLists","WATimeUtils","asyncToGeneratorRuntime","createInstamadilloMediaPayload"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b,c){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(b,c)));return a});return j.apply(this,arguments)}function k(a){return{validatedAudioInfo:l(a),validatedDocumentFileInfo:null,validatedImageInfo:m(a),validatedVideoInfo:n(a)}}function l(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").AUDIO))?{duration:a.playableDurationMs?(h||(h=d("I64"))).to_float(a.playableDurationMs):0,mimetype:a.playableUrlMimeType}:null}function m(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").IMAGE))?{height:a.previewHeight?(h||(h=d("I64"))).to_float(a.previewHeight):0,width:a.previewWidth?(h||(h=d("I64"))).to_float(a.previewWidth):0}:null}function n(a){return(h||(h=d("I64"))).equal(a==null?void 0:a.attachmentType,(i||(i=d("LSIntEnum"))).ofNumber(c("MessagingAttachmentType").VIDEO))?{duration:a.playableDurationMs?(h||(h=d("I64"))).to_float(a.playableDurationMs):0,height:a.previewHeight?(h||(h=d("I64"))).to_float(a.previewHeight):0,mimetype:a.playableUrlMimeType,width:a.previewWidth?(h||(h=d("I64"))).to_float(a.previewWidth):0}:null}function o(a){var b=a.directPath,c=a.fbid,e=a.fileEncSha256,f=a.fileSha256,g=a.mediaKey,h=a.mediaKeyTimestamp;a=a.objectId;return{directPath:(b=b)!=null?b:void 0,fileEncSha256:d("WABase64").encodeB64(e),fileSha256:d("WABase64").encodeB64(f),mediaId:(b=c)!=null?b:void 0,mediaKey:d("WABase64").encodeB64(g),mediaKeyTimestamp:String(h),objectId:(e=a)!=null?e:void 0}}function e(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var g,i=(yield d("MAWFetchXMABlob").fetchBlob({descriptionForLogging:"InstamadilloSendMediaMessageUtils",url:e.playableUrl}));if(i==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("Blob is null");var j=e.playableUrlMimeType;if(j==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("IGDSendMessageTaskHandler: mimeType is null");var l=d("MAWFrontendMediaUtils").getMediaTypeAndServerMediaTypeFromBlob(j),m=l.mediaType;l=l.serverMediaType;if(m==null)throw c("FBLogger")("igd_web_on_msgr").mustfixThrow("handleInstamadilloMediaSends: mediaType is null");var n=(yield d("MAWMediaUtils").genBlobHashes(i)),p=n[0],q=n[1];n=(yield d("MAWReStoreDb").getDB(f.id+":186"));var r=(yield n.runInTransaction(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=(yield b.e2ee_media.index("hashedPlaintextHash").get(q)),f=new Map(c==null?void 0:c.mediaEntries),g=k(e),h=d("MAWDbMsg").stanzaIdToMsgId(a.externalId);if(c!=null){var l=d("WASortedLists").addToSet(c.msgIds,h);c=babelHelpers["extends"]({},c,g,{mediaEntries:f,msgIds:l})}else c=babelHelpers["extends"]({hashedPlaintextHash:q,mediaEntries:f,mediaType:m,msgIds:d("WASortedLists").singleElement(h),plaintextHash:p,size:i.size,ts:d("WATimeUtils").unixTime()},g);yield b.e2ee_media.put(c);l=(yield d("WABlobToArrayBuffer").blobToArrayBuffer(i));f=(yield b.e2ee_chunk.index("hashedPlaintextHash").get(q));f==null&&(yield b.e2ee_chunk.put({blobData:l,hashedPlaintextHash:q,mimetype:j,plaintextHash:p}));return c});return function(a){return c.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":187"));g=new File([i],(g=e.filename)!=null?g:"",{type:j});var s=(yield d("InstamadilloMediaUpload").instamadilloUpload(a,g,e)),t=s.mediaEntry;s=s.thumbnailMediaEntry;var u=babelHelpers["extends"]({},r,{objectId:t.objectId!=null?d("WAMediaUtils").stringToDeliveryObjectId(t.objectId):void 0});yield n.runInTransaction(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield a.e2ee_media.put(u)});return function(b){return a.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":254");r=o(t);r.$$unknownFieldCount;n=babelHelpers.objectWithoutPropertiesLoose(r,["$$unknownFieldCount"]);t=babelHelpers["extends"]({},n,{duration:e.playableDurationMs!=null?(h||(h=d("I64"))).to_int32(e.playableDurationMs):void 0,fileLength:g.size,height:e.previewHeight!=null?(h||(h=d("I64"))).to_int32(e.previewHeight):void 0,isAnimated:!1,isSticker:!1,mediaType:m,mimetype:j,sidecar:void 0,waveforms:e.waveformData!=null?e.waveformData.split(",").map(Number):void 0,waveformSamplingFrequencyHz:e.samplingFrequencyHz!=null?(h||(h=d("I64"))).to_int32(e.samplingFrequencyHz):void 0,width:e.previewWidth!=null?(h||(h=d("I64"))).to_int32(e.previewWidth):void 0});if(s!=null){r=o(s);r.$$unknownFieldCount;n=babelHelpers.objectWithoutPropertiesLoose(r,["$$unknownFieldCount"]);g={mediaTransport:n};t=babelHelpers["extends"]({},t,{thumbnail:g})}s=d("createInstamadilloMediaPayload").createInstamadilloMediaEncode(t);return{media:u,mediaEncode:s,serverMediaType:l}});return p.apply(this,arguments)}g.getMediaAttachment=a;g.generateValidatedMediaInfoFromAttachment=k;g.prepareMediaProtobuf=e}),98);
__d("MAWDbChunk",[],(function(a,b,c,d,e,f){"use strict";function a(a){return a}function b(a){return a}f.convertNumberToChunkId=a;f.convertToChunkId64=b}),66);
__d("createInstamadilloAddMessagePayload",["I64","InstamadilloMessageIdUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return a!=null?{ephemeralityParams:{ephemeralDurationSec:(h||(h=d("I64"))).to_int32(a)}}:{}}function j(a){return a.isForwarded===!0?{forwardingParams:{forwardedThreadId:(h||(h=d("I64"))).to_string(a.threadKey)}}:{}}function k(a){if(a.replySourceId==null&&a.replySourceTimestampMs==null)return{};function b(){return a.replySourceId!=null?{repliedToMessageOtid:d("InstamadilloMessageIdUtils").fromInstamadilloMessageId(a.replySourceId).stanzaId}:{}}function c(){return a.replySourceTimestampMs!=null?{repliedToMessageWaServerTimeSec:(h||(h=d("I64"))).to_string(a.replySourceTimestampMs)}:{}}return{repliedToMessage:babelHelpers["extends"]({},b(),c())}}function a(a,b){b={content:{text:{text:b?void 0:a.text}},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),j(a),k(a))};return b}function b(a,b){b={content:{media:b},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),j(a),k(a))};return b}function c(a,b){b={content:{receiverFetchXma:JSON.parse(b)},metadata:babelHelpers["extends"]({},i(a.ephemeralDurationInSec),j(a),k(a))};return b}g.createInstamadilloAddMessageTextPayload=a;g.createInstamadilloAddMessageMediaPayload=b;g.createInstamadilloAddMessageReceiverFetchXmaPayload=c}),98);
__d("createInstamadilloTransportPayload",[],(function(a,b,c,d,e,f){"use strict";function a(a){a={add:a};return a}function b(a){a={supplement:a};return a}function c(a){a={"delete":a};return a}function d(a){a={franking:a};return a}f.createInstamadilloAddMessageTransportPayload=a;f.createInstamadilloSupplementMessageTransportPayload=b;f.createInstamadilloDeleteMessageTransportPayload=c;f.createInstamadilloFrankingTransportPayload=d}),66);
__d("IGDReportUserSpamJob",["FBLogger","I64","InstamadilloSendMediaMessageUtils","LSIntEnum","MAWDbChunk","MAWDbMedia","MAWDbMsg","MAWGetGroupInfoApi","MAWJids","MAWJobManager","MAWReStoreDb","MAWSpamReportUtils","Promise","WABase64","WADeprecatedSendIq","WAGlobals","WAJids","WAMediaUtils","WAResultOrError","WAWap","asyncToGeneratorRuntime","createInstamadilloMediaPayload","err","isStringNullOrEmpty"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("reportUserSpam",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.chatJid,f=a.context,g=a.frxParams,h=a.frxTags,i=a.msgs,j=a.reportedMessageId,l=a.spamFlow,m=a.userJid;a=null;if(h!=null){if(h.length===0)throw c("err")("spam reasons should not be an empty array");a=d("WAWap").wap("tagset",null,h.map(function(a){return d("WAWap").wap("tag",{value:d("WAWap").CUSTOM_STRING(a)})}))}h=null;c("isStringNullOrEmpty")(g)||(h=d("WAWap").wap("parameters",null,g));g=null;f!=null&&(g=d("WAWap").wap("context",null,f));var n=null;(a!=null||g!=null||h!=null)&&(n=d("WAWap").wap("frx",null,a,g,h));var q=(yield k(i,e,m,j));f=(yield d("WAJids").switchOnMsgrChatJidType(e,{group:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("WAWap").DROP_ATTR,c=d("WAWap").DROP_ATTR,e=(yield d("MAWGetGroupInfoApi").getGroupInfo(a));e!=null&&e.subject!=null&&e.subject.content!=null&&(b=d("WAWap").CUSTOM_STRING(e.subject.content));e!=null&&e.inviter!=null&&(c=d("WAWap").USER_JID(e.inviter));return o(q,a,m,c,b,l,n)});function c(b){return a.apply(this,arguments)}return c}(),user:function(){return p(q,m,l,n)}}));d("WADeprecatedSendIq").deprecatedCastStanza(f);return d("WAResultOrError").makeResult()});return function(b){return a.apply(this,arguments)}}()).end();function k(a,c,e,f){a=((a=a)!=null?a:[]).map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("MAWJids").toUserJid((i||(i=d("I64"))).to_string(a.senderId)),g;a.transportKey==="Instamadillo"&&(i||(i=d("I64"))).equal(a.displayedContentTypes,(j||(j=d("LSIntEnum"))).ofNumber(2))&&(g=(yield l(a)));if(d("WAJids").interpretAsGroupJid(c)!=null)return d("MAWSpamReportUtils").formatLSDbMsgForSpamReport(a,null,d("WAJids").toGroupJid(c),b);else{var h=(i||(i=d("I64"))).equal(a.senderId,(i||(i=d("I64"))).of_string(d("WAJids").userIdFromJid(d("WAGlobals").getMyUserJid())))?e:d("WAGlobals").getMyUserJid();return d("MAWSpamReportUtils").formatLSDbMsgForSpamReport(a,h,null,b,g,f===a.messageId)}});return function(b){return a.apply(this,arguments)}}());return(h||(h=b("Promise"))).all(a)}function l(a){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=(yield d("MAWReStoreDb").getDB(f.id+":244"));e=(yield e.runInTransaction(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e=(yield d("InstamadilloSendMediaMessageUtils").getMediaAttachment(b,a.threadKey,a.messageId));if(e==null)throw c("FBLogger")("igd_web_on_msgr").warn("IGDReportUserSpam: Tried to send a message with associated attachment");var f=d("MAWDbMedia").convertToMediaId64((i||(i=d("I64"))).of_string(e.attachmentFbid));f=(yield b.e2ee_media.get(f));if(f==null)throw c("FBLogger")("igd_web_on_msgr").warn("IGDReportUserSpam: Tried to send an E2EE media message without associated e2ee_media");var g=d("MAWDbChunk").convertToChunkId64(i.of_string(e.attachmentFbid));b=(yield b.e2ee_chunk.get(g));if(b==null)throw c("FBLogger")("igd_web_on_msgr").warn("IGDReportUserSpam: Tried to send an E2EE media message without associated e2ee_chunk");return{attachment:e,chunk:b,media:f}});return function(a){return e.apply(this,arguments)}}(),"readonly",void 0,void 0,f.id+":245"));var g=e.attachment;e=e.media;var h=d("MAWDbMsg").instamadilloMsgIdToMsgId(a.messageId);if(!e.msgIds.includes(h))throw c("FBLogger")("igd_web_on_msgr").warn("IGDReportUserSpam: media is not linked to this message");h=e.mediaEntries.get(h);if(h==null)throw c("FBLogger")("igd_web_on_msgr").warn("IGDreportUserSpam: media entry not found");h=d("WAMediaUtils").mediaEntryDataToRawData(e.plaintextHash,h);h=n(h);h.$$unknownFieldCount;h=babelHelpers.objectWithoutPropertiesLoose(h,["$$unknownFieldCount"]);h=babelHelpers["extends"]({},h,{duration:g.playableDurationMs!=null?(i||(i=d("I64"))).to_int32(g.playableDurationMs):void 0,fileLength:e.size!=null?e.size:void 0,height:g.previewHeight!=null?(i||(i=d("I64"))).to_int32(g.previewHeight):void 0,isAnimated:!1,isSticker:!1,mediaType:e.mediaType,mimetype:g.playableUrlMimeType,sidecar:void 0,waveforms:g.waveformData!=null?g.waveformData.split(",").map(Number):void 0,waveformSamplingFrequencyHz:g.samplingFrequencyHz!=null?(i||(i=d("I64"))).to_int32(g.samplingFrequencyHz):void 0,width:g.previewWidth!=null?(i||(i=d("I64"))).to_int32(g.previewWidth):void 0});e=d("createInstamadilloMediaPayload").createInstamadilloMediaEncode(h);return e});return m.apply(this,arguments)}function n(a){var b=a.directPath,c=a.fbid,e=a.fileEncSha256,f=a.fileSha256,g=a.mediaKey,h=a.mediaKeyTimestamp;a=a.objectId;return{directPath:b!=null?b:void 0,fileEncSha256:e!=null?d("WABase64").encodeB64(e):void 0,fileSha256:f!=null?d("WABase64").encodeB64(f):void 0,mediaId:(b=c)!=null?b:void 0,mediaKey:g!=null?d("WABase64").encodeB64(g):void 0,mediaKeyTimestamp:String(h),objectId:(e=a)!=null?e:void 0}}function o(a,b,c,e,f,g,h){var i;return(i=d("WAWap")).wap("iq",{id:i.generateId(),to:i.S_WHATSAPP_NET,type:"set",xmlns:"spam"},i.wap("spam_list",{jid:i.GROUP_JID(b),reportee:i.USER_JID(c),source:e,spam_flow:i.CUSTOM_STRING(g),subject:f},a),h)}function p(a,b,c,e){var f;return(f=d("WAWap")).wap("iq",{id:f.generateId(),to:f.S_WHATSAPP_NET,type:"set",xmlns:"spam"},f.wap("spam_list",{jid:f.USER_JID(b),reportee:f.USER_JID(b),spam_flow:f.CUSTOM_STRING(c)},a),e)}g.igdReportUserSpam=a}),98);
__d("IGDStartInstamadilloDYIJob",["EncryptedBackupsDYISingleton","EncryptedBackupsDYITypes","MAWJobManager","MAWReStoreDb","asyncToGeneratorRuntime","cr:1288"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Instamadillo DYI not enabled"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Started job startInstamadilloDYI"]);i=function(){return a};return a}a=d("MAWJobManager").getPersistedJobsApi().definePersistedJob().finalStep("startInstamadilloDYI",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=a.qplInstanceKey;d("EncryptedBackupsDYISingleton").initSingleton(d("EncryptedBackupsDYITypes").EncryptedBackupsDYIConfig.Instamadillo,d("MAWReStoreDb").getDB,a);a=d("EncryptedBackupsDYISingleton").getSingleton();var c=a.getLogger();c.LOG(i());a.logDYIQPLPoint("instamadillo_dyi_job_start");b("cr:1288")!=null?(yield b("cr:1288").getInstance().startDYI(),a.logDYIQPLPoint("instamadillo_dyi_started")):c.ERROR(h())});return function(b){return a.apply(this,arguments)}}()).end();g.startInstamadilloDYI=a}),98);
__d("IGDJobHandlers",["IGDReportUserSpamJob","IGDStartInstamadilloDYIJob","MAWCreateJobNotImplemented"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;return{acceptGroupInvite:(a=d("MAWCreateJobNotImplemented")).createNotImplementedJob("acceptGroupInvite"),addGroupParticipants:a.createNotImplementedJob("addGroupParticipants"),createGroup:a.createNotImplementedJob("createGroup"),deleteMsgsForMe:a.createNotImplementedJob("deleteMsgsForMe"),deleteThread:a.createNotImplementedJob("deleteThread"),demoteGroupParticipants:a.createNotImplementedJob("demoteGroupParticipants"),downloadAndHandleMedia:a.createNotImplementedJob("downloadAndHandleMedia"),downloadAndRestoreMedia:a.createNotImplementedJob("downloadAndRestoreMedia"),getSpams:a.createNotImplementedJob("getSpams"),handleFutureproofMsg:a.createNotImplementedJob("handleFutureproofMsg"),handleSpamMsg:a.createNotImplementedJob("handleSpamMsg"),igdReportUserSpam:d("IGDReportUserSpamJob").igdReportUserSpam,leaveGroups:a.createNotImplementedJob("leaveGroups"),markThreadAsRead:a.createNotImplementedJob("markThreadAsRead"),promoteGroupParticipants:a.createNotImplementedJob("promoteGroupParticipants"),removeGroupParticipants:a.createNotImplementedJob("removeGroupParticipants"),reportUserSpam:a.createNotImplementedJob("reportUserSpam"),requestReuploadMedia:a.createNotImplementedJob("requestReuploadMedia"),rerevokeMsgs:a.createNotImplementedJob("rerevokeMsgs"),resendWrittenAppData:a.createNotImplementedJob("resendWrittenAppData"),restoreMessagesFromEncryptedBackups:a.createNotImplementedJob("restoreMessagesFromEncryptedBackups"),restoreProtobufsFromEncryptedBackups:a.createNotImplementedJob("restoreProtobufsFromEncryptedBackups"),restoreThreadsFromEncryptedBackups:a.createNotImplementedJob("restoreThreadsFromEncryptedBackups"),reuploadMedia:a.createNotImplementedJob("reuploadMedia"),revokeMsgs:a.createNotImplementedJob("revokeMsgs"),sendAppData:a.createNotImplementedJob("sendAppData"),sendEditMsg:a.createNotImplementedJob("sendEditMsg"),sendEphemeralSettingMsg:a.createNotImplementedJob("sendEphemeralSettingMsg"),sendGroupInviteMsg:a.createNotImplementedJob("sendGroupInviteMsg"),sendMediaMsg:a.createNotImplementedJob("sendMediaMsg"),sendMsg:a.createNotImplementedJob("sendMsg"),sendReactionMsg:a.createNotImplementedJob("sendReactionMsg"),sendWrittenAppData:a.createNotImplementedJob("sendWrittenAppData"),sendWrittenMsg:a.createNotImplementedJob("sendWrittenMsg"),sendXMAShareMsg:a.createNotImplementedJob("sendXMAShareMsg"),setGroupSubject:a.createNotImplementedJob("setGroupSubject"),startInstamadilloDYI:d("IGDStartInstamadilloDYIJob").startInstamadilloDYI,updateBackupEntFbidForMedia:a.createNotImplementedJob("updateBackupEntFbidForMedia"),uploadRetroactiveThreadsAndMessages:a.createNotImplementedJob("uploadRetroactiveThreadsAndMessages")}}g.getJobHandlers=a}),98);
__d("IGDLoadRecentParticipantsApi",["I64","LSIntEnum","MAWReStoreDb","ReQL","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=(yield d("MAWReStoreDb").getDB(f.id+":30"));c=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(c.tables.threads.index("lastActivityTimestampMs")).filter(function(a){return(h||(h=d("I64"))).equal(a.threadType,(i||(i=d("LSIntEnum"))).ofNumber(1))}).take(a)));var e=[];c.forEach(function(a){a=d("WAJids").interpretAsUserJid(d("WAJids").toMsgrUserJid((h||(h=d("I64"))).to_string(a.threadKey)));a!=null&&a!==b&&e.push(a)});return new Set(e)});return function(b,c){return a.apply(this,arguments)}}();g.loadRecentParticipants=a}),98);
__d("InstamadilloBackend",["cr:10745","cr:10746","cr:10747","cr:4772","cr:4849","cr:7098","cr:7691","cr:8224","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h=(d=b("cr:7098"))!=null?d:b("cr:10746"),i=(e=b("cr:4849"))!=null?e:b("cr:10747");function a(a){i!=null&&c("promiseDone")(i.setDeviceJid(a.deviceJid)),b("cr:8224")==null?void 0:b("cr:8224").initEbUploadQueue(),b("cr:7691")==null?void 0:b("cr:7691").initIGDEbRestoreProcessor(),b("cr:4772")==null?void 0:b("cr:4772").listenForEbUploadQueueFlush(),h!=null&&(h.initPendingMessageStanzaQueue(),c("promiseDone")(h.processFutureproofPendingMessageStanzas())),b("cr:10745")==null?void 0:b("cr:10745").startIGDDisappearingMsgCleaner()}g.init=a}),98);
__d("WAFrameSocket",["WABinary","WAErrors","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket: queueing partial frame of "," bytes"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Buffer to send: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket error"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["FrameSocket closed, waiting for pending processing"]);l=function(){return a};return a}var m=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c="SocketClosed";a=b.call(this,(a=a)!=null?a:c)||this;a.name=c;return a}var c=a.prototype;c.toString=function(){return this.name};return a}(babelHelpers.wrapNativeSuper(Error));a=function(){function a(a,b){var c=this;this.$3=new(d("WABinary").Binary)();this.closed=!1;this.$4=!1;this.onFrame=null;this.onClose=null;this.$5=function(a){c.$3.writeByteArray(a),c.convertBufferedToFrames()};this.$6=function(){if(c.$3.peek(n)){d("WALogger").LOG(l());c.$4=!0;return}c.$9()};this.$7=function(a){d("WALogger").DEV(k()).devConsole(a)};this.$2=b;this.$1=a;a.onData=this.$5;a.onClose=this.$6;a.onError=this.$7}var b=a.prototype;b.sendFrame=function(a){if(this.$4)return;this.throwIfClosed();var b=this.$2,c=a.byteLength;this.$8(c);var d=this.$1.dataToSend;b?(this.$2=null,d.ensureAdditionalCapacity(b.length+3+c),d.writeByteArray(b)):d.ensureAdditionalCapacity(3+c);d.writeUint8(c>>16);d.writeUint16(c&65535);d.write(a);this.$1.requestSend()};b.$9=function(){if(this.closed)return;d("WALogger").LOG(j());this.$4=!1;this.closed=!0;var a=this.onClose;a&&a()};b.$8=function(a){if(a>=1<<24){d("WALogger").WARN(i(),a);throw new(d("WAErrors").BufferTooLargeError)("Buffer too large: "+a)}};b.convertBufferedToFrames=function(){var a=this.$3,b=this.onFrame;while(b&&a.peek(n)){var c=o(a);c=a.readByteArray(c);b(c);b=this.onFrame}this.$4&&!a.peek(n)&&this.$9();b&&a.size()&&d("WALogger").LOG(h(),a.size())};b.throwIfClosed=function(){if(this.closed)throw new m()};b.close=function(){this.$1.close()};return a}();function n(a){if(a.size()<3)return!1;var b=o(a);return b<=a.size()}function o(a){return a.readUint8()<<16|a.readUint16()}g.SocketClosed=m;g.FrameSocket=a}),98);
__d("WANoiseSocket",["Promise","WACryptoDependencies","WALogger","WAPromiseQueue","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["sendFrame adding to queue with frame size: "," bytes"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["NoiseSocket socket closed while encrypting frame"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sending encrypted frame to web socket"]);k=function(){return a};return a}a=(h||(h=b("Promise"))).reject("UNINITIALIZED HANDSHAKE");var l=new Uint8Array(0);a["catch"](function(){});c=function(){function a(a,b,c){var e=this;this.$4=[];this.$5=new(d("WAPromiseQueue").PromiseQueue)();this.$6=new(d("WAPromiseQueue").PromiseQueue)();this.$7=0;this.$8=0;this.$9=!1;this.$14=function(a){!e.$1.closed?(d("WALogger").DEV(k()).tags("WANoiseSocket"),e.$1.sendFrame(a)):d("WALogger").LOG(j())};this.$12=function(a){var b=e.$7++;e.$5.enqueueHandlers(o(e.$2,b,void 0,a),e.$15)};this.$13=function(){e.$9=!0,e.$5.wait().then(function(){e.$9=!1;var a=e.$11;a&&a()})};this.$15=function(a){e.$10?e.$10(a):e.$4.push(a)};this.$1=a;this.$3=b;this.$2=c;a.onFrame=this.$12;this.$1.onClose=this.$13;a.convertBufferedToFrames()}var c=a.prototype;c.sendFrameAsync=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield this.sendFrame(a));return a});function c(b){return a.apply(this,arguments)}return c}();c.sendFrame=function(a){if(this.$9)return(h||(h=b("Promise"))).resolve();this.$1.throwIfClosed();var c=this.$8++;d("WALogger").DEV(i(),a.length).tags("WANoiseSocket");return this.$6.enqueueHandlers(n(this.$3,c,void 0,a),this.$14)};c.setOnFrame=function(a){this.$10=a};c.setOnClose=function(a){this.$11=a};c.close=function(){this.$1.close()};return a}();function m(a){var b=new ArrayBuffer(12),c=new DataView(b);c.setUint32(8,a);return new Uint8Array(b)}function n(a,b,c,e){return d("WACryptoDependencies").getCrypto().subtle.encrypt({name:"AES-GCM",iv:m(b),additionalData:c?new Uint8Array(c):l},a,e)}function o(a,b,c,e){return d("WACryptoDependencies").getCrypto().subtle.decrypt({name:"AES-GCM",iv:m(b),additionalData:c?new Uint8Array(c):l},a,e)}g.NoiseSocket=c}),98);
__d("MAWAdminAddParticipantMsg",["MAWLocalizationType","MAWUserJidWrapper","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h=1;function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_ONE_USER};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_YOU_AND_MORE_THAN_ONE_USERS}}}function j(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_ONE_PARTICIPANT};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_TWO_PARTICIPANTS};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.CURRENT_USER_ADDED_MORE_THAN_TWO_PARTICIPANTS}}}function k(a,b,c,e){switch(a){case 1:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_ONE_USER};case 2:return{adminMsgContent:[b,c,e],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_TWO_USER}}return{adminMsgContent:[b,c,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.PARTICIPANT_ADDED_MORE_THAN_TWO_USER}}function l(a,b){switch(a){case 1:return{adminMsgContent:[],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU};case 2:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_ONE_USER}}return{adminMsgContent:[(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_YOU_AND_MORE_THAN_ONE_USER}}function m(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_ONE_USER};case 2:return{adminMsgContent:[b,c],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_TWO_USER}}return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWLocalizationType").LOCALIZATION_TYPE.UNKNOWN_USER_ADDED_MORE_THAN_TWO_USER}}function n(a,b){var c=d("MAWUserJidWrapper").getMyUserJid(),e=b[0],f=b[1],g=d("WAJids").userIdFromJid(e);f=f!=null?d("WAJids").userIdFromJid(f):"";if(a==null)return b.includes(c)?l(b.length,e===c?f:g):m(b.length,g,f);if(a===c)return j(b.length,g,f);a=d("WAJids").userIdFromJid(a);return b.includes(c)?i(b.length,a,e===c?f:g):k(b.length,a,g,f)}function a(a,b){return babelHelpers["extends"]({},n(a,b),{version:h})}g.createAddParticipantsAdminMessage=a}),98);
__d("MAWAdminRemoveParticipantMsg",["MAWAdminMsgType","MAWUserJidWrapper","WAJids"],(function(a,b,c,d,e,f,g){"use strict";var h=1;function i(a,b,c){switch(a){case 1:return{adminMsgContent:[b],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_YOU};case 2:return{adminMsgContent:[b,c],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_YOU_AND_ONE_USER};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_YOU_AND_MORE_THAN_ONE_USERS}}}function j(a,b,c,e){switch(a){case 1:return e?{adminMsgContent:[],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_LEFT_GROUP}:{adminMsgContent:[b],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_REMOVED_ONE_PARTICIPANT};case 2:return{adminMsgContent:[b,c],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_REMOVED_TWO_PARTICIPANTS};default:return{adminMsgContent:[b,(a-1).toString()],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_REMOVED_MORE_THAN_TWO_PARTICIPANTS}}}function k(a,b,c,e,f){switch(a){case 1:return f?{adminMsgContent:[b],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_LEFT_GROUP}:{adminMsgContent:[b,c],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_ONE_USER};case 2:return{adminMsgContent:[b,c,e],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_TWO_USER}}return{adminMsgContent:[b,c,(a-1).toString()],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_REMOVED_MORE_THAN_TWO_USER}}function l(a,b){var c=d("MAWUserJidWrapper").getMyUserJid(),e=b[0],f=b[1],g=d("WAJids").userIdFromJid(e);f=f!=null?d("WAJids").userIdFromJid(f):"";if(a==null)return b.includes(c)?{adminMsgContent:[],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.UNKNOWN_USER_REMOVED_YOU}:{adminMsgContent:[g],adminType:d("MAWAdminMsgType").ADMIN_MSG_TYPE.UNKNOWN_USER_REMOVED_ONE_USER};if(a===c)return j(b.length,g,f,e===c);var h=d("WAJids").userIdFromJid(a);return b.includes(c)?i(b.length,h,e===c?f:g):k(b.length,h,g,f,e===a)}function a(a,b){return babelHelpers["extends"]({},l(a,b),{version:h})}g.createRemoveParticipantsAdminMessage=a}),98);
__d("MAWAdminWriteChangeParticipantsAdminMsgTxn",["MAWAdminAddParticipantMsg","MAWAdminRemoveParticipantMsg","MAWDbThreadTxns","MAWLocalizationUtils","MAWUserJidWrapper","MAWWriteMsgTxns","emptyFunction","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h(a,b,d("MAWAdminAddParticipantMsg").createAddParticipantsAdminMessage)}function b(a,b){return h(a,b,d("MAWAdminRemoveParticipantMsg").createRemoveParticipantsAdminMessage)}function h(a,b,e){var f=b.admin,g=b.chatJid,h=b.participants,i=b.serverTs;if(h.length===0)throw c("err")("invalid number of participants when writing participants change admin msg");return d("MAWDbThreadTxns").getThread(a,g).then(function(b){if(!b.success)throw c("err")("no thread when writing participants change admin msg");b=b.value;var g=d("MAWUserJidWrapper").getMyUserJid();g=f==="@me"?g:f;if(g==null)return;g=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg(e(g,h),b.jid,i);return d("MAWWriteMsgTxns").writeMsg(a,g,b,"MAWAdminWriteChangeParticipantsAdminMsgTxn").then(c("emptyFunction"))})}g.writeAddParticipantAdminMsg=a;g.writeRemoveParticipantAdminMsg=b}),98);
__d("MAWAdminWriteGroupNameChangeTxn",["MAWAdminMsgType","MAWDexieTable","MAWLocalizationUtils","MAWUserJidWrapper","MAWWriteMsgTxns","WAJids","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e){var f=b.name;if(f==null)return d("MAWDexieTable").dexieResolve();var g=d("MAWUserJidWrapper").getMyUserJid(),h=[];b.nameOwner===g?(g=d("MAWAdminMsgType").ADMIN_MSG_TYPE.CURRENT_USER_NAMED_GROUP,h.push(f)):b.nameOwner==null?(g=d("MAWAdminMsgType").ADMIN_MSG_TYPE.UNKNOWN_USER_NAMED_GROUP,h.push(f)):(g=d("MAWAdminMsgType").ADMIN_MSG_TYPE.PARTICIPANT_NAMED_GROUP,h.push(d("WAJids").userIdFromJid(b.nameOwner),f));b=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:h,adminType:g,version:1},e.jid,d("WATimeUtils").castMillisTimeToUnixTime(d("WATimeUtils").millisTime()));return d("MAWWriteMsgTxns").writeMsg(a,b,e,"MAWAdminWriteGroupNameChangeTxn").then(c("emptyFunction"))}g.writeGroupNameChangeInfo=a}),98);
__d("MAWParticipantManagementTxns",["MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","MAWUserJidWrapper"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDbParticipantTxns").getParticipantsInThread(a,b).then(function(e){if(c.length===0&&e.length===0)return{addedJids:[],participants:e,removedJids:[],typeUpdateJids:[]};var f=new Map();e.forEach(function(a){f.set(a.userJid,a)});var g=new Set(c.map(function(a){return a.userJid})),h=[],i=[],j=[],k=[];f.forEach(function(a,b){g.has(b)||(a.type!=="invitedParticipant"?h.push(b):(k.push({type:a.type,userJid:a.userJid}),j.push(babelHelpers["extends"]({},a))))});c.forEach(function(a){var b=f.get(a.userJid);b==null?(i.push(a),a.type==="admin"&&k.push({type:a.type,userJid:a.userJid})):(b.type!==a.type&&k.push({type:a.type,userJid:a.userJid}),j.push(babelHelpers["extends"]({},b,a)))});var l=h.indexOf(d("MAWUserJidWrapper").getMyUserJid())>=0;e=function(){return[d("MAWDbParticipantTxns").bulkAddParticipants(a,b,i),d("MAWDbParticipantTxns").bulkUpdateParticipants(a,j),d("MAWDbParticipantTxns").bulkDeleteParticipantsInThread(a,b,h),l?d("MAWDbThreadTxns").archiveThreads(a,[b],!0):d("MAWDexieTable").dexieResolve()]};return d("MAWDexieTable").dexieAll(e()).then(function(a){var b=a[0];a=a[1];return{addedJids:i.map(function(a){return a.userJid}),participants:[].concat(b,a),removedJids:h,typeUpdateJids:k}})})}g.syncParticipantList=a}),98);
__d("MAWGroupManagementTxns",["MAWAdminWriteChangeParticipantsAdminMsgTxn","MAWAdminWriteGroupNameChangeTxn","MAWDbGroupInfoTxns","MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbThreadTxns","MAWDexieTable","MAWFolderTypes","MAWGetOrCreateThreadTxns","MAWLoadMsgsTxns","MAWParticipantManagementTxns","MAWThreadManagementTxns","MAWUserJidWrapper","WATimeUtils","isGroupInvitesEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("MAWDexieTable").dexieAll([d("MAWThreadManagementTxns").deleteAllThreadData(a,c),d("MAWDbGroupInfoTxns").deleteGroupInfo(a,b)]).then(function(a){a=a[0];return a}).then(function(a){return a})}b=function(a,b){var e=b.authoritativeThreadKey,f=b.deduplicationKey,g=b.extras,h=b.folder,i=b.groupStatus,j=b.groupToCreate,k=b.serverTs;b=i==="added"?d("WATimeUtils").unixTime():j.creationTs;return d("MAWGetOrCreateThreadTxns").getOrCreateThread(a,{authoritativeThreadKey:e,clientThreadKey:g==null?void 0:g.clientThreadKey,createTs:d("WATimeUtils").castUnixTimeToMillisTime(b),deduplicationKey:f,description:"createGroup",folder:h==null?d("MAWFolderTypes").FOLDER_ID.INBOX:h,jid:j.jid}).then(function(b){var e=b.created,f=b.thread;b=j.participants.map(function(a){return a.error?c("isGroupInvitesEnabled")()&&a.error.errorCode===403?{addressable:!0,type:"invitedParticipant",userJid:a.error.user}:null:{addressable:a.value.addressable,type:a.value.type,userJid:a.value.user}}).filter(Boolean);var g=e?d("MAWDbParticipantTxns").bulkAddParticipants:d("MAWParticipantManagementTxns").syncParticipantList,h=g(a,f.jid,b);g=d("MAWUserJidWrapper").getMyUserJid();var l=i==="added"&&!e&&j.creator!==g?d("MAWAdminWriteChangeParticipantsAdminMsgTxn").writeAddParticipantAdminMsg(a,{admin:j.inviter,chatJid:f.jid,participants:[g],serverTs:k}):d("MAWDexieTable").dexieResolve();j.description;j.participants;var m=babelHelpers.objectWithoutPropertiesLoose(j,["description","participants"]);return d("MAWDbMsgTxns").getThreadNewestMessageId(a,f.jid).then(function(b){return d("MAWDexieTable").dexieAll([h,d("MAWDbGroupInfoTxns").putGroupInfo(a,m),b==null?d("MAWDexieTable").dexieResolve():d("MAWLoadMsgsTxns").loadMsgsAndMediaFromOffset(a,f.jid,b,10,!0),l]).then(function(b){b[0];b=b[1];return e&&i==="added"?d("MAWAdminWriteGroupNameChangeTxn").writeGroupNameChangeInfo(a,b,f):d("MAWDexieTable").dexieResolve()}).then(function(){return f.archived===!0?d("MAWDbThreadTxns").unarchiveThreads(a,[f.jid]):d("MAWDbThreadTxns").subscribeToThreads(a,[f.jid])}).then(function(a){return f.jid})})})};g.deleteGroup=a;g.createGroupInternal=b}),98);
__d("WAServerRPCLogger",["WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";a=d("WATagsLogger").TAGS(["ServerRPC"]);g.logger=a}),98);
__d("isUseridAnnotationEnabled",["gkx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("gkx")("24163")}g["default"]=a}),98);
__d("MAWDebugSendReaction",["MAWJobDefinitions","MAWJobManager","MAWLoggerUtils","WADevToolsDebugFns"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADevToolsDebugFns").defineDebugFunction("sendReaction",{desc:"Sends reaction to a message",execute:function(a,b,c,e){return d("MAWJobManager").getJobManager().waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.sendReactionMsg(a,b,c,d("MAWLoggerUtils").getInstanceKey(),e))},serializedArgs:[{desc:"ChatJid of the thread containing the message to react to",name:"chatJid",placeholder:"ChatJid",type:"string"},{desc:"ProtocolMsgId of the message to react to",name:"reactTo",placeholder:"ProtocolMsgId",type:"object"},{desc:"FBID of the author of the message to react to",name:"author",placeholder:"FBID",type:"string"},{desc:"Reaction emoji to use",name:"reaction",placeholder:"\ud83d\ude00",type:"string"}]});g.sendReaction=a}),98);
__d("MAWDebugDefineFunctions",["MAWDebug","MAWDebugHydrateOfflineQueue","MAWDebugSendMultipleMsgs","MAWDebugSendReaction"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return{desc:a,execute:b,name:a,serializedArgs:[]}}function a(){var a=Object.keys(d("MAWDebug").MAWDebugFuncs).reduce(function(a,b){return Object.assign(a,(a={},a[b]=h(b,d("MAWDebug").MAWDebugFuncs[b]),a))},{});return babelHelpers["extends"]({},a,{hydrateOfflineQueue:d("MAWDebugHydrateOfflineQueue").hydrateOfflineQueue,sendMultipleMsgs:d("MAWDebugSendMultipleMsgs").sendMultipleMsgs,sendReaction:d("MAWDebugSendReaction").sendReaction})}g.getAllDebugFunctions=a}),98);
__d("WAStanzaRootTag",[],(function(a,b,c,d,e,f){"use strict";a="notification";b="receipt";c="message";d="call";e="chatstate";var g="presence",h="appdata",i="failure",j="stream:error",k="ib",l="iq",m="error",n="success",o="xmlstreamend",p={NOTIFICATION:a,RECEIPT:b,MESSAGE:c,CHATSTATE:e,PRESENCE:g,APPDATA:h,CALL:d,IQ:l,IB:k,STREAM_ERROR:j,FAILURE:i,SUCCESS:n,ERROR:m,XML_STREAM_END:o};f.NOTIFICATION=a;f.RECEIPT=b;f.MESSAGE=c;f.CALL=d;f.CHATSTATE=e;f.PRESENCE=g;f.APPDATA=h;f.FAILURE=i;f.STREAM_ERROR=j;f.IB=k;f.IQ=l;f.ERROR=m;f.SUCCESS=n;f.XML_STREAM_END=o;f.STANZA_ROOT_TAG=p}),66);
__d("WAPreKeysStanzaUtils",["WAWap"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b;return(b=d("WAWap")).wap("key",null,b.wap("id",null,b.BIG_ENDIAN_CONTENT(a.id,3)),b.wap("value",null,a.keyPair.publicKey))}function b(a){var b;return(b=d("WAWap")).wap("skey",null,b.wap("id",null,b.BIG_ENDIAN_CONTENT(a.id,3)),b.wap("value",null,a.keyPair.publicKey),b.wap("signature",null,a.signature))}function c(a){var b=a.child("skey"),c=null;if(a.hasChild("key")){var d=a.child("key");c={id:d.child("id").contentUint(3),publicKey:d.child("value").contentSerializedPubKey()}}return{identity:a.child("identity").contentSerializedPubKey(),signedKey:{id:b.child("id").contentUint(3),publicKey:b.child("value").contentSerializedPubKey(),signature:b.child("signature").contentBytes(64)},oneTimeKey:c}}g.xmppPreKey=a;g.xmppSignedPreKey=b;g.readSessionInfo=c}),98);
__d("WAReceiptUtils",["WACryptoManagerUtils","WADeprecatedSendIq","WAMapWithDefault","WAMsg","WAPreKeysStanzaUtils","WARequestPreKeyDigest","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.retryCount;c=c+1;c>=3&&(yield d("WARequestPreKeyDigest").requestPreKeyDigestFn(function(a){return a(b)}));var e=null;c>=2&&(e=(yield d("WACryptoManagerUtils").getSignalInfoForRetry(b.cryptoManager)));var f=b.cryptoManager.regInfo.regId;return k(a,c,f,e)});return i.apply(this,arguments)}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.externalId,e=a.from,f=a.participant,g;e.type==="group"?g=e.groupJid:(e.type,g=e.deviceJid);yield d("WADeprecatedSendIq").deprecatedSendStanzaAndWaitForAck(yield h(a,b),{id:c,"class":"receipt",from:g,participant:f})});return j.apply(this,arguments)}function k(a,b,c,e){var f=null;if(e!=null){var g=e.keyType,h=e.signedPreKey,i=e.preKey;e=e.publicKey;var j=a.deviceIdentity!=null?d("WAWap").wap("device-identity",null,a.deviceIdentity):null;f=d("WAWap").wap("keys",null,d("WAWap").wap("type",null,d("WAWap").BIG_ENDIAN_CONTENT(g,1)),d("WAWap").wap("identity",null,e),d("WAPreKeysStanzaUtils").xmppPreKey(i),d("WAPreKeysStanzaUtils").xmppSignedPreKey(h),j)}a.from.type==="group"?g=a.from.groupJid:(a.from.type,g=a.from.deviceJid);return d("WAWap").wap("receipt",{category:a.category!=null?d("WAWap").CUSTOM_STRING(a.category):d("WAWap").DROP_ATTR,id:d("WAWap").CUSTOM_STRING(a.externalId),participant:a.participant?d("WAWap").DEVICE_JID(a.participant):d("WAWap").DROP_ATTR,recipient:a.recipient?d("WAWap").USER_JID(a.recipient):d("WAWap").DROP_ATTR,to:d("WAWap").JID(g),type:"retry"},d("WAWap").wap("retry",{count:d("WAWap").INT(b),id:d("WAWap").CUSTOM_STRING(a.externalId),t:d("WAWap").INT(a.ts),v:"1"}),d("WAWap").wap("registration",null,d("WAWap").BIG_ENDIAN_CONTENT(c)),f)}function c(a){var b=new(d("WAMapWithDefault").MapWithDefault)(function(a){return new Set()});for(a of a){var c=a.receipt;if(c.receiptType==="group"||c.receiptType==="user")for(var e of c.externalIds)b.get(d("WAMsg").craftWAMsgIdString({author:c.messageAuthor,chat:c.chat,externalId:e})).add(c.from.author);else if(c.receiptType==="group-server-agg")for(e of c.receivers)b.get(d("WAMsg").craftWAMsgIdString({author:c.messageAuthor,chat:c.chat,externalId:c.externalId})).add(e.device)}return b.toMap()}g.makeRetryReceipt=h;g.sendRetryReceipt=a;g.calculateIdentitiesToDelete=c}),98);
__d("WAParseV3Protocol",["WAAckLevel","WAAssertUnreachable","WAGlobals","WAHex","WAMsgType","WAParseConsumerMessageProtocol","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return function(b,e,f,g,h,i){h={id:{chat:e,author:g,externalId:f},ts:h,serverTs:h,ack:d("WAAckLevel").ACK.RECEIVED,forwardingScore:b.type!=="futureProof"?(f=b==null?void 0:(g=b.metadata)==null?void 0:g.forwardingScore)!=null?f:0:0};g=b.type!=="futureProof"&&((g=b.metadata)==null?void 0:(f=g.chatEphemeralSetting)==null?void 0:f.ephemeralExpiration)!=null&&((g=b.metadata)==null?void 0:(f=g.chatEphemeralSetting)==null?void 0:f.ephemeralExpiration)>0;if(b.type==="futureProof"||g&&!d("WAGlobals").getConfig().isEphemeralMessagesEnabled())return{unstoredMsg:{type:d("WAMsgType").FUTUREPROOF,msgContent:{subtype:null,protobuf:d("WAHex").bytesToBuffer(b.protobuf)},id:h.id,ts:h.ts,sentTs:h.sentTs,serverTs:h.serverTs,ack:h.ack,reportingMeta:h.reportingMeta},unstoredMedia:null,unstoredQuotedMedia:null};else if(b.type==="subprotocol"){f=a==null?void 0:a.get(b.subprotocolType);if(f!=null)return f(e,b.subprotocol,h,b.protobuf,b.metadata,i);switch(b.subprotocolType){case"consumerMessage":return d("WAParseConsumerMessageProtocol").parseConsumerMessageProtocol(e,b.subprotocol,h,b.protobuf,b.metadata,i);case"businessMessage":throw c("err")("unsupported subprotocolType: "+b.subprotocolType);case"paymentMessage":throw c("err")("unsupported subprotocolType: "+b.subprotocolType);case"multiDevice":throw c("err")("unsupported subprotocolType: "+b.subprotocolType);case"voip":throw c("err")("unsupported subprotocolType: "+b.subprotocolType);default:throw c("err")("Subprotocol parser for: "+b.subprotocolType+" was not found")}}else return c("WAAssertUnreachable")(b.type)}}g.createV3ProtocolParser=a}),98);
__d("MAWServerRPC",["MAWHandleAbPropsRefreshNotification","MAWHandleAppdataMessage","MAWHandleChatState","MAWHandleFailure","MAWHandleFbDeviceChangeNotification","MAWHandleFbMultiwayNotification","MAWHandleFbThreadNotification","MAWHandleGroupNotification","MAWHandleGroupReceipt","MAWHandleGroupRetryReceipt","MAWHandleIndividualRetryReceipt","MAWHandleLoginSuccess","MAWHandlePeerAppdataReceipt","MAWHandlePeerAppdataRetryReceipt","MAWHandleSpam","MAWHandleThreadMetadata","Promise","WAHandleErrorStanza","WAHandleIncomingMsg","WAHandleInfoBulletin","WAHandlePrekeyContactIDChangedNotification","WAHandlePrekeyDigestNotification","WAHandlePrekeyLowCountNotification","WAHandleReceipt","WAHandleServerPing","WAHandleStreamError","WALogger","WAServerRPC"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Peer messages are not supported"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Broadcast messages are not supported"]);j=function(){return a};return a}function a(){var a;return d("WAServerRPC").makeServerRPC({abprops:{handleAbPropsRefreshNotification:d("MAWHandleAbPropsRefreshNotification").handleAbPropsRefreshNotification},accountSync:null,appdataMessage:{handleAppdataMessage:d("MAWHandleAppdataMessage").handleAppdataMessage,handlePeerAppdataReceipt:d("MAWHandlePeerAppdataReceipt").handlePeerAppdataReceipt,handlePeerAppdataRetryReceipt:d("MAWHandlePeerAppdataRetryReceipt").handlePeerAppdataRetryReceipt},broadcast:{handleBroadcastMessage:function(a){a=a.makeAck;d("WALogger").ERROR(j());return(h||(h=b("Promise"))).resolve(a())}},clientLog:null,comms:{handleEdgeRoutingInfo:d("WAHandleInfoBulletin").handleEdgeRoutingInfo,handleServerPing:d("WAHandleServerPing").handleServerPing},error:{handleErrorStanza:d("WAHandleErrorStanza").handleErrorStanza,handleSmaxErrorStanza:d("WAHandleErrorStanza").handleSmaxErrorStanza},fb:{handleFbDeviceChangeNotification:d("MAWHandleFbDeviceChangeNotification").handleFbDeviceChangeNotification,handleFbMultiwayNotification:d("MAWHandleFbMultiwayNotification").handleFbMultiwayNotification,handleFbThreadNotification:d("MAWHandleFbThreadNotification").handleFbThreadNotification},groupMessage:{handleGroupChatState:d("MAWHandleChatState").handleGroupChatState,handleGroupDirtyBit:null,handleGroupMessage:d("WAHandleIncomingMsg").handleGroupMessage,handleGroupNotification:d("MAWHandleGroupNotification").handleGroupNotification,handleGroupReceipt:d("MAWHandleGroupReceipt").handleGroupReceipt,handleGroupRetryReceipt:d("MAWHandleGroupRetryReceipt").handleGroupRetryReceipt},individualMessage:{handleIndividualChatState:d("MAWHandleChatState").handleIndividualChatState,handleIndividualMessage:d("WAHandleIncomingMsg").handleIncomingIndividualMsg,handleIndividualReceipt:d("WAHandleReceipt").handleIndividualReceipt,handleIndividualRetryReceipt:d("MAWHandleIndividualRetryReceipt").handleIndividualRetryReceipt},login:{handleLoginFailure:d("MAWHandleFailure").handleLoginFailure,handleLoginSuccess:d("MAWHandleLoginSuccess").handleLoginSuccess},md:null,newsletter:null,offline:{handleOfflineEnd:d("WAHandleInfoBulletin").handleOfflineEnd,handleOfflineStart:d("WAHandleInfoBulletin").handleOfflineStart,handleThreadMetadata:d("MAWHandleThreadMetadata").handleThreadMetadata},peerMessage:{handlePeerMessage:function(a){a=a.makeAck;d("WALogger").ERROR(i());return(h||(h=b("Promise"))).resolve(a())}},prekey:{handlePrekeyContactIDChangedNotification:d("WAHandlePrekeyContactIDChangedNotification").handlePrekeyContactIDChangedNotification,handlePrekeyDigestNotification:d("WAHandlePrekeyDigestNotification").handlePrekeyDigestNotification,handlePrekeyLowCountNotification:d("WAHandlePrekeyLowCountNotification").handlePrekeyLowCountNotification},presence:null,serverProps:null,spam:{handleSpam:d("MAWHandleSpam").handleSpam},status:null,streamError:{handleAckKick:(a=d("WAHandleStreamError")).handleAckKick,handleBadMac:a.handleBadMac,handleConflict:a.handleConflict,handlePingKick:a.handlePingKick,handleStreamErrorCode:a.handleStreamErrorCode,handleXmlNotWellFormed:a.handleXmlNotWellFormed},syncd:null,usync:null})}g.makeServerRPC=a}),98);
__d("WADebugTools",["WADevToolsDebugFns"],(function(a,b,c,d,e,f,g){"use strict";function a(a){self.Debug==null&&(self.Debug={});var b=function(b){var c=a[b];self.Debug[c.name]=function(){return c.execute.apply(c,arguments)}};for(var c in a)b(c);d("WADevToolsDebugFns").registerDebugFnsToDevTool(a)}g.initDebugFunctions=a}),98);
__d("IGDBackend",["IGDAWDebug","IGDAWMainWebWorkerConfig","IGDBackendBridgeHandlers","IGDCOP","IGDJobHandlers","IGDLoadRecentParticipantsApi","InstamadilloBackend","MAWClearSignalAndTempStores","MAWCommsConfig","MAWConfig","MAWCreateGroupApi","MAWCurrentUser","MAWDebugDefineFunctions","MAWDefinePersistedJob","MAWEphemeralConsts","MAWExtractMsFromExternalId","MAWFbCat","MAWHandleReachabilityErrorAdminMsgApi","MAWPREListeners","MAWQplProxy","MAWReStoreDb","MAWServerRPC","MAWSharedOfflineQueueMetric","MAWSharedOfflineResumeUINotifier","MAWTaskDefinitions","Promise","WAArrayBufferUtils","WADebugTools","WAMessageLoggingPublisher","WAMockServerShell","WAPassiveMode","WAService","WATagsLogger","WAWaitForComms","WAWaitForUserUnblocked","asyncToGeneratorRuntime","isUseridAnnotationEnabled","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Worker inited"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to init worker (post-startup): ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["deviceJid: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["initWAInfra"]);l=function(){return a};return a}var m=d("WATagsLogger").TAGS(["backend"]);function a(a,b,c,d,e){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,n){m.LOG(l());m.LOG(k(),a.deviceJid);d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),"igd_backend_setup_start");d("MAWFbCat").setFbCat(d("WAArrayBufferUtils").stringToArrayBuffer(a.fbCat));g=d("MAWServerRPC").makeServerRPC();n=(yield d("WAService").makeWAService({config:n,dependencies:{clearSignalAndTempStores:d("MAWClearSignalAndTempStores").clearSignalAndTempStores,createGroups:d("MAWCreateGroupApi").createGroups,ephemeralMaxDeletionWindowForUnseenMessage:function(){return d("MAWEphemeralConsts").ephemeralMaxDelectionWindowForUnseenMessage},extractMsFromStanzaId:d("MAWExtractMsFromExternalId").extractMsFromStanzaId,handleReachabilityErrorAdminMsg:d("MAWHandleReachabilityErrorAdminMsgApi").handleReachabilityErrorAdminMsg,isEmployee:d("MAWCurrentUser").isEmployee,isUseridAnnotationEnabled:c("isUseridAnnotationEnabled"),loadRecentParticipants:d("MAWReStoreDb").shouldUseReStoreDb()?d("IGDLoadRecentParticipantsApi").loadRecentParticipants:function(){return(h||(h=b("Promise"))).resolve(new Set())},mediaUploadRoot:function(){return"/wa-igd/mms"},waMessageReceiveReliabilityQplEvent:function(){return c("qpl")._(25306682,"11176")}},getCommsConfig:d("MAWCommsConfig").getCommsConfig,hmacKey:e,regData:a,serverRPC:g})["catch"](function(a){m.ERROR(j(),a);throw a}));d("MAWSharedOfflineQueueMetric").makeOfflineQueueMetric(n.oneQueue,d("WAPassiveMode").passiveModeNotifier,d("IGDCOP").cop,d("WAMessageLoggingPublisher").messageLoggingPublisher);d("MAWConfig").setConfig(d("IGDAWMainWebWorkerConfig").mawConfig);d("IGDCOP").cop.subscribeToOfflineQueue(n.oneQueue,n.protocolQueue);d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.subscribeToWAEvents(n.oneQueue);d("MAWSharedOfflineResumeUINotifier").offlineResumeUINotifier.subscribeToMawEvents(d("IGDCOP").cop);d("WAMockServerShell").isMockServerMode||c("promiseDone")(d("WAWaitForComms").waitForComms().then(function(){return d("MAWTaskDefinitions").registerTasks(d("WAWaitForUserUnblocked").waitForUserUnblocked())}));f.setHandlers("backend",d("IGDBackendBridgeHandlers").getIGDBridgeHandlers(m));d("MAWPREListeners").initializeWAPREMetrics();d("InstamadilloBackend").init(a);d("MAWDefinePersistedJob").setMsgrJobImplementations(d("IGDJobHandlers").getJobHandlers());yield n.startComms();m.LOG(i());d("WAWaitForComms").unblockComms();d("MAWQplProxy").sendQplPointThroughBridge(c("qpl")._(25310776,"6155"),"igd_backend_setup_end")});return n.apply(this,arguments)}g.startIGDBackend=a}),98);
__d("IGDLowLevelApiImpl",["IGDLowLevelApiBridgeHandlers"],(function(a,b,c,d,e,f,g){"use strict";function a(){return{bridgeHandlers:d("IGDLowLevelApiBridgeHandlers").igdBridgeHandlers}}g.makeLowLevelApi=a}),98);
__d("WADbIdentityTxnsV2",[],(function(a,b,c,d,e,f){"use strict";function a(a,b){return a.identity.bulkGet(b).then(function(a){return a.map(function(a){if(a==null)return;return{id:a.deviceJid,identity:a.identity}}).filter(Boolean)})}f.bulkGetIdentities=a}),66);
__d("WACompareIdentityV2",["WACryptoUtils","WADbIdentityTxnsV2","WADbSignal","WAJids","WASignalKeys","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield a.meta.bulkGet([d("WADbSignal").MetaKeysEnum.fbid,d("WADbSignal").MetaKeysEnum.deviceId,d("WADbSignal").MetaKeysEnum.identityKeyPair])),c=b[0],e=b[1];b=b[2];c=c==null?void 0:c.value.fbid;e=e==null?void 0:e.value.deviceId;b=b==null?void 0:b.value.identityKeyPair;if(c!=null&&e!=null){c=d("WAJids").toDeviceJid(d("WAJids").toMsgrUserJid(c),e);e=(yield d("WADbIdentityTxnsV2").bulkGetIdentities(a,[c]));if(!(e.length===0)){a=e[0];if((b==null?void 0:b.publicKey)==null)return!0;if(!d("WACryptoUtils").serializedPubKeysEqual(a.identity,d("WASignalKeys").serializePubKey(b)))return!1}return!0}return!0});return h.apply(this,arguments)}g.compareIdentity=a}),98);
__d("WAGetRegistrationInfoApi",["Promise","WACompareIdentityV2","WADbSignal","WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){return d("WASignalDB").getDb().runInTransaction(["meta","identity"],"readonly",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=(yield (h||(h=b("Promise"))).all([a.stores.meta.bulkGet([d("WADbSignal").MetaKeysEnum.lastSignedPrekeyId,d("WADbSignal").MetaKeysEnum.deviceUUID,d("WADbSignal").MetaKeysEnum.lastSessionDeviceWasLinkedTo,d("WADbSignal").MetaKeysEnum.regId,d("WADbSignal").MetaKeysEnum.identityKeyPair,d("WADbSignal").MetaKeysEnum.fbid,d("WADbSignal").MetaKeysEnum.deviceId,d("WADbSignal").MetaKeysEnum.registrationVersion]),d("WACompareIdentityV2").compareIdentity(a.stores)]));var c=a[0],e=c[0],f=c[1],g=c[2],i=c[3],j=c[4],k=c[5],l=c[6];c=c[7];a=a[1];e=e==null?void 0:(e=e.value)==null?void 0:e.lastSignedPrekeyId;f=f==null?void 0:(f=f.value)==null?void 0:f.deviceUUID;g=g==null?void 0:(g=g.value)==null?void 0:g.lastSessionDeviceWasLinkedTo;i=i==null?void 0:(i=i.value)==null?void 0:i.regId;j=j==null?void 0:(j=j.value)==null?void 0:j.identityKeyPair;k=k==null?void 0:(k=k.value)==null?void 0:k.fbid;l=l==null?void 0:(l=l.value)==null?void 0:l.deviceId;c=c==null?void 0:c.value.registrationVersion;return{lastSignedPrekeyId:e,deviceUUID:f,lastSessionDeviceWasLinkedTo:g,regId:i,identityKeyPair:j,fbid:k,deviceId:l,registrationVersion:c,identityCompareResult:a}});return function(b){return a.apply(this,arguments)}}(),d("WASignalDB").signalOp("getRegistrationInfo"))}g.getRegistrationInfo=a}),98);
__d("WASignedKeyApi",["WASignalDB"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WASignalDB").getDb().runInTransaction(["signedPrekey"],"readonly",function(b){return b.stores.signedPrekey.get(a)},d("WASignalDB").signalOp("getSignedKey"))}g.getSignedKey=a}),98);
__d("MAWDeviceRegistrationActions",["MAWCurrentUser","MAWDexieTable","MAWLoggerUtils","MAWODSProxy","MessengerWebInitData","WACompareIdentity","WADbSignal","WAGetRegistrationInfoApi","WALoggerTag","WAOdsEnums","WASignedKeyApi","WATagsLogger","asyncToGeneratorRuntime","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": signedPrekey}"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Device Registration Meta Check] Device Id should be a number"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWDeviceRegistrationActions: sessionId is null"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": signedPrekey}"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Device Registration Meta Check] Device Id should be a number"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWDeviceRegistrationActions: sessionId is null"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["",": ",""]);r=function(){return a};return a}var s="Device registration meta is incomplete: ",t=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.DeviceRegistration]);function u(a,b,e,f,g){(a!=null||b!=null||e!=null||f!=null||g!=null)&&(a==null&&t.TAGS([c("WALoggerTag").SignedPrekey]).ERROR(r(),s,d("WADbSignal").MetaKeysEnum.lastSignedPrekeyId),b==null&&t.ERROR(q(),s,d("WADbSignal").MetaKeysEnum.deviceUUID),e==null&&t.ERROR(p(),s,d("WADbSignal").MetaKeysEnum.regId),f==null&&t.ERROR(o(),s,d("WADbSignal").MetaKeysEnum.identityKeyPair),g==null&&t.ERROR(n(),s,d("WADbSignal").MetaKeysEnum.fbid))}function a(a){var b;return d("MAWDexieTable").dexieAll([a.meta.bulkGet([(b=d("WADbSignal")).MetaKeysEnum.lastSignedPrekeyId,b.MetaKeysEnum.deviceUUID,b.MetaKeysEnum.lastSessionDeviceWasLinkedTo,b.MetaKeysEnum.regId,b.MetaKeysEnum.identityKeyPair,b.MetaKeysEnum.fbid,b.MetaKeysEnum.deviceId,b.MetaKeysEnum.registrationVersion]),d("WACompareIdentity").compareIdentityDexie(a)]).then(function(b){var d=b[0],e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],j=d[5],n=d[6];d=d[7];var o=b[1],p=e==null?void 0:(b=e.value)==null?void 0:b.lastSignedPrekeyId,q=f==null?void 0:(e=f.value)==null?void 0:e.deviceUUID,r=g==null?void 0:(b=g.value)==null?void 0:b.lastSessionDeviceWasLinkedTo,v=h==null?void 0:(f=h.value)==null?void 0:f.regId,w=i==null?void 0:(e=i.value)==null?void 0:e.identityKeyPair;b=j==null?void 0:(g=j.value)==null?void 0:g.fbid;var x=n==null?void 0:(h=n.value)==null?void 0:h.deviceId,y=d==null?void 0:d.value.registrationVersion;if(p==null||q==null||v==null||w==null||b==null){u(p,q,v,w,b);return null}c("MessengerWebInitData").sessionId==null&&t.ERROR(m());if(x!=null&&typeof x!=="number"){t.ERROR(l());return null}return a.signedPrekey.get(p).then(function(a){if(a==null){t.TAGS([c("WALoggerTag").SignedPrekey]).ERROR(k(),s);return null}return{deviceId:x,deviceUUID:q,identityCompareResult:o,lastSessionDeviceWasLinkedTo:r,lastSignedPrekeyId:p,registrationVersion:y,signalRegInfo:{identityKeyPair:w,regId:v,signedPreKey:a}}})})}function e(){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAGetRegistrationInfoApi").getRegistrationInfo()),b=a.deviceId,e=a.deviceUUID,f=a.fbid,g=a.identityCompareResult,k=a.identityKeyPair,l=a.lastSessionDeviceWasLinkedTo,m=a.lastSignedPrekeyId,n=a.regId;a=a.registrationVersion;g||d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.COMPARE_IDENTITY,key:"meta_identity_mismatch"});if(m==null||e==null||n==null||k==null||f==null){u(m,e,n,k,f);return null}c("MessengerWebInitData").sessionId==null&&t.ERROR(j());if(b!=null&&typeof b!=="number"){t.ERROR(i());return null}f=(yield d("WASignedKeyApi").getSignedKey(m));if(f==null){t.TAGS([c("WALoggerTag").SignedPrekey]).ERROR(h(),s);return null}return{deviceId:b,deviceUUID:e,identityCompareResult:g,lastSessionDeviceWasLinkedTo:l,lastSignedPrekeyId:m,registrationVersion:a!=null?a:void 0,signalRegInfo:{identityKeyPair:k,regId:n,signedPreKey:f}}});return v.apply(this,arguments)}function f(a,b){var c;return d("MAWDexieTable").dexieAll([a.meta.bulkPut([{key:(c=d("WADbSignal")).MetaKeysEnum.deviceUUID,value:{deviceUUID:b.deviceUUID}},{key:c.MetaKeysEnum.fbid,value:{fbid:d("MAWCurrentUser").getID()}},{key:c.MetaKeysEnum.regId,value:{regId:b.signalRegInfo.regId}},{key:c.MetaKeysEnum.identityKeyPair,value:{identityKeyPair:b.signalRegInfo.identityKeyPair}},{key:c.MetaKeysEnum.lastSignedPrekeyId,value:{lastSignedPrekeyId:b.signalRegInfo.signedPreKey.keyId}},{key:c.MetaKeysEnum.registrationVersion,value:{registrationVersion:b.registrationVersion}},{key:c.MetaKeysEnum.authKeyPair,value:{authKeyPair:b.signalRegInfo.authKeyPair}}]),a.signedPrekey.put(b.signalRegInfo.signedPreKey)])}function w(a,b){return a.meta.put({key:d("WADbSignal").MetaKeysEnum.deviceId,value:{deviceId:b}})}function x(a,b,d){return a.contacts.get(b).then(function(c){if(c!=null)return a.contacts.put(babelHelpers["extends"]({},c,{icdcInfo:d}));else return a.contacts.put({contactJid:b,dhash:null,icdcInfo:d})}).then(c("emptyFunction"))}g.getRegistrationMetaDexie=a;g.getRegistrationMetaWorm=e;g.saveUnsentRegistrationMeta=f;g.saveDeviceId=w;g.saveICDC=x}),98);
__d("MAWConstants",[],(function(a,b,c,d,e,f){"use strict";a=5;b="Facebook user";c="Instagram user";d=3;f.MESSAGE_RETRY_COUNT_LIMIT=a;f.FB_UNKNOWN_USER=b;f.INS_UNKNOWN_USER=c;f.CURRENT_REGISTRATION_VERSION=d}),66);
__d("WAPreRegistrationCrypto",["WACryptoManager","WASignalSignatures","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";function a(){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WACryptoManager").generateRegistrationInfo()),b=a.regId,c=a.staticKeyPair;a=a.authKeyPair;var e=Date.now();e=(yield d("WASignalSignatures").generateSignedPreKey(1,e,c));var f=e.plainObject;e=e.record;return{regId:b,identityKeyPair:c,authKeyPair:a,signedPreKey:{keyId:f.id,encoded:e}}});return h.apply(this,arguments)}function e(a){var b=d("WASignalSignatures").deserializeSignedPreKey(a.signedPreKey.encoded);if(b==null||b.id!==a.signedPreKey.keyId)throw c("err")("Badly formatted signed prekey");return{regId:a.regId,identityPubKeyType:5,identityPubKey:a.identityKeyPair.publicKey,signedPreKey:b}}g.makeRegistrationData=a;g.serializeRegistrationData=e}),98);
__d("MAWDeviceRegistrationUtilWorker",["FBLogger","MAWConstants","MAWCurrentUser","URI","WABase64","WADbDeviceRegistration","WAPreRegistrationCrypto","WAWorkerGlobalScope","asyncToGeneratorRuntime","err","gkx","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,b){var c=new Uint8Array(b);a=a;for(b=b-1|0;b>=0;--b)c[b]=a&255,a=a>>>8;return c}function j(a,b,c,e,f,g,h,j,k){var l;f=(l=d("WABase64")).encodeB64(i(f,4));g=l.encodeB64(i(g,1));h=l.encodeB64(h);var m=l.encodeB64(i(j.id,3)),n=l.encodeB64(j.keyPair.publicKey);l=l.encodeB64(j.signature);j=new Map().set("fbid",a).set("fb_cat",b).set("app_id",c).set("device_id",e).set("e_regid",f).set("e_keytype",g).set("e_ident",h).set("e_skey_id",m).set("e_skey_val",n).set("e_skey_sig",l);if(k){a=d("WABase64").encodeB64(k.signedICDCIdentityList);b=d("WABase64").encodeB64(k.ihash);j.set("icdc_list",a).set("icdc_ts",k.ts).set("icdc_seq",k.seq).set("ihash",b)}return j}function k(a){var b=[];a.forEach(function(a,c,d){b.push(encodeURIComponent(c)+("="+encodeURIComponent(a.toString())))});return b.join("&")}function l(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("WAWorkerGlobalScope").workerGlobalScope.fetch(b,{body:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST"}));return yield b.json()});return m.apply(this,arguments)}function n(a,b){return o.apply(this,arguments)}function o(){o=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b=(yield d("WAWorkerGlobalScope").workerGlobalScope.fetch(b,{body:a,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST"}));return b.json()});return o.apply(this,arguments)}function p(){var a=new(h||(h=c("URI")))(s()+d("WADbDeviceRegistration").ICDC_ENDPOINT);return a.toString()}function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=p();a=(yield l(a,b));if(a==null)throw c("err")(d("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER);if(a.status!==200)throw c("err")("WA Server returned status code "+a.status+" while attempting device registration");return a});return r.apply(this,arguments)}function s(){var a=Number(d("MAWCurrentUser").getAppID()),b=d("WADbDeviceRegistration").REG_FB_DOMAIN;switch(a){case 1217981644879628:case 936619743392459:case 487152425211411:case 1035956773910536:b=d("WADbDeviceRegistration").REG_IGD_DOMAIN;break;case 772021112871879:b=d("WADbDeviceRegistration").REG_MSGR_DOMAIN;break;default:b=d("WADbDeviceRegistration").REG_FB_DOMAIN}return b}function t(){var a=new(h||(h=c("URI")))(s()+d("WADbDeviceRegistration").REGISTRATION_ENDPOINT);return a.toString()}var u=new Set(["www.facebook.com","intern.facebook.com","web.facebook.com","www.instagram.com","www.messenger.com"]);function v(){if(c("gkx")("2456")){var a=d("WAWorkerGlobalScope").workerGlobalScope.location.hostname;u.has(a)||c("FBLogger")("bt","device_registration").warn("Invalid subdomain for device registration: %s",a)}}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=t();v();var e;try{e=(yield n(a,b))}catch(a){throw c("err")("Post request failed: "+(a==null?void 0:a.message)+" url:"+b)}if(e==null)throw c("err")(d("WADbDeviceRegistration").NULL_RESPONSE_FROM_SERVER);if(e.status!==200){c("FBLogger")("messenger_e2ee_web").warn("WA Server returned status code %s %s while attempting device registration",e.status,(a=e.message)!=null?a:"");return{message:(b=e.message)!=null?b:"Empty message",status:e.status,success:!1}}if(typeof e.wa_device_id!=="number")throw c("err")("Device ID from WA Server was not a number");if(typeof e.product!=="string")throw c("err")("Product info from WA Server was not a string");return{edge_routing_info:e.edge_routing_info,icdc_success:e.icdc_success,product:e.product,status:200,success:!0,type:e.type,wa_device_id:e.wa_device_id}});return x.apply(this,arguments)}function a(a,b,c,d){a=new Map().set("fbid",a).set("fb_cat",b).set("app_id",c).set("device_id",d);b=k(a);return q(b)}function e(a,b,c,d,e,f,g,h,i){a=j(a,b,c,d,e,f,g,h,i);b=k(a);return w(b)}function f(){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield d("WAPreRegistrationCrypto").makeRegistrationData());return{deviceUUID:c("uuidv4")(),lastSignedPrekeyId:a.signedPreKey.keyId,registrationVersion:d("MAWConstants").CURRENT_REGISTRATION_VERSION,signalRegInfo:a}});return y.apply(this,arguments)}g.getRegistrationEndpoint=t;g.fetchICDC=a;g.register=e;g.createNewRegistrationMeta=f}),98);
__d("MAWDbInitIndexedDb",["MAWIndexedDb","MWEARKeychainV3","WALogger","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[DB INIT] REGULAR DB INIT"]);h=function(){return a};return a}function a(a){a=a.onDbPopulate;d("WALogger").LOG(h());return d("MAWIndexedDb").makeDB(d("MWEARKeychainV3").getDbEncryptionKey,{enableDataSyncMiddleware:!0,enableMutationValidator:c("gkx")("1627"),onDbPopulate:a})}g.dbInit=a}),98);
__d("getBroadcastChannelForExecutionContext",["CometTaskFrameworkTypes","MWBroadcastChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("MWBroadcastChannel").MWBroadcastChannel(d("CometTaskFrameworkTypes").TASK_FRAMEWORK_PREFIX+"_"+String(a))}g["default"]=a}),98);
__d("loadTaskHandlerResource",["asyncToGeneratorRuntime","cr:3760"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=b("cr:3760").TASK_HANDLERS_RESOURCES[a];return a==null?null:a.getModuleIfRequired()||a.load()});return h.apply(this,arguments)}g["default"]=a}),98);
__d("registerExecutionContext",["BroadcastChannelClientServerHandshake","FBLogger","asyncToGeneratorRuntime","getBroadcastChannelForExecutionContext","loadTaskHandlerResource","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return i.apply(this,arguments)}function i(){i=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var d=a.context,e=a.name,f=a.payload;try{var g=(yield c("loadTaskHandlerResource")(e));if(g==null)throw c("FBLogger")("maw_worker").mustfixThrow("No task handler found in context %s",e);e=(yield g.handleTask(f,d));g={context:d,result:e,type:"task_success"};b.postMessage(g)}catch(g){c("FBLogger")("maw_worker").catching(g).mustfix("%s executionContext: Failed to execute task %s",String(a.context.executionContext),a.name);e={context:d,reason:(f=g.message)!=null?f:"",type:"task_failure"};b.postMessage(e)}return});return i.apply(this,arguments)}function a(a){var b=c("getBroadcastChannelForExecutionContext")(a);d("BroadcastChannelClientServerHandshake").listen(b);var e=new Set();b.addEventListener("message",function(a){switch(a.data.type){case"execute_task":a=a.data;var d=a.context.taskID;if(e.has(d))return;e.add(d);c("promiseDone")(h(a,b)["finally"](function(){e["delete"](d)}));break;default:}});return function(){return b.close()}}g["default"]=a}),98);
__d("WorkerBanzaiLazyQueueChannelWorker",["BanzaiLazyQueue","WorkerFuncChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=d("WorkerFuncChannel").importChannel({queuePost:null},a,"banzai_lazyqueue_channel");c("BanzaiLazyQueue").onQueue.add(function(){h(b)});h(b)}function h(a){c("BanzaiLazyQueue").flushQueue().forEach(function(b){a.queuePost.apply(a,b)})}g.init=a}),98);
__d("WorkerSelf",["WorkerBanzaiLazyQueueChannelWorker","WorkerFuncChannel","WorkerQPLChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("WorkerFuncChannel").activateChannels(a,"worker","client"),d("WorkerBanzaiLazyQueueChannelWorker").init(a),d("WorkerQPLChannel").setMessagePort(a)}g.init=a}),98);
__d("IGDAWMainWebWorker",["CurrentWorkerMessagePort","FalcoLoggerTransports","IGDAWMainWebWorkerConfig","IGDBackend","IGDLowLevelApiImpl","MAWCommonMainWebWorker","WorkerBridgeAdaptor"],(function(a,b,c,d,e,f,g){"use strict";function a(){self.Env=self.Env||{};var a=new(c("WorkerBridgeAdaptor"))(d("CurrentWorkerMessagePort").getMessagePort(),"IGDAWMainWebWorker");d("MAWCommonMainWebWorker").initWorker(a,d("IGDLowLevelApiImpl").makeLowLevelApi,d("IGDAWMainWebWorkerConfig").waConfig,d("IGDBackend").startIGDBackend);d("FalcoLoggerTransports").attach()}g["default"]=a}),98);
__d("MAWIncomingReceiptUtils",["WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["User "," is in affectedUserJids in receipt-writing results, but they have no corresponding read/delivery receipt entry in the DB"]);h=function(){return a};return a}function a(a){var b=new Map();a.forEach(function(a){if(a.msgRenderType==="unrendered")return;a.affectedUserJids.forEach(function(c){var e=a.receipt.statusTsPerUser.get(c);if(e==null){d("WALogger").WARN(h(),c);return}c=[a.threadJid,c];var f=b.get(JSON.stringify(c)),g=e.deliveredTs!=null,i=e.readTs!=null;g=g?a.msgTs:0;i=i?a.msgTs:0;e=(e=e.readTs)!=null?e:0;if(f!=null){var j=f.lastDeliveredMsgTs,k=f.lastReadMsgTs;f=f.lastReadActionTs;g=Math.max(g,j);i=Math.max(i,k);e=Math.max(e,f)}b.set(JSON.stringify(c),{lastDeliveredMsgTs:d("WATimeUtils").castToUnixTime(g),lastReadActionTs:d("WATimeUtils").castToUnixTime(e),lastReadMsgTs:d("WATimeUtils").castToUnixTime(i)})})});return new Map(Array.from(b).map(function(a){var b=a[0];a=a[1];return[JSON.parse(b),a]}))}g.getMaxTimestampsPerParticipant=a}),98);
__d("MAWAckAndTimestampUpdatesForReceiptsTxns",["MAWDbMsgTxns","MAWDbParticipantTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWIncomingReceiptUtils","MAWLoggerUtils","WATagsLogger","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Updating timestamps for "," participants"]);h=function(){return a};return a}var i=d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.Countdown,d("MAWLoggerUtils").Tag.Incoming]);function a(a,b,e){b=d("MAWIncomingReceiptUtils").getMaxTimestampsPerParticipant(b);i.LOG(h(),b.size);var f=[];b.forEach(function(a,b){f.push({deliveredWatermarkTs:a.lastDeliveredMsgTs,lastReadActionTs:a.lastReadActionTs,lastReadWatermarkTs:a.lastReadMsgTs,participantKey:b})});b=e.regular.length>0?d("MAWDbMsgTxns").bulkUpdateSystemAck(a,e.regular):d("MAWDexieTable").dexieResolve();e=e.unrendered.length>0?d("MAWDbUnrenderedMsgTxns").bulkUpdateSystemAckForUnrenderedMsgs(a,e.unrendered):d("MAWDexieTable").dexieResolve();b=d("MAWDexieTable").dexieAll([b,e]);return d("MAWDexieTable").dexieAll([b,f.length>0?d("MAWDbParticipantTxns").bulkUpdateParticipantTimestamps(a,f,i):d("MAWDexieTable").dexieResolve()]).then(c("emptyFunction"))}g.handleAckAndTimestampUpdatesForReceipts=a}),98);
__d("MAWAdminWriteUsersConnectedMsgTxn",["MAWDbMsgTxns","MAWDbThreadTxns","MAWDexieTable","MAWIndexedDb","MAWLocalizationType","MAWLocalizationUtils","MAWUserJidWrapper","MAWWriteMsgTxns","MessengerMSplitFlag","WAJids","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeUsersConnectedAdminMsg found a thread without messages from both users, which we'll not append to."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeUsersConnectedAdminMsg failed to create or get 1:1 thread"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["writeUsersConnectedAdminMsg is called for self thread"]);j=function(){return a};return a}function a(a,b,e,f){var g=d("MAWUserJidWrapper").getMyUserJid();if(b===g){d("WALogger").WARN(j());return d("MAWDexieTable").dexieResolve()}return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success){d("WALogger").WARN(i());return}var j=b.value;return d("MAWDbMsgTxns").getNonAdminMsgs(a,j.jid).then(function(b){var i=b.find(function(a){return a.author===g||a.author===d("WAJids").AUTHOR_ME})!=null;b=b.find(function(a){return a.author!==g&&a.author!==d("WAJids").AUTHOR_ME})!=null;if(!i||!b){d("WALogger").WARN(h());return}i=d("MAWLocalizationUtils").buildUnstoredDbAdminMsg({adminMsgContent:[],adminType:c("MessengerMSplitFlag").is_msplit_account||e?d("MAWLocalizationType").LOCALIZATION_TYPE.TWO_USERS_CONNECTED_ONE_MSPLIT:d("MAWLocalizationType").LOCALIZATION_TYPE.TWO_USERS_CONNECTED,version:1},j.jid,f);return d("MAWWriteMsgTxns").writeMsg(a,i,j,"MAWAdminWriteUsersConnectedMsgTxn").then(function(){var a=d("WAJids").interpretAsUserJid(j.jid);if(a==null)return;d("MAWIndexedDb").afterTransaction({tag:"UpdateContactAsConnected",value:{contactUserId:d("WAJids").extractUserId(a),threadJid:j.jid}})})})})}g.writeUsersConnectedAdminMsg=a}),98);
__d("MAWBulkGetAppDataForRetryApi",["MAWIndexedDb","MAWTransactionMode","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h=30*d("WATimeUtils").DAY_SECONDS;a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READONLY},"bulkGetAppDataForRetry",function(a){return function(b){var c=b.map(function(a){a=a.externalId;return a});return a.appData.where("externalId").anyOf(c).toArray().then(function(a){var c=new Map(a.map(function(a){return[a.externalId,a]}));return b.map(function(a){var b=a.deviceJid;a=a.externalId;a=c.get(a);if(a==null)return{type:"missing"};b=a.permittedIdentitiesPerDevice.get(b);return b==null||!d("WATimeUtils").happenedWithin(a.ts,h)?{type:"unauthorized"}:{appData:a.contents,deviceIdentity:b,permittedIdentitiesPerDevice:a.permittedIdentitiesPerDevice,type:"unacked"}})})}});g.bulkGetAppDataForRetry=a}),98);
__d("MAWIncomingReceiptDataFormatTxns",["MAWDbMsgTxns","MAWDbUnrenderedMsgTxns","MAWDexieTable","MAWMsgType","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to map the threadId of a message to its threadJid during receipt-writing"]);h=function(){return a};return a}function i(a){var b=a.author,c=a.chat;a=a.externalId;return c+"_"+a+"_"+b}function a(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve();var c=new Map(),e=new Set();b.forEach(function(a){a=a.msgs;a.forEach(function(a){return e.add(babelHelpers["extends"]({},a))})});a=d("MAWDexieTable").dexieAll([d("MAWDbMsgTxns").getMsgsByProtocolMsgId(a,Array.from(e)),d("MAWDbUnrenderedMsgTxns").getUnrenderedMsgsByProtocolMsgId(a,Array.from(e))]).then(function(a){var b=a[0];a=a[1];var c=[];b.forEach(function(a){return c.push({msg:a,renderType:"regular"})});a.forEach(function(a){return c.push({msg:a,renderType:"unrendered"})});return{msgs:c}});return a.then(function(a){a=a.msgs;b.forEach(function(a){var b=a.msgs,d=a.receivers,e=a.type;b.forEach(function(a){var b=i(a),f=c.get(b)||{deliveryReceipts:[],protocolMsgId:a,readReceipts:[],senderReceipts:[]};d.forEach(function(a){if(e==="read"||e==="read-self"){f.readReceipts.push(a);return}else if(e==="delivered"){f.deliveryReceipts.push(a);return}else if(e==="sender"){f.senderReceipts.push(a);return}else if(e==="inactive"){f.deliveryReceipts.push(a);return}e});c.set(b,f)})});var e=new Map(),f=new Map(),g=[];a.forEach(function(a){var b=a.msg,g=b.author,j=b.externalId,k=b.msgId,l=b.threadJid;b=b.type;if(l==null){d("WALogger").ERROR(h());return}if(b!==d("MAWMsgType").MSG_TYPE.CIPHERTEXT){b=i({author:g,chat:l,externalId:j});g=c.get(b);if(g!=null){g.protocolMsgId;l=babelHelpers.objectWithoutPropertiesLoose(g,["protocolMsgId"]);j=babelHelpers["extends"]({msgId:k},l);f.set(k,j);c["delete"](b)}}e.set(k,a)});c.forEach(function(a){var b=a.deliveryReceipts,c=a.protocolMsgId;a=a.readReceipts;if(b.length===0&&a.length===0)return;var d=c.author,e=c.chat;c=c.externalId;g.push({author:d,deliveryReceipts:b,externalId:c,readReceipts:a,thread:e})});return{msgIdToDbMsgMap:e,pendingReceiptsToWrite:g,receiptsToWriteMap:f}})}g.prepareDataForReceiptsToWrite=a}),98);
__d("MAWIncomingReceiptDataFormatUtils",["MAWAckLevel","MAWDbMsg"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var c=[],e=[];a.forEach(function(a){var f=null,g=a.receipt.msgId,h=a.receipt.statusTsPerUser,i=b.get(g);if(i==null)return;var j=i.msg;i=i.renderType;a.affectedUserJids.forEach(function(a){var b,c=null;((b=h.get(a))==null?void 0:b.readTs)!=null?c=d("MAWAckLevel").ACK.read:((b=h.get(a))==null?void 0:b.deliveredTs)!=null&&(c=d("MAWAckLevel").ACK.received);f=f==null||c!=null&&c>f?c:f});f!=null&&f>j.ack&&(i==="regular"?c.push({ack:f,msgId:g,reportingMeta:null}):(i,e.push({ack:f,msgId:g})))});return{regular:c,unrendered:e}}function b(a,b,c){return a.map(function(a){var e=b.get(a.receipt.msgId);if(e==null)return null;var f=e.msg,g=c.get(f.msgId);return g==null||g.deliveryReceipts.length===0&&g.readReceipts.length===0?null:babelHelpers["extends"]({},a,{externalId:f.externalId,msgRenderType:e.renderType,msgTs:d("MAWDbMsg").getCanonicalTsFromMsg(f),threadJid:f.threadJid})}).filter(Boolean)}g.createUpdateSystemAckParams=a;g.formatWriteReceiptResultsWithExtras=b}),98);
__d("MAWReceiptTrace",["ArmadilloDataTraceType","MAWBridgeTrace","MAWBridgeTraceEvent","MAWIndexedDb"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(a==="delivered"){a=b.reduce(function(a,b){return b.externalId!=null?[].concat(a,[b.externalId]):a},[]);a.length>0&&d("MAWIndexedDb").afterTransaction({tag:"UpdateTrace",value:d("MAWBridgeTrace").createBridgeUpdateTraceData(a,c("MAWBridgeTraceEvent").ReceivedReceipt,d("ArmadilloDataTraceType").armadilloMessageSend)})}}g.flushTrace=a}),98);
__d("MAWIncomingReceiptTxns",["MAWAckAndTimestampUpdatesForReceiptsTxns","MAWDbPendingReceiptTxns","MAWDbReceiptTxns","MAWDexieTable","MAWIncomingReceiptDataFormatUtils","MAWReceiptTrace"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){if(b==null)return d("MAWDexieTable").dexieResolve();var c=b.msgIdToDbMsgMap,e=b.pendingReceiptsToWrite,f=b.receiptsToWriteMap;b=Array.from(f.values());return d("MAWDexieTable").dexieAll([d("MAWDbReceiptTxns").bulkWriteReceiptsForDevices(b),d("MAWDbPendingReceiptTxns").bulkAddPendingReceipts(a,e)]).then(function(b){b=b[0];var e=d("MAWIncomingReceiptDataFormatUtils").createUpdateSystemAckParams(b,c);b=d("MAWIncomingReceiptDataFormatUtils").formatWriteReceiptResultsWithExtras(b,c,f);var g=b.filter(function(a){a=((a=f.get(a.receipt.msgId))==null?void 0:a.deliveryReceipts)||[];return a.length>0});g.length>0&&d("MAWReceiptTrace").flushTrace("delivered",g);return d("MAWAckAndTimestampUpdatesForReceiptsTxns").handleAckAndTimestampUpdatesForReceipts(a,b,e)})}g.bulkHandleIncomingReceipts=a}),98);
__d("MAWWriteAppDataReceiptsApi",["MAWDexieTable","MAWIndexedDb","MAWTransactionMode","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE},"writeAppDataReceipts",function(a){return function(b){return h(a,b).then(function(b){return i(a,b)})}});function h(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve();b=b.reduce(function(a,b){var c=a.appDataExternalIdSet,d=a.appDataReceiversSet;a=b.externalIds;b=b.receivers;a.forEach(function(a){c.add(a)});b.forEach(function(a){d.add(a)});return{appDataExternalIdSet:c,appDataReceiversSet:d}},{appDataExternalIdSet:new Set(),appDataReceiversSet:new Set()});var c=b.appDataExternalIdSet;b=b.appDataReceiversSet;c=Array.from(c);var e=Array.from(b);return a.appData.where("externalId").anyOf(c).toArray().then(function(a){if(a.length===0)return;return j(a,e)})}function i(a,b){if(b==null)return d("MAWDexieTable").dexieResolve();var e=b.toDelete;b=b.toUpdate;return d("MAWDexieTable").dexieAll([e.length>0?a.appData.bulkDelete(e):d("MAWDexieTable").dexieResolve(),b.length>0?a.appData.bulkPut(b):d("MAWDexieTable").dexieResolve()]).then(c("emptyFunction"))}function j(a,b){return a.reduce(function(a,c){if(c==null)return a;for(var d=0;d<b.length;d++){var e=b[d];c.permittedIdentitiesPerDevice["delete"](e)}if(c.permittedIdentitiesPerDevice.size===0){a.toDelete.push(c.appDataId);return a}else{a.toUpdate.push(c);return a}},{toDelete:[],toUpdate:[]})}g.writeAppDataReceipts=a;g.prepareBulkAppDataReceipts=h;g.writeBulkAppDataReceipts=i}),98);
__d("MAWWritePeerMsgReceiptsApi",["MAWDbMsg","MAWDbMsgTxns","MAWDbPendingReceiptTxns","MAWDexieTable","MAWLoggerUtils","MAWMarkThreadAsReadTxns","MAWMsgType","WAGlobals","WAJids","WATagsLogger","WATimeUtils","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Processing "," receipt for messages not from me"]);h=function(){return a};return a}function i(a,b,c){return d("MAWDbMsgTxns").maybeGetMsgByProtocolMsgId(a,b).then(function(a){return a==null||a.type===d("MAWMsgType").MSG_TYPE.CIPHERTEXT?{msg:b,readReceipt:c,type:"missing"}:{dbMsg:a,msg:b,readReceipt:c,type:"found"}})}function j(a){a=a.map(function(a){return a.type==="missing"?null:a.dbMsg}).filter(Boolean);return a.reduce(function(a,b){var c=b.threadJid,e=d("WATimeUtils").castToMillisTime(d("MAWDbMsg").getSortOrderWithFallback(b)),f=a.get(c);(f==null||e>f.msgSortOrderMs)&&a.set(c,{msgId:b.msgId,msgSortOrderMs:e});return a},new Map())}function a(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve([]);b=b.map(function(a){d("WATagsLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.PeerReceipt]).LOG(h(),a.type);if(a.type==="delivered")return;var b={device:void 0,ts:void 0};a.receivers.forEach(function(a){var c=a.device;a=a.ts;var e=d("WAJids").extractUserJid(c);e===d("WAGlobals").getMyUserJid()&&(b.ts==null||a<b.ts)&&(b.device=c,b.ts=a)});if(b.device!=null&&b.ts!=null)return babelHelpers["extends"]({},a,{receivers:{device:b.device,ts:b.ts}});else return}).filter(Boolean);var c=[];b.forEach(function(a){a.msgs.forEach(function(b){c.push([b,a.receivers])})});return d("MAWDexieTable").dexieAll(c.map(function(b){var c=b[0];b=b[1];return i(a,c,b)}))}function b(a,b){if(b.length===0)return d("MAWDexieTable").dexieResolve();var e=[],f=[];b.map(function(a){a.type==="missing"?e.push({author:a.msg.author,deliveryReceipts:[],externalId:a.msg.externalId,readReceipts:[a.readReceipt],thread:a.msg.chat}):f.push({msgId:a.msg,ts:a.readReceipt.ts})});var g=j(b);b=b.reduce(function(a,b){b=b.msg.chat;var c=g.get(b);c!=null&&a.set(b,{msgId:c.msgId,sortOrderMs:c.msgSortOrderMs});return a},new Map());return d("MAWDexieTable").dexieAll([d("MAWDbPendingReceiptTxns").bulkAddPendingReceipts(a,e),d("MAWMarkThreadAsReadTxns").bulkMarkThreadAsReadUpToMsgSortOrderMs(a,b)]).then(c("emptyFunction"))}g.getResultByProtocolMsgId=i;g.prepareReceiptsForMeToWrite=a;g.bulkWritePeerReceiptsForMsgsNotFromMeInternal=b}),98);
__d("MAWBulkWriteReceiptsApi",["MAWDexieTable","MAWIncomingReceiptDataFormatTxns","MAWIncomingReceiptTxns","MAWIndexedDb","MAWTransactionMode","MAWWriteAppDataReceiptsApi","MAWWritePeerMsgReceiptsApi","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c=[],e=[],f=[];b.forEach(function(a){switch(a.type){case"msg-receipt":c.push(a.params);break;case"not-from-me":e.push(a.params);break;default:f.push(a.params);break}});return d("MAWDexieTable").dexieAll([f.length>0?d("MAWWriteAppDataReceiptsApi").prepareBulkAppDataReceipts(a,f):d("MAWDexieTable").dexieResolve(),c.length>0?d("MAWIncomingReceiptDataFormatTxns").prepareDataForReceiptsToWrite(a,c):d("MAWDexieTable").dexieResolve(),e.length>0?d("MAWWritePeerMsgReceiptsApi").prepareReceiptsForMeToWrite(a,e):d("MAWDexieTable").dexieResolve([])]).then(function(a){var b=a[0],c=a[1];a=a[2];if(b==null)return{incomingReceiptData:c,processedPeerReceiptsNotForMeResults:a};var d=b.toDelete;b=b.toUpdate;return{appDataReceipts:{toDelete:d,toUpdate:b},incomingReceiptData:c,processedPeerReceiptsNotForMeResults:a}})}b=d("MAWIndexedDb").makeMsgrTransactor({appData:(a=d("MAWTransactionMode")).READWRITE,chunk:a.READONLY,media:a.READONLY,messages:a.READWRITE,participants:a.READWRITE,pendingReceipts:a.READWRITE,receiverFetchInfo:a.READONLY,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READONLY},"bulkWriteReceipts",function(a){return function(b){return b.length===0?d("MAWDexieTable").dexieResolve():h(a,b).then(function(b){var e=b.appDataReceipts,f=b.incomingReceiptData;b=b.processedPeerReceiptsNotForMeResults;return d("MAWDexieTable").dexieAll([e!=null&&(e==null?void 0:e.toDelete.length)>0&&(e==null?void 0:e.toUpdate.length)>0?d("MAWWriteAppDataReceiptsApi").writeBulkAppDataReceipts(a,e):d("MAWDexieTable").dexieResolve(),f!=null?d("MAWIncomingReceiptTxns").bulkHandleIncomingReceipts(a,f):d("MAWDexieTable").dexieResolve(),b.length>0?d("MAWWritePeerMsgReceiptsApi").bulkWritePeerReceiptsForMsgsNotFromMeInternal(a,b):d("MAWDexieTable").dexieResolve()]).then(c("emptyFunction"))})}});g.bulkWriteReceipts=b}),98);
__d("MAWDbHistorySyncQRCodeData",[],(function(a,b,c,d,e,f){"use strict";a="qrCodeRowId";f.qrCodeRowId=a}),66);
__d("MAWHandleEncryptedBackupsSecretsApi",["MAWDbHistorySyncQRCodeData","MAWIndexedDb","MAWTransactionMode","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({historySyncQRCodeData:d("MAWTransactionMode").READWRITE},"handleEncryptedBackupsSecret",function(a){return function(b){var e=b.backupId,f=b.epoch,g=b.mailboxRootKey,i=b.obliviousValidationToken,j=b.serverDataId,k=b.tempOcmfClientState;return a.historySyncQRCodeData.get(d("MAWDbHistorySyncQRCodeData").qrCodeRowId).then(function(b){if(!(b==null?void 0:b.isQRScanned))return a.historySyncQRCodeData.put({isQRScanned:!0,rowId:d("MAWDbHistorySyncQRCodeData").qrCodeRowId}).then(function(a){d("MAWIndexedDb").afterTransaction({tag:"CallFinishAddDevice",value:{backupId:e.toString(),epoch:h(f),mailboxRootKey:g,obliviousValidationToken:i,serverDataId:j.toString(),tempOcmfClientState:k}});return})["catch"](function(b){return a.historySyncQRCodeData.put({isQRScanned:!1,rowId:d("MAWDbHistorySyncQRCodeData").qrCodeRowId}).then(c("emptyFunction"))})})}});function h(a){return a.map(function(a){var b=a.anonId,c=a.id,d=a.rootKey;a=a.status;return{epoch_anon_id:b,epoch_id:c.toString(),epoch_root_key:d,epoch_status:a.toString()}})}g.handleEncryptedBackupsSecret=a}),98);
__d("MAWWriteMetaSyncsTxns",["MAWDbDeletedMessages","MAWDbPendingStanza","MAWDbPendingStanzaTxns","MAWDbThreadTxns","MAWDexieTable","MAWFTSTxns","MAWThreadManagementTxns","WALogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[MAWWriteMetaSyncsTxns] Thread delete stanza was processed before thread insertion ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received chatDelete: ",""]);i=function(){return a};return a}var j=30*d("WATimeUtils").DAY_SECONDS;function a(a,b){d("WALogger").LOG(i(),b);var c=b.messageRange;c=c!=null?d("MAWDbPendingStanzaTxns").putPendingStanza(a,{content:{metaSyncMessageRange:c},type:d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD},j,b.chatJid,d("MAWDbPendingStanza").PENDING_TYPE.DELETE_THREAD):d("MAWDexieTable").dexieResolve();return d("MAWDexieTable").dexieAll([d("MAWDbThreadTxns").getThread(a,b.chatJid),c,d("MAWFTSTxns").maybePutThreadToPurgeBacklog(a,b.chatJid)]).then(function(c){c=c[0];if(c.success)return d("MAWThreadManagementTxns").metaSyncChatDeleteThread(a,c.value,b.messageRange,d("MAWDbDeletedMessages").DbDeletedMsgReasonEnum.cast(b.type));else{d("WALogger").LOG(h(),b.chatJid);return{deletedMessages:[]}}})}g.PENDING_DELETE_THREAD_EXPIRATION_IN_SEC=j;g.handleChatDelete=a}),98);
__d("WADeleteReceiptsApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){return a.receipts.where("waMsgId").anyOf(b)["delete"]().then(function(){})}a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"deleteReceipts",function(a){return function(b){return h(a,b)}});g.deleteAllReceiptsForWAMsgIds=h;g.deleteReceipts=a}),98);
__d("MAWHandleMetaSyncAction",["MAWIndexedDb","MAWTransactionMode","MAWWriteDeleteMessageTxns","MAWWriteMetaSyncsTxns","Promise","WAAssertUnreachable","WADeleteReceiptsApi","WALogger","asyncToGeneratorRuntime","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received action: ",""]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){for(a of a.actions)a.chatAction?yield k(a.chatAction):a.messageAction&&(yield n(a.messageAction))});return j.apply(this,arguments)}function k(a){d("WALogger").LOG(i(),a);switch(a.type){case"chat_archive":return l(a);case"chat_delete":return o(a).then(function(a){a=a.deletedMessages;return d("WADeleteReceiptsApi").deleteReceipts(a)});default:a.type;return m(a)}}function l(a){return(h||(h=b("Promise"))).resolve()}function m(a){return(h||(h=b("Promise"))).resolve()}function n(a){switch(a.type){case"delete_for_me":return p(a).then(c("emptyFunction"));default:return c("WAAssertUnreachable")(a.type)}}var o=d("MAWIndexedDb").makeMsgrTransactor({chunk:(e=d("MAWTransactionMode")).READWRITE,deletedMessages:e.READWRITE,editMsgHistory:e.READWRITE,ftsPurgeThreadBacklog:e.READWRITE,groupInfo:e.READWRITE,groupInvites:e.READWRITE,media:e.READWRITE,messages:e.READWRITE,participants:e.READWRITE,pendingStanzas:e.READWRITE,reactions:e.READWRITE,threads:e.READWRITE,unrenderedMessages:e.READWRITE,xma:e.READWRITE},"handleChatDeleteTxn",function(a){return function(b){return d("MAWWriteMetaSyncsTxns").handleChatDelete(a,b)}}),p=d("MAWIndexedDb").makeMsgrTransactor({chunk:e.READWRITE,editMsgHistory:e.READWRITE,ftsPurgeBacklog:e.READWRITE,groupInfo:e.READWRITE,groupInvites:e.READWRITE,media:e.READWRITE,messages:e.READWRITE,participants:e.READWRITE,pendingStanzas:e.READWRITE,reactions:e.READWRITE,threads:e.READWRITE,unrenderedMessages:e.READWRITE,xma:e.READWRITE},"handleDeleteForMeTxn",function(a){return function(b){return d("MAWWriteDeleteMessageTxns").handleDeleteForMe(a,b)}});g.handleMetaSyncActions=a}),98);
__d("MAWProtocolQueueAppdata",["MAWHandleEncryptedBackupsSecretsApi","MAWHandleMetaSyncAction","MAWSharedCOPLogger","Promise","WAConvertAppData","WAMsgApplication.pb","WAParseMessageApplication","WAProtocolQueue","WAResultOrError","decodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown appdata type: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle appdata: backup secret"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle appdata: meta sync"]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle appdata"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Appdata contains unparseable message application."]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Parse Appdata application protocol"]);n=function(){return a};return a}function a(a){var c=a.map(function(a){return o(a.appdata)});return(h||(h=b("Promise"))).all(c.map(function(a){a=p(a);return a})).then(function(b){var c=[];b.map(function(b,d){b.success===!0&&c.push(a[d].stanzaQueueId)});return{followUpParams:void 0,toAck:c}})}function o(a){c("MAWSharedCOPLogger").DEV(n());a=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMsgApplication.pb").MessageApplicationSpec,d("WAProtocolQueue").extractSubProtocolFromAppdataProtocol(a).payload);a=d("WAParseMessageApplication").parseMessageApplication(a);if(a.type==="error"){c("MAWSharedCOPLogger").ERROR(m());return}return d("WAConvertAppData").parseAppData(a)}function p(a){c("MAWSharedCOPLogger").LOG(l());if(a==null)return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());switch(a.type){case"meta_sync":c("MAWSharedCOPLogger").LOG(k());return d("MAWHandleMetaSyncAction").handleMetaSyncActions(a).then(function(){return d("WAResultOrError").makeResult()});case"backups_secrets":c("MAWSharedCOPLogger").LOG(j());return d("MAWHandleEncryptedBackupsSecretsApi").handleEncryptedBackupsSecret(a.encryptedBackupsSecrets).then(function(){return d("WAResultOrError").makeResult()});case"sync_key_share":return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());case"sync_key_request":return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult());default:a.type;c("MAWSharedCOPLogger").WARN(i(),a.type);return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())}}g.handleAppdataStanzas=a}),98);
__d("MAWCOPAppdataHandler",["MAWIsQuotaExceededError","MAWProtocolQueueAppdata","MAWSharedCOPLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing appdata batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["appdata consumer: ",""]);i=function(){return a};return a}function a(a){return j(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];var b=(yield d("MAWProtocolQueueAppdata").handleAppdataStanzas(a));b.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());return b.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("WAUpdateDevicesForUserApi",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=a.allowSecurityAlertForContact;a=a.isMe;return!a&&b}f.getShouldShowAdminMessages=a}),66);
__d("WAUpdateRotateSenderKeyToTrue",["MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"updateRotateSenderKeyToTrue",function(a){return function(b){return d("WADbPersonalSenderKeyStatusTxns").bulkSetRotateSenderKeyToTrueTxn(a,b)}});g.updateRotateSenderKeyToTrue=a}),98);
__d("MAWProtocolQueueInstructions",["MAWAdminWriteUserDeviceMsgTxn","MAWBridge","MAWDbAddDeviceChangeAlertsTxn","MAWDbDeviceChangeAlerts","MAWDbGetAlertsWithDeviceJidTxn","MAWDbGetUnArchivedDeviceChangeAlertsCountTxn","MAWDbMsgTypeVersionTxns","MAWDbThreadTxns","MAWDbUpdateDeviceChangeAlertsLogInStatusTxn","MAWDexieTable","MAWIndexedDb","MAWODSProxy","MAWTransactionMode","WAAssertUnreachable","WADbContact","WAGlobals","WAJids","WALogger","WAOdsEnums","WAUpdateDevicesForUserApi","WAUpdateRotateSenderKeyToTrue","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["ICDC error instruction for thread "," not found"]);h=function(){return a};return a}function i(a,b){b=new Set(b.map(function(a){return a.jid}));return d("MAWDexieTable").dexieAll([d("MAWDbMsgTypeVersionTxns").maybeBulkGetSecuritySetting(a),d("MAWDbThreadTxns").getAllThreadsForUsers(a,Array.from(b))])}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=(yield d("MAWBridge").getBridge().sendAndReceive("event","getLSDBUsersRelationships",{users:Array.from(new Set(a.map(function(a){return a.jid})))}));a=(yield k(a,b));b=a.followUpParams;a=a.toAck;b=b.groupsToUpdateForIdentityRemoved.flat();yield d("WAUpdateRotateSenderKeyToTrue").updateRotateSenderKeyToTrue(b);return{followUpParams:void 0,toAck:a}});return j.apply(this,arguments)}var k=d("MAWIndexedDb").makeMsgrTransactor({appMeta:(e=d("MAWTransactionMode")).READONLY,deviceChangeAlerts:e.READWRITE,ftsBackloggedMessages:e.READWRITE,groupInfo:e.READONLY,messages:e.READWRITE,participants:e.READONLY,threads:e.READWRITE},"handleInstructions",function(a){return function(b,c){return i(a,b).then(function(e){var f=e[0],g=f.allowSecurityAlertForContact,h=f.allowSecurityAlertForSelf,i=e[1];return d("MAWDexieTable").dexieSequentialAll(b.map(function(b){var e=b.jid,f=e===d("WAGlobals").getMyUserJid(),j=d("WAUpdateDevicesForUserApi").getShouldShowAdminMessages({allowSecurityAlertForContact:g,isMe:f})&&c.get(e)===d("WADbContact").TWO_WAY_CONTACT,k={allowSecurityAlertForSelf:h,isMe:f,shouldShowAdminMessages:j,threads:(f=i.get(e))!=null?f:[],user:e};return function(){return l(a,b,k)}})).then(function(){var a=b.filter(function(a){return a.instruction==="identityRemoved"}).map(function(a){a=(a=i.get(a.jid))!=null?a:[];a=a.map(function(a){return d("WAJids").interpretAsGroupJid(a.jid)}).filter(Boolean);return a});return{followUpParams:{groupsToUpdateForIdentityRemoved:a},toAck:b.map(function(a){return a.stanzaQueueId})}})})}});function l(a,b,d){switch(b.instruction){case"identityChanged":return m(a,b,d);case"identityAdded":return n(a,b,d);case"identityRemoved":return o(a,b,d);case"icdcError":return p(a,b,d);default:throw c("WAAssertUnreachable")(b)}}function m(a,b,c){var e=c.allowSecurityAlertForSelf,f=c.isMe,g=c.shouldShowAdminMessages;c=c.threads;var h=f&&b.model!=null&&b.platform!=null&&b.notificationTs!=null;return d("MAWDexieTable").dexieAll([h&&b.model!=null&&b.platform!=null&&b.notificationTs!=null?d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:d("MAWDbDeviceChangeAlerts").KEY_CHANGE,deviceJid:b.device,identity:b.identity,isArchived:!e,model:b.model,platform:b.platform,ts:b.notificationTs}).then(function(){return d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(a)}):d("MAWDexieTable").dexieResolve()].concat(g?c.map(function(c){return d("WAJids").interpretAsGroupJid(c.jid)==null&&d("MAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,b.jid,c,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.update,b.notificationTs)}):[])).then(function(){(h||g)&&d("MAWODSProxy").odsBumpEntityKey({entity:f?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").KEY_CHANGE})})}function n(a,b,c){var e=c.allowSecurityAlertForSelf,f=c.isMe,g=c.shouldShowAdminMessages,h=c.threads,i=c.user,j=f&&b.model!=null&&b.platform!=null&&b.notificationTs!=null;return d("MAWDexieTable").dexieAll([j&&b.model!=null&&b.platform!=null&&b.notificationTs!=null?d("MAWDbAddDeviceChangeAlertsTxn").addDeviceChangeAlertsTxn(a,{action:d("MAWDbDeviceChangeAlerts").ADD,deviceJid:b.device,identity:b.identity,isArchived:!e,model:b.model,platform:b.platform,ts:b.notificationTs}).then(function(){return d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(a)}):d("MAWDexieTable").dexieResolve()].concat(g?h.map(function(c){return d("WAJids").interpretAsGroupJid(c.jid)==null&&d("MAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,i,c,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.add,b.notificationTs)}):[])).then(function(){(j||g)&&d("MAWODSProxy").odsBumpEntityKey({entity:f?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").ADD})})}function o(a,b,c){var e=c.isMe,f=c.shouldShowAdminMessages,g=c.threads,h=c.user;return d("MAWDexieTable").dexieAll([e?d("MAWDbGetAlertsWithDeviceJidTxn").getAlertsWithDeviceJidTxn(a,b.device).then(function(){return d("MAWDbUpdateDeviceChangeAlertsLogInStatusTxn").updateDeviceChangeAlertsLogInStatusTxn(a,b.device)}).then(function(){return d("MAWDbGetUnArchivedDeviceChangeAlertsCountTxn").getUnArchivedDeviceChangeAlertsCountTxn(a)}):d("MAWDexieTable").dexieResolve()].concat(f?g.map(function(c){return d("WAJids").interpretAsGroupJid(c.jid)==null&&d("MAWAdminWriteUserDeviceMsgTxn").writeUserDeviceAdminMsg(a,h,c,d("MAWAdminWriteUserDeviceMsgTxn").DeviceChange.remove,b.notificationTs)}):[])).then(function(){(e||f)&&d("MAWODSProxy").odsBumpEntityKey({entity:e?d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_SELF:d("WAOdsEnums").Entity.SECURITY_ALERT_FOR_CONTACT,key:d("MAWDbDeviceChangeAlerts").REMOVE})})}function p(a,b,c){c=c.threads;if(!d("WAGlobals").getConfig().isICDCErrorEnabled())return d("MAWDexieTable").dexieResolve();c=c.find(function(a){return a.jid===b.jid});if(c==null){d("WALogger").ERROR(h(),b.jid);return d("MAWDexieTable").dexieResolve()}return d("MAWAdminWriteUserDeviceMsgTxn").writeICDCAlert(a,b.jid,c,b.notificationTs)}g.handleInstructions=a}),98);
__d("MAWCOPInstructionsHandler",["MAWIsQuotaExceededError","MAWProtocolQueueInstructions","MAWSharedCOPLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing instructions batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["instruction consumer: ",""]);i=function(){return a};return a}function a(a){return j(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];var b=(yield d("MAWProtocolQueueInstructions").handleInstructions(a));b.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());return b.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("MAWCommonScheduler",["WorkerScheduler"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(){h==null&&(h=d("WorkerScheduler").makeScheduler("msgr-common",{concurrency:1,maxConcurrency:10,maxThrottleMs:5e3}));return h}g.mawCommonScheduler=a}),98);
__d("MAWMessageDropError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.name="MAWMessageDropError";c.message=b;return c}return b}(babelHelpers.wrapNativeSuper(Error));f.MAWMessageDropError=a}),66);
__d("MAWMessageParseError",[],(function(a,b,c,d,e,f){"use strict";a=function(a){babelHelpers.inheritsLoose(b,a);function b(b){var c;c=a.call(this,b)||this;c.name="MAWMessageParseError";c.message=b;return c}return b}(babelHelpers.wrapNativeSuper(Error));f.MAWMessageParseError=a}),66);
__d("MAWParseBumpExistingMessageMsg",["WAMessageKey","WAParseConsumerMessageProtocol","WAParseProtocolUtils","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.chat,e=a.content,f=a.meta;a=a.metadata;e=e.bumpExistingMessage;if(e==null)throw c("err")("bumpExistingMessage has no content");e=e.key;if(e==null)throw c("err")("bumpExistingMessage has no message key");var g=d("WAParseConsumerMessageProtocol").interpretAsNonSystemAuthor(f.id.author);g=d("WAMessageKey").extractProtocolMessageId(b,g,e);e=g.author;g=g.externalId;a=d("WAParseProtocolUtils").parseEphemerality(f,a);var h=a.deleteTs,i=a.ephemeralSetting;a=a.expirationTs;h={ack:f.ack,deleteTs:h,ephemeralSetting:i,expirationTs:a,id:{author:f.id.author,chat:f.id.chat,externalId:f.id.externalId},quote:{content:{author:e,externalId:g,ts:null,type:"Unavailable"},remoteJid:b},reportingMeta:f.reportingMeta,sentTs:f.sentTs,serverTs:f.serverTs,ts:f.serverTs,type:"BumpExistingMessage"};return{contentTypeForLogging:"bumpExistingMessage",unstoredMedia:null,unstoredMsg:h,unstoredQuotedMedia:null,unstoredXMA:null}}g["default"]=a}),98);
__d("MAWParseNetworkVerificationMsg",["MAWMessageDropError","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Web does not support network verification code"]);h=function(){return a};return a}function a(a){d("WALogger").EXPECTED_ERROR(h());throw new(d("MAWMessageDropError").MAWMessageDropError)("Web does not support network verification")}g.parseNetworkVerificationMsg=a}),98);
__d("MAWParseNoteReplyMsg",["MAWJids","MAWMsgType","WAGlobals","WAJids","WALongInt","WAMediaTransport.pb","WAMsgType","WAParseMediaTransportProtocol","WAParseProtocolUtils","WAParseReadOnlyMetadataDataclassToUnsafeObject","WATimeUtils","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b,e=a.content,f=a.ebTimestampMs,g=a.meta;a=a.metadata;e=e.noteReplyMessage;if(h(a))return"noteMention";if(e==null)throw c("err")("noteReplyMessage has no content");b=(b=e.noteText)==null?void 0:b.text;if(b==null)throw c("err")("noteReplyMessage has no note text");var i=e.noteTimestampMs!=null?d("WATimeUtils").castMilliSecondsToUnixTime(d("WALongInt").numberOrThrowIfTooLarge(e.noteTimestampMs)):void 0,j=d("MAWJids").toUserJid(g.id.author),k=d("MAWJids").toUserJid(g.id.chat);j=k===j?d("WAJids").AUTHOR_ME:k;k=d("WAParseProtocolUtils").parseEphemerality(g,a);a=k.deleteTs;var l=k.ephemeralSetting;k=k.expirationTs;a={ack:g.ack,deleteTs:a,ebTimestampMs:f,ephemeralSetting:l,expirationTs:k,forwardingScore:g.forwardingScore,id:{author:g.id.author,chat:g.id.chat,externalId:g.id.externalId},quote:{content:{author:j,expirationTs:i,externalId:g.id.externalId,msgContent:{content:b},ts:g.serverTs,type:d("WAMsgType").NOTE_REPLY},remoteJid:g.id.chat},ts:g.serverTs};var m,n;l=(f=e.textContent)==null?void 0:f.text;k=e.stickerContent;j=e.videoContent;if(l!=null){i=babelHelpers["extends"]({msgContent:{content:l},type:d("MAWMsgType").MSG_TYPE.TEXT},a);b=i}else if(k!=null){f=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").StickerTransportSpec,k==null?void 0:k.payload);m=d("WAParseMediaTransportProtocol").parseStickerMsg(f,g.ts);if(m){e=babelHelpers["extends"]({mediaId:m.plaintextHash,type:d("MAWMsgType").MSG_TYPE.STICKER},a);b=e}else{if(((l=f.integral)==null?void 0:l.receiverFetchId)!=null)if(d("WAGlobals").getConfig().isStickerReceiverFetchEnabled()){n=d("WAParseMediaTransportProtocol").parseStickerReceiverFetchInfo(f);if(n==null)throw c("err")("consumerMessage has no sticker receiver fetch info");i=babelHelpers["extends"]({type:d("MAWMsgType").MSG_TYPE.RECEIVER_FETCH},a);b=i}else throw c("err")("noteReplyMessage sticker receiver fetch is not enabled");else throw c("err")("noteReplyMessage sticker has no media")}}else if(j!=null){k=d("decodeProtobuf").decodeProtobuf(d("WAMediaTransport.pb").VideoTransportSpec,j==null?void 0:j.payload);i=k==null?void 0:(e=k.integral)==null?void 0:(l=e.transport)==null?void 0:(f=l.ancillary)==null?void 0:f.mimetype;e=(k==null?void 0:(j=k.ancillary)==null?void 0:j.gifPlayback)===!0&&i==="image/gif";m=d("WAParseMediaTransportProtocol").parseVideoMsg(k,g.ts,e);if(m&&e){l=babelHelpers["extends"]({mediaId:m.plaintextHash,type:d("MAWMsgType").MSG_TYPE.GIF},a);b=l}else if(!m)throw c("err")("noteReplyMessage video has no media");else throw c("err")("noteReplyMessage video is not a gif")}else throw c("err")("noteReplyMessage has no valid content");return{contentTypeForLogging:"noteReplyMessage",unstoredMedia:m,unstoredMsg:b,unstoredQuotedMedia:null,unstoredReceiverFetchInfo:n,unstoredXMA:null}}function h(a){a=c("WAParseReadOnlyMetadataDataclassToUnsafeObject")(a);return(a==null?void 0:(a=a.note_metadata)==null?void 0:a.message_type)==="MENTION"}g["default"]=a}),98);
__d("MAWParseRavenActionNotificationMsg",["MAWMsg","MAWMsgType","WAHex","WALogger","WAStanzaUtils","WATimeUtils","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWParseRavenActionNotificationMsg - handling futureproof message for contentType: ",""]);h=function(){return a};return a}function a(a){var b=a.content,e=a.meta;a=a.protobuf;var f=c("gkx")("2898");if(!f){f="ravenActionNotifMessage";d("WALogger").LOG(h(),f);return{contentTypeForLogging:f,unstoredMedia:null,unstoredMsg:{ack:e.ack,id:e.id,msgContent:{protobuf:d("WAHex").bytesToBuffer(a),subtype:null},reportingMeta:e.reportingMeta,sentTs:e.sentTs,serverTs:e.serverTs,ts:e.ts,type:d("MAWMsgType").MSG_TYPE.FUTUREPROOF},unstoredQuotedMedia:null,unstoredXMA:null}}a=(f=b.ravenActionNotifMessage)==null?void 0:f.actionType;f=d("MAWMsg").MAWRavenActionNotifType.cast(a);a=(a=b.ravenActionNotifMessage)==null?void 0:a.actionTimestamp;var g;if(a!=null){a=Number(a);a>d("WATimeUtils").MAX_INT?g=d("WATimeUtils").castMilliSecondsToUnixTime(a):g=d("WATimeUtils").castToUnixTime(a)}a=((a=b.ravenActionNotifMessage)==null?void 0:(a=a.key)==null?void 0:a.id)!=null?d("WAStanzaUtils").toStanzaId((a=b.ravenActionNotifMessage)==null?void 0:(b=a.key)==null?void 0:b.id):null;if(f==null)throw c("err")("Error when getting actionType for RavenNotificationMessage "+e.id.externalId);if(g==null)throw c("err")("Error when getting actionTimestamp for RavenNotificationMessage "+e.id.externalId);if(a==null)throw c("err")("Error when getting ravenActionToMsgExternalId for RavenNotificationMessage "+e.id.externalId);b={ack:e.ack,actionTimestamp:g,actionType:f,id:e.id,ravenActionToMsgExternalId:a,sentTs:e.sentTs,serverTs:e.serverTs,ts:e.serverTs,type:"RavenAction"};return{unstoredMedia:null,unstoredMsg:b,unstoredQuotedMedia:null,unstoredXMA:null}}g.parseRavenActionNotificationMessage=a}),98);
__d("MAWParseRavenMsg",["MAWMsg","MAWMsgType","MAWParseSubprotocolVersionConsts","WAHex","WALogger","WAMediaTransport.pb","WAParseMediaTransportProtocol","WAParseProtocolUtils","decodeProtobuf","err","gkx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n        received video messsage version is older than expected ",". "]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["\n        received image messsage version is older than expected ",". "]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWParseRavenMsg - handling futureproof message for contentType: ",""]);j=function(){return a};return a}function a(a){var b=a.content,e=a.ebTimestampMs,f=a.meta,g=a.metadata;a=a.protobuf;var k=c("gkx")("2898");if(!k){k="ravenMessageMsgr";d("WALogger").LOG(j(),k);return{contentTypeForLogging:k,unstoredMedia:null,unstoredMsg:{ack:f.ack,id:f.id,msgContent:{protobuf:d("WAHex").bytesToBuffer(a),subtype:null},reportingMeta:f.reportingMeta,sentTs:f.sentTs,serverTs:f.serverTs,ts:f.ts,type:d("MAWMsgType").MSG_TYPE.FUTUREPROOF},unstoredQuotedMedia:null,unstoredXMA:null}}k=b.ravenMessageMsgr;if(k==null)throw c("err")("Raven message payload has no content");a=d("MAWMsg").MAWRavenMsgEphemeralType.cast(k.ephemeralType);if(a==null)throw c("err")("Error when casting ephemeralType for Raven message");b=void 0;var l=void 0;if(k.imageMessage)(k.imageMessage.version==null||k.imageMessage.version<d("MAWParseSubprotocolVersionConsts").RAVEN_IMAGE_MESSAGE_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(i(),d("MAWParseSubprotocolVersionConsts").RAVEN_IMAGE_MESSAGE_SUBPROTOCOL_VERSION),b=d("WAParseMediaTransportProtocol").decodeImageTransport(k.imageMessage.payload,f.ts,"image"),l=d("MAWMsg").MAWRavenMsgMediaType.IMAGE;else if(k.videoMessage){(k.videoMessage.version==null||k.videoMessage.version<d("MAWParseSubprotocolVersionConsts").RAVEN_VIDEO_MESSAGE_SUBPROTOCOL_VERSION)&&d("WALogger").WARN(h(),d("MAWParseSubprotocolVersionConsts").RAVEN_VIDEO_MESSAGE_SUBPROTOCOL_VERSION);k=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAMediaTransport.pb").VideoTransportSpec,k.videoMessage.payload);b=d("WAParseMediaTransportProtocol").parseVideoMsg(k,f.ts,!1);l=d("MAWMsg").MAWRavenMsgMediaType.VIDEO}else throw c("err")("Error unsupported Raven message type");if(b==null)throw c("err")("Error Raven message has no associated image or video");k=d("WAParseProtocolUtils").parseEphemerality(f,g);g=k.deleteTs;var m=k.ephemeralSetting;k=k.expirationTs;g={ack:f.ack,deleteTs:g,ebTimestampMs:e,ephemeralSetting:m,expirationTs:k,id:f.id,mediaId:b.plaintextHash,ravenEphemeralMediaState:a===d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT?d("MAWMsg").MAWRavenMsgEphemeralMediaState.PERMANENT:d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN,ravenEphemeralType:a,ravenMediaType:l,reportingMeta:f.reportingMeta,sentTs:f.sentTs,serverTs:f.serverTs,ts:f.ts,type:d("MAWMsgType").MSG_TYPE.RAVEN};return{unstoredMedia:b,unstoredMsg:g,unstoredQuotedMedia:null,unstoredXMA:null}}g.parseRavenMessage=a}),98);
__d("MAWParseScreenshotActionMsg",["MAWExternalId","MAWMsgType","WAAckLevel","WAArmadilloApplication.pb","WAJids","err"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.content;a=a.meta;b=b.screenshotAction;if(b==null)throw c("err")("screenshotAction has no content");b=b.screenshotType;if(b==null)throw c("err")("Missing screenshot type in payload");if(![d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREENSHOT_IMAGE,d("WAArmadilloApplication.pb").ARMADILLO_CONTENT_SCREENSHOT_ACTION_SCREENSHOT_TYPE.SCREEN_RECORDING].includes(b))throw c("err")("Received unexpected screenshot action type");b={ack:d("WAAckLevel").ACK.SENT,id:{author:d("WAJids").AUTHOR_SYSTEM,chat:a.id.chat,externalId:d("MAWExternalId").generateExternalId()},msgContent:{adminMsgContent:[],adminType:"youEphemeralTakeScreenshot",screenshotActionType:b},ts:a.serverTs,type:d("MAWMsgType").EPHEMERAL_SCREENSHOT_ACTION};return{contentTypeForLogging:"screenshotAction",unstoredMedia:null,unstoredMsg:b,unstoredQuotedMedia:null,unstoredXMA:null}}g.parseEphemeralScreenshotActionProtocol=a}),98);
__d("MAWParseArmadilloProtocol",["MAWMessageParseError","MAWMsgType","MAWParseBumpExistingMessageMsg","MAWParseNetworkVerificationMsg","MAWParseNoteReplyMsg","MAWParseRavenActionNotificationMsg","MAWParseRavenMsg","MAWParseScreenshotActionMsg","MAWParseXMAProtocol","WAArmadilloApplication.pb","WAHex","WALogger","decodeProtobuf","err"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWParseArmadilloProtocol - Dropping message. contentType: ",", reason: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWParseArmadilloProtocol - handling futureproof message for contentType: ",""]);i=function(){return a};return a}b={unstoredMedia:null,unstoredMsg:null,unstoredQuotedMedia:null,unstoredXMA:null};var j=new Map([["screenshotAction",d("MAWParseScreenshotActionMsg").parseEphemeralScreenshotActionProtocol],["extendedContentMessage",d("MAWParseXMAProtocol").parseXMAProtocol],["noteReplyMessage",c("MAWParseNoteReplyMsg")],["bumpExistingMessage",c("MAWParseBumpExistingMessageMsg")],["ravenMessageMsgr",d("MAWParseRavenMsg").parseRavenMessage],["ravenActionNotifMessage",d("MAWParseRavenActionNotificationMsg").parseRavenActionNotificationMessage],["networkVerificationMessage",d("MAWParseNetworkVerificationMsg").parseNetworkVerificationMsg]]);function a(a,b,c,e,f,g,m){b=d("decodeProtobuf").decodeProtobufWithUnknowns(d("WAArmadilloApplication.pb").ArmadilloSpec,b);b=(b=b.payload)==null?void 0:b.content;if(!b)throw new(d("MAWMessageParseError").MAWMessageParseError)("parse_armadillo_protocol_error:: empty_payload_content");var n=l(b);try{var o=j.get(n),p=null;if(o!=null){o=o({chat:a,content:b,ebTimestampMs:m,meta:c,metadata:g,protobuf:e},f);if(typeof o!=="string")return o;else p=o}d("WALogger").LOG(i(),n);return{contentTypeForLogging:n,unstoredMedia:null,unstoredMsg:{ack:c.ack,id:c.id,msgContent:{protobuf:d("WAHex").bytesToBuffer(e),subtype:(a=p)!=null?a:k(n)},reportingMeta:c.reportingMeta,sentTs:c.sentTs,serverTs:c.serverTs,ts:c.ts,type:d("MAWMsgType").MSG_TYPE.FUTUREPROOF},unstoredQuotedMedia:null,unstoredXMA:null}}catch(a){d("WALogger").ERROR(h(),n,a);throw new(d("MAWMessageParseError").MAWMessageParseError)("parse_armadillo_protocol_error:: contentType:: "+n+" reason:: "+a)}}function k(a){switch(a){case"bumpExistingMessage":return"bumpMessage";default:return null}}function l(a){var b=Object.keys(a).filter(function(a){return a!=="$$unknownFieldCount"});if(b.length!==1)throw c("err")(JSON.stringify(a)+" armadillo payload content should only have one field");a=b[0];return a}g.EMPTY_CONTENT=b;g.parseArmadilloProtocol=a}),98);
__d("MAWIncomingMsgUtils",["MAWEphemeralUtil","MAWParseArmadilloProtocol","MAWUnstoredContentToUnstoredDbContentUtils","WAParseV3Protocol","err"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function i(a){if(h==null){var b=function(b,c,e,f,g,h){return d("MAWParseArmadilloProtocol").parseArmadilloProtocol(b,c,e,f,a,g,h)};h=d("WAParseV3Protocol").createV3ProtocolParser(new Map([["armadillo",b]]))}return h}function a(a,b){var e=a.author,f=a.chat,g=a.ebTimestampMs,h=a.externalId,j=a.msg,k=a.reportingMeta;a=a.serverTs;if(j.version==="v2")throw c("err")("Armadillo does not support protobuf v2");if(j.type==="ephemeral"){var l=d("MAWEphemeralUtil").buildUnstoredDbEphemeralSettingMsgWithoutContentPlaceholder(a);k!=null&&l.unstoredDbMsg!=null&&(l.unstoredDbMsg.reportingMeta=k);return l}l=babelHelpers["extends"]({unstoredXMA:null},i(b)(j,f,h,e,a,g));k!=null&&l.unstoredMsg!=null&&(l.unstoredMsg.reportingMeta=k);return d("MAWUnstoredContentToUnstoredDbContentUtils").unstoredContentToUnstoredDbContent(l)}g.getDbMsg=a}),98);
__d("MAWProtocolQueueDecodeProto",["MAWIncomingMsgUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){switch(a.type){case"IncomingMsg":var e=a.folder,f=a.id,g=a.msg,h=a.reportingMeta;a=a.ts;var i=f.author,j=f.chat;f=f.externalId;return d("MAWIncomingMsgUtils").getDbMsg({author:i,chat:j,ebTimestampMs:c,externalId:f,folder:e,msg:g,reportingMeta:h,serverTs:a},b);case"InvisibleMsg":case"IncomingCiphertextMsg":default:return}}g.decodeMsg=a}),98);
__d("MAWProtocolQueueMsg",["MAWBulkHandleIncomingMsgApi","MAWHIMLogger","MAWMsgType","MAWParseXMAProtocol","MAWXMALoggingUtils","MAWXMAUtils","PersistedQueueDB","Promise","WASignalDB","WAStanzaRootTag","asyncToGeneratorRuntime","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot have null result for non-invisible msgs"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle: "," msgs: done"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Handle: "," msgs"]);k=function(){return a};return a}function l(a,b){if(a==null)return b;return a>b?b:a}function a(a,b){return m.apply(this,arguments)}function m(){m=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var f=new Set(),g=a.filter(function(a){return a.stanza.message.details.retryCount>0});if(g.length>0){var m;c("gkx")("7318")?m=(yield d("PersistedQueueDB").getPersistedQueues().runInTransaction(["stanzaQueue"],"readonly",function(a){return(h||(h=b("Promise"))).all(g.map(function(b){return a.stores.stanzaQueue.readIndex("[jid+priority+stanzaId]",[b.stanza.jid,b.stanza.priority,b.stanza.stanzaId])}))},"fetch-pending-ciphertext-stanzas")):m=(yield d("WASignalDB").getDb().runInTransaction(["stanzaQueue"],"readonly",function(a){return(h||(h=b("Promise"))).all(g.map(function(b){return a.stores.stanzaQueue.readIndex("[jid+priority+stanzaId]",[b.stanza.jid,b.stanza.priority,b.stanza.stanzaId])}))},"fetch-pending-ciphertext-stanzas"));g.forEach(function(a,b){var c,e=null;m[b].forEach(function(a){if(a.type!==d("WAStanzaRootTag").STANZA_ROOT_TAG.MESSAGE)return;a;if(a.subtype!=="ciphertext")return;e==null&&(e=a);e.serverTs>a.serverTs&&(e=a)});if(e==null)return;e;b=e.serverTs;a.stanza.message.details.ts=l(a.stanza.message.details.ts,b);a.stanza.message.decrypted.ts=l(a.stanza.message.decrypted.ts,b);if(((c=a.decodedMsg)==null?void 0:c.unstoredDbMsg)!=null){c=a.decodedMsg.unstoredDbMsg;c.ts=l(c.ts,b);c.serverTs=l(c.serverTs,b)}if(((c=a.decodedMsg)==null?void 0:c.unstoredDbMedia)!=null){c=a.decodedMsg.unstoredDbMedia;c.ts=l(c.ts,b)}})}var n=a.map(function(a){var b,c,e=a.decodedMsg,g=a.receiveFlow;a=a.stanza;var h=a.message.decrypted,i=d("MAWXMALoggingUtils").getXmaTargetTypeStringFromEnum(e==null?void 0:e.xmaTargetTypeForLogging);b=e==null?void 0:(b=e.unstoredXMA)==null?void 0:b.unstoredDbXMA.xmaDataclass;c=e==null?void 0:(c=e.unstoredXMA)==null?void 0:c.unstoredDbXMA.targetType;c=d("MAWParseXMAProtocol").getUnsupportedMessageType(c,b);g.addAnnotations({bool:{furuteproof:(e==null?void 0:(b=e.unstoredDbMsg)==null?void 0:b.type)===d("MAWMsgType").MSG_TYPE.FUTUREPROOF},"int":{xmaTargetType:(b=e==null?void 0:e.xmaTargetTypeForLogging)!=null?b:-1},string:{contentType:(b=e==null?void 0:e.contentTypeForLogging)!=null?b:"",subtype:(b=e==null?void 0:(b=e.unstoredDbMsg)==null?void 0:(b=b.msgContent)==null?void 0:b.subtype)!=null?b:c,xmaTargetTypeString:i}});if(d("MAWXMAUtils").isRtcXMA(e==null?void 0:(b=e.unstoredXMA)==null?void 0:(c=b.unstoredDbXMA)==null?void 0:c.targetType)){g.endFail("rtc_xma_not_supported");f.add(a.stanzaQueueId);return null}if(h.type==="InstamadilloMsg"){g.endFail("instamadillo_not_supported");f.add(a.stanzaQueueId);return null}if(h.type==="InvisibleMsg"){f.add(a.stanzaQueueId);return null}return{msgData:h,receiveFlow:g,stanzaSource:a.incomingType,unstoredContent:e}}).filter(Boolean);c("MAWHIMLogger").LOG(k(),n.length);return d("MAWBulkHandleIncomingMsgApi").bulkHandleIncomingMsgs(n,e).then(function(b){var d=b.msgResults;c("MAWHIMLogger").LOG(j(),n.length);a.map(function(a){a=a.stanza;var b=d.get(a.message.decrypted.id);if(b==null){f.has(a.stanzaQueueId)||c("MAWHIMLogger").ERROR(i());return}b.success===!0&&f.add(a.stanzaQueueId)});return{followUpParams:{incomingMsgResults:d,incomingMsgs:a},toAck:Array.from(f)}})["catch"](function(b){var c="Not an Error instance",d="N/A";typeof b.message==="string"&&(c=b.message);typeof b.stack==="string"&&(d=b.stack);a.forEach(function(a){a.receiveFlow.endFail("consumer_handle_message_transaction_error",{string:{errorDescription:c,errorStack:d}})});throw b})});return m.apply(this,arguments)}g.handleIncomingMessagesStanzas=a}),98);
__d("MAWUserHash",["MAWCurrentUser","WAGlobals","WAJids","isUseridAnnotationEnabled"],(function(a,b,c,d,e,f,g){"use strict";function a(){return d("MAWCurrentUser").isEmployee()&&c("isUseridAnnotationEnabled")()?d("WAJids").extractUserId(d("WAGlobals").getMyUserJid()).slice(-5):null}g.getUserHash=a}),98);
__d("MAWIncomingMsg",["MAWUserHash","WAGetPlatformFromStanzaId","WAHashStringToNumber","WAServerRPCLogger","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";a=d("WAServerRPCLogger").logger.TAGS(["HandleIncomingMsg"]);b=function(a){var b=a.encTypes,c=a.incomingType,e=a.msg,f=a.queueType,g=a.retryCount;a=a.taskSource;var h=e.details;e=e.decrypted;return{"int":{messageAge:d("WATimeUtils").unixTime()-h.ts,msgId:d("WAHashStringToNumber").hashStringToNumber(h.externalId.toString()),offlineDelivery:h.offline,retryCount:g,taskSource:a},string:{e2eePlatform:d("WAGetPlatformFromStanzaId").getPlatformFromStanzaId(h.externalId),incomingType:c,jid:h.from.chat,msgDecryptedDataType:e.type,msgType:h.type,queueType:f,threadType:h.from.type,userHash:d("MAWUserHash").getUserHash()},string_array:{encTypes:b}}};g.logger=a;g.prepareAnnotationsForIncomingMessage=b}),98);
__d("MAWProtocolQueueUtils",["LSMEBTaskCreationSource","MAWIncomingMsg","MAWMessageReceiveReliabilityLogger","WAGetStorageQplAnnotations","WAHashStringToNumber","WAPREList","WAPREMetrics","WAQPLProxy","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){b===void 0&&(b=d("WAPREList").PRE_METRIC.RECEIVE_MESSAGE);var e=a.stanza,f=d("WAPREMetrics").startMetric(b,d("MAWIncomingMsg").prepareAnnotationsForIncomingMessage({incomingType:e.incomingType,msg:e.message,queueType:e.message.details.offline!=null?"offline":"online",retryCount:e.message.details.retryCount,taskSource:c("LSMEBTaskCreationSource").UNKNOWN}),d("WAHashStringToNumber").hashStringToNumber(e.stanzaId.toString()),d("MAWMessageReceiveReliabilityLogger").RECEIVE_RELIABILITY_TIMEOUT);c("promiseDone")(d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){f.addAnnotations(a)}));f.addPoint("consumer_handle_message_stanza_start");return babelHelpers["extends"]({},a,{receiveFlow:f})}function a(a){return h({decodedMsg:void 0,stanza:a})}function b(a,b){var e=d("WAQPLProxy").waQPLProxyStartResume(a.incomingType==="wa"?c("qpl")._(1056840931,"814"):c("qpl")._(521477947,"2395"),d("WAHashStringToNumber").hashStringToNumber(a.stanzaId));e.addAnnotations(d("MAWIncomingMsg").prepareAnnotationsForIncomingMessage({incomingType:a.incomingType,msg:a.message,queueType:a.message.details.offline!=null?"offline":"online",retryCount:a.message.details.retryCount,taskSource:b}));return e}function e(a,b){c("promiseDone")(d("WAGetStorageQplAnnotations").getStorageQplAnnotations().then(function(a){b.addAnnotations(a)}));b.addPoint("consumer_handle_message_stanza_start");return babelHelpers["extends"]({},a,{receiveFlow:b})}g.addMetricToMessage=h;g.addMetricToProtocolMessage=a;g.startMetricForIncomingMsgV2=b;g.addAnnotationsToMessage=e}),98);
__d("WAQueryGroupInvite",["WADeprecatedSendIq","WAPREList","WAPREMetrics","WAQueryGroup","WAResultOrError","WAWap","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c,d){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e){var f,g=d("WAPREMetrics").startMetric(d("WAPREList").PRE_METRIC.QUERY_GROUP,{string:{key:"query_group_invite"}});a=(f=d("WAWap")).wap("iq",{id:f.generateId(),to:f.GROUP_JID(a),type:"get",xmlns:"w:g2"},f.wap("query",null,f.wap("add_request",{admin:f.USER_JID(e),code:f.CUSTOM_STRING(b),expiration:f.CUSTOM_STRING(c.toString(10))})));e=(yield d("WADeprecatedSendIq").deprecatedSendIq(a,d("WAQueryGroup").parseQueryGroupResponse));if(!e.success){g.endFail("query_group_for_invitee_fail");return d("WAResultOrError").makeError(e)}g.endSuccess();return d("WAResultOrError").makeResult(e.result.group)});return h.apply(this,arguments)}g.queryGroupInvite=a}),98);
__d("MAWCOPMessagesHandler",["ACTSanitizerApiLazyLoader","EBAPI","IGDInstamadilloUtils","LSMEBTaskCreationSource","LSMessagingThreadAttributionType","MAWBridge","MAWCommonScheduler","MAWDbStaleQueue","MAWDebugMsg","MAWDownloadAndHandleMedia","MAWExternalId","MAWIsQuotaExceededError","MAWJobDefinitions","MAWJobManager","MAWLoggerUtils","MAWMediaGalleryM2Utils","MAWMessageDropError","MAWMessageParseError","MAWMsgType","MAWODSProxy","MAWProtocolQueueDecodeProto","MAWProtocolQueueMsg","MAWProtocolQueueUtils","MAWQplProxy","MAWSendEphemeralSettingMsg","MAWSharedCOPLogger","MWEBODSEntityName.enum","MWEBODSUtils","MWSharedS2SBaseAnnotations","Promise","WACreateGroup","WAGlobals","WAHashUtils","WAJids","WAMsgMap","WAOdsEnums","WAProtocolQueue","WAQueryGroup","WAQueryGroupInvite","WAResultOrError","WAStartMediaDownloadQplFlow","WATimeUtils","WorkerScheduler","asyncToGeneratorRuntime","err","gkx","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Media: externalId="," - plaintextFollowUp - plaintextHash=",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot find db result for message"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing messages batch, see transactor error reports."]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot prepare msgs to put to EBUploadQueue: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot prepare msgs to put to EBUploadQueue: ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Decode fails: ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Cannot load XMA Validation WASM module: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Scheduling job for ",", plaintextHash: ",""]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleMsg: detected out-of-sync ephemeral setting for ",", sending EPHEMERAL_SYNC_RESPONSE"]);q=function(){return a};return a}function r(){var a=babelHelpers.taggedTemplateLiteralLoose(["message consumer: ",""]);r=function(){return a};return a}function a(a,b){b===void 0&&(b=c("LSMEBTaskCreationSource").UNKNOWN);return s(a,b)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(r(),a);return[]})}function s(a,b){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){if(a.length===0)return[];var e=new Set();y(a);var f=(yield A()),g=new(d("WAMsgMap").MsgMap)(),h=c("gkx")("8488"),o=new Map(a.map(function(a){a=z(a);a=d("WAProtocolQueue").mapProcolQueueMessageV2toV1(a);var h=a.incomingType==="ebrestore",i=d("MAWProtocolQueueUtils").startMetricForIncomingMsgV2(a,b);try{if(a.message.decrypted.type==="InstamadilloMsg")if(c("gkx")("3577")){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.IGDW_INSTAMADILLO_MESSAGE_ON_OLD_WORKER,key:"message"});e.add(a.stanzaQueueId);i.endFail("instamadillo_msg_on_old_worker");return null}else{i.endFail("instamadillo_msg_not_supported_on_msgr");throw c("err")("InstamadilloMsg is not supported in MSGR. Should never happen "+d("IGDInstamadilloUtils").getE2EEGatingStateAsString())}var j=d("MAWProtocolQueueDecodeProto").decodeMsg(a.message.decrypted,f,a.ebTimestampMs);g.set(a.message.decrypted.id,a.incomingType);h&&(a.message.details.type=(j==null?void 0:j.unstoredDbReaction)!=null?"reaction":(j==null?void 0:j.unstoredXMA)!=null||(j==null?void 0:j.unstoredDbMedia)!=null?"media":"text");return[a.stanzaQueueId,d("MAWProtocolQueueUtils").addAnnotationsToMessage({decodedMsg:j!=null?j:void 0,stanza:babelHelpers["extends"]({},a)},i)]}catch(b){h=b instanceof Error?b:null;c("MAWSharedCOPLogger").ERROR(n(),b);j=b instanceof d("MAWMessageParseError").MAWMessageParseError?b:null;var k=b instanceof d("MAWMessageDropError").MAWMessageDropError;if(k){e.add(a.stanzaQueueId);i.addPoint("network_verification_msg_dropped");i.endSuccess({string:{isDropped:"true"}});return null}if(j==null){c("promiseDone")(d("MAWDbStaleQueue").mawAddStaleStanza(a,"Decode issue: "+((k=h==null?void 0:h.message)!=null?k:"")))}e.add(a.stanzaQueueId);i.endFail("decoding_error",{string:{errorDescription:(a=(k=j==null?void 0:j.message)!=null?k:h==null?void 0:h.message)!=null?a:"",isDropped:"true"}});return null}}).filter(Boolean)),p=0;if(h)try{d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.receive.call",o.size);var q=Array.from(o.values()).filter(function(a){return a.stanza.incomingType==="wa"});p=q.length;yield c("EBAPI").uploadReceivedMessagesProtobufOnly({uploadArray:q})}catch(a){c("MAWSharedCOPLogger").ERROR(m(),a)}var r=(yield d("MAWProtocolQueueMsg").handleIncomingMessagesStanzas(Array.from(o.values()),b));r.toAck.forEach(function(a){return e.add(a)});q=a.map(function(a){var b=o.get(a.stanzaQueueId);if(b==null)return null;b=b;var c=r.followUpParams.incomingMsgResults.get(b.stanza.message.decrypted.id);return[b,e.has(a.stanzaQueueId),c]}).filter(Boolean);if(!h)try{d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"upload.api.receive.call",o.size),yield c("EBAPI").uploadReceivedMessages({incomingMessages:Array.from(o.values()).filter(function(a){return a.stanza.incomingType==="wa"}),msgResults:r.followUpParams.incomingMsgResults})}catch(a){c("MAWSharedCOPLogger").ERROR(l(),a)}e.size!==a.length&&c("MAWSharedCOPLogger").WARN(k());var s=new Map(),t=new Set();q.forEach(function(a){var e=a[0],f=a[1];a=a[2];e.receiveFlow.addPoint("consumer_handle_message_stanza_end",{bool:{dbSuccess:!!(a==null?void 0:a.success)}});if(f){e.receiveFlow.addPoint("ack_received");var h=e.stanza.message.decrypted.type;h==="UnavailableMsg"||h==="IncomingCiphertextMsg"?e.receiveFlow.endFail(h):(e.stanza.message.details.type==="media"&&e.receiveFlow.addPoint("message_with_media"),e.receiveFlow.endSuccess())}if(!a&&!f){c("MAWSharedCOPLogger").ERROR(j());e.receiveFlow.endFail("db_result_not_found");return}if(!a)return;if(a.success===!1){h=a.error;switch(h.type){case"group_invite":e.receiveFlow.endFail("end_with_db_error_group_invite");s.set(h.groupJid,{folder:h.folder,inviteCode:h.inviteCode,inviteExpireTs:h.inviteExpireTs,inviterJid:h.inviterJid});e.receiveFlow.endFail("need_group_invite");break;default:h.type;e.receiveFlow.endFail("invlid_args");break}return}a.success;if(a.value!=null){f=a.value;var k=f.msgType;h=f.outOfSyncEphemeralSetting;a=f.plaintextHashs;var l=f.protocolMsgId;f=f.unknownGroup;if(f){f=d("WAJids").interpretAsGroupJid(l.chat);f!=null&&t.add(f)}u(h,l);f=!(b===c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE&&d("MAWMediaGalleryM2Utils").shouldSkipSyncToLSDB());f&&(a==null?void 0:a.forEach(function(a){c("MAWSharedCOPLogger").LOG(i(),e.stanza.message.details.externalId,d("WAHashUtils").sanitisePlaintextHash(a));v({msgType:k,plaintextHash:a,protocolMsgId:l,source:(a=g.get(l))!=null?a:"wa"})}))}});w(t);x(s);h&&p>0&&p>e.size&&d("MAWODSProxy").odsBumpEntityKey({amount:p-e.size,entity:d("WAOdsEnums").Entity.EB_UPLOAD,key:"upload_count_higher_than_acks"});return Array.from(e)});return t.apply(this,arguments)}function u(a,e){a!=null&&(c("MAWSharedCOPLogger").TAGS([d("MAWLoggerUtils").Tag.Ephemeral,d("MAWLoggerUtils").Tag.SettingSync]).LOG(q(),e==null?void 0:e.externalId),c("promiseDone")(d("MAWCommonScheduler").mawCommonScheduler().runTask({fn:function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var b=d("MAWLoggerUtils").getInstanceKey(),e=d("MAWQplProxy").startQplUserFlow(c("qpl")._(25313175,"1551"),yield d("MWSharedS2SBaseAnnotations").getSendToSentBaseAnnotations(d("MWSharedS2SBaseAnnotations").getMessageTypeParams({isEphemeralSetting:!0}),c("LSMessagingThreadAttributionType").UNKNOWN),{providedInstanceKey:b});try{b=(yield d("MAWSendEphemeralSettingMsg").sendEphemeralSettingMsgFn({args:{ephemeralSetting:{ephemeralExpirationInSec:a.correctEphemeralExpirationInSec,ephemeralLastUpdatedOrSetTimestamp:a.correctEphemeralLastUpdatedOrSetTimestamp},isEphemeralSettingReset:!1,isForSyncResponse:!0},chatJid:a.chatJid,externalId:d("MAWExternalId").generateExternalId(),qplEventType:c("qpl")._(25313175,"1551"),qplInstanceKey:b}));if(b.success){e.endSuccess();if(b.value!=null){var f=b.value;d("MAWBridge").getBridge().fireAndForget("event","handleMessageSendResult",{report:f,success:!0},!0)}}else e.endFail(b.error.type)}catch(a){f=a instanceof Error?a:null;e==null?void 0:e.endFail("failed_to_send_empemeral_settings",{string:{errorDescription:(b=f==null?void 0:f.message)!=null?b:""}})}});function f(){return e.apply(this,arguments)}return f}(),name:"ephemeral_sync_response",priority:d("WorkerScheduler").BACKGROUND_PRIORITY})))}function v(a){var b=a.msgType,e=a.plaintextHash,f=a.protocolMsgId;a=a.source;if(f!=null&&e!=null&&b!==d("MAWMsgType").MSG_TYPE.RAVEN){c("MAWSharedCOPLogger").TAGS(["downloadAndHandleMedia"]).LOG(p(),f,d("WAHashUtils").sanitisePlaintextHash(e));var g=a==="ebrestore"?"EBRestore":"WAIncomingMsg";if(c("gkx")("4695")){if(c("gkx")("1614")&&a==="ebrestore")return;a=d("WAStartMediaDownloadQplFlow").startMediaDownloadQplFlow({downloadEntry:g,msgType:b,protocolMsgId:f,triggerUIView:null});void d("MAWDownloadAndHandleMedia").downloadAndHandleMediaImpl({downloadEntry:g,hash:e,mediaDownloadFlow:a,msgType:b,protocolMsgId:f})}else d("MAWJobManager").getJobManager().fireAndForget(d("MAWJobDefinitions").jobSerializers.downloadAndHandleMedia(f,e,g,b,null))}}function w(a){if(a.size===0)return;c("promiseDone")(d("MAWCommonScheduler").mawCommonScheduler().runTask({fn:function(){return e()},name:"queryGroup",priority:d("WorkerScheduler").BACKGROUND_PRIORITY}));function e(){return f.apply(this,arguments)}function f(){f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var c=(yield (h||(h=b("Promise"))).all(Array.from(a).map(function(a){return d("WAQueryGroup").queryGroup(a,"interactive")["catch"](function(a){return d("WAResultOrError").makeError()})})));c=c.map(function(a){if(a.success===!0){a={extras:null,folder:null,groupStatus:"added",groupToCreate:a.value,key:null,serverTs:d("WATimeUtils").unixTime()};return a}return null}).filter(Boolean);yield d("WACreateGroup").createGroups(c)});return f.apply(this,arguments)}}function x(a){if(a.size===0)return;c("promiseDone")(d("MAWCommonScheduler").mawCommonScheduler().runTask({fn:function(){return e()},name:"queryGroupInvite",priority:d("WorkerScheduler").BACKGROUND_PRIORITY}));function e(){return f.apply(this,arguments)}function f(){f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var c=(yield (h||(h=b("Promise"))).all(Array.from(a.entries()).map(function(a){var b=a[0];a=a[1];var c=a.inviteCode,e=a.inviteExpireTs;a=a.inviterJid;return d("WAQueryGroupInvite").queryGroupInvite(b,c,e,a)["catch"](function(a){return d("WAResultOrError").makeError()})})));c=c.map(function(a){if(a.success===!0){a={extras:null,folder:null,groupStatus:"added",groupToCreate:a.value,key:null,serverTs:d("WATimeUtils").unixTime()};return a}return null}).filter(Boolean);yield d("WACreateGroup").createGroups(c)});return f.apply(this,arguments)}}function y(a){if(c("gkx")("23915"))for(a of a)a.subtype==="ciphertext"&&c("promiseDone")(d("MAWDebugMsg").writeDebugMsg(a.jid,"Message "+a.stanzaId+" has decryption error: "+a.decryptionError+" from user "+a.from,{decryptionError:a.decryptionError,protocolMsgId:{author:d("WAGlobals").getMyDeviceJid()===a.from?"@me":d("WAJids").extractUserJid(a.from),chat:a.jid,externalId:a.stanzaId}}))}function z(a){if(a.message==null)return a;if(a.message.type!=="ephemeral")return a;var b=a.serverTs;a.message.ephemeralLastUpdatedOrSetTimestamp=a.message.ephemeralLastUpdatedOrSetTimestamp===d("WATimeUtils").DEFAULT_UNIXTIME?b:a.message.ephemeralLastUpdatedOrSetTimestamp;return a}function A(){return d("ACTSanitizerApiLazyLoader").loadACTSanitizerApi().then(function(a){return a.isXMAValid})["catch"](function(a){c("MAWSharedCOPLogger").TAGS(["ActSanitizerWasmApi"]).ERROR(o(),a);return function(){throw a}})}g["default"]=a}),98);
__d("MAWChangeGroupParticipantAdminStatusApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"changeGroupParticipantAdminStatus")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g,h){var i=a.GroupInfoStore,j=a.MessagesStore;a=a.ParticipantsStore;var k=(yield i.get(c));if(!k.success)return d("WAResultOrError").makeError("missing_group");k=f.map(function(a){return{addressable:a.addressable,chatJid:c,type:g,user:a.user}});yield a.bulkPut(k);if(b!=null){yield i.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:b.current})});for(f=0;f<k.length;f++)g==="admin"?a=d("MAWAdminMsgHelpers").createParticipantPromoteAdminMsg(c,k[f].user,e,h):a=d("MAWAdminMsgHelpers").createParticipantDemoteAdminMsg(c,k[f].user,e,h),yield j.create(a)}return d("WAResultOrError").makeResult()});return function(b,c,d,e,f,g,h){return a.apply(this,arguments)}}();g.changeGroupParticipantAdminStatus=a;g.changeGroupParticipantAdminStatusTransactor=h}),98);
__d("MAWThreadTypes",["MAWTransactionMode"],(function(a,b,c,d,e,f,g){"use strict";b={chunk:(a=d("MAWTransactionMode")).READWRITE,deletedMessages:a.READWRITE,editMsgHistory:a.READWRITE,groupInfo:a.READWRITE,groupInvites:a.READWRITE,media:a.READWRITE,messages:a.READWRITE,participants:a.READWRITE,pendingStanzas:a.READWRITE,reactions:a.READWRITE,threads:a.READWRITE,unrenderedMessages:a.READWRITE,xma:a.READWRITE};g.ThreadRelatedTablesPermissions=b}),98);
__d("MAWDeleteGroupsApi",["MAWDbThreadTxns","MAWDexieTable","MAWGroupManagementTxns","MAWIndexedDb","MAWThreadTypes","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor(d("MAWThreadTypes").ThreadRelatedTablesPermissions,"deleteGroups",function(a){return function(b){return d("MAWDexieTable").dexieAll(b.map(function(b){var c=b.group;return d("MAWDbThreadTxns").getThread(a,c).then(function(b){return!b.success?d("WAResultOrError").makeError("missing_thread"):d("MAWGroupManagementTxns").deleteGroup(a,c,b.value).then(function(a){return d("WAResultOrError").makeResult({deletedGroupId:c,deletedMsgIds:a.deletedMessages})})})})).then(function(a){return a})}});g.deleteGroupsFromMAW=a}),98);
__d("WADeleteGroupFollowUpLowLevelApi",["MAWDexieTable","MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbSenderKeySessionTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE,receipts:d("MAWTransactionMode").READWRITE,senderKeySessions:d("MAWTransactionMode").READWRITE},"deleteGroupFollowUpLowLevel",function(a){return function(b,c){return d("MAWDexieTable").dexieAll([d("WADbPersonalSenderKeyStatusTxns").bulkDeletePersonalSenderKeyStatus(a,[b]),d("WADbSenderKeySessionTxns").deleteSenderKeysByGroupJid(a,b),h(a,c)]).then(function(){})}});function h(a,b){return a.receipts.where("waMsgId").anyOf(b)["delete"]().then(function(){})}g.deleteGroupFollowUpLowLevel=a}),98);
__d("WADeleteGroupFollowUpLowLevelApiV2",["WASignalDB","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(a){return d("WASignalDB").getDb().runInTransaction(["senderKeySessions"],"readwrite",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=(yield b.stores.senderKeySessions.readIndex("groupJid",[a]));return b.stores.senderKeySessions.bulkDelete(c.map(function(a){return a.id}))});return function(a){return c.apply(this,arguments)}}(),d("WASignalDB").signalOp("deleteGroupFollowUpLowLevel"))};g.deleteGroupFollowUpLowLevel=a}),98);
__d("MAWDeleteGroup",["MAWDeleteGroupsApi","Promise","WADeleteGroupFollowUpLowLevelApi","WADeleteGroupFollowUpLowLevelApiV2","WADexieToWormMigration","WALogger","asyncToGeneratorRuntime","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["deleteGroups failed to delete group to a non-existent thread"]);i=function(){return a};return a}function a(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){e=(yield d("MAWDeleteGroupsApi").deleteGroupsFromMAW(e.map(function(b){return{deleter:a,group:b}})));return(h||(h=b("Promise"))).all(e.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(!a.success)d("WALogger").ERROR(i());else{a=a.value;var c=a.deletedGroupId;a=a.deletedMsgIds;yield (h||(h=b("Promise"))).all([d("WADeleteGroupFollowUpLowLevelApi").deleteGroupFollowUpLowLevel(c,a),d("WADexieToWormMigration").isWorm("MAWDeleteGroup")&&d("WADeleteGroupFollowUpLowLevelApiV2").deleteGroupFollowUpLowLevel(c,a)])}});return function(b){return a.apply(this,arguments)}}())).then(c("emptyFunction"))});return j.apply(this,arguments)}g["default"]=a}),98);
__d("MAWRemoveGroupInvitesApi",["MAWDbGroupInviteTxns","MAWIndexedDb","MAWTransactionMode","WALogger","justknobx"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["removeGroupInvites deleted "," record(s) from "," for ",""]);h=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({groupInvites:d("MAWTransactionMode").READWRITE},"removeGroupInvites",function(a){return function(b,e){return d("MAWDbGroupInviteTxns").deleteGroupInvitesByThreadAndInvitedParticipant(a,b,e).then(function(a){d("WALogger").DEV(h(),a,b,e),c("justknobx")._("1162")&&d("MAWIndexedDb").afterTransaction({tag:"DeleteGroupInvite",value:{threadJid:b}})}).then(function(){c("justknobx")._("1162")&&d("MAWIndexedDb").afterTransaction({tag:"GroupInviteLoaded",value:{actorId:e,threadJid:b}})})}});g.removeGroupInvites=a}),98);
__d("MAWUpdateGroupSubjectApi",["MAWAdminMsgHelpers","MAWRunInTransaction","WAJids","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return h.apply(void 0,[a].concat(b))},"updateGroupSubject")};var h=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=a.GroupInfoStore;a=a.MessagesStore;var f=(yield e.get(b));if(!f.success)return d("WAResultOrError").makeError("missing_group");f=f.value;if(f.subject.ts!=null&&(c.ts==null||f.subject.ts>c.ts))return d("WAResultOrError").makeResult();yield e.update(b,function(a){return babelHelpers["extends"]({},a,{subject:c})});e=(yield e.get(f.jid));if(!e.success)return d("WAResultOrError").makeError("missing_group");f=e.value;e=f.subject.user;f=d("MAWAdminMsgHelpers").createGroupNameChangeAdminMsg(b,f,e!=null?d("WAJids").userIdFromJid(e):void 0,(b=c.ts)!=null?b:d("WATimeUtils").unixTime());f!=null&&(yield a.create(f));return d("WAResultOrError").makeResult()});return function(b,c,d){return a.apply(this,arguments)}}();g.updateGroupSubject=a;g.updateGroupSubjectTransactor=h}),98);
__d("MAWHandleGroupNotifications",["MAWAddGroupParticipantsApi","MAWChangeGroupMemberAddModeApi","MAWChangeGroupParticipantAdminStatusApi","MAWDeleteGroup","MAWRemoveGroupInvitesApi","MAWRemoveGroupParticipantsApi","MAWUpdateGroupSubjectApi","Promise","WAAPI","WACreateGroup","WAGlobals","WAResultOrError","asyncToGeneratorRuntime","emptyFunction","err","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a=a.notification;switch(a.type){case"join":return i(a).then(function(){return d("WAResultOrError").makeResult()});case"add":return k(a);case"remove":return l(a);case"promote":return n(a);case"demote":return m(a);case"delete":var e=a.groupJid,f=a.participant;if(f==null)throw c("err")("Group delete notification without deleter JID: "+e);return c("MAWDeleteGroup")(f,[e]).then(function(){return d("WAResultOrError").makeResult()});case"subject":return o(a).then(function(){return d("WAResultOrError").makeResult()});case"memberAddMode":return p(a);default:a.type;return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())}}function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.isE2EEMigration)return;var b=a.group,e=a.isNew,f=a.key,g=a.serverTs;yield d("WACreateGroup").createGroups([{extras:f!=null?{deduplicationKey:f,platform:"msgr"}:null,folder:null,groupStatus:e?"new":"added",groupToCreate:b,key:f,serverTs:g}]);e=a.group.participants.map(function(a){if(a.success)return a.value.user;else return a.error.user});var h=d("WAGlobals").getMyUserJid();f=c("justknobx")._("1162");f&&e.find(function(a){return a===h})&&(yield d("MAWRemoveGroupInvitesApi").removeGroupInvites(b.jid,h));yield c("WAAPI").getDevices({ignoreDhash:!1,reason:"added-to-group",users:new Set(e)})});return j.apply(this,arguments)}function k(a){var b=a.groupJid,e=a.participant,f=a.participants,g=a.previousVersionId,h=a.reason,i=a.serverTs;a=a.versionId;if(e==null)throw c("err")("Group add participant notification without adder JID: "+b);return d("MAWAddGroupParticipantsApi").addGroupParticipants({current:a,previous:g},b,e,f,!1,h,i)}function l(a){var b=a.groupJid,e=a.participant,f=a.participants,g=a.previousVersionId,h=a.serverTs;a=a.versionId;if(e==null)throw c("err")("Group remove participant notification without remover JID: "+b);var i=null;a!=null&&(i={current:a,previous:g});return d("MAWRemoveGroupParticipantsApi").removeGroupParticipants(i,b,e,f,!1,h)}function m(a){var b=a.groupJid,c=a.participant,e=a.participants,f=a.previousVersionId,g=a.serverTs;a=a.versionId;return d("MAWChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus({current:a,previous:f},b,c,e,"participant",g)}function n(a){var b=a.groupJid,c=a.participant,e=a.participants,f=a.previousVersionId,g=a.serverTs;a=a.versionId;return d("MAWChangeGroupParticipantAdminStatusApi").changeGroupParticipantAdminStatus({current:a,previous:f},b,c,e,"admin",g)}function o(a){var b=a.groupJid,e=a.participant,f=a.subject;a=a.ts;return d("MAWUpdateGroupSubjectApi").updateGroupSubject(b,{content:f,ts:a,user:e}).then(c("emptyFunction"))}function p(a){var b=a.groupJid,c=a.memberAddMode,e=a.participant;a=a.serverTs;return d("MAWChangeGroupMemberAddModeApi").changeGroupMemberAddMode(b,e,c,a,"create_admin_message")}g.persistGroupNotification=a}),98);
__d("WAParticipant",[],(function(a,b,c,d,e,f){"use strict";function a(a){switch(a){case"admin":case"superadmin":return!0;default:return!1}}f.isGroupAdminParticipantType=a}),66);
__d("WASyncParticipantsApi",["WAResultOrError","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){a=a.ParticipantsStore;var e=(yield a.bulkGetInGroup(b));if(e.success!==!0)return d("WAResultOrError").makeError("missing_participants");if(c.length===0&&e.value.length===0)return d("WAResultOrError").makeResult({removedJids:[],addedJids:[],typeUpdateJids:[]});var f=new Map();e.value.forEach(function(a){f.set(a.user,a)});var g=new Set(c.map(function(a){return a.user})),h=[],i=[],j=[],k=[];f.forEach(function(a,c){g.has(c)||(a.type!=="invitedParticipant"?h.push({userJid:c,groupJid:b}):(k.push({previousType:a.type,newType:a.type,userJid:a.user}),j.push(babelHelpers["extends"]({},a))))});c.forEach(function(a){var b=f.get(a.user);b==null?(i.push(a),a.type==="admin"&&k.push({previousType:"nonparticipant",newType:a.type,userJid:a.user})):(b.type!==a.type&&k.push({previousType:b.type,newType:a.type,userJid:a.user}),j.push(babelHelpers["extends"]({},b,a)))});yield a.bulkPut(i);yield a.bulkPut(j);yield a.bulkDelete(h);return d("WAResultOrError").makeResult({removedJids:h.map(function(a){a=a.userJid;return a}),addedJids:i.map(function(a){return a.user}),typeUpdateJids:k})});return function(b,c,d){return a.apply(this,arguments)}}();g.syncParticipantsTransactor=a}),98);
__d("MAWResetGroupParticipantInfoApi",["MAWAdminMsgHelpers","MAWRunInTransaction","Promise","WAAPI","WALogger","WAParticipant","WAResultOrError","WASyncParticipantsApi","WATimeUtils","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpectedly received an error when sync-ing participants"]);i=function(){return a};return a}a=function(){for(var a=arguments.length,e=new Array(a),f=0;f<a;f++)e[f]=arguments[f];return d("MAWRunInTransaction").runInTransaction({GroupInfoStore:!0,MessagesStore:!0,ParticipantsStore:!0},function(a){return j.apply(void 0,[a].concat(e))},"resetGroupParticipantInfo").then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a.success&&(yield c("WAAPI").setRotateSenderKeyToTrue([e[0]]));return a});return function(b){return a.apply(this,arguments)}}())};var j=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c,e,f){var g=a.GroupInfoStore,j=a.MessagesStore;a=a.ParticipantsStore;e=e.map(function(a){return{addressable:a.addressable,chatJid:c,type:a.type,user:a.user}});a=(yield d("WASyncParticipantsApi").syncParticipantsTransactor({ParticipantsStore:a},c,e));if(f!=null){e=(yield g.update(c,function(a){return babelHelpers["extends"]({},a,{participantVersion:f})}));if(!e.success)return e}if(a.success!==!0){d("WALogger").ERROR(i());return a}g=a.value;e=[];if(g.removedJids.length>0){a=d("MAWAdminMsgHelpers").createParticipantRemoveAdminMsg(c,g.removedJids,null,d("WATimeUtils").unixTime());e.push(j.create(a))}if(g.addedJids.length>0){a=d("MAWAdminMsgHelpers").createParticipantAddAdminMessage(c,g.addedJids,null,d("WATimeUtils").unixTime());e.push(j.create(a))}if(g.typeUpdateJids.length>0)for(a=0;a<g.typeUpdateJids.length;a++){var k=g.typeUpdateJids[a].previousType,l=g.typeUpdateJids[a].newType;k=d("WAParticipant").isGroupAdminParticipantType(k);l=d("WAParticipant").isGroupAdminParticipantType(l);var m=!k&&l;k=k&&!l;if(m){l=d("MAWAdminMsgHelpers").createParticipantPromoteAdminMsg(c,g.typeUpdateJids[a].userJid,null,d("WATimeUtils").unixTime());e.push(j.create(l))}else if(k){m=d("MAWAdminMsgHelpers").createParticipantDemoteAdminMsg(c,g.typeUpdateJids[a].userJid,null,d("WATimeUtils").unixTime());e.push(j.create(m))}}return(h||(h=b("Promise"))).all(e).then(function(){return d("WAResultOrError").makeResult()})});return function(b,c,d,e){return a.apply(this,arguments)}}();g.resetGroupParticipantInfo=a;g.resetGroupParticipantInfoTransactor=j}),98);
__d("MAWProtocolQueueGroupNotification",["MAWHandleGroupNotifications","MAWResetGroupParticipantInfoApi","Promise","WAAPI","WACreateGroup","WALogger","WAQueryGroup","WAResultOrError","WATimeUtils","asyncToGeneratorRuntime","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to create group infos"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to recover missing group info"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[doGroupRecovery] Cannot get a group, as per ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to query groups"]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to query groups"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to get group info"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unexpectedly received a participant with an error"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["[ParticipantRecovery] Cannot get a group, as per ",""]);p=function(){return a};return a}function a(a){var b=a.notification;return d("MAWHandleGroupNotifications").persistGroupNotification(a).then(function(a){return a.success?a:d("WAResultOrError").makeResult({errorResult:a,groupNotification:b})})}function e(a){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=[];yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{var b=(yield d("WAQueryGroup").queryGroup(a,"participant_change_recovery"));if(b.success===!1){var f;d("WALogger").ERROR(p(),b.error);throw c("err")("[ParticipantRecovery] Cannot get a group, as per "+JSON.stringify((f=b.error)!=null?f:null))}f=b.value;b=f.participants.map(function(a){if(a.error){d("WALogger").ERROR(o());return null}return a.value}).filter(Boolean);b=(yield d("MAWResetGroupParticipantInfoApi").resetGroupParticipantInfo(a,b,f.participantVersion));f=b.error;!b.success&&f==="missing_group"&&e.push(a)}catch(a){d("WALogger").DEV(n()).devConsole(a)}});return function(b){return a.apply(this,arguments)}}()));try{c("WAAPI").queryGroups({groups:e,type:"array"})["catch"](function(a){d("WALogger").DEV(m()).devConsole(a)})}catch(a){d("WALogger").DEV(l()).devConsole(a)}});return q.apply(this,arguments)}function f(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=[];yield (h||(h=b("Promise"))).all(a.map(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){try{a=(yield d("WAQueryGroup").queryGroup(a,"interactive"));if(a.success===!1){var b;d("WALogger").ERROR(k(),a.error);throw c("err")("[doGroupRecovery] Cannot get a group, as per "+JSON.stringify((b=a.error)!=null?b:null))}e.push(a.value)}catch(a){d("WALogger").DEV(j()).devConsole(a)}});return function(b){return a.apply(this,arguments)}}()));try{yield d("WACreateGroup").createGroups(e.map(function(a){return{extras:null,folder:null,groupStatus:"queried",groupToCreate:a,key:null,serverTs:d("WATimeUtils").unixTime()}}))}catch(a){d("WALogger").DEV(i()).devConsole(a)}});return r.apply(this,arguments)}g.handleProtocolQueueGroupNotification=a;g.doParticipantRecovery=e;g.doGroupRecovery=f}),98);
__d("MAWHandleConnectedAdminMsgApi",["MAWAdminWriteUsersConnectedMsgTxn","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleConnectedAdminMsg: chat ",""]);h=function(){return a};return a}b=d("MAWIndexedDb").makeMsgrTransactor({ftsBackloggedMessages:(a=d("MAWTransactionMode")).READWRITE,groupInfo:a.READONLY,messages:a.READWRITE,threads:a.READWRITE},"handleConnectedAdminMsg",function(a){return function(b){var c=b.chatJid,e=b.isOtherContactMsplit;b=b.notificationTs;d("WALogger").LOG(h(),c);return d("MAWAdminWriteUsersConnectedMsgTxn").writeUsersConnectedAdminMsg(a,c,e,b)}});g.handleConnectedAdminMsg=b}),98);
__d("MAWUpdateThreadFolderApi",["MAWBridgeTypesCreators","MAWDbThreadTxns","MAWIndexedDb","MAWTransactionMode","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update thread "," folder with folder id ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Update thread ",""]);i=function(){return a};return a}a=d("MAWIndexedDb").makeMsgrTransactor({threads:d("MAWTransactionMode").READWRITE},"updateThreadFolder",function(a){return function(b,c){d("WALogger").LOG(i(),b);return d("MAWDbThreadTxns").getThread(a,b).then(function(b){if(!b.success)return;return d("MAWDbThreadTxns").updateThread(a,babelHelpers["extends"]({},b.value,{folder:c})).then(function(a){d("WALogger").LOG(h(),b.value.jid,c);d("MAWIndexedDb").afterTransaction({tag:"ThreadUpdated",value:d("MAWBridgeTypesCreators").createBridgeUpdatedThread({folder:c,threadJid:b.value.jid})});return})})}});g.updateThreadFolder=a}),98);
__d("MAWProtocolQueueNotification",["MAWBridge","MAWFolderTypes","MAWHandleConnectedAdminMsgApi","MAWODSProxy","MAWProtocolQueueGroupNotification","MAWUpdateThreadFolderApi","Promise","WAJids","WALogger","WAOdsEnums","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") unknown thread action, jid: ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") connected, jid: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleThreadNotification (",") with folder id ",", jid: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received unsupported notification type: ",""]);l=function(){return a};return a}function m(a){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var e=a.stanzaId;a=a.notification;var f=a.actions,g=a.chatJid,l=a.ts,m=d("WAJids").interpretAsUserJid(g),n=(yield d("MAWBridge").getBridge().sendAndReceive("event","getLSDBUsersIsMsplit",{users:[m].filter(Boolean)}));return(h||(h=b("Promise"))).all(f.map(function(a){switch(a.type){case"folder":var c;c=(c=a.folderId)!=null?c:d("MAWFolderTypes").FOLDER_ID.INBOX;d("WALogger").LOG(k(),e,c,g);return d("MAWUpdateThreadFolderApi").updateThreadFolder(g,c);case"connected":d("WALogger").LOG(j(),e,g);c=m!=null&&n.get(m)===!0;return d("MAWHandleConnectedAdminMsgApi").handleConnectedAdminMsg({chatJid:g,isOtherContactMsplit:c,notificationTs:l});default:a.type;d("WALogger").ERROR(i(),e,g);return(h||(h=b("Promise"))).reject("Handle thread notification: unknown thread action")}})).then(c("emptyFunction"))});return n.apply(this,arguments)}function a(a){return(h||(h=b("Promise"))).all(a.map(function(a){a=a.notification;a=o(a);return a})).then(function(b){var c={groupRecoveries:[],participantRecoveries:[]},d=[];b.map(function(b,e){if(b.success===!0){d.push(a[e].stanzaQueueId);if(b.value!=null){e=b.value;e.type==="group"&&c.groupRecoveries.push(e.data.groupNotification.groupJid)}}});return{followUpParams:c,toAck:d}})}function o(a){switch(a.type){case"group":d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.WA_PROTOCOL_QUEUE_NOTIFICATION,key:a.type+"."+a.notification.type});return d("MAWProtocolQueueGroupNotification").handleProtocolQueueGroupNotification(a).then(function(a){return a.value?d("WAResultOrError").makeResult({data:a.value,type:"group"}):d("WAResultOrError").makeResult()});case"thread":a.notification.actions.forEach(function(b){d("MAWODSProxy").odsBumpEntityKey({entity:d("WAOdsEnums").Entity.WA_PROTOCOL_QUEUE_NOTIFICATION,key:a.type+"."+b.type})});return m(a).then(function(){return d("WAResultOrError").makeResult()});default:a;d("WATagsLogger").TAGS(["ProtocolQueue"]).ERROR(l(),a.type);return(h||(h=b("Promise"))).resolve(d("WAResultOrError").makeResult())}}g.handleIncomingNotificationStanzas=a}),98);
__d("MAWCOPNotificationsHandler",["MAWCommonScheduler","MAWIsQuotaExceededError","MAWProtocolQueueGroupNotification","MAWProtocolQueueNotification","MAWSharedCOPLogger","WorkerScheduler","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing notifications batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["notification consumer: ",""]);i=function(){return a};return a}function a(a){return j(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];var e=(yield d("MAWProtocolQueueNotification").handleIncomingNotificationStanzas(a));e.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());a=e.followUpParams;var f=a.groupRecoveries,g=a.participantRecoveries;g.length>0&&c("promiseDone")(d("MAWCommonScheduler").mawCommonScheduler().runTask({fn:function(){return d("MAWProtocolQueueGroupNotification").doParticipantRecovery(g)},name:"ParticipantsRecovery",priority:d("WorkerScheduler").BACKGROUND_PRIORITY}));f.length>0&&c("promiseDone")(d("MAWCommonScheduler").mawCommonScheduler().runTask({fn:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWProtocolQueueGroupNotification").doGroupRecovery(f)});function c(){return a.apply(this,arguments)}return c}(),name:"GroupsRecovery",priority:d("WorkerScheduler").BACKGROUND_PRIORITY}));return e.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("MAWSharedProtocolQueueReceipt",["asyncToGeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";function g(a){if(a.receiptType==="appdata")return{params:{externalIds:a.externalIds,receivers:[a.from]},type:"appdata"};var b,c,d=a.chat;switch(a.receiptType){case"user":c=a.externalIds;b=[{device:a.from.author,ts:a.ts}];break;case"group":c=a.externalIds;b=[{device:a.from.author,ts:a.ts}];break;default:a.receiptType;c=[a.externalId];b=a.receivers;break}var e=a.messageAuthor;a=a.type;if(e==="@me"||a==="sender")return{params:{msgs:c.map(function(a){return{author:"@me",chat:d,externalId:a}}),receivers:b,type:a},type:"msg-receipt"};else return{params:{msgs:c.map(function(a){return{author:e,chat:d,externalId:a}}),receivers:b,type:a},type:"not-from-me"}}function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=a.map(function(a){a=g(a.receipt);return a});yield b(c);return{followUpParams:void 0,toAck:a.map(function(a){return a.stanzaQueueId})}});return h.apply(this,arguments)}f.sharedHandleIncomingReceiptStanza=a}),66);
__d("WADbHandlePermitedIdentitiesApi",["MAWTransactionMode","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"handlePermitedIdentitiesPerDevice",function(a){return function(b){var c=Array.from(b.keys());return a.receipts.where("waMsgId").anyOf(c).toArray().then(function(a){return a.map(function(a){var c;c=(c=b.get(a.waMsgId))!=null?c:new Set();for(var c=c,d=Array.isArray(c),e=0,c=d?c:c[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f,g;if(d){if(e>=c.length)break;g=c[e++]}else{e=c.next();if(e.done)break;g=e.value}g=g;(f=a.permittedIdentitiesPerDevice)==null?void 0:f["delete"](g)}return a})}).then(function(b){return a.receipts.bulkPut(b).then(function(){})})}});g.handlePermitedIdentitiesPerDevice=a}),98);
__d("MAWProtocolQueueReceipt",["MAWBulkWriteReceiptsApi","MAWSharedProtocolQueueReceipt","WADbHandlePermitedIdentitiesApi","WAReceiptUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return d("WADbHandlePermitedIdentitiesApi").handlePermitedIdentitiesPerDevice(d("WAReceiptUtils").calculateIdentitiesToDelete(a)).then(function(){return d("MAWSharedProtocolQueueReceipt").sharedHandleIncomingReceiptStanza(a,d("MAWBulkWriteReceiptsApi").bulkWriteReceipts)})}g.handleIncomingReceiptStanza=a}),98);
__d("MAWCOPReceiptsHandler",["MAWIsQuotaExceededError","MAWProtocolQueueReceipt","MAWSharedCOPLogger","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Errors occurred while processing receipts batch, see transactor error reports."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["receipt consumer: ",""]);i=function(){return a};return a}function a(a){return j(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(i(),a);return[]})}function j(a){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];var b=(yield d("MAWProtocolQueueReceipt").handleIncomingReceiptStanza(a));b.toAck.length!==a.length&&c("MAWSharedCOPLogger").WARN(h());return b.toAck});return k.apply(this,arguments)}g["default"]=a}),98);
__d("MAWWriteAppDataRetryApi",["MAWIndexedDb","MAWTransactionMode","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";a=d("MAWIndexedDb").makeMsgrTransactor({appData:d("MAWTransactionMode").READWRITE},"writeAppDataRetry",function(a){return function(b,d,e){return a.appData.get({externalId:b}).then(function(b){if(b==null)return;var f=b.permittedIdentitiesPerDevice,g=f.get(d);if(g==null)return;g.baseKey=e;f.set(d,g);return a.appData.update(b.appDataId,{permittedIdentitiesPerDevice:f}).then(c("emptyFunction"))})}});g.writeAppDataRetry=a}),98);
__d("WAMarkParticipantNeedsKeyApi",["MAWTransactionMode","WADbPersonalSenderKeyStatusTxns","WADbTransactor"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({personalSenderKeyStatuses:d("MAWTransactionMode").READWRITE},"markParticipantNeedsKey",function(a){return function(b,c){return d("WADbPersonalSenderKeyStatusTxns").removeDevicesToMultiplePersonalSenderKeyStatuses(a,[b],[c]).then(function(){})}});g.markParticipantNeedsKey=a}),98);
__d("WASendAppDataIndividualProtocol",["WAAsMessageApplication","WAConvertAppData","WAEncUserMsg","WAErrorMessage","WAGetCurrentUserDeviceInfoApi","WAGlobals","WAMsgApplication.pb","WAResultOrError","WASmaxAppdataPublishPeerRPC","WATagsLogger","WATimeUtils","asyncToGeneratorRuntime","encodeProtobuf"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata. Error: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch current device public identity key"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["MAWSendAppData Failed to encrypt appdata"]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Sending appdata, externalId: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata retry to device with error: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Failed to send appdata to device with error: ",""]);m=function(){return a};return a}var n=d("WATagsLogger").TAGS(["sendAppDataIndividual"]);function a(a,b,c,e,f){return o(a,b,c,void 0,e,f)["catch"](function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);n.ERROR(m(),a);return d("WAResultOrError").makeError("runtime-error")})}function c(a,b,c,e,f,g){return o(a,b,c,e,f,g)["catch"](function(a){a=d("WAErrorMessage").maybeGetMessageFromError(a);n.ERROR(l(),a);return d("WAResultOrError").makeError("runtime-error")})}function o(a,b,c,d,e,f){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f,g){n.LOG(k(),b);a=d("WAConvertAppData").convertAppData(a);var l={bytes:d("WAAsMessageApplication").castToMessageApplicationBytes(d("encodeProtobuf").encodeProtobuf(d("WAMsgApplication.pb").MessageApplicationSpec,a).readByteArray()),version:"v3"};a=(yield d("WAGlobals").getWaOneQueue().enqueue(function(a){a=a.cryptoManager;return d("WAEncUserMsg").encryptDeviceJidMessage(c,{messageBytes:l,type:"appdata"},{cryptoManager:a},void 0,g,f)},{operationType:"encrypt",flush:!0}));if(a==null){n.LOG(j());return d("WAResultOrError").makeError("encrypt-failure")}var m;e!=null&&(m={appdataT:d("WATimeUtils").unixTime(),encRetryMixinArgs:{encCount:e}});e={appdataTo:c,encVersionFutureproofMixinArgs:{encV:parseInt(a.v,10)},encTypeIndividualMixinArgs:{encType:a.type,encElementValue:a.ciphertext},retryMixinArgs:m};e={peerPeerSingle:e};var o=void 0;if(a.type==="pkmsg"){var p=(yield d("WAGetCurrentUserDeviceInfoApi").getCurrentUserDeviceInfo());p=p==null?void 0:p.identityKey;if(p==null){n.ERROR(i());return d("WAResultOrError").makeError("no-public-identity")}o={deviceIdentityElementValue:p}}p={appdataId:b,peerPeerFanoutOrPeerSingleMixinGroupArgs:e,deviceIdentityMixinArgs:o};b=(yield d("WASmaxAppdataPublishPeerRPC").sendPeerRPC(p));switch(b.name){case"PeerResponseSuccess":return d("WAResultOrError").makeResult({baseKey:a.baseKey});default:b.name;n.ERROR(h(),b.value.error);return d("WAResultOrError").makeError("ack-failure")}});return p.apply(this,arguments)}g.sendAppDataToIndividualDeviceProtocol=a;g.sendAppDataRetryToIndividualDeviceProtocol=c}),98);
__d("WAWriteMsgRetryApi",["MAWTransactionMode","WADbTransactor","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"writeMsgRetry",function(a){return function(b,c,e){return h(a,d("WAMsg").craftWAMsgIdString({author:b.author,chat:b.chat,externalId:b.externalId}),c,e)}});function h(a,b,c,d){return a.receipts.get({waMsgId:b}).then(function(b){if(b==null||b.permittedIdentitiesPerDevice==null)return;var e=b.permittedIdentitiesPerDevice,f=e.get(c);if(f==null)return;f.baseKey=d;e.set(c,f);return a.receipts.put(babelHelpers["extends"]({},b,{permittedIdentitiesPerDevice:e})).then(function(){})})}g.writeMsgRetry=a}),98);
__d("WAWriteMsgRetryCountApi",["MAWTransactionMode","WADbTransactor","WAMsg"],(function(a,b,c,d,e,f,g){"use strict";a=d("WADbTransactor").makeSignalTransactor({receipts:d("MAWTransactionMode").READWRITE},"writeMsgRetryCount",function(a){return function(b,c,e){return h(a,d("WAMsg").craftWAMsgIdString({author:b.author,chat:b.chat,externalId:b.externalId}),c,e)}});function h(a,b,c,d){return a.receipts.get({waMsgId:b}).then(function(b){var e;if(b==null||d==null)return;e=(e=b.retryCountsPerDevice)!=null?e:new Map();e.set(c,d);return a.receipts.put(babelHelpers["extends"]({},b,{retryCountsPerDevice:e})).then(function(){})})}g.writeMsgRetryCount=a}),98);
__d("MAWSharedHandleRetryRequest",["MAWBulkGetAppDataForRetryApi","MAWConstants","MAWDebugMsg","MAWWriteAppDataRetryApi","Promise","WACryptoManagerUtils","WACryptoUtils","WAGenReportingMeta","WAGlobals","WAJids","WALoadReceiptApi","WALogger","WAMarkParticipantNeedsKeyApi","WAQPLProxy","WASendAppDataIndividualProtocol","WASendMsgInternal","WASentBytesCache","WAWap","WAWriteMsgRetryApi","WAWriteMsgRetryCountApi","asyncToGeneratorRuntime","gkx","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied because receipt is null"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied because (messageId, deviceJID, retryCount) is already executed for retryCount ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied with type ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied with type "," id: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkHandleRetryRequest unexpected receipt"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["bulkHandleRetryRequest called for ",""]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Unknown receipt categories: ",""]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["handleRetryRequest denied due to retry count"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Received retry request from peer without recipient set"]);q=function(){return a};return a}function r(){var a=0,b=0,c=new Map();return{getMetrics:function(){var d;return{appDataMissing:(d=c.get("appDatamissing"))!=null?d:0,appDataUnauthorized:(d=c.get("appDataunauthorized"))!=null?d:0,appDataUnsupported:(d=c.get("appDataunsupported"))!=null?d:0,msgMissing:(d=c.get("msgmissing"))!=null?d:0,msgUnauthorized:(d=c.get("msgunauthorized"))!=null?d:0,msgUnsupported:(d=c.get("msgunsupported"))!=null?d:0,receiptFailures:b,receiptSuccesses:a}},markError:function(){return b++},markSuccess:function(){return a++},setError:function(a){var b=c.get(a);b!=null?c.set(a,b+1):c.set(a,1)}}}function s(a,b){return b+"_"+a}function a(a){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];d("WALogger").LOG(n(),a.map(function(a){a=a.externalId;return a}).join(","));var e=d("WAQPLProxy").waQPLProxyStart(c("qpl")._(25308942,"164"),{bool:{bulk:!0},"int":{receipts:a.length},string:{origin:self.location.origin}}),f=new Set(a.filter(function(a){return a.category!=null&&!C(a)||D(a)}).map(function(a){return a.externalId})),g=a.filter(function(a){return!f.has(a.externalId)&&!C(a)}),i=a.filter(C);i=(yield (h||(h=b("Promise"))).all([u(i),x(g)]));g=i[0];i=i[1];e.addPoint("get_msg_for_retry_complete");var j=[],k=r();for(a of a){var l=g.get(a.externalId),o=i.get(s(a.from.author,a.externalId));f.has(a.externalId)?(e.addPoint("just_ack"),k.markError(),k.setError("just_ack"),E(a)):l!=null?(e.addPoint("app_data_for_retry"),yield F(a,l,e,!1,k),e.addPoint("app_data_for_retry_complete")):o!=null?(e.addPoint("msg_for_retry"),yield H(a,o,e,!1,k),e.addPoint("msg_for_retry_complete")):(d("WALogger").ERROR(m()),k.markError(),k.setError("unexpected_receipt"));j.push(B(a))}e.endSuccess({"int":babelHelpers["extends"]({},k.getMetrics())});return j});return t.apply(this,arguments)}function u(a){return v.apply(this,arguments)}function v(){v=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return new Map();var b=a.map(function(a){var b=a.externalId;a=a.from;return{deviceJid:a.author,externalId:b}});b=(yield d("MAWBulkGetAppDataForRetryApi").bulkGetAppDataForRetry(b));return new Map(b.map(function(b,c){c=a[c];return[c.externalId,b]}))});return v.apply(this,arguments)}function w(a){return a.map(function(a){var b=a.externalId,c=a.from,e=a.recipient,f=c.chat;if(c.type==="device"&&d("WAJids").extractUserJid(c.author)===d("WAJids").extractUserJid(d("WAGlobals").getMyDeviceJid())){if(e==null){d("WALogger").ERROR(q());return}f=e}e={author:"@me",chat:f,externalId:b};return{deviceJid:c.author,protocolMsgId:e,retryCount:a.retryCount}})}function x(a){return y.apply(this,arguments)}function y(){y=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return new Map();var b=w(a),c=a.filter(function(a,c){return b[c]!=null}),e=b.filter(Boolean);a=(yield d("WASentBytesCache").sentBytesCache().getMsgsForRetry(e));a=new Map(a.map(function(a,b){return[s(e[b].deviceJid,c[b].externalId),{msgForRetry:a,retryRequest:e[b]}]}));return a});return y.apply(this,arguments)}function z(a,b){return A.apply(this,arguments)}function A(){A=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var c=void 0,e=(yield d("WAGlobals").getWaOneQueue().enqueue(function(b){b=b.cryptoManager;return d("WACryptoManagerUtils").getParticipantInfo(a.from.author,b)},{flush:!1,operationType:"get_participant_info"}));if(a.keys!=null){var f=a.keys,g=a.timestamp;b={baseKey:b.baseKey,keys:f,timestamp:g};f=J(a,e);f?c={session:b,type:"compareTSAndUseSession"}:c={session:b,type:"useSession"}}else{g=e==null||a.regId!==e.regId;g&&(c={type:"requestNewSession"})}return c});return A.apply(this,arguments)}function B(a){var b,c=a.externalId;a=a.from;return(b=d("WAWap")).wap("ack",{"class":"receipt",id:b.CUSTOM_STRING(c),participant:b.PARTICIPANT_JID(a),to:b.TO_JID(a),type:"retry"})}function C(a){a=a.category;return a==="peer_appdata"||a==="peer"}function D(a){a=a.retryCount;return a>=d("MAWConstants").MESSAGE_RETRY_COUNT_LIMIT}function E(a){if(D(a)){d("WALogger").LOG(p());return}if(a.category!=null){d("WALogger").WARN(o(),a.category);return}}function F(a,b,c,d,e){return G.apply(this,arguments)}function G(){G=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c,e,f){e===void 0&&(e=!0);var g=a.externalId,h=a.from,i=a.retryCount;c.addPoint("get_app_data_for_retry");if(b.type!=="unacked"){d("WALogger").LOG(l(),b.type,g);e?c.endFail(b.type):c.addPoint(b.type);f==null?void 0:f.markError();f==null?void 0:f.setError("appData"+b.type);return}e=b.appData;b=b.deviceIdentity;a=(yield z(a,b));c.addPoint("get_session_info");e=(yield d("WASendAppDataIndividualProtocol").sendAppDataRetryToIndividualDeviceProtocol(e,g,h.author,i,b.pubKey,a));c.addPoint("send_app_data");if(i>=2&&e.success===!0&&e.value.baseKey!=null){b=e.value.baseKey;yield d("MAWWriteAppDataRetryApi").writeAppDataRetry(g,h.author,b)}f==null?void 0:f.markSuccess();return e});return G.apply(this,arguments)}function H(a,b,c,d,e){return I.apply(this,arguments)}function I(){I=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g){var h;f===void 0&&(f=!0);var l=b.msgForRetry;b=b.retryRequest;var m=a.externalId,n=a.from,o=a.retryCount,p=b.protocolMsgId.chat;if(l.type!=="unacked"){f&&e.endFail(l.type);d("WALogger").LOG(k(),l.type);g==null?void 0:g.markError();g==null?void 0:g.setError("msg"+l.type);return}if(l.retryCount!=null&&l.retryCount>0&&l.retryCount===o){f&&e.endFail("unauthorized");d("WALogger").LOG(j(),o);g==null?void 0:g.markError();g==null?void 0:g.setError("msgunauthorized");return}n.type==="group"&&(yield d("WAMarkParticipantNeedsKeyApi").markParticipantNeedsKey(n.chat,n.author),e.addPoint("mark_participant_needs_key_complete"));var q=l.backupDirective,r=l.frankingKey,s=l.frankingVersion,t=l.isInstamadillo,u=l.messageBytes,v=l.messageType,w=l.protocolMsgId,x=(yield d("WALoadReceiptApi").loadReceipt({author:w.author,chat:w.chat,externalId:w.externalId}).then(function(a){return a.success?a.value:null}));h=x==null?void 0:(h=x.permittedIdentitiesPerDevice)==null?void 0:h.get(b.deviceJid);if(x==null||h==null){f&&e.endFail("unauthorized");d("WALogger").LOG(i());g==null?void 0:g.markError();g==null?void 0:g.setError("msgunauthorized");return}x=(yield z(a,h));e.addPoint("get_session_info_complete");c("gkx")("24021")&&(yield d("MAWDebugMsg").writeDebugMsg(p,"Handling retry request for message: "+l.protocolMsgId.externalId.toString()+" to user "+n.author));f=(yield d("WAGenReportingMeta").genReportingMeta(u.bytes,r,s));a=(yield d("WASendMsgInternal").sendMessage({backupDirective:q,chat:p,count:o,deviceIdentity:null,externalId:m,identityKey:h.pubKey,messageBytes:u,messageType:v,protocolMsgId:w,reportingMeta:f,sessionInfo:x,to:n.author,type:"direct"},e,t));e.addPoint("send_message_complete");if(o>=2&&a.success&&a.value.baseKey!=null){l=a.value.baseKey;yield d("WAWriteMsgRetryApi").writeMsgRetry(b.protocolMsgId,n.author,l)}o>=1&&a.success&&(yield d("WAWriteMsgRetryCountApi").writeMsgRetryCount(b.protocolMsgId,n.author,o));g==null?void 0:g.markSuccess()});return I.apply(this,arguments)}function J(a,b){if(a.offline==null)return!1;var c=b==null||a.regId!==b.regId;b=b!=null&&a.keys!=null&&!d("WACryptoUtils").uint8ArraysEqual(b.pubKey,a.keys.identity);return c||b}g.bulkHandleRetryRequest=a}),98);
__d("MAWCOPRetryHandler",["MAWIsQuotaExceededError","MAWSharedCOPLogger","MAWSharedHandleRetryRequest","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["receipt consumer: ",""]);h=function(){return a};return a}function a(a){return i(a)["catch"](function(a){if(d("MAWIsQuotaExceededError").isQuotaExceededError(a))throw a;c("MAWSharedCOPLogger").ERROR(h(),a);return[]})}function i(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(a.length===0)return[];yield d("MAWSharedHandleRetryRequest").bulkHandleRetryRequest(a.map(function(a){return a.retry}));return a.map(function(a){return a.stanzaQueueId})});return j.apply(this,arguments)}g["default"]=a}),98);
__d("MAWSplitProtocolEntityByType",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b={appdatas:[],instructions:[],messages:[],notifications:[],receipts:[],retries:[]};a.forEach(function(a){switch(a.type){case"message":b.messages.push(a);return;case"retryReceipt":b.retries.push(a);return;case"appdata":b.appdatas.push(a);return;case"notification":b.notifications.push(a);return;case"receipt":b.receipts.push(a);return;default:a;b.instructions.push(a);return}});return b}f["default"]=a}),66);
__d("MAWProtocolQueueProcess",["MAWCOPAppdataHandler","MAWCOPInstructionsHandler","MAWCOPMessagesHandler","MAWCOPNotificationsHandler","MAWCOPReceiptsHandler","MAWCOPRetryHandler","MAWSharedCOPLogger","MAWSplitProtocolEntityByType","Promise","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["New COP handler for "," msgs, "," appdatas, "," notifications, "," receipts, "," retries, "," instructions"]);i=function(){return a};return a}function a(a){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a=c("MAWSplitProtocolEntityByType")(a);c("MAWSharedCOPLogger").LOG(i(),a.messages.length,a.appdatas.length,a.notifications.length,a.receipts.length,a.retries.length,a.instructions.length);a=(yield (h||(h=b("Promise"))).all([c("MAWCOPMessagesHandler")(a.messages),c("MAWCOPInstructionsHandler")(a.instructions),c("MAWCOPReceiptsHandler")(a.receipts),c("MAWCOPAppdataHandler")(a.appdatas),c("MAWCOPNotificationsHandler")(a.notifications),c("MAWCOPRetryHandler")(a.retries)])).flat();return a});return j.apply(this,arguments)}g.processProtocolQueueEntries=a}),98);
__d("SharedWorkerBootstrap",["CurrentSharedWorker","CurrentSharedWorkerAdapter"],(function(a,b,c,d,e,f,g){"use strict";function a(a){h(function(){return b.call(null,a)})}function c(a){h(function(){return a})}function h(a){d("CurrentSharedWorker").onInitComplete(function(){var b=a();if(typeof b==="function"||b!==null)try{b(new(d("CurrentSharedWorkerAdapter").CurrentSharedWorkerAdapter)())}catch(a){}})}g.start=a;g.startServerJS=c}),98);
__d("SharedOrWebWorkerBootstrapInit",["SharedWorkerBootstrap","WorkerBootstrap"],(function(a,b,c,d,e,f){"use strict";function a(a){"SharedWorkerGlobalScope"in self&&self instanceof self.SharedWorkerGlobalScope?b("SharedWorkerBootstrap").startServerJS(a):b("WorkerBootstrap").startServerJS(a)}f.startServerJS=a}),66);